<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <title>Execution Trace Diff</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <style>
* {
  box-sizing: border-box;
}

/* Create two equal columns that floats next to each other */
.column {
  float: left;
  width: 50%;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

.test {
    border: 1px solid darkblue;
    padding-left: 10px;
}
</style> 
 </head> 
 <body> 
  <div class="row test"> 
   <h2>Differencing Test:</h2> <code> <pre>@Test <br>
public void test_main(){ <br>
    String ret = NumberAnalyzer.analyze(1); <br>
    assertThat(ret, containsString("greater")); <br>
}
        </pre> </code> 
  </div> 
  <div class="row"> 
   <div class="column"> 
    <h2>Original Code:</h2> <code> <pre id="original-trace">           1:  <span style="background-color: white">      /*</span><br>           2:  <span style="background-color: white">       * Copyright (c) 2006 Wisconsin Court System</span><br>           3:  <span style="background-color: white">       *</span><br>           4:  <span style="background-color: white">       * This program is free software; you can redistribute it and/or</span><br>           5:  <span style="background-color: white">       * modify it under the terms of the GNU Lesser General Public License</span><br>           6:  <span style="background-color: white">       * as published by the Free Software Foundation; either version 2.1</span><br>           7:  <span style="background-color: white">       * of the License, or (at your option) any later version.</span><br>           8:  <span style="background-color: white">       *</span><br>           9:  <span style="background-color: white">       * This program is distributed in the hope that it will be useful,</span><br>          10:  <span style="background-color: white">       * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br>          11:  <span style="background-color: white">       * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><br>          12:  <span style="background-color: white">       * GNU Lesser General Public License for more details.</span><br>          13:  <span style="background-color: white">       *</span><br>          14:  <span style="background-color: white">       * You should have received a copy of the GNU Lesser General Public License</span><br>          15:  <span style="background-color: white">       * along with this program; if not, write to the Free Software</span><br>          16:  <span style="background-color: white">       * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span><br>          17:  <span style="background-color: white">       *</span><br>          18:  <span style="background-color: white">       */</span><br>          19:  <span style="background-color: white">      package com.openhtmltopdf.render;</span><br>          20:  <span style="background-color: white">      </span><br>          21:  <span style="background-color: white">      import java.text.BreakIterator;</span><br>          22:  <span style="background-color: white">      </span><br>          23:  <span style="background-color: white">      import org.w3c.dom.Element;</span><br>          24:  <span style="background-color: white">      import com.openhtmltopdf.bidi.BidiSplitter;</span><br>          25:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.CSSName;</span><br>          26:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.IdentValue;</span><br>          27:  <span style="background-color: white">      import com.openhtmltopdf.css.extend.ContentFunction;</span><br>          28:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSFunction;</span><br>          29:  <span style="background-color: white">      import com.openhtmltopdf.css.style.CalculatedStyle;</span><br>          30:  <span style="background-color: white">      import com.openhtmltopdf.extend.FSTextBreaker;</span><br>          31:  <span style="background-color: white">      import com.openhtmltopdf.layout.Breaker;</span><br>          32:  <span style="background-color: white">      import com.openhtmltopdf.layout.LayoutContext;</span><br>          33:  <span style="background-color: white">      import com.openhtmltopdf.layout.Styleable;</span><br>          34:  <span style="background-color: white">      import com.openhtmltopdf.layout.TextUtil;</span><br>          35:  <span style="background-color: white">      import com.openhtmltopdf.layout.WhitespaceStripper;</span><br>          36:  <span style="background-color: white">      </span><br>          37:  <span style="background-color: white">      /**</span><br>          38:  <span style="background-color: white">       * A class which represents a portion of an inline element. If an inline element</span><br>          39:  <span style="background-color: white">       * does not contain any nested elements, then a single <code>InlineBox</code></span><br>          40:  <span style="background-color: white">       * object will contain the content for the entire element. Otherwise multiple</span><br>          41:  <span style="background-color: white">       * <code>InlineBox</code> objects will be created corresponding to each</span><br>          42:  <span style="background-color: white">       * discrete chunk of text appearing in the element. It is not rendered directly</span><br>          43:  <span style="background-color: white">       * (and hence does not extend from {@link Box}), but does play an important</span><br>          44:  <span style="background-color: white">       * role in layout (for example, when calculating min/max widths). Note that it</span><br>          45:  <span style="background-color: white">       * does not contain children. Inline content is stored as a flat list in the</span><br>          46:  <span style="background-color: white">       * layout tree. However, <code>InlineBox</code> does contain enough</span><br>          47:  <span style="background-color: white">       * information to reconstruct the original element nesting and this is, in fact,</span><br>          48:  <span style="background-color: white">       * done during inline layout.</span><br>          49:  <span style="background-color: white">       *</span><br>          50:  <span style="background-color: white">       * @see InlineLayoutBox</span><br>          51:  <span style="background-color: white">       */</span><br>          52:  <span style="background-color: white">      public class InlineBox implements Styleable {</span><br>          53:  <span style="background-color: white">          private Element _element;</span><br>          54:  <span style="background-color: white">      </span><br>          55:  <span style="background-color: white">          private String _originalText;</span><br>          56:  <span style="background-color: white">          private String _text;</span><br>          57:  <span style="background-color: white">          private boolean _removableWhitespace;</span><br>          58:  <span style="background-color: white">          </span><br>          59:  <span style="background-color: white">          /**</span><br>          60:  <span style="background-color: white">           * See {@link #isStartsHere()}</span><br>          61:  <span style="background-color: white">           */</span><br>          62:  <span style="background-color: white">          private boolean _startsHere;</span><br>          63:  <span style="background-color: white">          </span><br>          64:  <span style="background-color: white">          /**</span><br>          65:  <span style="background-color: white">           * See {@link #isEndsHere()}</span><br>          66:  <span style="background-color: white">           */</span><br>          67:  <span style="background-color: white">          private boolean _endsHere;</span><br>          68:  <span style="background-color: white">      </span><br>          69:  <span style="background-color: white">          private CalculatedStyle _style;</span><br>          70:  <span style="background-color: white">      </span><br>          71:  <span style="background-color: white">          private ContentFunction _contentFunction;</span><br>          72:  <span style="background-color: white">          private FSFunction _function;</span><br>          73:  <span style="background-color: white">      </span><br>          74:  <span style="background-color: white">          private boolean _minMaxCalculated;</span><br>          75:  <span style="background-color: white">          private int _maxWidth;</span><br>          76:  <span style="background-color: white">          private int _minWidth;</span><br>          77:  <span style="background-color: white">      </span><br>          78:  <span style="background-color: white">          private int _firstLineWidth;</span><br>          79:  <span style="background-color: white">      </span><br>          80:  <span style="background-color: white">          private String _pseudoElementOrClass;</span><br>          81:  <span style="background-color: white">      </span><br>          82:  <span style="background-color: red">          public InlineBox(String text) {</span><br>          83:  <span style="background-color: red">              _text = text;</span><br>          84:  <span style="background-color: red">              _originalText = text;</span><br>          85:  <span style="background-color: white">          }</span><br>          86:  <span style="background-color: white">      </span><br>          87:  <span style="background-color: white">          private byte _textDirection;</span><br>          88:  <span style="background-color: white">          </span><br>          89:  <span style="background-color: white">          /**</span><br>          90:  <span style="background-color: white">           * @param direction either LTR or RTL from {@link BidiSplitter} interface.</span><br>          91:  <span style="background-color: white">           */</span><br>          92:  <span style="background-color: red">          public void setTextDirection(byte direction) {</span><br>          93:  <span style="background-color: red">          	this._textDirection = direction;</span><br>          94:  <span style="background-color: white">          }</span><br>          95:  <span style="background-color: white">          </span><br>          96:  <span style="background-color: white">          /**</span><br>          97:  <span style="background-color: white">           * @return either LTR or RTL from {@link BidiSplitter} interface.</span><br>          98:  <span style="background-color: white">           */</span><br>          99:  <span style="background-color: red">          public byte getTextDirection() {</span><br>         100:  <span style="background-color: white">          	return this._textDirection;</span><br>         101:  <span style="background-color: white">          }</span><br>         102:  <span style="background-color: white">          </span><br>         103:  <span style="background-color: red">          public String getText() {</span><br>         104:  <span style="background-color: white">              return _text;</span><br>         105:  <span style="background-color: white">          }</span><br>         106:  <span style="background-color: white">      </span><br>         107:  <span style="background-color: red">          public void setText(String text) {</span><br>         108:  <span style="background-color: red">              _text = text;</span><br>         109:  <span style="background-color: red">              _originalText = text;</span><br>         110:  <span style="background-color: white">          }</span><br>         111:  <span style="background-color: white">      </span><br>         112:  <span style="background-color: red">          public void applyTextTransform() {</span><br>         113:  <span style="background-color: white">              _text = _originalText;</span><br>         114:  <span style="background-color: red">              _text = TextUtil.transformText(_text, getStyle());</span><br>         115:  <span style="background-color: white">          }</span><br>         116:  <span style="background-color: white">      </span><br>         117:  <span style="background-color: red">          public boolean isRemovableWhitespace() {</span><br>         118:  <span style="background-color: white">              return _removableWhitespace;</span><br>         119:  <span style="background-color: white">          }</span><br>         120:  <span style="background-color: white">      </span><br>         121:  <span style="background-color: red">          public void setRemovableWhitespace(boolean removeableWhitespace) {</span><br>         122:  <span style="background-color: red">              _removableWhitespace = removeableWhitespace;</span><br>         123:  <span style="background-color: white">          }</span><br>         124:  <span style="background-color: white">      </span><br>         125:  <span style="background-color: white">          /**</span><br>         126:  <span style="background-color: white">           * The opposite of {@link #isStartsHere()}</span><br>         127:  <span style="background-color: white">           */</span><br>         128:  <span style="background-color: red">          public boolean isEndsHere() {</span><br>         129:  <span style="background-color: white">              return _endsHere;</span><br>         130:  <span style="background-color: white">          }</span><br>         131:  <span style="background-color: white">      </span><br>         132:  <span style="background-color: white">          /**</span><br>         133:  <span style="background-color: white">           * See {@link #isEndsHere()}</span><br>         134:  <span style="background-color: white">           */</span><br>         135:  <span style="background-color: red">          public void setEndsHere(boolean endsHere) {</span><br>         136:  <span style="background-color: red">              _endsHere = endsHere;</span><br>         137:  <span style="background-color: white">          }</span><br>         138:  <span style="background-color: white">      </span><br>         139:  <span style="background-color: white">          /**</span><br>         140:  <span style="background-color: white">           * Whether this is the first InlineBox for a box. For example:</span><br>         141:  <span style="background-color: white">           * </span><br>         142:  <span style="background-color: white">           * <code>[b]one[i]two[/i]three[/b]</code></span><br>         143:  <span style="background-color: white">           * </span><br>         144:  <span style="background-color: white">           * will create three InlineBox objects and one and two will return</span><br>         145:  <span style="background-color: white">           * true for isStartsHere.</span><br>         146:  <span style="background-color: white">           * </span><br>         147:  <span style="background-color: white">           * This is used for example to decide whether left margin needs to be applied.</span><br>         148:  <span style="background-color: white">           */</span><br>         149:  <span style="background-color: red">          public boolean isStartsHere() {</span><br>         150:  <span style="background-color: white">              return _startsHere;</span><br>         151:  <span style="background-color: white">          }</span><br>         152:  <span style="background-color: white">      </span><br>         153:  <span style="background-color: white">          /**</span><br>         154:  <span style="background-color: white">           * See {@link #isStartsHere()}</span><br>         155:  <span style="background-color: white">           */</span><br>         156:  <span style="background-color: red">          public void setStartsHere(boolean startsHere) {</span><br>         157:  <span style="background-color: red">              _startsHere = startsHere;</span><br>         158:  <span style="background-color: white">          }</span><br>         159:  <span style="background-color: white">      </span><br>         160:  <span style="background-color: red">          @Override</span><br>         161:  <span style="background-color: white">          public CalculatedStyle getStyle() {</span><br>         162:  <span style="background-color: white">              return _style;</span><br>         163:  <span style="background-color: white">          }</span><br>         164:  <span style="background-color: white">      </span><br>         165:  <span style="background-color: red">          @Override</span><br>         166:  <span style="background-color: white">          public void setStyle(CalculatedStyle style) {</span><br>         167:  <span style="background-color: red">              _style = style;</span><br>         168:  <span style="background-color: white">          }</span><br>         169:  <span style="background-color: white">      </span><br>         170:  <span style="background-color: red">          @Override</span><br>         171:  <span style="background-color: white">          public Element getElement() {</span><br>         172:  <span style="background-color: white">              return _element;</span><br>         173:  <span style="background-color: white">          }</span><br>         174:  <span style="background-color: white">      </span><br>         175:  <span style="background-color: red">          @Override</span><br>         176:  <span style="background-color: white">          public void setElement(Element element) {</span><br>         177:  <span style="background-color: red">              _element = element;</span><br>         178:  <span style="background-color: white">          }</span><br>         179:  <span style="background-color: white">      </span><br>         180:  <span style="background-color: white">          public ContentFunction getContentFunction() {</span><br>         181:  <span style="background-color: white">              return _contentFunction;</span><br>         182:  <span style="background-color: white">          }</span><br>         183:  <span style="background-color: white">      </span><br>         184:  <span style="background-color: red">          public void setContentFunction(ContentFunction contentFunction) {</span><br>         185:  <span style="background-color: red">              _contentFunction = contentFunction;</span><br>         186:  <span style="background-color: white">          }</span><br>         187:  <span style="background-color: white">      </span><br>         188:  <span style="background-color: red">          public boolean isDynamicFunction() {</span><br>         189:  <span style="background-color: red">              return _contentFunction != null;</span><br>         190:  <span style="background-color: white">          }</span><br>         191:  <span style="background-color: white">      </span><br>         192:  <span style="background-color: red">          private int getTextWidth(LayoutContext c, String s) {</span><br>         193:  <span style="background-color: red">              return c.getTextRenderer().getWidth(</span><br>         194:  <span style="background-color: white">                      c.getFontContext(),</span><br>         195:  <span style="background-color: white">                      c.getFont(getStyle().getFont(c)),</span><br>         196:  <span style="background-color: white">                      s);</span><br>         197:  <span style="background-color: white">          }</span><br>         198:  <span style="background-color: white">      </span><br>         199:  <span style="background-color: white">          private int getMaxCharWidth(LayoutContext c, String s) {</span><br>         200:  <span style="background-color: white">              char[] chars = s.toCharArray();</span><br>         201:  <span style="background-color: white">              int result = 0;</span><br>         202:  <span style="background-color: white">              for (int i = 0; i &lt; chars.length; i++) {</span><br>         203:  <span style="background-color: white">                  int width = getTextWidth(c, Character.toString(chars[i]));</span><br>         204:  <span style="background-color: white">                  if (width &gt; result) {</span><br>         205:  <span style="background-color: white">                      result = width;</span><br>         206:  <span style="background-color: white">                  }</span><br>         207:  <span style="background-color: white">              }</span><br>         208:  <span style="background-color: white">              return result;</span><br>         209:  <span style="background-color: white">          }</span><br>         210:  <span style="background-color: white">      </span><br>         211:  <span style="background-color: red">          private void calcMaxWidthFromLineLength(LayoutContext c, int cbWidth, boolean trim) {</span><br>         212:  <span style="background-color: red">              int last = 0;</span><br>         213:  <span style="background-color: red">              int current = 0;</span><br>         214:  <span style="background-color: white">      </span><br>         215:  <span style="background-color: white">              while ( (current = _text.indexOf(WhitespaceStripper.EOL, last)) != -1) {</span><br>         216:  <span style="background-color: red">                  String target = _text.substring(last, current);</span><br>         217:  <span style="background-color: red">                  if (trim) {</span><br>         218:  <span style="background-color: red">                      target = target.trim();</span><br>         219:  <span style="background-color: white">                  }</span><br>         220:  <span style="background-color: red">                  int length = getTextWidth(c, target);</span><br>         221:  <span style="background-color: red">                  if (last == 0) {</span><br>         222:  <span style="background-color: red">                      length += getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.LEFT);</span><br>         223:  <span style="background-color: white">                  }</span><br>         224:  <span style="background-color: red">                  if (length &gt; _maxWidth) {</span><br>         225:  <span style="background-color: white">                      _maxWidth = length;</span><br>         226:  <span style="background-color: white">                  }</span><br>         227:  <span style="background-color: red">                  if (last == 0) {</span><br>         228:  <span style="background-color: red">                      _firstLineWidth = length;</span><br>         229:  <span style="background-color: white">                  }</span><br>         230:  <span style="background-color: red">                  last = current + 1;</span><br>         231:  <span style="background-color: white">              }</span><br>         232:  <span style="background-color: white">      </span><br>         233:  <span style="background-color: red">              String target = _text.substring(last);</span><br>         234:  <span style="background-color: red">              if (trim) {</span><br>         235:  <span style="background-color: red">                  target = target.trim();</span><br>         236:  <span style="background-color: white">              }</span><br>         237:  <span style="background-color: red">              int length = getTextWidth(c, target);</span><br>         238:  <span style="background-color: red">              length += getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.RIGHT);</span><br>         239:  <span style="background-color: red">              if (length &gt; _maxWidth) {</span><br>         240:  <span style="background-color: white">                  _maxWidth = length;</span><br>         241:  <span style="background-color: white">              }</span><br>         242:  <span style="background-color: red">              if (last == 0) {</span><br>         243:  <span style="background-color: red">                  _firstLineWidth = length;</span><br>         244:  <span style="background-color: white">              }</span><br>         245:  <span style="background-color: white">          }</span><br>         246:  <span style="background-color: white">      </span><br>         247:  <span style="background-color: red">          public int getSpaceWidth(LayoutContext c) {</span><br>         248:  <span style="background-color: red">              return c.getTextRenderer().getWidth(</span><br>         249:  <span style="background-color: white">                      c.getFontContext(),</span><br>         250:  <span style="background-color: white">                      getStyle().getFSFont(c),</span><br>         251:  <span style="background-color: white">                      WhitespaceStripper.SPACE);</span><br>         252:  <span style="background-color: white">      </span><br>         253:  <span style="background-color: white">          }</span><br>         254:  <span style="background-color: white">      </span><br>         255:  <span style="background-color: red">          public int getTrailingSpaceWidth(LayoutContext c) {</span><br>         256:  <span style="background-color: red">              if (_text.length() &gt; 0 &amp;&amp; _text.charAt(_text.length()-1) == ' ') {</span><br>         257:  <span style="background-color: red">                  return getSpaceWidth(c);</span><br>         258:  <span style="background-color: white">              } else {</span><br>         259:  <span style="background-color: red">                  return 0;</span><br>         260:  <span style="background-color: white">              }</span><br>         261:  <span style="background-color: white">          }</span><br>         262:  <span style="background-color: white">      </span><br>         263:  <span style="background-color: red">          private int calcMinWidthFromWordLength(</span><br>         264:  <span style="background-color: white">                  LayoutContext c, int cbWidth, boolean trimLeadingSpace, boolean includeWS) {</span><br>         265:  <span style="background-color: red">              int spaceWidth = -1;</span><br>         266:  <span style="background-color: white">      </span><br>         267:  <span style="background-color: red">              int last = 0;</span><br>         268:  <span style="background-color: red">              int current = 0;</span><br>         269:  <span style="background-color: red">              int maxWidth = 0;</span><br>         270:  <span style="background-color: red">              int spaceCount = 0;</span><br>         271:  <span style="background-color: white">      </span><br>         272:  <span style="background-color: red">              boolean haveFirstWord = false;</span><br>         273:  <span style="background-color: red">              int firstWord = 0;</span><br>         274:  <span style="background-color: red">              int lastWord = 0;</span><br>         275:  <span style="background-color: white">              </span><br>         276:  <span style="background-color: red">              CalculatedStyle style = getStyle();</span><br>         277:  <span style="background-color: red">              float letterSpacing = style.hasLetterSpacing()</span><br>         278:  <span style="background-color: white">                      ? style.getFloatPropertyProportionalWidth(CSSName.LETTER_SPACING, 0, c)</span><br>         279:  <span style="background-color: white">                      : 0f;</span><br>         280:  <span style="background-color: white">      </span><br>         281:  <span style="background-color: red">              String text = getText(trimLeadingSpace);</span><br>         282:  <span style="background-color: red">              FSTextBreaker breakIterator = Breaker.getLineBreakStream(text, c.getSharedContext());</span><br>         283:  <span style="background-color: white">      </span><br>         284:  <span style="background-color: white">              // Breaker should be used</span><br>         285:  <span style="background-color: white">              while ( (current = breakIterator.next()) != BreakIterator.DONE) {</span><br>         286:  <span style="background-color: red">                  String currentWord = text.substring(last, current);</span><br>         287:  <span style="background-color: white">                  </span><br>         288:  <span style="background-color: red">                  if (currentWord.length() &gt; 0 &amp;&amp; currentWord.charAt(currentWord.length() - 1) == Breaker.SOFT_HYPHEN) {</span><br>         289:  <span style="background-color: white">                      currentWord += '-';</span><br>         290:  <span style="background-color: white">                  }</span><br>         291:  <span style="background-color: white">                  </span><br>         292:  <span style="background-color: red">                  int wordWidth = getTextWidth(c, currentWord);</span><br>         293:  <span style="background-color: red">                  int minWordWidth;</span><br>         294:  <span style="background-color: white">                  if (getStyle().getWordWrap() == IdentValue.BREAK_WORD) {</span><br>         295:  <span style="background-color: white">                      minWordWidth = getMaxCharWidth(c, currentWord);</span><br>         296:  <span style="background-color: white">                  } else {</span><br>         297:  <span style="background-color: red">                      minWordWidth = (int) (wordWidth + (letterSpacing * currentWord.length()));</span><br>         298:  <span style="background-color: white">                  }</span><br>         299:  <span style="background-color: white">      </span><br>         300:  <span style="background-color: red">                  if (spaceCount &gt; 0) {</span><br>         301:  <span style="background-color: red">                      if (includeWS) {</span><br>         302:  <span style="background-color: white">                          for (int i = 0; i &lt; spaceCount; i++) {</span><br>         303:  <span style="background-color: white">                              wordWidth += spaceWidth;</span><br>         304:  <span style="background-color: white">                              minWordWidth += spaceWidth;</span><br>         305:  <span style="background-color: white">                          }</span><br>         306:  <span style="background-color: white">                      } else {</span><br>         307:  <span style="background-color: red">                          maxWidth += spaceWidth;</span><br>         308:  <span style="background-color: white">                      }</span><br>         309:  <span style="background-color: red">                      spaceCount = 0;</span><br>         310:  <span style="background-color: white">                  }</span><br>         311:  <span style="background-color: red">                  if (minWordWidth &gt; 0) {</span><br>         312:  <span style="background-color: red">                      if (! haveFirstWord) {</span><br>         313:  <span style="background-color: red">                          firstWord = minWordWidth;</span><br>         314:  <span style="background-color: white">                      }</span><br>         315:  <span style="background-color: red">                      lastWord = minWordWidth;</span><br>         316:  <span style="background-color: white">                  }</span><br>         317:  <span style="background-color: white">      </span><br>         318:  <span style="background-color: red">                  if (minWordWidth &gt; _minWidth) {</span><br>         319:  <span style="background-color: red">                      _minWidth = minWordWidth;</span><br>         320:  <span style="background-color: white">                  }</span><br>         321:  <span style="background-color: red">                  maxWidth += wordWidth;</span><br>         322:  <span style="background-color: white">      </span><br>         323:  <span style="background-color: red">                  last = current;</span><br>         324:  <span style="background-color: red">                  for (int i = current; i &lt; text.length(); i++) {</span><br>         325:  <span style="background-color: red">                      if (text.charAt(i) == ' ') {</span><br>         326:  <span style="background-color: red">                          spaceCount++;</span><br>         327:  <span style="background-color: red">                          last++;</span><br>         328:  <span style="background-color: white">                      } else {</span><br>         329:  <span style="background-color: red">                          break;</span><br>         330:  <span style="background-color: white">                      }</span><br>         331:  <span style="background-color: white">                  }</span><br>         332:  <span style="background-color: red">                  if (spaceCount &gt; 0 &amp;&amp; spaceWidth == -1) {</span><br>         333:  <span style="background-color: red">                      spaceWidth = getSpaceWidth(c);</span><br>         334:  <span style="background-color: white">                  }</span><br>         335:  <span style="background-color: white">              }</span><br>         336:  <span style="background-color: white">      </span><br>         337:  <span style="background-color: red">              String currentWord = text.substring(last);</span><br>         338:  <span style="background-color: red">              int wordWidth = getTextWidth(c, currentWord);</span><br>         339:  <span style="background-color: red">              int minWordWidth;</span><br>         340:  <span style="background-color: white">              if (getStyle().getWordWrap() == IdentValue.BREAK_WORD) {</span><br>         341:  <span style="background-color: white">                  minWordWidth = getMaxCharWidth(c, currentWord);</span><br>         342:  <span style="background-color: white">              } else {</span><br>         343:  <span style="background-color: red">                  minWordWidth = (int) (wordWidth + (letterSpacing * currentWord.length()));</span><br>         344:  <span style="background-color: white">              }</span><br>         345:  <span style="background-color: red">              if (spaceCount &gt; 0) {</span><br>         346:  <span style="background-color: red">                  if (includeWS) {</span><br>         347:  <span style="background-color: white">                      for (int i = 0; i &lt; spaceCount; i++) {</span><br>         348:  <span style="background-color: white">                          wordWidth += spaceWidth;</span><br>         349:  <span style="background-color: white">                          minWordWidth += spaceWidth;</span><br>         350:  <span style="background-color: white">                      }</span><br>         351:  <span style="background-color: white">                  } else {</span><br>         352:  <span style="background-color: red">                      maxWidth += spaceWidth;</span><br>         353:  <span style="background-color: white">                  }</span><br>         354:  <span style="background-color: red">                  spaceCount = 0;</span><br>         355:  <span style="background-color: white">              }</span><br>         356:  <span style="background-color: red">              if (minWordWidth &gt; 0) {</span><br>         357:  <span style="background-color: white">                  if (! haveFirstWord) {</span><br>         358:  <span style="background-color: white">                      firstWord = minWordWidth;</span><br>         359:  <span style="background-color: white">                  }</span><br>         360:  <span style="background-color: white">                  lastWord = minWordWidth;</span><br>         361:  <span style="background-color: white">              }</span><br>         362:  <span style="background-color: red">              if (minWordWidth &gt; _minWidth) {</span><br>         363:  <span style="background-color: white">                  _minWidth = minWordWidth;</span><br>         364:  <span style="background-color: white">              }</span><br>         365:  <span style="background-color: red">              maxWidth += wordWidth;</span><br>         366:  <span style="background-color: white">      </span><br>         367:  <span style="background-color: white">              if (isStartsHere()) {</span><br>         368:  <span style="background-color: red">                  int leftMBP = getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.LEFT);</span><br>         369:  <span style="background-color: red">                  if (firstWord + leftMBP &gt; _minWidth) {</span><br>         370:  <span style="background-color: white">                      _minWidth = firstWord + leftMBP;</span><br>         371:  <span style="background-color: white">                  }</span><br>         372:  <span style="background-color: red">                  maxWidth += leftMBP;</span><br>         373:  <span style="background-color: white">              }</span><br>         374:  <span style="background-color: white">      </span><br>         375:  <span style="background-color: white">              if (isEndsHere()) {</span><br>         376:  <span style="background-color: red">                  int rightMBP = getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.RIGHT);</span><br>         377:  <span style="background-color: red">                  if (lastWord + rightMBP &gt; _minWidth) {</span><br>         378:  <span style="background-color: white">                      _minWidth = lastWord + rightMBP;</span><br>         379:  <span style="background-color: white">                  }</span><br>         380:  <span style="background-color: red">                  maxWidth += rightMBP;</span><br>         381:  <span style="background-color: white">              }</span><br>         382:  <span style="background-color: white">      </span><br>         383:  <span style="background-color: red">              return maxWidth;</span><br>         384:  <span style="background-color: white">          }</span><br>         385:  <span style="background-color: white">      </span><br>         386:  <span style="background-color: red">          private String getText(boolean trimLeadingSpace) {</span><br>         387:  <span style="background-color: red">              if (! trimLeadingSpace) {</span><br>         388:  <span style="background-color: white">                  return getText();</span><br>         389:  <span style="background-color: white">              } else {</span><br>         390:  <span style="background-color: red">                  if (_text.length() &gt; 0 &amp;&amp; _text.charAt(0) == ' ') {</span><br>         391:  <span style="background-color: red">                      return _text.substring(1);</span><br>         392:  <span style="background-color: white">                  } else {</span><br>         393:  <span style="background-color: white">                      return _text;</span><br>         394:  <span style="background-color: white">                  }</span><br>         395:  <span style="background-color: white">              }</span><br>         396:  <span style="background-color: white">          }</span><br>         397:  <span style="background-color: white">      </span><br>         398:  <span style="background-color: red">          private int getInlineMBP(LayoutContext c, int cbWidth) {</span><br>         399:  <span style="background-color: red">              return getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.LEFT) +</span><br>         400:  <span style="background-color: white">                  getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.RIGHT);</span><br>         401:  <span style="background-color: white">          }</span><br>         402:  <span style="background-color: white">      </span><br>         403:  <span style="background-color: red">          public void calcMinMaxWidth(LayoutContext c, int cbWidth, boolean trimLeadingSpace) {</span><br>         404:  <span style="background-color: white">              if (! _minMaxCalculated) {</span><br>         405:  <span style="background-color: red">                  IdentValue whitespace = getStyle().getWhitespace();</span><br>         406:  <span style="background-color: red">                  if (whitespace == IdentValue.NOWRAP) {</span><br>         407:  <span style="background-color: red">                      _minWidth = _maxWidth = getInlineMBP(c, cbWidth) + getTextWidth(c, getText(trimLeadingSpace));</span><br>         408:  <span style="background-color: red">                  } else if (whitespace == IdentValue.PRE) {</span><br>         409:  <span style="background-color: white">                      calcMaxWidthFromLineLength(c, cbWidth, false);</span><br>         410:  <span style="background-color: white">                      _minWidth = _maxWidth;</span><br>         411:  <span style="background-color: red">                  } else if (whitespace == IdentValue.PRE_WRAP) {</span><br>         412:  <span style="background-color: white">                      calcMinWidthFromWordLength(c, cbWidth, false, true);</span><br>         413:  <span style="background-color: white">                      calcMaxWidthFromLineLength(c, cbWidth, false);</span><br>         414:  <span style="background-color: red">                  } else if (whitespace == IdentValue.PRE_LINE) {</span><br>         415:  <span style="background-color: red">                      calcMinWidthFromWordLength(c, cbWidth, trimLeadingSpace, false);</span><br>         416:  <span style="background-color: red">                      calcMaxWidthFromLineLength(c, cbWidth, true);</span><br>         417:  <span style="background-color: white">                  } else /* if (whitespace == IdentValue.NORMAL) */ {</span><br>         418:  <span style="background-color: red">                      _maxWidth = calcMinWidthFromWordLength(c, cbWidth, trimLeadingSpace, false);</span><br>         419:  <span style="background-color: white">                  }</span><br>         420:  <span style="background-color: red">                  _minWidth = Math.min(_maxWidth, _minWidth);</span><br>         421:  <span style="background-color: red">                  _minMaxCalculated = true;</span><br>         422:  <span style="background-color: white">              }</span><br>         423:  <span style="background-color: white">          }</span><br>         424:  <span style="background-color: white">      </span><br>         425:  <span style="background-color: red">          public int getMaxWidth() {</span><br>         426:  <span style="background-color: white">              return _maxWidth;</span><br>         427:  <span style="background-color: white">          }</span><br>         428:  <span style="background-color: white">      </span><br>         429:  <span style="background-color: red">          public int getMinWidth() {</span><br>         430:  <span style="background-color: white">              return _minWidth;</span><br>         431:  <span style="background-color: white">          }</span><br>         432:  <span style="background-color: white">      </span><br>         433:  <span style="background-color: red">          public int getFirstLineWidth() {</span><br>         434:  <span style="background-color: white">              return _firstLineWidth;</span><br>         435:  <span style="background-color: white">          }</span><br>         436:  <span style="background-color: white">      </span><br>         437:  <span style="background-color: white">          @Override</span><br>         438:  <span style="background-color: white">          public String getPseudoElementOrClass() {</span><br>         439:  <span style="background-color: white">              return _pseudoElementOrClass;</span><br>         440:  <span style="background-color: white">          }</span><br>         441:  <span style="background-color: white">      </span><br>         442:  <span style="background-color: red">          public void setPseudoElementOrClass(String pseudoElementOrClass) {</span><br>         443:  <span style="background-color: red">              _pseudoElementOrClass = pseudoElementOrClass;</span><br>         444:  <span style="background-color: white">          }</span><br>         445:  <span style="background-color: white">      </span><br>         446:  <span style="background-color: white">          @Override</span><br>         447:  <span style="background-color: white">          public String toString() {</span><br>         448:  <span style="background-color: white">              StringBuilder result = new StringBuilder();</span><br>         449:  <span style="background-color: white">              result.append("InlineBox: ");</span><br>         450:  <span style="background-color: white">              if (getElement() != null) {</span><br>         451:  <span style="background-color: white">                  result.append("&lt;");</span><br>         452:  <span style="background-color: white">                  result.append(getElement().getNodeName());</span><br>         453:  <span style="background-color: white">                  result.append("&gt; ");</span><br>         454:  <span style="background-color: white">              } else {</span><br>         455:  <span style="background-color: white">                  result.append("(anonymous) ");</span><br>         456:  <span style="background-color: white">              }</span><br>         457:  <span style="background-color: white">              if (getPseudoElementOrClass() != null) {</span><br>         458:  <span style="background-color: white">                  result.append(':');</span><br>         459:  <span style="background-color: white">                  result.append(getPseudoElementOrClass());</span><br>         460:  <span style="background-color: white">                  result.append(' ');</span><br>         461:  <span style="background-color: white">              }</span><br>         462:  <span style="background-color: white">              if (isStartsHere() || isEndsHere()) {</span><br>         463:  <span style="background-color: white">                  result.append("(");</span><br>         464:  <span style="background-color: white">                  if (isStartsHere()) {</span><br>         465:  <span style="background-color: white">                      result.append("S");</span><br>         466:  <span style="background-color: white">                  }</span><br>         467:  <span style="background-color: white">                  if (isEndsHere()) {</span><br>         468:  <span style="background-color: white">                      result.append("E");</span><br>         469:  <span style="background-color: white">                  }</span><br>         470:  <span style="background-color: white">                  result.append(") ");</span><br>         471:  <span style="background-color: white">              }</span><br>         472:  <span style="background-color: white">      </span><br>         473:  <span style="background-color: white">              appendPositioningInfo(result);</span><br>         474:  <span style="background-color: white">      </span><br>         475:  <span style="background-color: white">              result.append("(");</span><br>         476:  <span style="background-color: white">              result.append(shortText());</span><br>         477:  <span style="background-color: white">              result.append(") ");</span><br>         478:  <span style="background-color: white">              return result.toString();</span><br>         479:  <span style="background-color: white">          }</span><br>         480:  <span style="background-color: white">      </span><br>         481:  <span style="background-color: white">          protected void appendPositioningInfo(StringBuilder result) {</span><br>         482:  <span style="background-color: white">              if (getStyle().isRelative()) {</span><br>         483:  <span style="background-color: white">                  result.append("(relative) ");</span><br>         484:  <span style="background-color: white">              }</span><br>         485:  <span style="background-color: white">              if (getStyle().isFixed()) {</span><br>         486:  <span style="background-color: white">                  result.append("(fixed) ");</span><br>         487:  <span style="background-color: white">              }</span><br>         488:  <span style="background-color: white">              if (getStyle().isAbsolute()) {</span><br>         489:  <span style="background-color: white">                  result.append("(absolute) ");</span><br>         490:  <span style="background-color: white">              }</span><br>         491:  <span style="background-color: white">              if (getStyle().isFloated()) {</span><br>         492:  <span style="background-color: white">                  result.append("(floated) ");</span><br>         493:  <span style="background-color: white">              }</span><br>         494:  <span style="background-color: white">          }</span><br>         495:  <span style="background-color: white">      </span><br>         496:  <span style="background-color: white">          private String shortText() {</span><br>         497:  <span style="background-color: white">              if (_text == null) {</span><br>         498:  <span style="background-color: white">                  return null;</span><br>         499:  <span style="background-color: white">              } else {</span><br>         500:  <span style="background-color: white">                  StringBuilder result = new StringBuilder();</span><br>         501:  <span style="background-color: white">                  for (int i = 0; i &lt; _text.length() &amp;&amp; i &lt; 40; i++) {</span><br>         502:  <span style="background-color: white">                      char c = _text.charAt(i);</span><br>         503:  <span style="background-color: white">                      if (c == '\n') {</span><br>         504:  <span style="background-color: white">                          result.append(' ');</span><br>         505:  <span style="background-color: white">                      } else {</span><br>         506:  <span style="background-color: white">                          result.append(c);</span><br>         507:  <span style="background-color: white">                      }</span><br>         508:  <span style="background-color: white">                  }</span><br>         509:  <span style="background-color: white">                  if (result.length() == 40) {</span><br>         510:  <span style="background-color: white">                      result.append("...");</span><br>         511:  <span style="background-color: white">                  }</span><br>         512:  <span style="background-color: white">                  return result.toString();</span><br>         513:  <span style="background-color: white">              }</span><br>         514:  <span style="background-color: white">          }</span><br>         515:  <span style="background-color: white">      </span><br>         516:  <span style="background-color: white">          public FSFunction getFunction() {</span><br>         517:  <span style="background-color: white">              return _function;</span><br>         518:  <span style="background-color: white">          }</span><br>         519:  <span style="background-color: white">      </span><br>         520:  <span style="background-color: red">          public void setFunction(FSFunction function) {</span><br>         521:  <span style="background-color: red">              _function = function;</span><br>         522:  <span style="background-color: white">          }</span><br>         523:  <span style="background-color: white">      </span><br>         524:  <span style="background-color: red">          public void truncateText() {</span><br>         525:  <span style="background-color: red">              _text = "";</span><br>         526:  <span style="background-color: red">              _originalText = "";</span><br>         527:  <span style="background-color: white">          }</span><br>         528:  <span style="background-color: white">      }</span><br></pre> </code> 
   </div> 
   <div class="column"> 
    <h2>Patched Code:</h2> <code> <pre id="patched-trace">        1-&gt;N:  <span style="background-color: white">      /*</span><br>        2-&gt;N:  <span style="background-color: white">       * Copyright (c) 2006 Wisconsin Court System</span><br>        3-&gt;N:  <span style="background-color: white">       *</span><br>        4-&gt;N:  <span style="background-color: white">       * This program is free software; you can redistribute it and/or</span><br>        5-&gt;N:  <span style="background-color: white">       * modify it under the terms of the GNU Lesser General Public License</span><br>        6-&gt;N:  <span style="background-color: white">       * as published by the Free Software Foundation; either version 2.1</span><br>        7-&gt;N:  <span style="background-color: white">       * of the License, or (at your option) any later version.</span><br>        8-&gt;N:  <span style="background-color: white">       *</span><br>        9-&gt;N:  <span style="background-color: white">       * This program is distributed in the hope that it will be useful,</span><br>       10-&gt;N:  <span style="background-color: white">       * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br>       11-&gt;N:  <span style="background-color: white">       * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><br>       12-&gt;N:  <span style="background-color: white">       * GNU Lesser General Public License for more details.</span><br>       13-&gt;N:  <span style="background-color: white">       *</span><br>       14-&gt;N:  <span style="background-color: white">       * You should have received a copy of the GNU Lesser General Public License</span><br>       15-&gt;N:  <span style="background-color: white">       * along with this program; if not, write to the Free Software</span><br>       16-&gt;N:  <span style="background-color: white">       * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span><br>       17-&gt;N:  <span style="background-color: white">       *</span><br>       18-&gt;N:  <span style="background-color: white">       */</span><br>       19-&gt;N:  <span style="background-color: white">      package com.openhtmltopdf.render;</span><br>       20-&gt;N:  <span style="background-color: white">      </span><br>       21-&gt;N:  <span style="background-color: white">      import java.text.BreakIterator;</span><br>       22-&gt;N:  <span style="background-color: white">      </span><br>       23-&gt;N:  <span style="background-color: white">      import org.w3c.dom.Element;</span><br>       24-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.bidi.BidiSplitter;</span><br>       25-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.CSSName;</span><br>       26-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.IdentValue;</span><br>       27-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.extend.ContentFunction;</span><br>       28-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSFunction;</span><br>       29-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.CalculatedStyle;</span><br>       30-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.extend.FSTextBreaker;</span><br>       31-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.Breaker;</span><br>       32-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.LayoutContext;</span><br>       33-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.Styleable;</span><br>       34-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.TextUtil;</span><br>       35-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.WhitespaceStripper;</span><br>       36-&gt;N:  <span style="background-color: white">      </span><br>       37-&gt;N:  <span style="background-color: white">      /**</span><br>       38-&gt;N:  <span style="background-color: white">       * A class which represents a portion of an inline element. If an inline element</span><br>       39-&gt;N:  <span style="background-color: white">       * does not contain any nested elements, then a single <code>InlineBox</code></span><br>       40-&gt;N:  <span style="background-color: white">       * object will contain the content for the entire element. Otherwise multiple</span><br>       41-&gt;N:  <span style="background-color: white">       * <code>InlineBox</code> objects will be created corresponding to each</span><br>       42-&gt;N:  <span style="background-color: white">       * discrete chunk of text appearing in the element. It is not rendered directly</span><br>       43-&gt;N:  <span style="background-color: white">       * (and hence does not extend from {@link Box}), but does play an important</span><br>       44-&gt;N:  <span style="background-color: white">       * role in layout (for example, when calculating min/max widths). Note that it</span><br>       45-&gt;N:  <span style="background-color: white">       * does not contain children. Inline content is stored as a flat list in the</span><br>       46-&gt;N:  <span style="background-color: white">       * layout tree. However, <code>InlineBox</code> does contain enough</span><br>       47-&gt;N:  <span style="background-color: white">       * information to reconstruct the original element nesting and this is, in fact,</span><br>       48-&gt;N:  <span style="background-color: white">       * done during inline layout.</span><br>       49-&gt;N:  <span style="background-color: white">       *</span><br>       50-&gt;N:  <span style="background-color: white">       * @see InlineLayoutBox</span><br>       51-&gt;N:  <span style="background-color: white">       */</span><br>       52-&gt;N:  <span style="background-color: white">      public class InlineBox implements Styleable {</span><br>      53-&gt;53:  <span style="background-color: white">          private Element _element;</span><br>       54-&gt;N:  <span style="background-color: white">      </span><br>      55-&gt;55:  <span style="background-color: white">          private String _originalText;</span><br>      56-&gt;56:  <span style="background-color: white">          private String _text;</span><br>      57-&gt;57:  <span style="background-color: white">          private boolean _removableWhitespace;</span><br>       58-&gt;N:  <span style="background-color: white">          </span><br>       59-&gt;N:  <span style="background-color: white">          /**</span><br>       60-&gt;N:  <span style="background-color: white">           * See {@link #isStartsHere()}</span><br>       61-&gt;N:  <span style="background-color: white">           */</span><br>      62-&gt;62:  <span style="background-color: white">          private boolean _startsHere;</span><br>       63-&gt;N:  <span style="background-color: white">          </span><br>       64-&gt;N:  <span style="background-color: white">          /**</span><br>       65-&gt;N:  <span style="background-color: white">           * See {@link #isEndsHere()}</span><br>       66-&gt;N:  <span style="background-color: white">           */</span><br>      67-&gt;67:  <span style="background-color: white">          private boolean _endsHere;</span><br>       68-&gt;N:  <span style="background-color: white">      </span><br>      69-&gt;69:  <span style="background-color: white">          private CalculatedStyle _style;</span><br>       70-&gt;N:  <span style="background-color: white">      </span><br>      71-&gt;71:  <span style="background-color: white">          private ContentFunction _contentFunction;</span><br>      72-&gt;72:  <span style="background-color: white">          private FSFunction _function;</span><br>       73-&gt;N:  <span style="background-color: white">      </span><br>      74-&gt;74:  <span style="background-color: white">          private boolean _minMaxCalculated;</span><br>      75-&gt;75:  <span style="background-color: white">          private int _maxWidth;</span><br>      76-&gt;76:  <span style="background-color: white">          private int _minWidth;</span><br>       77-&gt;N:  <span style="background-color: white">      </span><br>      78-&gt;78:  <span style="background-color: white">          private int _firstLineWidth;</span><br>       79-&gt;N:  <span style="background-color: white">      </span><br>      80-&gt;80:  <span style="background-color: white">          private String _pseudoElementOrClass;</span><br>       81-&gt;N:  <span style="background-color: white">      </span><br>      82-&gt;82:  <span style="background-color: cyan">          public InlineBox(String text) {</span><br>      83-&gt;83:  <span style="background-color: cyan">              _text = text;</span><br>      84-&gt;84:  <span style="background-color: cyan">              _originalText = text;</span><br>       85-&gt;N:  <span style="background-color: white">          }</span><br>       86-&gt;N:  <span style="background-color: white">      </span><br>      87-&gt;87:  <span style="background-color: white">          private byte _textDirection;</span><br>       88-&gt;N:  <span style="background-color: white">      </span><br>       89-&gt;U:  <span style="background-color: yellow">          private BlockBox _footnoteBody;</span><br>       90-&gt;N:  <span style="background-color: white">          </span><br>       91-&gt;N:  <span style="background-color: white">          /**</span><br>       92-&gt;N:  <span style="background-color: white">           * @param direction either LTR or RTL from {@link BidiSplitter} interface.</span><br>       93-&gt;N:  <span style="background-color: white">           */</span><br>      94-&gt;92:  <span style="background-color: cyan">          public void setTextDirection(byte direction) {</span><br>      95-&gt;93:  <span style="background-color: cyan">          	this._textDirection = direction;</span><br>       96-&gt;N:  <span style="background-color: white">          }</span><br>       97-&gt;N:  <span style="background-color: white">          </span><br>       98-&gt;N:  <span style="background-color: white">          /**</span><br>       99-&gt;N:  <span style="background-color: white">           * @return either LTR or RTL from {@link BidiSplitter} interface.</span><br>      100-&gt;N:  <span style="background-color: white">           */</span><br>     101-&gt;99:  <span style="background-color: cyan">          public byte getTextDirection() {</span><br>      102-&gt;N:  <span style="background-color: white">          	return this._textDirection;</span><br>      103-&gt;N:  <span style="background-color: white">          }</span><br>      104-&gt;N:  <span style="background-color: white">          </span><br>    105-&gt;103:  <span style="background-color: cyan">          public String getText() {</span><br>      106-&gt;N:  <span style="background-color: white">              return _text;</span><br>      107-&gt;N:  <span style="background-color: white">          }</span><br>      108-&gt;N:  <span style="background-color: white">      </span><br>    109-&gt;107:  <span style="background-color: cyan">          public void setText(String text) {</span><br>    110-&gt;108:  <span style="background-color: cyan">              _text = text;</span><br>    111-&gt;109:  <span style="background-color: cyan">              _originalText = text;</span><br>      112-&gt;N:  <span style="background-color: white">          }</span><br>      113-&gt;N:  <span style="background-color: white">      </span><br>    114-&gt;112:  <span style="background-color: cyan">          public void applyTextTransform() {</span><br>      115-&gt;N:  <span style="background-color: white">              _text = _originalText;</span><br>    116-&gt;114:  <span style="background-color: cyan">              _text = TextUtil.transformText(_text, getStyle());</span><br>      117-&gt;N:  <span style="background-color: white">          }</span><br>      118-&gt;N:  <span style="background-color: white">      </span><br>    119-&gt;117:  <span style="background-color: cyan">          public boolean isRemovableWhitespace() {</span><br>      120-&gt;N:  <span style="background-color: white">              return _removableWhitespace;</span><br>      121-&gt;N:  <span style="background-color: white">          }</span><br>      122-&gt;N:  <span style="background-color: white">      </span><br>    123-&gt;121:  <span style="background-color: cyan">          public void setRemovableWhitespace(boolean removeableWhitespace) {</span><br>    124-&gt;122:  <span style="background-color: cyan">              _removableWhitespace = removeableWhitespace;</span><br>      125-&gt;N:  <span style="background-color: white">          }</span><br>      126-&gt;N:  <span style="background-color: white">      </span><br>      127-&gt;N:  <span style="background-color: white">          /**</span><br>      128-&gt;N:  <span style="background-color: white">           * The opposite of {@link #isStartsHere()}</span><br>      129-&gt;N:  <span style="background-color: white">           */</span><br>    130-&gt;128:  <span style="background-color: cyan">          public boolean isEndsHere() {</span><br>      131-&gt;N:  <span style="background-color: white">              return _endsHere;</span><br>      132-&gt;N:  <span style="background-color: white">          }</span><br>      133-&gt;N:  <span style="background-color: white">      </span><br>      134-&gt;N:  <span style="background-color: white">          /**</span><br>      135-&gt;N:  <span style="background-color: white">           * See {@link #isEndsHere()}</span><br>      136-&gt;N:  <span style="background-color: white">           */</span><br>    137-&gt;135:  <span style="background-color: cyan">          public void setEndsHere(boolean endsHere) {</span><br>    138-&gt;136:  <span style="background-color: cyan">              _endsHere = endsHere;</span><br>      139-&gt;N:  <span style="background-color: white">          }</span><br>      140-&gt;N:  <span style="background-color: white">      </span><br>      141-&gt;N:  <span style="background-color: white">          /**</span><br>      142-&gt;N:  <span style="background-color: white">           * Whether this is the first InlineBox for a box. For example:</span><br>      143-&gt;N:  <span style="background-color: white">           * </span><br>      144-&gt;N:  <span style="background-color: white">           * <code>[b]one[i]two[/i]three[/b]</code></span><br>      145-&gt;N:  <span style="background-color: white">           * </span><br>      146-&gt;N:  <span style="background-color: white">           * will create three InlineBox objects and one and two will return</span><br>      147-&gt;N:  <span style="background-color: white">           * true for isStartsHere.</span><br>      148-&gt;N:  <span style="background-color: white">           * </span><br>      149-&gt;N:  <span style="background-color: white">           * This is used for example to decide whether left margin needs to be applied.</span><br>      150-&gt;N:  <span style="background-color: white">           */</span><br>    151-&gt;149:  <span style="background-color: cyan">          public boolean isStartsHere() {</span><br>      152-&gt;N:  <span style="background-color: white">              return _startsHere;</span><br>      153-&gt;N:  <span style="background-color: white">          }</span><br>      154-&gt;N:  <span style="background-color: white">      </span><br>      155-&gt;N:  <span style="background-color: white">          /**</span><br>      156-&gt;N:  <span style="background-color: white">           * See {@link #isStartsHere()}</span><br>      157-&gt;N:  <span style="background-color: white">           */</span><br>    158-&gt;156:  <span style="background-color: cyan">          public void setStartsHere(boolean startsHere) {</span><br>    159-&gt;157:  <span style="background-color: cyan">              _startsHere = startsHere;</span><br>      160-&gt;N:  <span style="background-color: white">          }</span><br>      161-&gt;N:  <span style="background-color: white">      </span><br>    162-&gt;160:  <span style="background-color: cyan">          @Override</span><br>    163-&gt;161:  <span style="background-color: white">          public CalculatedStyle getStyle() {</span><br>      164-&gt;N:  <span style="background-color: white">              return _style;</span><br>      165-&gt;N:  <span style="background-color: white">          }</span><br>      166-&gt;N:  <span style="background-color: white">      </span><br>    167-&gt;165:  <span style="background-color: cyan">          @Override</span><br>    168-&gt;166:  <span style="background-color: white">          public void setStyle(CalculatedStyle style) {</span><br>    169-&gt;167:  <span style="background-color: cyan">              _style = style;</span><br>      170-&gt;N:  <span style="background-color: white">          }</span><br>      171-&gt;N:  <span style="background-color: white">      </span><br>    172-&gt;170:  <span style="background-color: cyan">          @Override</span><br>    173-&gt;171:  <span style="background-color: white">          public Element getElement() {</span><br>      174-&gt;N:  <span style="background-color: white">              return _element;</span><br>      175-&gt;N:  <span style="background-color: white">          }</span><br>      176-&gt;N:  <span style="background-color: white">      </span><br>    177-&gt;175:  <span style="background-color: cyan">          @Override</span><br>    178-&gt;176:  <span style="background-color: white">          public void setElement(Element element) {</span><br>    179-&gt;177:  <span style="background-color: cyan">              _element = element;</span><br>      180-&gt;N:  <span style="background-color: white">          }</span><br>      181-&gt;N:  <span style="background-color: white">      </span><br>    182-&gt;180:  <span style="background-color: white">          public ContentFunction getContentFunction() {</span><br>      183-&gt;N:  <span style="background-color: white">              return _contentFunction;</span><br>      184-&gt;N:  <span style="background-color: white">          }</span><br>      185-&gt;N:  <span style="background-color: white">      </span><br>    186-&gt;184:  <span style="background-color: cyan">          public void setContentFunction(ContentFunction contentFunction) {</span><br>    187-&gt;185:  <span style="background-color: cyan">              _contentFunction = contentFunction;</span><br>      188-&gt;N:  <span style="background-color: white">          }</span><br>      189-&gt;N:  <span style="background-color: white">      </span><br>    190-&gt;188:  <span style="background-color: cyan">          public boolean isDynamicFunction() {</span><br>    191-&gt;189:  <span style="background-color: cyan">              return _contentFunction != null;</span><br>      192-&gt;N:  <span style="background-color: white">          }</span><br>      193-&gt;N:  <span style="background-color: white">      </span><br>    194-&gt;192:  <span style="background-color: cyan">          private int getTextWidth(LayoutContext c, String s) {</span><br>    195-&gt;193:  <span style="background-color: cyan">              return c.getTextRenderer().getWidth(</span><br>    196-&gt;194:  <span style="background-color: white">                      c.getFontContext(),</span><br>    197-&gt;195:  <span style="background-color: white">                      c.getFont(getStyle().getFont(c)),</span><br>    198-&gt;196:  <span style="background-color: white">                      s);</span><br>      199-&gt;N:  <span style="background-color: white">          }</span><br>      200-&gt;N:  <span style="background-color: white">      </span><br>    201-&gt;199:  <span style="background-color: white">          private int getMaxCharWidth(LayoutContext c, String s) {</span><br>    202-&gt;200:  <span style="background-color: white">              char[] chars = s.toCharArray();</span><br>    203-&gt;201:  <span style="background-color: white">              int result = 0;</span><br>    204-&gt;202:  <span style="background-color: white">              for (int i = 0; i &lt; chars.length; i++) {</span><br>    205-&gt;203:  <span style="background-color: white">                  int width = getTextWidth(c, Character.toString(chars[i]));</span><br>    206-&gt;204:  <span style="background-color: white">                  if (width &gt; result) {</span><br>    207-&gt;205:  <span style="background-color: white">                      result = width;</span><br>      208-&gt;N:  <span style="background-color: white">                  }</span><br>      209-&gt;N:  <span style="background-color: white">              }</span><br>    210-&gt;208:  <span style="background-color: white">              return result;</span><br>      211-&gt;N:  <span style="background-color: white">          }</span><br>      212-&gt;N:  <span style="background-color: white">      </span><br>    213-&gt;211:  <span style="background-color: cyan">          private void calcMaxWidthFromLineLength(LayoutContext c, int cbWidth, boolean trim) {</span><br>    214-&gt;212:  <span style="background-color: cyan">              int last = 0;</span><br>    215-&gt;213:  <span style="background-color: cyan">              int current = 0;</span><br>      216-&gt;N:  <span style="background-color: white">      </span><br>    217-&gt;215:  <span style="background-color: white">              while ( (current = _text.indexOf(WhitespaceStripper.EOL, last)) != -1) {</span><br>    218-&gt;216:  <span style="background-color: cyan">                  String target = _text.substring(last, current);</span><br>    219-&gt;217:  <span style="background-color: cyan">                  if (trim) {</span><br>    220-&gt;218:  <span style="background-color: cyan">                      target = target.trim();</span><br>      221-&gt;N:  <span style="background-color: white">                  }</span><br>    222-&gt;220:  <span style="background-color: cyan">                  int length = getTextWidth(c, target);</span><br>    223-&gt;221:  <span style="background-color: cyan">                  if (last == 0) {</span><br>    224-&gt;222:  <span style="background-color: cyan">                      length += getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.LEFT);</span><br>      225-&gt;N:  <span style="background-color: white">                  }</span><br>    226-&gt;224:  <span style="background-color: cyan">                  if (length &gt; _maxWidth) {</span><br>    227-&gt;225:  <span style="background-color: white">                      _maxWidth = length;</span><br>      228-&gt;N:  <span style="background-color: white">                  }</span><br>    229-&gt;227:  <span style="background-color: cyan">                  if (last == 0) {</span><br>    230-&gt;228:  <span style="background-color: cyan">                      _firstLineWidth = length;</span><br>      231-&gt;N:  <span style="background-color: white">                  }</span><br>    232-&gt;230:  <span style="background-color: cyan">                  last = current + 1;</span><br>      233-&gt;N:  <span style="background-color: white">              }</span><br>      234-&gt;N:  <span style="background-color: white">      </span><br>    235-&gt;233:  <span style="background-color: cyan">              String target = _text.substring(last);</span><br>    236-&gt;234:  <span style="background-color: cyan">              if (trim) {</span><br>    237-&gt;235:  <span style="background-color: cyan">                  target = target.trim();</span><br>      238-&gt;N:  <span style="background-color: white">              }</span><br>    239-&gt;237:  <span style="background-color: cyan">              int length = getTextWidth(c, target);</span><br>    240-&gt;238:  <span style="background-color: cyan">              length += getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.RIGHT);</span><br>    241-&gt;239:  <span style="background-color: cyan">              if (length &gt; _maxWidth) {</span><br>    242-&gt;240:  <span style="background-color: white">                  _maxWidth = length;</span><br>      243-&gt;N:  <span style="background-color: white">              }</span><br>    244-&gt;242:  <span style="background-color: cyan">              if (last == 0) {</span><br>    245-&gt;243:  <span style="background-color: cyan">                  _firstLineWidth = length;</span><br>      246-&gt;N:  <span style="background-color: white">              }</span><br>      247-&gt;N:  <span style="background-color: white">          }</span><br>      248-&gt;N:  <span style="background-color: white">      </span><br>    249-&gt;247:  <span style="background-color: cyan">          public int getSpaceWidth(LayoutContext c) {</span><br>    250-&gt;248:  <span style="background-color: cyan">              return c.getTextRenderer().getWidth(</span><br>    251-&gt;249:  <span style="background-color: white">                      c.getFontContext(),</span><br>    252-&gt;250:  <span style="background-color: white">                      getStyle().getFSFont(c),</span><br>    253-&gt;251:  <span style="background-color: white">                      WhitespaceStripper.SPACE);</span><br>      254-&gt;N:  <span style="background-color: white">      </span><br>      255-&gt;N:  <span style="background-color: white">          }</span><br>      256-&gt;N:  <span style="background-color: white">      </span><br>    257-&gt;255:  <span style="background-color: cyan">          public int getTrailingSpaceWidth(LayoutContext c) {</span><br>    258-&gt;256:  <span style="background-color: cyan">              if (_text.length() &gt; 0 &amp;&amp; _text.charAt(_text.length()-1) == ' ') {</span><br>    259-&gt;257:  <span style="background-color: cyan">                  return getSpaceWidth(c);</span><br>      260-&gt;N:  <span style="background-color: white">              } else {</span><br>    261-&gt;259:  <span style="background-color: cyan">                  return 0;</span><br>      262-&gt;N:  <span style="background-color: white">              }</span><br>      263-&gt;N:  <span style="background-color: white">          }</span><br>      264-&gt;N:  <span style="background-color: white">      </span><br>    265-&gt;263:  <span style="background-color: cyan">          private int calcMinWidthFromWordLength(</span><br>    266-&gt;264:  <span style="background-color: white">                  LayoutContext c, int cbWidth, boolean trimLeadingSpace, boolean includeWS) {</span><br>    267-&gt;265:  <span style="background-color: cyan">              int spaceWidth = -1;</span><br>      268-&gt;N:  <span style="background-color: white">      </span><br>    269-&gt;267:  <span style="background-color: cyan">              int last = 0;</span><br>    270-&gt;268:  <span style="background-color: cyan">              int current = 0;</span><br>    271-&gt;269:  <span style="background-color: cyan">              int maxWidth = 0;</span><br>    272-&gt;270:  <span style="background-color: cyan">              int spaceCount = 0;</span><br>      273-&gt;N:  <span style="background-color: white">      </span><br>    274-&gt;272:  <span style="background-color: cyan">              boolean haveFirstWord = false;</span><br>    275-&gt;273:  <span style="background-color: cyan">              int firstWord = 0;</span><br>    276-&gt;274:  <span style="background-color: cyan">              int lastWord = 0;</span><br>      277-&gt;N:  <span style="background-color: white">              </span><br>    278-&gt;276:  <span style="background-color: cyan">              CalculatedStyle style = getStyle();</span><br>    279-&gt;277:  <span style="background-color: cyan">              float letterSpacing = style.hasLetterSpacing()</span><br>    280-&gt;278:  <span style="background-color: white">                      ? style.getFloatPropertyProportionalWidth(CSSName.LETTER_SPACING, 0, c)</span><br>    281-&gt;279:  <span style="background-color: white">                      : 0f;</span><br>      282-&gt;N:  <span style="background-color: white">      </span><br>    283-&gt;281:  <span style="background-color: cyan">              String text = getText(trimLeadingSpace);</span><br>    284-&gt;282:  <span style="background-color: cyan">              FSTextBreaker breakIterator = Breaker.getLineBreakStream(text, c.getSharedContext());</span><br>      285-&gt;N:  <span style="background-color: white">      </span><br>      286-&gt;N:  <span style="background-color: white">              // Breaker should be used</span><br>    287-&gt;285:  <span style="background-color: white">              while ( (current = breakIterator.next()) != BreakIterator.DONE) {</span><br>    288-&gt;286:  <span style="background-color: cyan">                  String currentWord = text.substring(last, current);</span><br>      289-&gt;N:  <span style="background-color: white">                  </span><br>    290-&gt;288:  <span style="background-color: cyan">                  if (currentWord.length() &gt; 0 &amp;&amp; currentWord.charAt(currentWord.length() - 1) == Breaker.SOFT_HYPHEN) {</span><br>    291-&gt;289:  <span style="background-color: white">                      currentWord += '-';</span><br>      292-&gt;N:  <span style="background-color: white">                  }</span><br>      293-&gt;N:  <span style="background-color: white">                  </span><br>    294-&gt;292:  <span style="background-color: cyan">                  int wordWidth = getTextWidth(c, currentWord);</span><br>    295-&gt;293:  <span style="background-color: cyan">                  int minWordWidth;</span><br>      296-&gt;N:  <span style="background-color: white">                  if (getStyle().getWordWrap() == IdentValue.BREAK_WORD) {</span><br>    297-&gt;295:  <span style="background-color: white">                      minWordWidth = getMaxCharWidth(c, currentWord);</span><br>      298-&gt;N:  <span style="background-color: white">                  } else {</span><br>    299-&gt;297:  <span style="background-color: cyan">                      minWordWidth = (int) (wordWidth + (letterSpacing * currentWord.length()));</span><br>      300-&gt;N:  <span style="background-color: white">                  }</span><br>      301-&gt;N:  <span style="background-color: white">      </span><br>    302-&gt;300:  <span style="background-color: cyan">                  if (spaceCount &gt; 0) {</span><br>    303-&gt;301:  <span style="background-color: cyan">                      if (includeWS) {</span><br>    304-&gt;302:  <span style="background-color: white">                          for (int i = 0; i &lt; spaceCount; i++) {</span><br>    305-&gt;303:  <span style="background-color: white">                              wordWidth += spaceWidth;</span><br>    306-&gt;304:  <span style="background-color: white">                              minWordWidth += spaceWidth;</span><br>      307-&gt;N:  <span style="background-color: white">                          }</span><br>      308-&gt;N:  <span style="background-color: white">                      } else {</span><br>    309-&gt;307:  <span style="background-color: cyan">                          maxWidth += spaceWidth;</span><br>      310-&gt;N:  <span style="background-color: white">                      }</span><br>    311-&gt;309:  <span style="background-color: cyan">                      spaceCount = 0;</span><br>      312-&gt;N:  <span style="background-color: white">                  }</span><br>    313-&gt;311:  <span style="background-color: cyan">                  if (minWordWidth &gt; 0) {</span><br>    314-&gt;312:  <span style="background-color: cyan">                      if (! haveFirstWord) {</span><br>    315-&gt;313:  <span style="background-color: cyan">                          firstWord = minWordWidth;</span><br>      316-&gt;N:  <span style="background-color: white">                      }</span><br>    317-&gt;315:  <span style="background-color: cyan">                      lastWord = minWordWidth;</span><br>      318-&gt;N:  <span style="background-color: white">                  }</span><br>      319-&gt;N:  <span style="background-color: white">      </span><br>    320-&gt;318:  <span style="background-color: cyan">                  if (minWordWidth &gt; _minWidth) {</span><br>    321-&gt;319:  <span style="background-color: cyan">                      _minWidth = minWordWidth;</span><br>      322-&gt;N:  <span style="background-color: white">                  }</span><br>    323-&gt;321:  <span style="background-color: cyan">                  maxWidth += wordWidth;</span><br>      324-&gt;N:  <span style="background-color: white">      </span><br>    325-&gt;323:  <span style="background-color: cyan">                  last = current;</span><br>    326-&gt;324:  <span style="background-color: cyan">                  for (int i = current; i &lt; text.length(); i++) {</span><br>    327-&gt;325:  <span style="background-color: cyan">                      if (text.charAt(i) == ' ') {</span><br>    328-&gt;326:  <span style="background-color: cyan">                          spaceCount++;</span><br>    329-&gt;327:  <span style="background-color: cyan">                          last++;</span><br>      330-&gt;N:  <span style="background-color: white">                      } else {</span><br>    331-&gt;329:  <span style="background-color: cyan">                          break;</span><br>      332-&gt;N:  <span style="background-color: white">                      }</span><br>      333-&gt;N:  <span style="background-color: white">                  }</span><br>    334-&gt;332:  <span style="background-color: cyan">                  if (spaceCount &gt; 0 &amp;&amp; spaceWidth == -1) {</span><br>    335-&gt;333:  <span style="background-color: cyan">                      spaceWidth = getSpaceWidth(c);</span><br>      336-&gt;N:  <span style="background-color: white">                  }</span><br>      337-&gt;N:  <span style="background-color: white">              }</span><br>      338-&gt;N:  <span style="background-color: white">      </span><br>    339-&gt;337:  <span style="background-color: cyan">              String currentWord = text.substring(last);</span><br>    340-&gt;338:  <span style="background-color: cyan">              int wordWidth = getTextWidth(c, currentWord);</span><br>    341-&gt;339:  <span style="background-color: cyan">              int minWordWidth;</span><br>      342-&gt;N:  <span style="background-color: white">              if (getStyle().getWordWrap() == IdentValue.BREAK_WORD) {</span><br>    343-&gt;341:  <span style="background-color: white">                  minWordWidth = getMaxCharWidth(c, currentWord);</span><br>      344-&gt;N:  <span style="background-color: white">              } else {</span><br>    345-&gt;343:  <span style="background-color: cyan">                  minWordWidth = (int) (wordWidth + (letterSpacing * currentWord.length()));</span><br>      346-&gt;N:  <span style="background-color: white">              }</span><br>    347-&gt;345:  <span style="background-color: cyan">              if (spaceCount &gt; 0) {</span><br>    348-&gt;346:  <span style="background-color: cyan">                  if (includeWS) {</span><br>    349-&gt;347:  <span style="background-color: white">                      for (int i = 0; i &lt; spaceCount; i++) {</span><br>    350-&gt;348:  <span style="background-color: white">                          wordWidth += spaceWidth;</span><br>    351-&gt;349:  <span style="background-color: white">                          minWordWidth += spaceWidth;</span><br>      352-&gt;N:  <span style="background-color: white">                      }</span><br>      353-&gt;N:  <span style="background-color: white">                  } else {</span><br>    354-&gt;352:  <span style="background-color: cyan">                      maxWidth += spaceWidth;</span><br>      355-&gt;N:  <span style="background-color: white">                  }</span><br>    356-&gt;354:  <span style="background-color: cyan">                  spaceCount = 0;</span><br>      357-&gt;N:  <span style="background-color: white">              }</span><br>    358-&gt;356:  <span style="background-color: cyan">              if (minWordWidth &gt; 0) {</span><br>    359-&gt;357:  <span style="background-color: white">                  if (! haveFirstWord) {</span><br>    360-&gt;358:  <span style="background-color: white">                      firstWord = minWordWidth;</span><br>      361-&gt;N:  <span style="background-color: white">                  }</span><br>    362-&gt;360:  <span style="background-color: white">                  lastWord = minWordWidth;</span><br>      363-&gt;N:  <span style="background-color: white">              }</span><br>    364-&gt;362:  <span style="background-color: cyan">              if (minWordWidth &gt; _minWidth) {</span><br>    365-&gt;363:  <span style="background-color: white">                  _minWidth = minWordWidth;</span><br>      366-&gt;N:  <span style="background-color: white">              }</span><br>    367-&gt;365:  <span style="background-color: cyan">              maxWidth += wordWidth;</span><br>      368-&gt;N:  <span style="background-color: white">      </span><br>      369-&gt;N:  <span style="background-color: white">              if (isStartsHere()) {</span><br>    370-&gt;368:  <span style="background-color: cyan">                  int leftMBP = getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.LEFT);</span><br>    371-&gt;369:  <span style="background-color: cyan">                  if (firstWord + leftMBP &gt; _minWidth) {</span><br>    372-&gt;370:  <span style="background-color: white">                      _minWidth = firstWord + leftMBP;</span><br>      373-&gt;N:  <span style="background-color: white">                  }</span><br>    374-&gt;372:  <span style="background-color: cyan">                  maxWidth += leftMBP;</span><br>      375-&gt;N:  <span style="background-color: white">              }</span><br>      376-&gt;N:  <span style="background-color: white">      </span><br>      377-&gt;N:  <span style="background-color: white">              if (isEndsHere()) {</span><br>    378-&gt;376:  <span style="background-color: cyan">                  int rightMBP = getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.RIGHT);</span><br>    379-&gt;377:  <span style="background-color: cyan">                  if (lastWord + rightMBP &gt; _minWidth) {</span><br>    380-&gt;378:  <span style="background-color: white">                      _minWidth = lastWord + rightMBP;</span><br>      381-&gt;N:  <span style="background-color: white">                  }</span><br>    382-&gt;380:  <span style="background-color: cyan">                  maxWidth += rightMBP;</span><br>      383-&gt;N:  <span style="background-color: white">              }</span><br>      384-&gt;N:  <span style="background-color: white">      </span><br>    385-&gt;383:  <span style="background-color: cyan">              return maxWidth;</span><br>      386-&gt;N:  <span style="background-color: white">          }</span><br>      387-&gt;N:  <span style="background-color: white">      </span><br>    388-&gt;386:  <span style="background-color: cyan">          private String getText(boolean trimLeadingSpace) {</span><br>    389-&gt;387:  <span style="background-color: cyan">              if (! trimLeadingSpace) {</span><br>      390-&gt;N:  <span style="background-color: white">                  return getText();</span><br>      391-&gt;N:  <span style="background-color: white">              } else {</span><br>    392-&gt;390:  <span style="background-color: cyan">                  if (_text.length() &gt; 0 &amp;&amp; _text.charAt(0) == ' ') {</span><br>    393-&gt;391:  <span style="background-color: cyan">                      return _text.substring(1);</span><br>      394-&gt;N:  <span style="background-color: white">                  } else {</span><br>      395-&gt;N:  <span style="background-color: white">                      return _text;</span><br>      396-&gt;N:  <span style="background-color: white">                  }</span><br>      397-&gt;N:  <span style="background-color: white">              }</span><br>      398-&gt;N:  <span style="background-color: white">          }</span><br>      399-&gt;N:  <span style="background-color: white">      </span><br>    400-&gt;398:  <span style="background-color: cyan">          private int getInlineMBP(LayoutContext c, int cbWidth) {</span><br>    401-&gt;399:  <span style="background-color: cyan">              return getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.LEFT) +</span><br>    402-&gt;400:  <span style="background-color: white">                  getStyle().getMarginBorderPadding(c, cbWidth, CalculatedStyle.RIGHT);</span><br>      403-&gt;N:  <span style="background-color: white">          }</span><br>      404-&gt;N:  <span style="background-color: white">      </span><br>    405-&gt;403:  <span style="background-color: cyan">          public void calcMinMaxWidth(LayoutContext c, int cbWidth, boolean trimLeadingSpace) {</span><br>      406-&gt;N:  <span style="background-color: white">              if (! _minMaxCalculated) {</span><br>    407-&gt;405:  <span style="background-color: cyan">                  IdentValue whitespace = getStyle().getWhitespace();</span><br>    408-&gt;406:  <span style="background-color: cyan">                  if (whitespace == IdentValue.NOWRAP) {</span><br>    409-&gt;407:  <span style="background-color: cyan">                      _minWidth = _maxWidth = getInlineMBP(c, cbWidth) + getTextWidth(c, getText(trimLeadingSpace));</span><br>    410-&gt;408:  <span style="background-color: cyan">                  } else if (whitespace == IdentValue.PRE) {</span><br>    411-&gt;409:  <span style="background-color: white">                      calcMaxWidthFromLineLength(c, cbWidth, false);</span><br>      412-&gt;N:  <span style="background-color: white">                      _minWidth = _maxWidth;</span><br>    413-&gt;411:  <span style="background-color: cyan">                  } else if (whitespace == IdentValue.PRE_WRAP) {</span><br>    414-&gt;412:  <span style="background-color: white">                      calcMinWidthFromWordLength(c, cbWidth, false, true);</span><br>    415-&gt;413:  <span style="background-color: white">                      calcMaxWidthFromLineLength(c, cbWidth, false);</span><br>    416-&gt;414:  <span style="background-color: cyan">                  } else if (whitespace == IdentValue.PRE_LINE) {</span><br>    417-&gt;415:  <span style="background-color: cyan">                      calcMinWidthFromWordLength(c, cbWidth, trimLeadingSpace, false);</span><br>    418-&gt;416:  <span style="background-color: cyan">                      calcMaxWidthFromLineLength(c, cbWidth, true);</span><br>      419-&gt;N:  <span style="background-color: white">                  } else /* if (whitespace == IdentValue.NORMAL) */ {</span><br>    420-&gt;418:  <span style="background-color: cyan">                      _maxWidth = calcMinWidthFromWordLength(c, cbWidth, trimLeadingSpace, false);</span><br>      421-&gt;N:  <span style="background-color: white">                  }</span><br>    422-&gt;420:  <span style="background-color: cyan">                  _minWidth = Math.min(_maxWidth, _minWidth);</span><br>    423-&gt;421:  <span style="background-color: cyan">                  _minMaxCalculated = true;</span><br>      424-&gt;N:  <span style="background-color: white">              }</span><br>      425-&gt;N:  <span style="background-color: white">          }</span><br>      426-&gt;N:  <span style="background-color: white">      </span><br>    427-&gt;425:  <span style="background-color: cyan">          public int getMaxWidth() {</span><br>      428-&gt;N:  <span style="background-color: white">              return _maxWidth;</span><br>      429-&gt;N:  <span style="background-color: white">          }</span><br>      430-&gt;N:  <span style="background-color: white">      </span><br>    431-&gt;429:  <span style="background-color: cyan">          public int getMinWidth() {</span><br>      432-&gt;N:  <span style="background-color: white">              return _minWidth;</span><br>      433-&gt;N:  <span style="background-color: white">          }</span><br>      434-&gt;N:  <span style="background-color: white">      </span><br>    435-&gt;433:  <span style="background-color: cyan">          public int getFirstLineWidth() {</span><br>      436-&gt;N:  <span style="background-color: white">              return _firstLineWidth;</span><br>      437-&gt;N:  <span style="background-color: white">          }</span><br>      438-&gt;N:  <span style="background-color: white">      </span><br>    439-&gt;437:  <span style="background-color: white">          @Override</span><br>    440-&gt;438:  <span style="background-color: white">          public String getPseudoElementOrClass() {</span><br>      441-&gt;N:  <span style="background-color: white">              return _pseudoElementOrClass;</span><br>      442-&gt;N:  <span style="background-color: white">          }</span><br>      443-&gt;N:  <span style="background-color: white">      </span><br>    444-&gt;442:  <span style="background-color: cyan">          public void setPseudoElementOrClass(String pseudoElementOrClass) {</span><br>    445-&gt;443:  <span style="background-color: cyan">              _pseudoElementOrClass = pseudoElementOrClass;</span><br>      446-&gt;N:  <span style="background-color: white">          }</span><br>      447-&gt;N:  <span style="background-color: white">      </span><br>    448-&gt;446:  <span style="background-color: white">          @Override</span><br>    449-&gt;447:  <span style="background-color: white">          public String toString() {</span><br>    450-&gt;448:  <span style="background-color: white">              StringBuilder result = new StringBuilder();</span><br>    451-&gt;449:  <span style="background-color: white">              result.append("InlineBox: ");</span><br>    452-&gt;450:  <span style="background-color: white">              if (getElement() != null) {</span><br>    453-&gt;451:  <span style="background-color: white">                  result.append("&lt;");</span><br>    454-&gt;452:  <span style="background-color: white">                  result.append(getElement().getNodeName());</span><br>    455-&gt;453:  <span style="background-color: white">                  result.append("&gt; ");</span><br>      456-&gt;N:  <span style="background-color: white">              } else {</span><br>    457-&gt;455:  <span style="background-color: white">                  result.append("(anonymous) ");</span><br>      458-&gt;N:  <span style="background-color: white">              }</span><br>    459-&gt;457:  <span style="background-color: white">              if (getPseudoElementOrClass() != null) {</span><br>    460-&gt;458:  <span style="background-color: white">                  result.append(':');</span><br>    461-&gt;459:  <span style="background-color: white">                  result.append(getPseudoElementOrClass());</span><br>    462-&gt;460:  <span style="background-color: white">                  result.append(' ');</span><br>      463-&gt;N:  <span style="background-color: white">              }</span><br>      464-&gt;N:  <span style="background-color: white">              if (isStartsHere() || isEndsHere()) {</span><br>    465-&gt;463:  <span style="background-color: white">                  result.append("(");</span><br>      466-&gt;N:  <span style="background-color: white">                  if (isStartsHere()) {</span><br>    467-&gt;465:  <span style="background-color: white">                      result.append("S");</span><br>      468-&gt;N:  <span style="background-color: white">                  }</span><br>      469-&gt;N:  <span style="background-color: white">                  if (isEndsHere()) {</span><br>    470-&gt;468:  <span style="background-color: white">                      result.append("E");</span><br>      471-&gt;N:  <span style="background-color: white">                  }</span><br>    472-&gt;470:  <span style="background-color: white">                  result.append(") ");</span><br>      473-&gt;N:  <span style="background-color: white">              }</span><br>      474-&gt;N:  <span style="background-color: white">      </span><br>    475-&gt;473:  <span style="background-color: white">              appendPositioningInfo(result);</span><br>      476-&gt;N:  <span style="background-color: white">      </span><br>    477-&gt;475:  <span style="background-color: white">              result.append("(");</span><br>    478-&gt;476:  <span style="background-color: white">              result.append(shortText());</span><br>    479-&gt;477:  <span style="background-color: white">              result.append(") ");</span><br>    480-&gt;478:  <span style="background-color: white">              return result.toString();</span><br>      481-&gt;N:  <span style="background-color: white">          }</span><br>      482-&gt;N:  <span style="background-color: white">      </span><br>    483-&gt;481:  <span style="background-color: white">          protected void appendPositioningInfo(StringBuilder result) {</span><br>      484-&gt;N:  <span style="background-color: white">              if (getStyle().isRelative()) {</span><br>    485-&gt;483:  <span style="background-color: white">                  result.append("(relative) ");</span><br>      486-&gt;N:  <span style="background-color: white">              }</span><br>      487-&gt;N:  <span style="background-color: white">              if (getStyle().isFixed()) {</span><br>    488-&gt;486:  <span style="background-color: white">                  result.append("(fixed) ");</span><br>      489-&gt;N:  <span style="background-color: white">              }</span><br>      490-&gt;N:  <span style="background-color: white">              if (getStyle().isAbsolute()) {</span><br>    491-&gt;489:  <span style="background-color: white">                  result.append("(absolute) ");</span><br>      492-&gt;N:  <span style="background-color: white">              }</span><br>      493-&gt;N:  <span style="background-color: white">              if (getStyle().isFloated()) {</span><br>    494-&gt;492:  <span style="background-color: white">                  result.append("(floated) ");</span><br>      495-&gt;N:  <span style="background-color: white">              }</span><br>      496-&gt;N:  <span style="background-color: white">          }</span><br>      497-&gt;N:  <span style="background-color: white">      </span><br>    498-&gt;496:  <span style="background-color: white">          private String shortText() {</span><br>    499-&gt;497:  <span style="background-color: white">              if (_text == null) {</span><br>    500-&gt;498:  <span style="background-color: white">                  return null;</span><br>      501-&gt;N:  <span style="background-color: white">              } else {</span><br>    502-&gt;500:  <span style="background-color: white">                  StringBuilder result = new StringBuilder();</span><br>    503-&gt;501:  <span style="background-color: white">                  for (int i = 0; i &lt; _text.length() &amp;&amp; i &lt; 40; i++) {</span><br>    504-&gt;502:  <span style="background-color: white">                      char c = _text.charAt(i);</span><br>    505-&gt;503:  <span style="background-color: white">                      if (c == '\n') {</span><br>    506-&gt;504:  <span style="background-color: white">                          result.append(' ');</span><br>      507-&gt;N:  <span style="background-color: white">                      } else {</span><br>    508-&gt;506:  <span style="background-color: white">                          result.append(c);</span><br>      509-&gt;N:  <span style="background-color: white">                      }</span><br>      510-&gt;N:  <span style="background-color: white">                  }</span><br>    511-&gt;509:  <span style="background-color: white">                  if (result.length() == 40) {</span><br>    512-&gt;510:  <span style="background-color: white">                      result.append("...");</span><br>      513-&gt;N:  <span style="background-color: white">                  }</span><br>    514-&gt;512:  <span style="background-color: white">                  return result.toString();</span><br>      515-&gt;N:  <span style="background-color: white">              }</span><br>      516-&gt;N:  <span style="background-color: white">          }</span><br>      517-&gt;N:  <span style="background-color: white">      </span><br>    518-&gt;516:  <span style="background-color: white">          public FSFunction getFunction() {</span><br>      519-&gt;N:  <span style="background-color: white">              return _function;</span><br>      520-&gt;N:  <span style="background-color: white">          }</span><br>      521-&gt;N:  <span style="background-color: white">      </span><br>    522-&gt;520:  <span style="background-color: cyan">          public void setFunction(FSFunction function) {</span><br>    523-&gt;521:  <span style="background-color: cyan">              _function = function;</span><br>      524-&gt;N:  <span style="background-color: white">          }</span><br>      525-&gt;N:  <span style="background-color: white">      </span><br>    526-&gt;524:  <span style="background-color: cyan">          public void truncateText() {</span><br>    527-&gt;525:  <span style="background-color: cyan">              _text = "";</span><br>    528-&gt;526:  <span style="background-color: cyan">              _originalText = "";</span><br>      529-&gt;N:  <span style="background-color: white">          }</span><br>      530-&gt;N:  <span style="background-color: white">      </span><br>      531-&gt;U:  <span style="background-color: yellow">          public void setFootnote(BlockBox footnoteBody) {</span><br>      532-&gt;U:  <span style="background-color: yellow">              _footnoteBody = footnoteBody;</span><br>      533-&gt;U:  <span style="background-color: yellow">          }</span><br>      534-&gt;N:  <span style="background-color: white">      </span><br>      535-&gt;U:  <span style="background-color: yellow">          public boolean hasFootnote() {</span><br>      536-&gt;U:  <span style="background-color: yellow">              return getFootnoteBody() != null;</span><br>      537-&gt;U:  <span style="background-color: yellow">          }</span><br>      538-&gt;N:  <span style="background-color: white">      </span><br>      539-&gt;U:  <span style="background-color: yellow">          public BlockBox getFootnoteBody() {</span><br>      540-&gt;U:  <span style="background-color: yellow">              return _footnoteBody;</span><br>      541-&gt;U:  <span style="background-color: yellow">          }</span><br>      542-&gt;N:  <span style="background-color: white">      }</span><br></pre> </code> 
   </div> 
  </div>  
 </body>
</html>