<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <title>Execution Trace Diff</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <style>
* {
  box-sizing: border-box;
}

/* Create two equal columns that floats next to each other */
.column {
  float: left;
  width: 50%;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

.test {
    border: 1px solid darkblue;
    padding-left: 10px;
}
</style> 
 </head> 
 <body> 
  <div class="row test"> 
   <h2>Differencing Test:</h2> <code> <pre>@Test <br>
public void test_main(){ <br>
    String ret = NumberAnalyzer.analyze(1); <br>
    assertThat(ret, containsString("greater")); <br>
}
        </pre> </code> 
  </div> 
  <div class="row"> 
   <div class="column"> 
    <h2>Original Code:</h2> <code> <pre id="original-trace">           1:  <span style="background-color: white">      /*</span><br>           2:  <span style="background-color: white">       * CalculatedStyle.java</span><br>           3:  <span style="background-color: white">       * Copyright (c) 2004, 2005 Patrick Wright, Torbjoern Gannholm</span><br>           4:  <span style="background-color: white">       * Copyright (c) 2006 Wisconsin Court System</span><br>           5:  <span style="background-color: white">       *</span><br>           6:  <span style="background-color: white">       * This program is free software; you can redistribute it and/or</span><br>           7:  <span style="background-color: white">       * modify it under the terms of the GNU Lesser General Public License</span><br>           8:  <span style="background-color: white">       * as published by the Free Software Foundation; either version 2.1</span><br>           9:  <span style="background-color: white">       * of the License, or (at your option) any later version.</span><br>          10:  <span style="background-color: white">       *</span><br>          11:  <span style="background-color: white">       * This program is distributed in the hope that it will be useful,</span><br>          12:  <span style="background-color: white">       * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br>          13:  <span style="background-color: white">       * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><br>          14:  <span style="background-color: white">       * GNU Lesser General Public License for more details.</span><br>          15:  <span style="background-color: white">       *</span><br>          16:  <span style="background-color: white">       * You should have received a copy of the GNU Lesser General Public License</span><br>          17:  <span style="background-color: white">       * along with this program; if not, write to the Free Software</span><br>          18:  <span style="background-color: white">       * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span><br>          19:  <span style="background-color: white">       *</span><br>          20:  <span style="background-color: white">       */</span><br>          21:  <span style="background-color: white">      package com.openhtmltopdf.css.style;</span><br>          22:  <span style="background-color: white">      </span><br>          23:  <span style="background-color: white">      import java.awt.Cursor;</span><br>          24:  <span style="background-color: white">      import java.lang.annotation.Documented;</span><br>          25:  <span style="background-color: white">      import java.util.ArrayList;</span><br>          26:  <span style="background-color: white">      import java.util.Collections;</span><br>          27:  <span style="background-color: white">      import java.util.List;</span><br>          28:  <span style="background-color: white">      import java.util.Objects;</span><br>          29:  <span style="background-color: white">      import java.util.logging.Level;</span><br>          30:  <span style="background-color: white">      import java.util.stream.Collectors;</span><br>          31:  <span style="background-color: white">      </span><br>          32:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.CSSName;</span><br>          33:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.IdentValue;</span><br>          34:  <span style="background-color: white">      import com.openhtmltopdf.css.newmatch.CascadedStyle;</span><br>          35:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.CSSPrimitiveValue;</span><br>          36:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.CounterData;</span><br>          37:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSColor;</span><br>          38:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSFunction;</span><br>          39:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSRGBColor;</span><br>          40:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.PropertyValue;</span><br>          41:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.property.PrimitivePropertyBuilders;</span><br>          42:  <span style="background-color: white">      import com.openhtmltopdf.css.sheet.PropertyDeclaration;</span><br>          43:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.BorderPropertySet;</span><br>          44:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.CountersValue;</span><br>          45:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.DerivedValueFactory;</span><br>          46:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.FSLinearGradient;</span><br>          47:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.FunctionValue;</span><br>          48:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.LengthValue;</span><br>          49:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.ListValue;</span><br>          50:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.NumberValue;</span><br>          51:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.RectPropertySet;</span><br>          52:  <span style="background-color: white">      import com.openhtmltopdf.css.value.FontSpecification;</span><br>          53:  <span style="background-color: white">      import com.openhtmltopdf.newtable.TableBox;</span><br>          54:  <span style="background-color: white">      import com.openhtmltopdf.render.Box;</span><br>          55:  <span style="background-color: white">      import com.openhtmltopdf.render.FSFont;</span><br>          56:  <span style="background-color: white">      import com.openhtmltopdf.render.FSFontMetrics;</span><br>          57:  <span style="background-color: white">      import com.openhtmltopdf.render.RenderingContext;</span><br>          58:  <span style="background-color: white">      import com.openhtmltopdf.util.LogMessageId;</span><br>          59:  <span style="background-color: white">      import com.openhtmltopdf.util.WebDoc;</span><br>          60:  <span style="background-color: white">      import com.openhtmltopdf.util.WebDocLocations;</span><br>          61:  <span style="background-color: white">      import com.openhtmltopdf.util.XRLog;</span><br>          62:  <span style="background-color: white">      import com.openhtmltopdf.util.XRRuntimeException;</span><br>          63:  <span style="background-color: white">      </span><br>          64:  <span style="background-color: white">      </span><br>          65:  <span style="background-color: white">      /**</span><br>          66:  <span style="background-color: white">       * A set of properties that apply to a single Element, derived from all matched</span><br>          67:  <span style="background-color: white">       * properties following the rules for CSS cascade, inheritance, importance,</span><br>          68:  <span style="background-color: white">       * specificity and sequence. A derived style is just like a style but</span><br>          69:  <span style="background-color: white">       * (presumably) has additional information that allows relative properties to be</span><br>          70:  <span style="background-color: white">       * assigned values, e.g. font attributes. Property values are fully resolved</span><br>          71:  <span style="background-color: white">       * when this style is created. A property retrieved by name should always have</span><br>          72:  <span style="background-color: white">       * only one value in this class (e.g. one-one map). Any methods to retrieve</span><br>          73:  <span style="background-color: white">       * property values from an instance of this class require a valid {@link</span><br>          74:  <span style="background-color: white">       * com.openhtmltopdf.layout.LayoutContext} be given to it, for some cases of property</span><br>          75:  <span style="background-color: white">       * resolution. Generally, a programmer will not use this class directly, but</span><br>          76:  <span style="background-color: white">       * will retrieve properties using a {@link com.openhtmltopdf.context.StyleReference}</span><br>          77:  <span style="background-color: white">       * implementation.</span><br>          78:  <span style="background-color: white">       *</span><br>          79:  <span style="background-color: white">       * @author Torbjoern Gannholm</span><br>          80:  <span style="background-color: white">       * @author Patrick Wright</span><br>          81:  <span style="background-color: white">       */</span><br>          82:  <span style="background-color: white">      public class CalculatedStyle {</span><br>          83:  <span style="background-color: white">          /**</span><br>          84:  <span style="background-color: white">           * The parent-style we inherit from</span><br>          85:  <span style="background-color: white">           */</span><br>          86:  <span style="background-color: white">          private CalculatedStyle _parent;</span><br>          87:  <span style="background-color: white">      </span><br>          88:  <span style="background-color: white">          private BorderPropertySet _border;</span><br>          89:  <span style="background-color: white">          private RectPropertySet _margin;</span><br>          90:  <span style="background-color: white">          private RectPropertySet _padding;</span><br>          91:  <span style="background-color: white">      </span><br>          92:  <span style="background-color: white">          private float _lineHeight;</span><br>          93:  <span style="background-color: white">          private boolean _lineHeightResolved;</span><br>          94:  <span style="background-color: white">      </span><br>          95:  <span style="background-color: white">          private FSFont _FSFont;</span><br>          96:  <span style="background-color: white">          private FSFontMetrics _FSFontMetrics;</span><br>          97:  <span style="background-color: white">      </span><br>          98:  <span style="background-color: white">          private boolean _marginsAllowed = true;</span><br>          99:  <span style="background-color: white">          private boolean _paddingAllowed = true;</span><br>         100:  <span style="background-color: white">          private boolean _bordersAllowed = true;</span><br>         101:  <span style="background-color: white">      </span><br>         102:  <span style="background-color: yellow">          private BackgroundSize _backgroundSize;</span><br>         103:  <span style="background-color: white">      </span><br>         104:  <span style="background-color: white">          /**</span><br>         105:  <span style="background-color: white">           * Cache child styles of this style that have the same cascaded properties</span><br>         106:  <span style="background-color: white">           */</span><br>         107:  <span style="background-color: white">          private final java.util.Map
       <string, calculatedstyle>
         _childCache = new java.util.HashMap&lt;&gt;();
       </string,></span><br>         108:  <span style="background-color: white">          /*private java.util.HashMap _childCache = new java.util.LinkedHashMap(5, 0.75f, true) {</span><br>         109:  <span style="background-color: white">              private static final int MAX_ENTRIES = 10;</span><br>         110:  <span style="background-color: white">      </span><br>         111:  <span style="background-color: white">              protected boolean removeEldestEntry(Map.Entry eldest) {</span><br>         112:  <span style="background-color: white">                  return size() &gt; MAX_ENTRIES;</span><br>         113:  <span style="background-color: white">              }</span><br>         114:  <span style="background-color: white">          };*/</span><br>         115:  <span style="background-color: white">      </span><br>         116:  <span style="background-color: white">          /**</span><br>         117:  <span style="background-color: white">           * Our main array of property values defined in this style, keyed</span><br>         118:  <span style="background-color: white">           * by the CSSName assigned ID.</span><br>         119:  <span style="background-color: white">           */</span><br>         120:  <span style="background-color: white">          private final FSDerivedValue[] _derivedValuesById;</span><br>         121:  <span style="background-color: white">      </span><br>         122:  <span style="background-color: white">   0      public FSDerivedValue[] getderivedValuesById() {</span><br>         123:  <span style="background-color: white">   0  		return _derivedValuesById;</span><br>         124:  <span style="background-color: white">      	}</span><br>         125:  <span style="background-color: white">      </span><br>         126:  <span style="background-color: white">      	/**</span><br>         127:  <span style="background-color: white">           * The derived Font for this style</span><br>         128:  <span style="background-color: white">           */</span><br>         129:  <span style="background-color: white">          private FontSpecification _font;</span><br>         130:  <span style="background-color: white">      </span><br>         131:  <span style="background-color: white">      </span><br>         132:  <span style="background-color: white">          /**</span><br>         133:  <span style="background-color: white">           * Default constructor; as the instance is immutable after use, don't use</span><br>         134:  <span style="background-color: white">           * this for class instantiation externally.</span><br>         135:  <span style="background-color: white">           */</span><br>         136:  <span style="background-color: white"> 99+      protected CalculatedStyle() {</span><br>         137:  <span style="background-color: red"> 99+          _derivedValuesById = new FSDerivedValue[CSSName.countCSSPrimitiveNames()];</span><br>         138:  <span style="background-color: white">          }</span><br>         139:  <span style="background-color: white">      </span><br>         140:  <span style="background-color: white">      </span><br>         141:  <span style="background-color: white">          /**</span><br>         142:  <span style="background-color: white">           * Constructor for the CalculatedStyle object. To get a derived style, use</span><br>         143:  <span style="background-color: white">           * the Styler objects getDerivedStyle which will cache styles</span><br>         144:  <span style="background-color: white">           *</span><br>         145:  <span style="background-color: white">           * @param parent  PARAM</span><br>         146:  <span style="background-color: white">           * @param matched PARAM</span><br>         147:  <span style="background-color: white">           */</span><br>         148:  <span style="background-color: yellow"> 99+      private CalculatedStyle(CalculatedStyle parent, CascadedStyle matched) {</span><br>         149:  <span style="background-color: red"> 99+          this();</span><br>         150:  <span style="background-color: red"> 99+          _parent = parent;</span><br>         151:  <span style="background-color: white">      </span><br>         152:  <span style="background-color: yellow"> 99+          derive(matched);</span><br>         153:  <span style="background-color: white">      </span><br>         154:  <span style="background-color: yellow"> 99+          checkPaddingAllowed();</span><br>         155:  <span style="background-color: yellow"> 99+          checkMarginsAllowed();</span><br>         156:  <span style="background-color: yellow"> 99+          checkBordersAllowed();</span><br>         157:  <span style="background-color: white">          }</span><br>         158:  <span style="background-color: white">      </span><br>         159:  <span style="background-color: red"> 99+      private void checkPaddingAllowed() {</span><br>         160:  <span style="background-color: red"> 99+          IdentValue v = getIdent(CSSName.DISPLAY);</span><br>         161:  <span style="background-color: red"> 99+          if (v == IdentValue.TABLE_HEADER_GROUP || v == IdentValue.TABLE_ROW_GROUP ||</span><br>         162:  <span style="background-color: white">                      v == IdentValue.TABLE_FOOTER_GROUP || v == IdentValue.TABLE_ROW) {</span><br>         163:  <span style="background-color: red"> 99+              _paddingAllowed = false;</span><br>         164:  <span style="background-color: red"> 99+          } else if ((v == IdentValue.TABLE || v == IdentValue.INLINE_TABLE) &amp;&amp; isCollapseBorders()) {</span><br>         165:  <span style="background-color: red">  45              _paddingAllowed = false;</span><br>         166:  <span style="background-color: white">              }</span><br>         167:  <span style="background-color: white">          }</span><br>         168:  <span style="background-color: white">      </span><br>         169:  <span style="background-color: red"> 99+      private void checkMarginsAllowed() {</span><br>         170:  <span style="background-color: red"> 99+          IdentValue v = getIdent(CSSName.DISPLAY);</span><br>         171:  <span style="background-color: red"> 99+          if (v == IdentValue.TABLE_HEADER_GROUP || v == IdentValue.TABLE_ROW_GROUP ||</span><br>         172:  <span style="background-color: white">                      v == IdentValue.TABLE_FOOTER_GROUP || v == IdentValue.TABLE_ROW ||</span><br>         173:  <span style="background-color: white">                      v == IdentValue.TABLE_CELL) {</span><br>         174:  <span style="background-color: red"> 99+              _marginsAllowed = false;</span><br>         175:  <span style="background-color: white">              }</span><br>         176:  <span style="background-color: white">          }</span><br>         177:  <span style="background-color: white">      </span><br>         178:  <span style="background-color: red"> 99+      private void checkBordersAllowed() {</span><br>         179:  <span style="background-color: red"> 99+          IdentValue v = getIdent(CSSName.DISPLAY);</span><br>         180:  <span style="background-color: red"> 99+          if (v == IdentValue.TABLE_HEADER_GROUP || v == IdentValue.TABLE_ROW_GROUP ||</span><br>         181:  <span style="background-color: white">                      v == IdentValue.TABLE_FOOTER_GROUP || v == IdentValue.TABLE_ROW) {</span><br>         182:  <span style="background-color: red"> 99+              _bordersAllowed = false;</span><br>         183:  <span style="background-color: white">              }</span><br>         184:  <span style="background-color: white">          }</span><br>         185:  <span style="background-color: white">      </span><br>         186:  <span style="background-color: white">          /**</span><br>         187:  <span style="background-color: white">           * derives a child style from this style.</span><br>         188:  <span style="background-color: white">           * <br></span><br>         189:  <span style="background-color: white">           * depends on the ability to return the identical CascadedStyle each time a child style is needed</span><br>         190:  <span style="background-color: white">           *</span><br>         191:  <span style="background-color: white">           * @param matched the CascadedStyle to apply</span><br>         192:  <span style="background-color: white">           * @return The derived child style</span><br>         193:  <span style="background-color: white">           */</span><br>         194:  <span style="background-color: red"> 99+      public synchronized CalculatedStyle deriveStyle(CascadedStyle matched) {</span><br>         195:  <span style="background-color: red"> 99+          String fingerprint = matched.getFingerprint();</span><br>         196:  <span style="background-color: red"> 99+          CalculatedStyle cs = _childCache.get(fingerprint);</span><br>         197:  <span style="background-color: white">      </span><br>         198:  <span style="background-color: red"> 99+          if (cs == null) {</span><br>         199:  <span style="background-color: red"> 99+              cs = new CalculatedStyle(this, matched);</span><br>         200:  <span style="background-color: red"> 99+              _childCache.put(fingerprint, cs);</span><br>         201:  <span style="background-color: white">              }</span><br>         202:  <span style="background-color: red"> 99+          return cs;</span><br>         203:  <span style="background-color: white">          }</span><br>         204:  <span style="background-color: white">      </span><br>         205:  <span style="background-color: yellow">   0      public int countAssigned() {</span><br>         206:  <span style="background-color: yellow">   0          int c = 0;</span><br>         207:  <span style="background-color: yellow">   0          for (int i = 0; i &lt; _derivedValuesById.length; i++) {</span><br>         208:  <span style="background-color: yellow">   0              if (_derivedValuesById[i] != null) c++;</span><br>         209:  <span style="background-color: yellow">              }</span><br>         210:  <span style="background-color: yellow">   0          return c;</span><br>         211:  <span style="background-color: yellow">          }</span><br>         212:  <span style="background-color: white">      </span><br>         213:  <span style="background-color: white">          /**</span><br>         214:  <span style="background-color: white">           * Returns the parent style.</span><br>         215:  <span style="background-color: white">           *</span><br>         216:  <span style="background-color: white">           * @return Returns the parent style</span><br>         217:  <span style="background-color: white">           */</span><br>         218:  <span style="background-color: red"> 99+      public CalculatedStyle getParent() {</span><br>         219:  <span style="background-color: white"> 99+          return _parent;</span><br>         220:  <span style="background-color: white">          }</span><br>         221:  <span style="background-color: white">      </span><br>         222:  <span style="background-color: white">          /**</span><br>         223:  <span style="background-color: white">           * Converts to a String representation of the object.</span><br>         224:  <span style="background-color: white">           *</span><br>         225:  <span style="background-color: white">           * @return The borderWidth value</span><br>         226:  <span style="background-color: white">           */</span><br>         227:  <span style="background-color: white">   0      @Override</span><br>         228:  <span style="background-color: white">          public String toString() {</span><br>         229:  <span style="background-color: white">   0          return genStyleKey();</span><br>         230:  <span style="background-color: white">          }</span><br>         231:  <span style="background-color: white">      </span><br>         232:  <span style="background-color: red"> 99+      public FSColor asColor(CSSName cssName) {</span><br>         233:  <span style="background-color: red"> 99+          FSDerivedValue prop = valueByName(cssName);</span><br>         234:  <span style="background-color: red"> 99+          if (prop == IdentValue.TRANSPARENT) {</span><br>         235:  <span style="background-color: white">   0              return FSRGBColor.TRANSPARENT;</span><br>         236:  <span style="background-color: white">              } else {</span><br>         237:  <span style="background-color: red"> 99+              return prop.asColor();</span><br>         238:  <span style="background-color: white">              }</span><br>         239:  <span style="background-color: white">          }</span><br>         240:  <span style="background-color: white">      </span><br>         241:  <span style="background-color: cyan"> 99+      public float asFloat(CSSName cssName) {</span><br>         242:  <span style="background-color: cyan"> 99+          return valueByName(cssName).asFloat();</span><br>         243:  <span style="background-color: white">          }</span><br>         244:  <span style="background-color: white">      </span><br>         245:  <span style="background-color: white">   0      public String asString(CSSName cssName) {</span><br>         246:  <span style="background-color: white">   0          return valueByName(cssName).asString();</span><br>         247:  <span style="background-color: white">          }</span><br>         248:  <span style="background-color: white">      </span><br>         249:  <span style="background-color: white">  96      public String[] asStringArray(CSSName cssName) {</span><br>         250:  <span style="background-color: white">  96          return valueByName(cssName).asStringArray();</span><br>         251:  <span style="background-color: white">          }</span><br>         252:  <span style="background-color: white">      </span><br>         253:  <span style="background-color: yellow">   0      public void setDefaultValue(CSSName cssName, FSDerivedValue fsDerivedValue) {</span><br>         254:  <span style="background-color: yellow">   0          if (_derivedValuesById[cssName.FS_ID] == null) {</span><br>         255:  <span style="background-color: yellow">   0              _derivedValuesById[cssName.FS_ID] = fsDerivedValue;</span><br>         256:  <span style="background-color: yellow">              }</span><br>         257:  <span style="background-color: yellow">          }</span><br>         258:  <span style="background-color: white">      </span><br>         259:  <span style="background-color: white">          // TODO: doc</span><br>         260:  <span style="background-color: cyan"> 99+      public boolean hasAbsoluteUnit(CSSName cssName) {</span><br>         261:  <span style="background-color: cyan"> 99+          boolean isAbs = false;</span><br>         262:  <span style="background-color: white"> 99+          try {</span><br>         263:  <span style="background-color: cyan"> 99+              isAbs = valueByName(cssName).hasAbsoluteUnit();</span><br>         264:  <span style="background-color: white">              } catch (Exception e) {</span><br>         265:  <span style="background-color: white">   0              XRLog.log(Level.WARNING, LogMessageId.LogMessageId2Param.LAYOUT_CSS_PROPERTY_HAS_UNPROCESSABLE_ASSIGNMENT, cssName, e.getMessage());</span><br>         266:  <span style="background-color: white">   0              isAbs = false;</span><br>         267:  <span style="background-color: white">              }</span><br>         268:  <span style="background-color: cyan"> 99+          return isAbs;</span><br>         269:  <span style="background-color: white">          }</span><br>         270:  <span style="background-color: white">      </span><br>         271:  <span style="background-color: white">          /**</span><br>         272:  <span style="background-color: white">           * Gets the ident attribute of the CalculatedStyle object</span><br>         273:  <span style="background-color: white">           *</span><br>         274:  <span style="background-color: white">           * @param cssName PARAM</span><br>         275:  <span style="background-color: white">           * @param val     PARAM</span><br>         276:  <span style="background-color: white">           * @return The ident value</span><br>         277:  <span style="background-color: white">           */</span><br>         278:  <span style="background-color: red"> 99+      public boolean isIdent(CSSName cssName, IdentValue val) {</span><br>         279:  <span style="background-color: red"> 99+          return valueByName(cssName) == val;</span><br>         280:  <span style="background-color: white">          }</span><br>         281:  <span style="background-color: white">      </span><br>         282:  <span style="background-color: white">          /**</span><br>         283:  <span style="background-color: white">           * Gets the ident attribute of the CalculatedStyle object</span><br>         284:  <span style="background-color: white">           *</span><br>         285:  <span style="background-color: white">           * @param cssName PARAM</span><br>         286:  <span style="background-color: white">           * @return The ident value</span><br>         287:  <span style="background-color: white">           */</span><br>         288:  <span style="background-color: red"> 99+      public IdentValue getIdent(CSSName cssName) {</span><br>         289:  <span style="background-color: red"> 99+          return valueByName(cssName).asIdentValue();</span><br>         290:  <span style="background-color: white">          }</span><br>         291:  <span style="background-color: white">      </span><br>         292:  <span style="background-color: white">          /**</span><br>         293:  <span style="background-color: white">           * Convenience property accessor; returns a Color initialized with the</span><br>         294:  <span style="background-color: white">           * foreground color Uses the actual value (computed actual value) for this</span><br>         295:  <span style="background-color: white">           * element.</span><br>         296:  <span style="background-color: white">           *</span><br>         297:  <span style="background-color: white">           * @return The color value</span><br>         298:  <span style="background-color: white">           */</span><br>         299:  <span style="background-color: red"> 99+      public FSColor getColor() {</span><br>         300:  <span style="background-color: red"> 99+          return asColor(CSSName.COLOR);</span><br>         301:  <span style="background-color: white">          }</span><br>         302:  <span style="background-color: white">      </span><br>         303:  <span style="background-color: white">          /**</span><br>         304:  <span style="background-color: white">           * Convenience property accessor; returns a Color initialized with the</span><br>         305:  <span style="background-color: white">           * background color value; Uses the actual value (computed actual value) for</span><br>         306:  <span style="background-color: white">           * this element.</span><br>         307:  <span style="background-color: white">           *</span><br>         308:  <span style="background-color: white">           * @return The backgroundColor value</span><br>         309:  <span style="background-color: white">           */</span><br>         310:  <span style="background-color: red"> 99+      public FSColor getBackgroundColor() {</span><br>         311:  <span style="background-color: red"> 99+          FSDerivedValue prop = valueByName(CSSName.BACKGROUND_COLOR);</span><br>         312:  <span style="background-color: red"> 99+          if (prop == IdentValue.TRANSPARENT) {</span><br>         313:  <span style="background-color: red"> 99+              return null;</span><br>         314:  <span style="background-color: white">              } else {</span><br>         315:  <span style="background-color: red"> 99+              return asColor(CSSName.BACKGROUND_COLOR);</span><br>         316:  <span style="background-color: white">              }</span><br>         317:  <span style="background-color: white">          }</span><br>         318:  <span style="background-color: white">      </span><br>         319:  <span style="background-color: red"> 99+      public List
       <counterdata>
         getCounterReset() {
       </counterdata></span><br>         320:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(CSSName.COUNTER_RESET);</span><br>         321:  <span style="background-color: white">      </span><br>         322:  <span style="background-color: red"> 99+          if (value == IdentValue.NONE) {</span><br>         323:  <span style="background-color: red"> 99+              return null;</span><br>         324:  <span style="background-color: white">              } else {</span><br>         325:  <span style="background-color: white">   0              return ((CountersValue) value).getValues();</span><br>         326:  <span style="background-color: white">              }</span><br>         327:  <span style="background-color: white">          }</span><br>         328:  <span style="background-color: white">      </span><br>         329:  <span style="background-color: red"> 99+      public List
       <counterdata>
         getCounterIncrement() {
       </counterdata></span><br>         330:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(CSSName.COUNTER_INCREMENT);</span><br>         331:  <span style="background-color: white">      </span><br>         332:  <span style="background-color: red"> 99+          if (value == IdentValue.NONE) {</span><br>         333:  <span style="background-color: red"> 99+              return null;</span><br>         334:  <span style="background-color: white">              } else {</span><br>         335:  <span style="background-color: red">   0              return  ((CountersValue) value).getValues();</span><br>         336:  <span style="background-color: white">              }</span><br>         337:  <span style="background-color: white">          }</span><br>         338:  <span style="background-color: white">      </span><br>         339:  <span style="background-color: red"> 99+      public BorderPropertySet getBorder(CssContext ctx) {</span><br>         340:  <span style="background-color: white"> 99+          if (! _bordersAllowed) {</span><br>         341:  <span style="background-color: white"> 99+              return BorderPropertySet.EMPTY_BORDER;</span><br>         342:  <span style="background-color: white">              } else {</span><br>         343:  <span style="background-color: red"> 99+              BorderPropertySet b = getBorderProperty(this, ctx);</span><br>         344:  <span style="background-color: red"> 99+              return b;</span><br>         345:  <span style="background-color: white">              }</span><br>         346:  <span style="background-color: white">          }</span><br>         347:  <span style="background-color: white">      </span><br>         348:  <span style="background-color: red"> 99+      public FontSpecification getFont(CssContext ctx) {</span><br>         349:  <span style="background-color: red"> 99+          if (_font == null) {</span><br>         350:  <span style="background-color: red"> 99+              _font = new FontSpecification();</span><br>         351:  <span style="background-color: white">      </span><br>         352:  <span style="background-color: red"> 99+              _font.families = valueByName(CSSName.FONT_FAMILY).asStringArray();</span><br>         353:  <span style="background-color: white">      </span><br>         354:  <span style="background-color: red"> 99+              FSDerivedValue fontSize = valueByName(CSSName.FONT_SIZE);</span><br>         355:  <span style="background-color: red"> 99+              if (fontSize instanceof IdentValue) {</span><br>         356:  <span style="background-color: red"> 99+                  PropertyValue replacement;</span><br>         357:  <span style="background-color: red"> 99+                  IdentValue resolved = resolveAbsoluteFontSize();</span><br>         358:  <span style="background-color: red"> 99+                  if (resolved != null) {</span><br>         359:  <span style="background-color: red"> 99+                      replacement = FontSizeHelper.resolveAbsoluteFontSize(resolved, _font.families);</span><br>         360:  <span style="background-color: white">                      } else {</span><br>         361:  <span style="background-color: white">   0                      replacement = FontSizeHelper.getDefaultRelativeFontSize((IdentValue) fontSize);</span><br>         362:  <span style="background-color: white">                      }</span><br>         363:  <span style="background-color: red"> 99+                  _font.size = LengthValue.calcFloatProportionalValue(</span><br>         364:  <span style="background-color: white">                              this, CSSName.FONT_SIZE, replacement.getCssText(),</span><br>         365:  <span style="background-color: white">                              replacement.getFloatValue(), replacement.getPrimitiveType(), 0, ctx);</span><br>         366:  <span style="background-color: white">                  } else {</span><br>         367:  <span style="background-color: red"> 99+                  _font.size = getFloatPropertyProportionalTo(CSSName.FONT_SIZE, 0, ctx);</span><br>         368:  <span style="background-color: white">                  }</span><br>         369:  <span style="background-color: white">      </span><br>         370:  <span style="background-color: red"> 99+              _font.fontWeight = getIdent(CSSName.FONT_WEIGHT);</span><br>         371:  <span style="background-color: white">      </span><br>         372:  <span style="background-color: red"> 99+              _font.fontStyle = getIdent(CSSName.FONT_STYLE);</span><br>         373:  <span style="background-color: red"> 99+              _font.variant = getIdent(CSSName.FONT_VARIANT);</span><br>         374:  <span style="background-color: white">              }</span><br>         375:  <span style="background-color: white"> 99+          return _font;</span><br>         376:  <span style="background-color: white">          }</span><br>         377:  <span style="background-color: white">      </span><br>         378:  <span style="background-color: red"> 99+      public FontSpecification getFontSpecification() {</span><br>         379:  <span style="background-color: white"> 99+      return _font;</span><br>         380:  <span style="background-color: white">          }</span><br>         381:  <span style="background-color: white">      </span><br>         382:  <span style="background-color: red"> 99+      private IdentValue resolveAbsoluteFontSize() {</span><br>         383:  <span style="background-color: red"> 99+          FSDerivedValue fontSize = valueByName(CSSName.FONT_SIZE);</span><br>         384:  <span style="background-color: red"> 99+          if (! (fontSize instanceof IdentValue)) {</span><br>         385:  <span style="background-color: white">   0              return null;</span><br>         386:  <span style="background-color: white">              }</span><br>         387:  <span style="background-color: red"> 99+          IdentValue fontSizeIdent = (IdentValue) fontSize;</span><br>         388:  <span style="background-color: red"> 99+          if (PrimitivePropertyBuilders.ABSOLUTE_FONT_SIZES.get(fontSizeIdent.FS_ID)) {</span><br>         389:  <span style="background-color: red"> 99+              return fontSizeIdent;</span><br>         390:  <span style="background-color: white">              }</span><br>         391:  <span style="background-color: white">      </span><br>         392:  <span style="background-color: white">   0          IdentValue parent = getParent().resolveAbsoluteFontSize();</span><br>         393:  <span style="background-color: white">   0          if (parent != null) {</span><br>         394:  <span style="background-color: white">   0              if (fontSizeIdent == IdentValue.SMALLER) {</span><br>         395:  <span style="background-color: white">   0                  return FontSizeHelper.getNextSmaller(parent);</span><br>         396:  <span style="background-color: white">   0              } else if (fontSize == IdentValue.LARGER) {</span><br>         397:  <span style="background-color: white">   0                  return FontSizeHelper.getNextLarger(parent);</span><br>         398:  <span style="background-color: white">                  }</span><br>         399:  <span style="background-color: white">              }</span><br>         400:  <span style="background-color: white">      </span><br>         401:  <span style="background-color: white">   0          return null;</span><br>         402:  <span style="background-color: white">          }</span><br>         403:  <span style="background-color: white">      </span><br>         404:  <span style="background-color: red"> 99+      public float getFloatPropertyProportionalTo(CSSName cssName, float baseValue, CssContext ctx) {</span><br>         405:  <span style="background-color: red"> 99+          return valueByName(cssName).getFloatProportionalTo(cssName, baseValue, ctx);</span><br>         406:  <span style="background-color: white">          }</span><br>         407:  <span style="background-color: white">      </span><br>         408:  <span style="background-color: white">          /**</span><br>         409:  <span style="background-color: white">           * @param cssName</span><br>         410:  <span style="background-color: white">           * @param parentWidth</span><br>         411:  <span style="background-color: white">           * @param ctx</span><br>         412:  <span style="background-color: white">           * @return TODO</span><br>         413:  <span style="background-color: white">           */</span><br>         414:  <span style="background-color: red"> 99+      public float getFloatPropertyProportionalWidth(CSSName cssName, float parentWidth, CssContext ctx) {</span><br>         415:  <span style="background-color: red"> 99+          return valueByName(cssName).getFloatProportionalTo(cssName, parentWidth, ctx);</span><br>         416:  <span style="background-color: white">          }</span><br>         417:  <span style="background-color: white">      </span><br>         418:  <span style="background-color: white">          /**</span><br>         419:  <span style="background-color: white">           * @param cssName</span><br>         420:  <span style="background-color: white">           * @param parentHeight</span><br>         421:  <span style="background-color: white">           * @param ctx</span><br>         422:  <span style="background-color: white">           * @return TODO</span><br>         423:  <span style="background-color: white">           */</span><br>         424:  <span style="background-color: red"> 99+      public float getFloatPropertyProportionalHeight(CSSName cssName, float parentHeight, CssContext ctx) {</span><br>         425:  <span style="background-color: red"> 99+          return valueByName(cssName).getFloatProportionalTo(cssName, parentHeight, ctx);</span><br>         426:  <span style="background-color: white">          }</span><br>         427:  <span style="background-color: white">      </span><br>         428:  <span style="background-color: red"> 99+      public float getLineHeight(CssContext ctx) {</span><br>         429:  <span style="background-color: white"> 99+          if (! _lineHeightResolved) {</span><br>         430:  <span style="background-color: red"> 99+              if (isIdent(CSSName.LINE_HEIGHT, IdentValue.NORMAL)) {</span><br>         431:  <span style="background-color: red"> 99+                  float lineHeight1 = getFont(ctx).size * 1.1f;</span><br>         432:  <span style="background-color: white">                      // Make sure rasterized characters will (probably) fit inside</span><br>         433:  <span style="background-color: white">                      // the line box</span><br>         434:  <span style="background-color: red"> 99+                  FSFontMetrics metrics = getFSFontMetrics(ctx);</span><br>         435:  <span style="background-color: red"> 99+                  float lineHeight2 = (float)Math.ceil(metrics.getDescent() + metrics.getAscent());</span><br>         436:  <span style="background-color: red"> 99+                  _lineHeight = Math.max(lineHeight1, lineHeight2);</span><br>         437:  <span style="background-color: red"> 99+              } else if (isLength(CSSName.LINE_HEIGHT)) {</span><br>         438:  <span style="background-color: white">                      //could be more elegant, I suppose</span><br>         439:  <span style="background-color: red">  73                  _lineHeight = getFloatPropertyProportionalHeight(CSSName.LINE_HEIGHT, 0, ctx);</span><br>         440:  <span style="background-color: white">                  } else {</span><br>         441:  <span style="background-color: white">                      //must be a number</span><br>         442:  <span style="background-color: white">  85                  _lineHeight = getFont(ctx).size * valueByName(CSSName.LINE_HEIGHT).asFloat();</span><br>         443:  <span style="background-color: white">                  }</span><br>         444:  <span style="background-color: red"> 99+              _lineHeightResolved = true;</span><br>         445:  <span style="background-color: white">              }</span><br>         446:  <span style="background-color: white"> 99+          return _lineHeight;</span><br>         447:  <span style="background-color: white">          }</span><br>         448:  <span style="background-color: white">      </span><br>         449:  <span style="background-color: white">          /**</span><br>         450:  <span style="background-color: white">           * Convenience property accessor; returns a Border initialized with the</span><br>         451:  <span style="background-color: white">           * four-sided margin width. Uses the actual value (computed actual value)</span><br>         452:  <span style="background-color: white">           * for this element.</span><br>         453:  <span style="background-color: white">           *</span><br>         454:  <span style="background-color: white">           * @param cbWidth</span><br>         455:  <span style="background-color: white">           * @param ctx</span><br>         456:  <span style="background-color: white">           * @return The marginWidth value</span><br>         457:  <span style="background-color: white">           */</span><br>         458:  <span style="background-color: red"> 99+      public RectPropertySet getMarginRect(float cbWidth, CssContext ctx) {</span><br>         459:  <span style="background-color: red"> 99+          return getMarginRect(cbWidth, ctx, true);</span><br>         460:  <span style="background-color: white">          }</span><br>         461:  <span style="background-color: white">      </span><br>         462:  <span style="background-color: red"> 99+      public RectPropertySet getMarginRect(float cbWidth, CssContext ctx, boolean useCache) {</span><br>         463:  <span style="background-color: white"> 99+          if (! _marginsAllowed) {</span><br>         464:  <span style="background-color: white"> 99+              return RectPropertySet.ALL_ZEROS;</span><br>         465:  <span style="background-color: white">              } else {</span><br>         466:  <span style="background-color: white"> 99+              return getMarginProperty(</span><br>         467:  <span style="background-color: white">                          this, CSSName.MARGIN_SHORTHAND, CSSName.MARGIN_SIDE_PROPERTIES, cbWidth, ctx, useCache);</span><br>         468:  <span style="background-color: white">              }</span><br>         469:  <span style="background-color: white">          }</span><br>         470:  <span style="background-color: white">      </span><br>         471:  <span style="background-color: white">          /**</span><br>         472:  <span style="background-color: white">           * Convenience property accessor; returns a Border initialized with the</span><br>         473:  <span style="background-color: white">           * four-sided padding width. Uses the actual value (computed actual value)</span><br>         474:  <span style="background-color: white">           * for this element.</span><br>         475:  <span style="background-color: white">           *</span><br>         476:  <span style="background-color: white">           * @param cbWidth</span><br>         477:  <span style="background-color: white">           * @param ctx</span><br>         478:  <span style="background-color: white">           * @return The paddingWidth value</span><br>         479:  <span style="background-color: white">           */</span><br>         480:  <span style="background-color: red"> 99+      public RectPropertySet getPaddingRect(float cbWidth, CssContext ctx, boolean useCache) {</span><br>         481:  <span style="background-color: white"> 99+          if (! _paddingAllowed) {</span><br>         482:  <span style="background-color: white"> 99+              return RectPropertySet.ALL_ZEROS;</span><br>         483:  <span style="background-color: white">              } else {</span><br>         484:  <span style="background-color: red"> 99+              return getPaddingProperty(this, CSSName.PADDING_SHORTHAND, CSSName.PADDING_SIDE_PROPERTIES, cbWidth, ctx, useCache);</span><br>         485:  <span style="background-color: white">              }</span><br>         486:  <span style="background-color: white">          }</span><br>         487:  <span style="background-color: white">      </span><br>         488:  <span style="background-color: red"> 99+      public RectPropertySet getPaddingRect(float cbWidth, CssContext ctx) {</span><br>         489:  <span style="background-color: red"> 99+          return getPaddingRect(cbWidth, ctx, true);</span><br>         490:  <span style="background-color: white">          }</span><br>         491:  <span style="background-color: white">      </span><br>         492:  <span style="background-color: white">          /**</span><br>         493:  <span style="background-color: white">           * @param cssName</span><br>         494:  <span style="background-color: white">           * @return TODO</span><br>         495:  <span style="background-color: white">           */</span><br>         496:  <span style="background-color: white"> 99+      public String getStringProperty(CSSName cssName) {</span><br>         497:  <span style="background-color: white"> 99+          return valueByName(cssName).asString();</span><br>         498:  <span style="background-color: white">          }</span><br>         499:  <span style="background-color: white">      </span><br>         500:  <span style="background-color: white">          /**</span><br>         501:  <span style="background-color: white">           * TODO: doc</span><br>         502:  <span style="background-color: white">           */</span><br>         503:  <span style="background-color: red"> 99+      public boolean isLength(CSSName cssName) {</span><br>         504:  <span style="background-color: red"> 99+          FSDerivedValue val = valueByName(cssName);</span><br>         505:  <span style="background-color: red"> 99+          return val instanceof LengthValue;</span><br>         506:  <span style="background-color: white">          }</span><br>         507:  <span style="background-color: white">      </span><br>         508:  <span style="background-color: red"> 99+      public boolean isLengthOrNumber(CSSName cssName) {</span><br>         509:  <span style="background-color: red"> 99+          FSDerivedValue val = valueByName(cssName);</span><br>         510:  <span style="background-color: red"> 99+          return val instanceof NumberValue || val instanceof LengthValue;</span><br>         511:  <span style="background-color: white">          }</span><br>         512:  <span style="background-color: white">      </span><br>         513:  <span style="background-color: white">          /**</span><br>         514:  <span style="background-color: white">           * Returns a {@link FSDerivedValue} by name. Because we are a derived</span><br>         515:  <span style="background-color: white">           * style, the property will already be resolved at this point.</span><br>         516:  <span style="background-color: white">           *</span><br>         517:  <span style="background-color: white">           * @param cssName The CSS property name, e.g. "font-family"</span><br>         518:  <span style="background-color: white">           * @return See desc.</span><br>         519:  <span style="background-color: white">           */</span><br>         520:  <span style="background-color: red"> 99+      public FSDerivedValue valueByName(CSSName cssName) {</span><br>         521:  <span style="background-color: red"> 99+          FSDerivedValue val = _derivedValuesById[cssName.FS_ID];</span><br>         522:  <span style="background-color: white">      </span><br>         523:  <span style="background-color: red"> 99+          boolean needInitialValue = val == IdentValue.FS_INITIAL_VALUE;</span><br>         524:  <span style="background-color: white">      </span><br>         525:  <span style="background-color: white">              // but the property may not be defined for this Element</span><br>         526:  <span style="background-color: red"> 99+          if (val == null || needInitialValue) {</span><br>         527:  <span style="background-color: white">                  // if it is inheritable (like color) and we are not root, ask our parent</span><br>         528:  <span style="background-color: white">                  // for the value</span><br>         529:  <span style="background-color: white">   0              if (! needInitialValue &amp;&amp; CSSName.propertyInherits(cssName)</span><br>         530:  <span style="background-color: white">                          &amp;&amp; _parent != null</span><br>         531:  <span style="background-color: white">                          //</span><br>         532:  <span style="background-color: white">                          &amp;&amp; (val = _parent.valueByName(cssName)) != null) {</span><br>         533:  <span style="background-color: white">                      // Do nothing, val is already set</span><br>         534:  <span style="background-color: white">                  } else {</span><br>         535:  <span style="background-color: white">                      // otherwise, use the initial value (defined by the CSS2 Spec)</span><br>         536:  <span style="background-color: red"> 99+                  String initialValue = CSSName.initialValue(cssName);</span><br>         537:  <span style="background-color: red"> 99+                  if (initialValue == null) {</span><br>         538:  <span style="background-color: white">   0                      throw new XRRuntimeException("Property '" + cssName + "' has no initial values assigned. " +</span><br>         539:  <span style="background-color: white">                                  "Check CSSName declarations.");</span><br>         540:  <span style="background-color: white">                      }</span><br>         541:  <span style="background-color: red"> 99+                  if (initialValue.charAt(0) == '=') {</span><br>         542:  <span style="background-color: red"> 99+                      CSSName ref = CSSName.getByPropertyName(initialValue.substring(1));</span><br>         543:  <span style="background-color: red"> 99+                      val = valueByName(ref);</span><br>         544:  <span style="background-color: white">                      } else {</span><br>         545:  <span style="background-color: red"> 99+                      val = CSSName.initialDerivedValue(cssName);</span><br>         546:  <span style="background-color: white">                      }</span><br>         547:  <span style="background-color: white">                  }</span><br>         548:  <span style="background-color: red"> 99+              _derivedValuesById[cssName.FS_ID] = val;</span><br>         549:  <span style="background-color: white">              }</span><br>         550:  <span style="background-color: red"> 99+          return val;</span><br>         551:  <span style="background-color: white">          }</span><br>         552:  <span style="background-color: white">      </span><br>         553:  <span style="background-color: white">          /**</span><br>         554:  <span style="background-color: white">           * <p></p></span><br>         555:  <span style="background-color: white">           * <p></p></span><br>         556:  <span style="background-color: white">           * <p></p></span><br>         557:  <span style="background-color: white">           * <p></p></span><br>         558:  <span style="background-color: white">           * Implements cascade/inherit/important logic. This should result in the</span><br>         559:  <span style="background-color: white">           * element for this style having a value for *each and every* (visual)</span><br>         560:  <span style="background-color: white">           * property in the CSS2 spec. The implementation is based on the notion that</span><br>         561:  <span style="background-color: white">           * the matched styles are given to us in a perfectly sorted order, such that</span><br>         562:  <span style="background-color: white">           * properties appearing later in the rule-set always override properties</span><br>         563:  <span style="background-color: white">           * appearing earlier. It also assumes that all properties in the CSS2 spec</span><br>         564:  <span style="background-color: white">           * are defined somewhere across all the matched styles; for example, that</span><br>         565:  <span style="background-color: white">           * the full-property set is given in the user-agent CSS that is always</span><br>         566:  <span style="background-color: white">           * loaded with styles. The current implementation makes no attempt to check</span><br>         567:  <span style="background-color: white">           * either of these assumptions. When this method exits, the derived property</span><br>         568:  <span style="background-color: white">           * list for this class will be populated with the properties defined for</span><br>         569:  <span style="background-color: white">           * this element, properly cascaded.<p></p></span><br>         570:  <span style="background-color: white">           *</span><br>         571:  <span style="background-color: white">           * @param matched PARAM</span><br>         572:  <span style="background-color: white">           */</span><br>         573:  <span style="background-color: red"> 99+      private void derive(CascadedStyle matched) {</span><br>         574:  <span style="background-color: red"> 99+          if (matched == null) {</span><br>         575:  <span style="background-color: white">   0              return;</span><br>         576:  <span style="background-color: white">              }//nothing to derive</span><br>         577:  <span style="background-color: white">      </span><br>         578:  <span style="background-color: red"> 99+  		for (PropertyDeclaration pd : matched.getCascadedPropertyDeclarations()) {</span><br>         579:  <span style="background-color: red"> 99+              FSDerivedValue val = deriveValue(pd.getCSSName(), pd.getValue());</span><br>         580:  <span style="background-color: red"> 99+              _derivedValuesById[pd.getCSSName().FS_ID] = val;</span><br>         581:  <span style="background-color: white">              }</span><br>         582:  <span style="background-color: white">          }</span><br>         583:  <span style="background-color: white">      </span><br>         584:  <span style="background-color: red"> 99+      private FSDerivedValue deriveValue(CSSName cssName, CSSPrimitiveValue value) {</span><br>         585:  <span style="background-color: red"> 99+          return DerivedValueFactory.newDerivedValue(this, cssName, (PropertyValue) value);</span><br>         586:  <span style="background-color: white">          }</span><br>         587:  <span style="background-color: white">      </span><br>         588:  <span style="background-color: white">   0      private String genStyleKey() {</span><br>         589:  <span style="background-color: white">   0          StringBuilder  sb = new StringBuilder();</span><br>         590:  <span style="background-color: white">   0          for (int i = 0; i &lt; _derivedValuesById.length; i++) {</span><br>         591:  <span style="background-color: white">   0              CSSName name = CSSName.getByID(i);</span><br>         592:  <span style="background-color: white">   0              FSDerivedValue val = _derivedValuesById[i];</span><br>         593:  <span style="background-color: white">   0              if (val != null) {</span><br>         594:  <span style="background-color: white">   0                  sb.append(name.toString());</span><br>         595:  <span style="background-color: white">                  } else {</span><br>         596:  <span style="background-color: white">   0                  sb.append("(no prop assigned in this pos)");</span><br>         597:  <span style="background-color: white">                  }</span><br>         598:  <span style="background-color: white">   0              sb.append("|\n");</span><br>         599:  <span style="background-color: white">              }</span><br>         600:  <span style="background-color: white">   0          return sb.toString();</span><br>         601:  <span style="background-color: white">      </span><br>         602:  <span style="background-color: white">          }</span><br>         603:  <span style="background-color: white">      </span><br>         604:  <span style="background-color: white">   0      public RectPropertySet getCachedPadding() {</span><br>         605:  <span style="background-color: white">   0          if (_padding == null) {</span><br>         606:  <span style="background-color: white">   0              throw new XRRuntimeException("No padding property cached yet; should have called getPropertyRect() at least once before.");</span><br>         607:  <span style="background-color: white">              } else {</span><br>         608:  <span style="background-color: white">   0              return _padding;</span><br>         609:  <span style="background-color: white">              }</span><br>         610:  <span style="background-color: white">          }</span><br>         611:  <span style="background-color: white">      </span><br>         612:  <span style="background-color: white">   0      public RectPropertySet getCachedMargin() {</span><br>         613:  <span style="background-color: white">   0          if (_margin == null) {</span><br>         614:  <span style="background-color: white">   0              throw new XRRuntimeException("No margin property cached yet; should have called getMarginRect() at least once before.");</span><br>         615:  <span style="background-color: white">              } else {</span><br>         616:  <span style="background-color: white">   0              return _margin;</span><br>         617:  <span style="background-color: white">              }</span><br>         618:  <span style="background-color: white">          }</span><br>         619:  <span style="background-color: white">      </span><br>         620:  <span style="background-color: red"> 99+      private static RectPropertySet getPaddingProperty(CalculatedStyle style,</span><br>         621:  <span style="background-color: white">                                                            CSSName shorthandProp,</span><br>         622:  <span style="background-color: white">                                                            CSSName.CSSSideProperties sides,</span><br>         623:  <span style="background-color: white">                                                            float cbWidth,</span><br>         624:  <span style="background-color: white">                                                            CssContext ctx,</span><br>         625:  <span style="background-color: white">                                                            boolean useCache) {</span><br>         626:  <span style="background-color: red"> 99+          if (! useCache) {</span><br>         627:  <span style="background-color: white">   0              return newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>         628:  <span style="background-color: white">              } else {</span><br>         629:  <span style="background-color: red"> 99+              if (style._padding == null) {</span><br>         630:  <span style="background-color: red"> 99+                  RectPropertySet result = newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>         631:  <span style="background-color: red"> 99+                  boolean allZeros = result.isAllZeros();</span><br>         632:  <span style="background-color: white">      </span><br>         633:  <span style="background-color: red"> 99+                  if (allZeros) {</span><br>         634:  <span style="background-color: red"> 99+                      result = RectPropertySet.ALL_ZEROS;</span><br>         635:  <span style="background-color: white">                      }</span><br>         636:  <span style="background-color: white">      </span><br>         637:  <span style="background-color: red"> 99+                  style._padding = result;</span><br>         638:  <span style="background-color: white">      </span><br>         639:  <span style="background-color: red"> 99+                  if (! allZeros &amp;&amp; style._padding.hasNegativeValues()) {</span><br>         640:  <span style="background-color: white">   0                      style._padding.resetNegativeValues();</span><br>         641:  <span style="background-color: white">                      }</span><br>         642:  <span style="background-color: white">                  }</span><br>         643:  <span style="background-color: white">      </span><br>         644:  <span style="background-color: red"> 99+              return style._padding;</span><br>         645:  <span style="background-color: white">              }</span><br>         646:  <span style="background-color: white">          }</span><br>         647:  <span style="background-color: white">      </span><br>         648:  <span style="background-color: red"> 99+      private static RectPropertySet getMarginProperty(CalculatedStyle style,</span><br>         649:  <span style="background-color: white">                                                           CSSName shorthandProp,</span><br>         650:  <span style="background-color: white">                                                           CSSName.CSSSideProperties sides,</span><br>         651:  <span style="background-color: white">                                                           float cbWidth,</span><br>         652:  <span style="background-color: white">                                                           CssContext ctx,</span><br>         653:  <span style="background-color: white">                                                           boolean useCache) {</span><br>         654:  <span style="background-color: red"> 99+          if (! useCache) {</span><br>         655:  <span style="background-color: white">   0              return newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>         656:  <span style="background-color: white">              } else {</span><br>         657:  <span style="background-color: red"> 99+              if (style._margin == null) {</span><br>         658:  <span style="background-color: red"> 99+                  RectPropertySet result = newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>         659:  <span style="background-color: red"> 99+                  if (result.isAllZeros()) {</span><br>         660:  <span style="background-color: red"> 99+                      result = RectPropertySet.ALL_ZEROS;</span><br>         661:  <span style="background-color: white">                      }</span><br>         662:  <span style="background-color: red"> 99+                  style._margin = result;</span><br>         663:  <span style="background-color: white">                  }</span><br>         664:  <span style="background-color: white">      </span><br>         665:  <span style="background-color: red"> 99+              return style._margin;</span><br>         666:  <span style="background-color: white">              }</span><br>         667:  <span style="background-color: white">          }</span><br>         668:  <span style="background-color: white">      </span><br>         669:  <span style="background-color: red"> 99+      private static RectPropertySet newRectInstance(CalculatedStyle style,</span><br>         670:  <span style="background-color: white">                                                         CSSName shorthand,</span><br>         671:  <span style="background-color: white">                                                         CSSName.CSSSideProperties sides,</span><br>         672:  <span style="background-color: white">                                                         float cbWidth,</span><br>         673:  <span style="background-color: white">                                                         CssContext ctx) {</span><br>         674:  <span style="background-color: red"> 99+          RectPropertySet rect;</span><br>         675:  <span style="background-color: red"> 99+          rect = RectPropertySet.newInstance(style,</span><br>         676:  <span style="background-color: white">                      shorthand,</span><br>         677:  <span style="background-color: white">                      sides,</span><br>         678:  <span style="background-color: white">                      cbWidth,</span><br>         679:  <span style="background-color: white">                      ctx);</span><br>         680:  <span style="background-color: red"> 99+          return rect;</span><br>         681:  <span style="background-color: white">          }</span><br>         682:  <span style="background-color: white">      </span><br>         683:  <span style="background-color: red"> 99+      private static BorderPropertySet getBorderProperty(CalculatedStyle style,</span><br>         684:  <span style="background-color: white">                                                             CssContext ctx) {</span><br>         685:  <span style="background-color: red"> 99+          if (style._border == null) {</span><br>         686:  <span style="background-color: red"> 99+              BorderPropertySet result = BorderPropertySet.newInstance(style, ctx);</span><br>         687:  <span style="background-color: white">      </span><br>         688:  <span style="background-color: red"> 99+              boolean allZeros = result.isAllZeros();</span><br>         689:  <span style="background-color: red"> 99+              if (allZeros &amp;&amp; ! result.hasHidden() &amp;&amp; !result.hasBorderRadius()) {</span><br>         690:  <span style="background-color: red"> 99+                  result = BorderPropertySet.EMPTY_BORDER;</span><br>         691:  <span style="background-color: white">                  }</span><br>         692:  <span style="background-color: white">      </span><br>         693:  <span style="background-color: red"> 99+              style._border = result;</span><br>         694:  <span style="background-color: white">      </span><br>         695:  <span style="background-color: red"> 99+              if (! allZeros &amp;&amp; style._border.hasNegativeValues()) {</span><br>         696:  <span style="background-color: white">   0                  style._border.resetNegativeValues();</span><br>         697:  <span style="background-color: white">                  }</span><br>         698:  <span style="background-color: white">              }</span><br>         699:  <span style="background-color: red"> 99+          return style._border;</span><br>         700:  <span style="background-color: white">          }</span><br>         701:  <span style="background-color: white">      </span><br>         702:  <span style="background-color: white">          public static final int LEFT = 1;</span><br>         703:  <span style="background-color: white">          public static final int RIGHT = 2;</span><br>         704:  <span style="background-color: white">      </span><br>         705:  <span style="background-color: white">          public static final int TOP = 3;</span><br>         706:  <span style="background-color: white">          public static final int BOTTOM = 4;</span><br>         707:  <span style="background-color: white">      </span><br>         708:  <span style="background-color: red"> 99+      public int getMarginBorderPadding(</span><br>         709:  <span style="background-color: white">                  CssContext cssCtx, int cbWidth, int which) {</span><br>         710:  <span style="background-color: red"> 99+          BorderPropertySet border = getBorder(cssCtx);</span><br>         711:  <span style="background-color: red"> 99+          RectPropertySet margin = getMarginRect(cbWidth, cssCtx);</span><br>         712:  <span style="background-color: red"> 99+          RectPropertySet padding = getPaddingRect(cbWidth, cssCtx);</span><br>         713:  <span style="background-color: white">      </span><br>         714:  <span style="background-color: red"> 99+          switch (which) {</span><br>         715:  <span style="background-color: red"> 99+              case LEFT:</span><br>         716:  <span style="background-color: red"> 99+                  return (int) (margin.left() + border.left() + padding.left());</span><br>         717:  <span style="background-color: red"> 99+              case RIGHT:</span><br>         718:  <span style="background-color: red"> 99+                  return (int) (margin.right() + border.right() + padding.right());</span><br>         719:  <span style="background-color: red"> 99+              case TOP:</span><br>         720:  <span style="background-color: red"> 99+                  return (int) (margin.top() + border.top() + padding.top());</span><br>         721:  <span style="background-color: red"> 99+              case BOTTOM:</span><br>         722:  <span style="background-color: red"> 99+                  return (int) (margin.bottom() + border.bottom() + padding.bottom());</span><br>         723:  <span style="background-color: white">   0              default:</span><br>         724:  <span style="background-color: white">   0                  throw new IllegalArgumentException();</span><br>         725:  <span style="background-color: white">              }</span><br>         726:  <span style="background-color: white">          }</span><br>         727:  <span style="background-color: white">      </span><br>         728:  <span style="background-color: red"> 99+      public IdentValue getWhitespace() {</span><br>         729:  <span style="background-color: red"> 99+          return getIdent(CSSName.WHITE_SPACE);</span><br>         730:  <span style="background-color: white">          }</span><br>         731:  <span style="background-color: white">      </span><br>         732:  <span style="background-color: red"> 99+      public FSFont getFSFont(CssContext cssContext) {</span><br>         733:  <span style="background-color: red"> 99+          if (_FSFont == null) {</span><br>         734:  <span style="background-color: red"> 99+              _FSFont = cssContext.getFont(getFont(cssContext));</span><br>         735:  <span style="background-color: white">              }</span><br>         736:  <span style="background-color: white"> 99+          return _FSFont;</span><br>         737:  <span style="background-color: white">          }</span><br>         738:  <span style="background-color: white">      </span><br>         739:  <span style="background-color: red"> 99+      public FSFontMetrics getFSFontMetrics(CssContext c) {</span><br>         740:  <span style="background-color: red"> 99+          if (_FSFontMetrics == null) {</span><br>         741:  <span style="background-color: red"> 99+              _FSFontMetrics = c.getFSFontMetrics(getFSFont(c));</span><br>         742:  <span style="background-color: white">              }</span><br>         743:  <span style="background-color: white"> 99+          return _FSFontMetrics;</span><br>         744:  <span style="background-color: white">          }</span><br>         745:  <span style="background-color: white">      </span><br>         746:  <span style="background-color: red"> 99+      public IdentValue getWordWrap() {</span><br>         747:  <span style="background-color: red"> 99+          return getIdent(CSSName.WORD_WRAP);</span><br>         748:  <span style="background-color: white">          }</span><br>         749:  <span style="background-color: white">      </span><br>         750:  <span style="background-color: red">  11      public boolean isClearLeft() {</span><br>         751:  <span style="background-color: red">  11          IdentValue clear = getIdent(CSSName.CLEAR);</span><br>         752:  <span style="background-color: red">  11          return clear == IdentValue.LEFT || clear == IdentValue.BOTH;</span><br>         753:  <span style="background-color: white">          }</span><br>         754:  <span style="background-color: white">      </span><br>         755:  <span style="background-color: red">   5      public boolean isClearRight() {</span><br>         756:  <span style="background-color: red">   5          IdentValue clear = getIdent(CSSName.CLEAR);</span><br>         757:  <span style="background-color: red">   5          return clear == IdentValue.RIGHT || clear == IdentValue.BOTH;</span><br>         758:  <span style="background-color: white">          }</span><br>         759:  <span style="background-color: white">      </span><br>         760:  <span style="background-color: red"> 99+      public boolean isCleared() {</span><br>         761:  <span style="background-color: red"> 99+          return ! isIdent(CSSName.CLEAR, IdentValue.NONE);</span><br>         762:  <span style="background-color: white">          }</span><br>         763:  <span style="background-color: white">      </span><br>         764:  <span style="background-color: white">   0      public IdentValue getBackgroundRepeat(PropertyValue value) {</span><br>         765:  <span style="background-color: white">   0          return value.getIdentValue();</span><br>         766:  <span style="background-color: white">          }</span><br>         767:  <span style="background-color: white">      </span><br>         768:  <span style="background-color: red"> 99+      public boolean isInline() {</span><br>         769:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.INLINE) &amp;&amp;</span><br>         770:  <span style="background-color: white">                      ! (isFloated() || isAbsolute() || isFixed() || isRunning());</span><br>         771:  <span style="background-color: white">          }</span><br>         772:  <span style="background-color: white">      </span><br>         773:  <span style="background-color: red"> 99+      public boolean isInlineBlock() {</span><br>         774:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.INLINE_BLOCK);</span><br>         775:  <span style="background-color: white">          }</span><br>         776:  <span style="background-color: white">      </span><br>         777:  <span style="background-color: red"> 99+      public boolean isTable() {</span><br>         778:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE);</span><br>         779:  <span style="background-color: white">          }</span><br>         780:  <span style="background-color: white">      </span><br>         781:  <span style="background-color: red"> 99+      public boolean isInlineTable() {</span><br>         782:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.INLINE_TABLE);</span><br>         783:  <span style="background-color: white">          }</span><br>         784:  <span style="background-color: white">      </span><br>         785:  <span style="background-color: red"> 99+      public boolean isTableCell() {</span><br>         786:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_CELL);</span><br>         787:  <span style="background-color: white">          }</span><br>         788:  <span style="background-color: white">      </span><br>         789:  <span style="background-color: red"> 99+      public boolean isTableSection() {</span><br>         790:  <span style="background-color: red"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>         791:  <span style="background-color: white">      </span><br>         792:  <span style="background-color: red"> 99+          return display == IdentValue.TABLE_ROW_GROUP ||</span><br>         793:  <span style="background-color: white">                      display == IdentValue.TABLE_HEADER_GROUP ||</span><br>         794:  <span style="background-color: white">                      display == IdentValue.TABLE_FOOTER_GROUP;</span><br>         795:  <span style="background-color: white">          }</span><br>         796:  <span style="background-color: white">      </span><br>         797:  <span style="background-color: red"> 99+      public boolean isTableCaption() {</span><br>         798:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_CAPTION);</span><br>         799:  <span style="background-color: white">          }</span><br>         800:  <span style="background-color: white">      </span><br>         801:  <span style="background-color: white">   0      public boolean isTableHeader() {</span><br>         802:  <span style="background-color: white">   0          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_HEADER_GROUP);</span><br>         803:  <span style="background-color: white">          }</span><br>         804:  <span style="background-color: white">      </span><br>         805:  <span style="background-color: white">   0      public boolean isTableFooter() {</span><br>         806:  <span style="background-color: white">   0          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_FOOTER_GROUP);</span><br>         807:  <span style="background-color: white">          }</span><br>         808:  <span style="background-color: white">      </span><br>         809:  <span style="background-color: red"> 99+      public boolean isTableRow() {</span><br>         810:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_ROW);</span><br>         811:  <span style="background-color: white">          }</span><br>         812:  <span style="background-color: white">      </span><br>         813:  <span style="background-color: red"> 99+      public boolean isDisplayNone() {</span><br>         814:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.NONE);</span><br>         815:  <span style="background-color: white">          }</span><br>         816:  <span style="background-color: white">      </span><br>         817:  <span style="background-color: cyan"> 99+      public boolean isSpecifiedAsBlock() {</span><br>         818:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.BLOCK);</span><br>         819:  <span style="background-color: white">          }</span><br>         820:  <span style="background-color: white">      </span><br>         821:  <span style="background-color: white">   0      public boolean isBlockEquivalent() {</span><br>         822:  <span style="background-color: white">   0          if (isFloated() || isAbsolute() || isFixed()) {</span><br>         823:  <span style="background-color: white">   0              return true;</span><br>         824:  <span style="background-color: white">              } else {</span><br>         825:  <span style="background-color: white">   0              IdentValue display = getIdent(CSSName.DISPLAY);</span><br>         826:  <span style="background-color: white">   0              if (display == IdentValue.INLINE) {</span><br>         827:  <span style="background-color: white">   0                  return false;</span><br>         828:  <span style="background-color: white">                  } else {</span><br>         829:  <span style="background-color: white">   0                  return display == IdentValue.BLOCK || display == IdentValue.LIST_ITEM ||</span><br>         830:  <span style="background-color: white">                              display == IdentValue.RUN_IN || display == IdentValue.INLINE_BLOCK ||</span><br>         831:  <span style="background-color: white">                              display == IdentValue.TABLE || display == IdentValue.INLINE_TABLE;</span><br>         832:  <span style="background-color: white">                  }</span><br>         833:  <span style="background-color: white">              }</span><br>         834:  <span style="background-color: white">          }</span><br>         835:  <span style="background-color: white">      </span><br>         836:  <span style="background-color: red"> 99+      public boolean isLayedOutInInlineContext() {</span><br>         837:  <span style="background-color: white"> 99+          if (isFloated() || isAbsolute() || isFixed() || isRunning()) {</span><br>         838:  <span style="background-color: red"> 99+              return true;</span><br>         839:  <span style="background-color: white">              } else {</span><br>         840:  <span style="background-color: red"> 99+              IdentValue display = getIdent(CSSName.DISPLAY);</span><br>         841:  <span style="background-color: red"> 99+              return display == IdentValue.INLINE || display == IdentValue.INLINE_BLOCK ||</span><br>         842:  <span style="background-color: white">                          display == IdentValue.INLINE_TABLE;</span><br>         843:  <span style="background-color: white">              }</span><br>         844:  <span style="background-color: white">          }</span><br>         845:  <span style="background-color: white">      </span><br>         846:  <span style="background-color: white">   5      public boolean isNeedAutoMarginResolution() {</span><br>         847:  <span style="background-color: white">   5          return ! (isAbsolute() || isFixed() || isFloated() || isInlineBlock());</span><br>         848:  <span style="background-color: white">          }</span><br>         849:  <span style="background-color: white">      </span><br>         850:  <span style="background-color: red"> 99+      public boolean isAbsolute() {</span><br>         851:  <span style="background-color: red"> 99+          return isIdent(CSSName.POSITION, IdentValue.ABSOLUTE);</span><br>         852:  <span style="background-color: white">          }</span><br>         853:  <span style="background-color: white">      </span><br>         854:  <span style="background-color: red"> 99+      public boolean isFixed() {</span><br>         855:  <span style="background-color: red"> 99+          return isIdent(CSSName.POSITION, IdentValue.FIXED);</span><br>         856:  <span style="background-color: white">          }</span><br>         857:  <span style="background-color: white">      </span><br>         858:  <span style="background-color: red"> 99+      public boolean isFloated() {</span><br>         859:  <span style="background-color: red"> 99+          IdentValue floatVal = getIdent(CSSName.FLOAT);</span><br>         860:  <span style="background-color: red"> 99+          return floatVal == IdentValue.LEFT || floatVal == IdentValue.RIGHT;</span><br>         861:  <span style="background-color: white">          }</span><br>         862:  <span style="background-color: white">      </span><br>         863:  <span style="background-color: red"> 99+      public boolean isFloatedLeft() {</span><br>         864:  <span style="background-color: red"> 99+          return isIdent(CSSName.FLOAT, IdentValue.LEFT);</span><br>         865:  <span style="background-color: white">          }</span><br>         866:  <span style="background-color: white">      </span><br>         867:  <span style="background-color: red">  72      public boolean isFloatedRight() {</span><br>         868:  <span style="background-color: red">  72          return isIdent(CSSName.FLOAT, IdentValue.RIGHT);</span><br>         869:  <span style="background-color: white">          }</span><br>         870:  <span style="background-color: white">      </span><br>         871:  <span style="background-color: red"> 99+      public boolean isRelative() {</span><br>         872:  <span style="background-color: red"> 99+          return isIdent(CSSName.POSITION, IdentValue.RELATIVE);</span><br>         873:  <span style="background-color: white">          }</span><br>         874:  <span style="background-color: white">      </span><br>         875:  <span style="background-color: red">   0      public boolean isPostionedOrFloated() {</span><br>         876:  <span style="background-color: white">   0          return isAbsolute() || isFixed() || isFloated() || isRelative();</span><br>         877:  <span style="background-color: white">          }</span><br>         878:  <span style="background-color: white">      </span><br>         879:  <span style="background-color: red"> 99+      public boolean isPositioned() {</span><br>         880:  <span style="background-color: white"> 99+          return isAbsolute() || isFixed() || isRelative();</span><br>         881:  <span style="background-color: white">          }</span><br>         882:  <span style="background-color: white">      </span><br>         883:  <span style="background-color: red"> 99+      public boolean isAutoWidth() {</span><br>         884:  <span style="background-color: red"> 99+          return isIdent(CSSName.WIDTH, IdentValue.AUTO);</span><br>         885:  <span style="background-color: white">          }</span><br>         886:  <span style="background-color: white">      </span><br>         887:  <span style="background-color: white"> 99+      public boolean isAbsoluteWidth() {</span><br>         888:  <span style="background-color: white"> 99+          return valueByName(CSSName.WIDTH).hasAbsoluteUnit();</span><br>         889:  <span style="background-color: white">          }</span><br>         890:  <span style="background-color: white">      </span><br>         891:  <span style="background-color: red"> 99+      public boolean isAutoHeight() {</span><br>         892:  <span style="background-color: red"> 99+          return isIdent(CSSName.HEIGHT, IdentValue.AUTO);</span><br>         893:  <span style="background-color: white">          }</span><br>         894:  <span style="background-color: white">      </span><br>         895:  <span style="background-color: red"> 99+      public boolean isAutoLeftMargin() {</span><br>         896:  <span style="background-color: red"> 99+          return isIdent(CSSName.MARGIN_LEFT, IdentValue.AUTO);</span><br>         897:  <span style="background-color: white">          }</span><br>         898:  <span style="background-color: white">      </span><br>         899:  <span style="background-color: red"> 99+      public boolean isAutoRightMargin() {</span><br>         900:  <span style="background-color: red"> 99+          return isIdent(CSSName.MARGIN_RIGHT, IdentValue.AUTO);</span><br>         901:  <span style="background-color: white">          }</span><br>         902:  <span style="background-color: white">      </span><br>         903:  <span style="background-color: red"> 99+      public boolean isAutoZIndex() {</span><br>         904:  <span style="background-color: red"> 99+          return isIdent(CSSName.Z_INDEX, IdentValue.AUTO);</span><br>         905:  <span style="background-color: white">          }</span><br>         906:  <span style="background-color: white">      </span><br>         907:  <span style="background-color: red"> 99+      public boolean establishesBFC() {</span><br>         908:  <span style="background-color: white"> 99+          if (hasColumns()) {</span><br>         909:  <span style="background-color: white">   0              return true;</span><br>         910:  <span style="background-color: white">              }</span><br>         911:  <span style="background-color: white">              </span><br>         912:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(CSSName.POSITION);</span><br>         913:  <span style="background-color: white">      </span><br>         914:  <span style="background-color: red"> 99+          if (value instanceof FunctionValue) {  // running(header)</span><br>         915:  <span style="background-color: red"> 99+              return false;</span><br>         916:  <span style="background-color: white">              } else {</span><br>         917:  <span style="background-color: red"> 99+              IdentValue display = getIdent(CSSName.DISPLAY);</span><br>         918:  <span style="background-color: red"> 99+              IdentValue position = (IdentValue)value;</span><br>         919:  <span style="background-color: white">      </span><br>         920:  <span style="background-color: white"> 99+              return isFloated() ||</span><br>         921:  <span style="background-color: white">                          position == IdentValue.ABSOLUTE || position == IdentValue.FIXED ||</span><br>         922:  <span style="background-color: white">                          display == IdentValue.INLINE_BLOCK || display == IdentValue.TABLE_CELL ||</span><br>         923:  <span style="background-color: white">                          ! isIdent(CSSName.OVERFLOW, IdentValue.VISIBLE);</span><br>         924:  <span style="background-color: white">              }</span><br>         925:  <span style="background-color: white">          }</span><br>         926:  <span style="background-color: white">      </span><br>         927:  <span style="background-color: red"> 99+      public boolean requiresLayer() {</span><br>         928:  <span style="background-color: red"> 99+      	if (!isIdent(CSSName.TRANSFORM, IdentValue.NONE)) {</span><br>         929:  <span style="background-color: cyan"> 99+      		return true;</span><br>         930:  <span style="background-color: white">          	}</span><br>         931:  <span style="background-color: white">          	</span><br>         932:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(CSSName.POSITION);</span><br>         933:  <span style="background-color: white">      </span><br>         934:  <span style="background-color: red"> 99+          if (value instanceof FunctionValue) {  // running(header)</span><br>         935:  <span style="background-color: red"> 99+              return false;</span><br>         936:  <span style="background-color: white">              } else {</span><br>         937:  <span style="background-color: red"> 99+              IdentValue position = getIdent(CSSName.POSITION);</span><br>         938:  <span style="background-color: white">      </span><br>         939:  <span style="background-color: red"> 99+              if (position == IdentValue.ABSOLUTE ||</span><br>         940:  <span style="background-color: white">                          position == IdentValue.RELATIVE || position == IdentValue.FIXED) {</span><br>         941:  <span style="background-color: red"> 99+                  return true;</span><br>         942:  <span style="background-color: white">                  }</span><br>         943:  <span style="background-color: white">      </span><br>         944:  <span style="background-color: red"> 99+              IdentValue overflow = getIdent(CSSName.OVERFLOW);</span><br>         945:  <span style="background-color: red"> 99+              return (overflow == IdentValue.SCROLL || overflow == IdentValue.AUTO) &amp;&amp;</span><br>         946:  <span style="background-color: white">                          isOverflowApplies();</span><br>         947:  <span style="background-color: white">      </span><br>         948:  <span style="background-color: white">              }</span><br>         949:  <span style="background-color: white">          }</span><br>         950:  <span style="background-color: white">      </span><br>         951:  <span style="background-color: red"> 99+      public boolean isRunning() {</span><br>         952:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(CSSName.POSITION);</span><br>         953:  <span style="background-color: red"> 99+          return value instanceof FunctionValue;</span><br>         954:  <span style="background-color: white">          }</span><br>         955:  <span style="background-color: white">      </span><br>         956:  <span style="background-color: red">  90      public String getRunningName() {</span><br>         957:  <span style="background-color: red">  90          FunctionValue value = (FunctionValue)valueByName(CSSName.POSITION);</span><br>         958:  <span style="background-color: red">  90          FSFunction function = value.getFunction();</span><br>         959:  <span style="background-color: white">      </span><br>         960:  <span style="background-color: red">  90          PropertyValue param = function.getParameters().get(0);</span><br>         961:  <span style="background-color: white">      </span><br>         962:  <span style="background-color: red">  90          return param.getStringValue();</span><br>         963:  <span style="background-color: white">          }</span><br>         964:  <span style="background-color: white">      </span><br>         965:  <span style="background-color: red"> 99+      public boolean isOverflowApplies() {</span><br>         966:  <span style="background-color: red"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>         967:  <span style="background-color: red"> 99+          return display == IdentValue.BLOCK || display == IdentValue.LIST_ITEM ||</span><br>         968:  <span style="background-color: white">                      display == IdentValue.TABLE || display == IdentValue.INLINE_BLOCK ||</span><br>         969:  <span style="background-color: white">                      display == IdentValue.TABLE_CELL;</span><br>         970:  <span style="background-color: white">          }</span><br>         971:  <span style="background-color: white">      </span><br>         972:  <span style="background-color: red"> 99+      public boolean isOverflowVisible() {</span><br>         973:  <span style="background-color: red"> 99+          return valueByName(CSSName.OVERFLOW) == IdentValue.VISIBLE;</span><br>         974:  <span style="background-color: white">          }</span><br>         975:  <span style="background-color: white">      </span><br>         976:  <span style="background-color: red"> 99+      public boolean isHorizontalBackgroundRepeat(PropertyValue value) {</span><br>         977:  <span style="background-color: red"> 99+          return value.getIdentValue() == IdentValue.REPEAT_X || value.getIdentValue() == IdentValue.REPEAT;</span><br>         978:  <span style="background-color: white">          }</span><br>         979:  <span style="background-color: white">      </span><br>         980:  <span style="background-color: red"> 99+      public boolean isVerticalBackgroundRepeat(PropertyValue value) {</span><br>         981:  <span style="background-color: red"> 99+          return value.getIdentValue() == IdentValue.REPEAT_Y || value.getIdentValue() == IdentValue.REPEAT;</span><br>         982:  <span style="background-color: white">          }</span><br>         983:  <span style="background-color: white">      </span><br>         984:  <span style="background-color: red"> 99+      public boolean isTopAuto() {</span><br>         985:  <span style="background-color: red"> 99+          return isIdent(CSSName.TOP, IdentValue.AUTO);</span><br>         986:  <span style="background-color: white">      </span><br>         987:  <span style="background-color: white">          }</span><br>         988:  <span style="background-color: white">      </span><br>         989:  <span style="background-color: red"> 99+      public boolean isBottomAuto() {</span><br>         990:  <span style="background-color: red"> 99+          return isIdent(CSSName.BOTTOM, IdentValue.AUTO);</span><br>         991:  <span style="background-color: white">          }</span><br>         992:  <span style="background-color: white">      </span><br>         993:  <span style="background-color: red"> 99+      public boolean isListItem() {</span><br>         994:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.LIST_ITEM);</span><br>         995:  <span style="background-color: white">          }</span><br>         996:  <span style="background-color: white">          </span><br>         997:  <span style="background-color: red"> 99+      public boolean hasColumns() {</span><br>         998:  <span style="background-color: red"> 99+          return !isIdent(CSSName.COLUMN_COUNT, IdentValue.AUTO) &amp;&amp; asFloat(CSSName.COLUMN_COUNT) &gt; 1;</span><br>         999:  <span style="background-color: white">          }</span><br>        1000:  <span style="background-color: white">          </span><br>        1001:  <span style="background-color: white">   8      public int columnCount() {</span><br>        1002:  <span style="background-color: white">   8      	return (int) asFloat(CSSName.COLUMN_COUNT);</span><br>        1003:  <span style="background-color: white">          }</span><br>        1004:  <span style="background-color: white">          </span><br>        1005:  <span style="background-color: red"> 99+      public int fsMaxOverflowPages() {</span><br>        1006:  <span style="background-color: red"> 99+          return (int) asFloat(CSSName.FS_MAX_OVERFLOW_PAGES);</span><br>        1007:  <span style="background-color: white">          }</span><br>        1008:  <span style="background-color: white">      </span><br>        1009:  <span style="background-color: white">      	/**</span><br>        1010:  <span style="background-color: white">           * Determine if the element is visible. This is normaly the case</span><br>        1011:  <span style="background-color: white">           * if visibility == visible. Only when visibilty is</span><br>        1012:  <span style="background-color: white">           * -fs-table-paginate-repeated-visible and we are in a repeated table header</span><br>        1013:  <span style="background-color: white">           * the element will also be visible. This allows to only show an element in the table header</span><br>        1014:  <span style="background-color: white">           * after a page break.</span><br>        1015:  <span style="background-color: white">           * @param renderingContext null or the current renderingContext. If null,</span><br>        1016:  <span style="background-color: white">           *                         then the -fs-table-paginate-repeated-visible logic</span><br>        1017:  <span style="background-color: white">           *                         will not work.</span><br>        1018:  <span style="background-color: white">      	 * @param thisElement the element for which the visibility should be determined. Only required if</span><br>        1019:  <span style="background-color: white">           * -fs-table-paginate-repeated-visible is specified.</span><br>        1020:  <span style="background-color: white">           * @return true if the element is visible</span><br>        1021:  <span style="background-color: white">           */</span><br>        1022:  <span style="background-color: red"> 99+      public boolean isVisible(RenderingContext renderingContext, Box thisElement) {</span><br>        1023:  <span style="background-color: red"> 99+          IdentValue val = getIdent(CSSName.VISIBILITY);</span><br>        1024:  <span style="background-color: red"> 99+  		if (val == IdentValue.VISIBLE)</span><br>        1025:  <span style="background-color: red"> 99+  			return true;</span><br>        1026:  <span style="background-color: white">   0  		if (renderingContext != null) {</span><br>        1027:  <span style="background-color: white">   0  			if (val == IdentValue.FS_TABLE_PAGINATE_REPEATED_VISIBLE) {</span><br>        1028:  <span style="background-color: white">      				/*</span><br>        1029:  <span style="background-color: white">      				 * We need to find the parent TableBox which has a</span><br>        1030:  <span style="background-color: white">      				 * ContentLimitContainer and can be repeated.</span><br>        1031:  <span style="background-color: white">      				 */</span><br>        1032:  <span style="background-color: white">   0  				Box parentElement = thisElement.getParent();</span><br>        1033:  <span style="background-color: white">   0  				while (parentElement != null</span><br>        1034:  <span style="background-color: white">      						&amp;&amp; !(parentElement.getStyle().isTable()</span><br>        1035:  <span style="background-color: white">                                      &amp;&amp; ((TableBox) parentElement).hasContentLimitContainer()))</span><br>        1036:  <span style="background-color: white">   0  					parentElement = parentElement.getDocumentParent();</span><br>        1037:  <span style="background-color: white">      </span><br>        1038:  <span style="background-color: white">   0  				if (parentElement != null) {</span><br>        1039:  <span style="background-color: white">   0  				    TableBox tableBox = (TableBox) parentElement;</span><br>        1040:  <span style="background-color: white">   0                      return !tableBox.isTableRenderedOnFirstPage(renderingContext);</span><br>        1041:  <span style="background-color: white">      				}</span><br>        1042:  <span style="background-color: white">      			}</span><br>        1043:  <span style="background-color: white">      		}</span><br>        1044:  <span style="background-color: white">   0          return false;</span><br>        1045:  <span style="background-color: white">          }</span><br>        1046:  <span style="background-color: white">      </span><br>        1047:  <span style="background-color: red"> 99+      public boolean isForcePageBreakBefore() {</span><br>        1048:  <span style="background-color: red"> 99+          IdentValue val = getIdent(CSSName.PAGE_BREAK_BEFORE);</span><br>        1049:  <span style="background-color: red"> 99+          return val == IdentValue.ALWAYS || val == IdentValue.LEFT</span><br>        1050:  <span style="background-color: white">                      || val == IdentValue.RIGHT;</span><br>        1051:  <span style="background-color: white">          }</span><br>        1052:  <span style="background-color: white">      </span><br>        1053:  <span style="background-color: red"> 99+      public boolean isForcePageBreakAfter() {</span><br>        1054:  <span style="background-color: red"> 99+          IdentValue val = getIdent(CSSName.PAGE_BREAK_AFTER);</span><br>        1055:  <span style="background-color: red"> 99+          return val == IdentValue.ALWAYS || val == IdentValue.LEFT</span><br>        1056:  <span style="background-color: white">                      || val == IdentValue.RIGHT;</span><br>        1057:  <span style="background-color: white">          }</span><br>        1058:  <span style="background-color: white">          </span><br>        1059:  <span style="background-color: white"> 99+      public boolean isColumnBreakBefore() {</span><br>        1060:  <span style="background-color: white"> 99+          return isIdent(CSSName.BREAK_BEFORE, IdentValue.COLUMN);</span><br>        1061:  <span style="background-color: white">          }</span><br>        1062:  <span style="background-color: white">          </span><br>        1063:  <span style="background-color: white"> 99+      public boolean isColumnBreakAfter() {</span><br>        1064:  <span style="background-color: white"> 99+          return isIdent(CSSName.BREAK_AFTER, IdentValue.COLUMN);</span><br>        1065:  <span style="background-color: white">          }</span><br>        1066:  <span style="background-color: white">      </span><br>        1067:  <span style="background-color: red"> 99+      public boolean isAvoidPageBreakInside() {</span><br>        1068:  <span style="background-color: red"> 99+          return isIdent(CSSName.PAGE_BREAK_INSIDE, IdentValue.AVOID);</span><br>        1069:  <span style="background-color: white">          }</span><br>        1070:  <span style="background-color: white">      </span><br>        1071:  <span style="background-color: red"> 99+      public CalculatedStyle createAnonymousStyle(IdentValue display) {</span><br>        1072:  <span style="background-color: red"> 99+          return deriveStyle(CascadedStyle.createAnonymousStyle(display));</span><br>        1073:  <span style="background-color: white">          }</span><br>        1074:  <span style="background-color: white">      </span><br>        1075:  <span style="background-color: red"> 99+      public boolean mayHaveFirstLine() {</span><br>        1076:  <span style="background-color: red"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>        1077:  <span style="background-color: red"> 99+          return display == IdentValue.BLOCK ||</span><br>        1078:  <span style="background-color: white">                      display == IdentValue.LIST_ITEM ||</span><br>        1079:  <span style="background-color: white">                      display == IdentValue.RUN_IN ||</span><br>        1080:  <span style="background-color: white">                      display == IdentValue.TABLE ||</span><br>        1081:  <span style="background-color: white">                      display == IdentValue.TABLE_CELL ||</span><br>        1082:  <span style="background-color: white">                      display == IdentValue.TABLE_CAPTION ||</span><br>        1083:  <span style="background-color: white">                      display == IdentValue.INLINE_BLOCK;</span><br>        1084:  <span style="background-color: white">          }</span><br>        1085:  <span style="background-color: white">      </span><br>        1086:  <span style="background-color: red"> 99+      public boolean mayHaveFirstLetter() {</span><br>        1087:  <span style="background-color: red"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>        1088:  <span style="background-color: red"> 99+          return display == IdentValue.BLOCK ||</span><br>        1089:  <span style="background-color: white">                      display == IdentValue.LIST_ITEM ||</span><br>        1090:  <span style="background-color: white">                      display == IdentValue.TABLE_CELL ||</span><br>        1091:  <span style="background-color: white">                      display == IdentValue.TABLE_CAPTION ||</span><br>        1092:  <span style="background-color: white">                      display == IdentValue.INLINE_BLOCK;</span><br>        1093:  <span style="background-color: white">          }</span><br>        1094:  <span style="background-color: white">      </span><br>        1095:  <span style="background-color: red"> 99+      public boolean isNonFlowContent() {</span><br>        1096:  <span style="background-color: white"> 99+          return isFloated() || isAbsolute() || isFixed() || isRunning();</span><br>        1097:  <span style="background-color: white">          }</span><br>        1098:  <span style="background-color: white">      </span><br>        1099:  <span style="background-color: red"> 99+      public boolean isMayCollapseMarginsWithChildren() {</span><br>        1100:  <span style="background-color: red"> 99+          return isIdent(CSSName.OVERFLOW, IdentValue.VISIBLE) &amp;&amp;</span><br>        1101:  <span style="background-color: white">                      ! (isFloated() || isAbsolute() || isFixed() || isInlineBlock());</span><br>        1102:  <span style="background-color: white">          }</span><br>        1103:  <span style="background-color: white">      </span><br>        1104:  <span style="background-color: red"> 99+      public boolean isAbsFixedOrInlineBlockEquiv() {</span><br>        1105:  <span style="background-color: white"> 99+          return isAbsolute() || isFixed() || isInlineBlock() || isInlineTable();</span><br>        1106:  <span style="background-color: white">          }</span><br>        1107:  <span style="background-color: white">      </span><br>        1108:  <span style="background-color: red"> 99+      public boolean isMaxWidthNone() {</span><br>        1109:  <span style="background-color: red"> 99+          return isIdent(CSSName.MAX_WIDTH, IdentValue.NONE);</span><br>        1110:  <span style="background-color: white">          }</span><br>        1111:  <span style="background-color: white">      </span><br>        1112:  <span style="background-color: red"> 99+      public boolean isMaxHeightNone() {</span><br>        1113:  <span style="background-color: red"> 99+          return isIdent(CSSName.MAX_HEIGHT, IdentValue.NONE);</span><br>        1114:  <span style="background-color: white">          }</span><br>        1115:  <span style="background-color: white">      </span><br>        1116:  <span style="background-color: red"> 99+      public boolean isImageRenderingPixelated() {</span><br>        1117:  <span style="background-color: red"> 99+          return isIdent(CSSName.IMAGE_RENDERING, IdentValue.PIXELATED) || isIdent(CSSName.IMAGE_RENDERING, IdentValue.CRISP_EDGES);</span><br>        1118:  <span style="background-color: white">          }</span><br>        1119:  <span style="background-color: red"> 99+      public boolean isImageRenderingInterpolate(){</span><br>        1120:  <span style="background-color: white"> 99+          return !isImageRenderingPixelated();</span><br>        1121:  <span style="background-color: white">          }</span><br>        1122:  <span style="background-color: white">      </span><br>        1123:  <span style="background-color: red"> 99+      public int getMinWidth(CssContext c, int cbWidth) {</span><br>        1124:  <span style="background-color: red"> 99+          return (int) getFloatPropertyProportionalTo(CSSName.MIN_WIDTH, cbWidth, c);</span><br>        1125:  <span style="background-color: white">          }</span><br>        1126:  <span style="background-color: white">      </span><br>        1127:  <span style="background-color: red"> 99+      public int getMaxWidth(CssContext c, int cbWidth) {</span><br>        1128:  <span style="background-color: red"> 99+          return (int) getFloatPropertyProportionalTo(CSSName.MAX_WIDTH, cbWidth, c);</span><br>        1129:  <span style="background-color: white">          }</span><br>        1130:  <span style="background-color: white">      </span><br>        1131:  <span style="background-color: red"> 99+      public int getMinHeight(CssContext c, int cbHeight) {</span><br>        1132:  <span style="background-color: red"> 99+          return (int) getFloatPropertyProportionalTo(CSSName.MIN_HEIGHT, cbHeight, c);</span><br>        1133:  <span style="background-color: white">          }</span><br>        1134:  <span style="background-color: white">      </span><br>        1135:  <span style="background-color: white">  69      public int getMaxHeight(CssContext c, int cbHeight) {</span><br>        1136:  <span style="background-color: white">  69          return (int) getFloatPropertyProportionalTo(CSSName.MAX_HEIGHT, cbHeight, c);</span><br>        1137:  <span style="background-color: white">          }</span><br>        1138:  <span style="background-color: white">      </span><br>        1139:  <span style="background-color: cyan"> 99+      public boolean isCollapseBorders() {</span><br>        1140:  <span style="background-color: white">          	// The second part of this condition was commented out by @danfickle because seems unneccessary</span><br>        1141:  <span style="background-color: white">          	// See https://github.com/danfickle/openhtmltopdf/issues/97</span><br>        1142:  <span style="background-color: white">          	</span><br>        1143:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.BORDER_COLLAPSE, IdentValue.COLLAPSE); // &amp;&amp; ! isPaginateTable();</span><br>        1144:  <span style="background-color: white">          }</span><br>        1145:  <span style="background-color: white">      </span><br>        1146:  <span style="background-color: cyan"> 99+      public int getBorderHSpacing(CssContext c) {</span><br>        1147:  <span style="background-color: cyan"> 99+          return isCollapseBorders() ? 0 : (int) getFloatPropertyProportionalTo(CSSName.FS_BORDER_SPACING_HORIZONTAL, 0, c);</span><br>        1148:  <span style="background-color: white">          }</span><br>        1149:  <span style="background-color: white">      </span><br>        1150:  <span style="background-color: cyan"> 99+      public int getBorderVSpacing(CssContext c) {</span><br>        1151:  <span style="background-color: cyan"> 99+          return isCollapseBorders() ? 0 : (int) getFloatPropertyProportionalTo(CSSName.FS_BORDER_SPACING_VERTICAL, 0, c);</span><br>        1152:  <span style="background-color: white">          }</span><br>        1153:  <span style="background-color: white">      </span><br>        1154:  <span style="background-color: cyan"> 99+      public int getRowSpan() {</span><br>        1155:  <span style="background-color: cyan"> 99+          int result = (int) asFloat(CSSName.FS_ROWSPAN);</span><br>        1156:  <span style="background-color: cyan"> 99+          return result &gt; 0 ? result : 1;</span><br>        1157:  <span style="background-color: white">          }</span><br>        1158:  <span style="background-color: white">      </span><br>        1159:  <span style="background-color: cyan"> 99+      public int getColSpan() {</span><br>        1160:  <span style="background-color: cyan"> 99+          int result = (int) asFloat(CSSName.FS_COLSPAN);</span><br>        1161:  <span style="background-color: cyan"> 99+          return result &gt; 0 ? result : 1;</span><br>        1162:  <span style="background-color: white">          }</span><br>        1163:  <span style="background-color: white">      </span><br>        1164:  <span style="background-color: red"> 99+      public float getFSPageBreakMinHeight(CssContext c){</span><br>        1165:  <span style="background-color: red"> 99+          return getFloatPropertyProportionalTo(CSSName.FS_PAGE_BREAK_MIN_HEIGHT, 0, c);</span><br>        1166:  <span style="background-color: white">          }</span><br>        1167:  <span style="background-color: white">      </span><br>        1168:  <span style="background-color: red"> 99+      public Length asLength(CssContext c, CSSName cssName) {</span><br>        1169:  <span style="background-color: red"> 99+          Length result = new Length();</span><br>        1170:  <span style="background-color: white">      </span><br>        1171:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(cssName);</span><br>        1172:  <span style="background-color: red"> 99+          if (value instanceof LengthValue || value instanceof NumberValue) {</span><br>        1173:  <span style="background-color: cyan"> 99+              if (value.hasAbsoluteUnit()) {</span><br>        1174:  <span style="background-color: cyan"> 99+                  result.setValue((int) value.getFloatProportionalTo(cssName, 0, c));</span><br>        1175:  <span style="background-color: cyan"> 99+                  result.setType(Length.FIXED);</span><br>        1176:  <span style="background-color: white">                  } else {</span><br>        1177:  <span style="background-color: red"> 99+                  result.setValue((int) value.asFloat());</span><br>        1178:  <span style="background-color: red"> 99+                  result.setType(Length.PERCENT);</span><br>        1179:  <span style="background-color: white">                  }</span><br>        1180:  <span style="background-color: white">              }</span><br>        1181:  <span style="background-color: white">      </span><br>        1182:  <span style="background-color: red"> 99+          return result;</span><br>        1183:  <span style="background-color: white">          }</span><br>        1184:  <span style="background-color: white">      </span><br>        1185:  <span style="background-color: red"> 99+      public boolean isShowEmptyCells() {</span><br>        1186:  <span style="background-color: red"> 99+          return isCollapseBorders() || isIdent(CSSName.EMPTY_CELLS, IdentValue.SHOW);</span><br>        1187:  <span style="background-color: white">          }</span><br>        1188:  <span style="background-color: white">      </span><br>        1189:  <span style="background-color: red"> 99+      public List
       <identvalue>
         getTextDecorations() {
       </identvalue></span><br>        1190:  <span style="background-color: red"> 99+          FSDerivedValue value = valueByName(CSSName.TEXT_DECORATION);</span><br>        1191:  <span style="background-color: red"> 99+          if (value == IdentValue.NONE) {</span><br>        1192:  <span style="background-color: red"> 99+              return null;</span><br>        1193:  <span style="background-color: white">              } else {</span><br>        1194:  <span style="background-color: cyan"> 99+              List
       <propertyvalue>
         idents = ((ListValue) value).getValues();
       </propertyvalue></span><br>        1195:  <span style="background-color: cyan"> 99+              return idents.stream()</span><br>        1196:  <span style="background-color: white">                          .map(val -&gt; (IdentValue) DerivedValueFactory.newDerivedValue(this, CSSName.TEXT_DECORATION, val))</span><br>        1197:  <span style="background-color: white">                          .collect(Collectors.toList());</span><br>        1198:  <span style="background-color: white">              }</span><br>        1199:  <span style="background-color: white">          }</span><br>        1200:  <span style="background-color: white">      </span><br>        1201:  <span style="background-color: white">   0      public Cursor getCursor() {</span><br>        1202:  <span style="background-color: white">   0          FSDerivedValue value = valueByName(CSSName.CURSOR);</span><br>        1203:  <span style="background-color: white">      </span><br>        1204:  <span style="background-color: white">   0          if (value == IdentValue.AUTO || value == IdentValue.DEFAULT) {</span><br>        1205:  <span style="background-color: white">   0              return Cursor.getDefaultCursor();</span><br>        1206:  <span style="background-color: white">   0          } else if (value == IdentValue.CROSSHAIR) {</span><br>        1207:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.CROSSHAIR_CURSOR);</span><br>        1208:  <span style="background-color: white">   0          } else if (value == IdentValue.POINTER) {</span><br>        1209:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.HAND_CURSOR);</span><br>        1210:  <span style="background-color: white">   0          } else if (value == IdentValue.MOVE) {</span><br>        1211:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.MOVE_CURSOR);</span><br>        1212:  <span style="background-color: white">   0          } else if (value == IdentValue.E_RESIZE) {</span><br>        1213:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.E_RESIZE_CURSOR);</span><br>        1214:  <span style="background-color: white">   0          } else if (value == IdentValue.NE_RESIZE) {</span><br>        1215:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.NE_RESIZE_CURSOR);</span><br>        1216:  <span style="background-color: white">   0          } else if (value == IdentValue.NW_RESIZE) {</span><br>        1217:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.NW_RESIZE_CURSOR);</span><br>        1218:  <span style="background-color: white">   0          } else if (value == IdentValue.N_RESIZE) {</span><br>        1219:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.N_RESIZE_CURSOR);</span><br>        1220:  <span style="background-color: white">   0          } else if (value == IdentValue.SE_RESIZE) {</span><br>        1221:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.SE_RESIZE_CURSOR);</span><br>        1222:  <span style="background-color: white">   0          } else if (value == IdentValue.SW_RESIZE) {</span><br>        1223:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.SW_RESIZE_CURSOR);</span><br>        1224:  <span style="background-color: white">   0          } else if (value == IdentValue.S_RESIZE) {</span><br>        1225:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.S_RESIZE_CURSOR);</span><br>        1226:  <span style="background-color: white">   0          } else if (value == IdentValue.W_RESIZE) {</span><br>        1227:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.W_RESIZE_CURSOR);</span><br>        1228:  <span style="background-color: white">   0          } else if (value == IdentValue.TEXT) {</span><br>        1229:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR);</span><br>        1230:  <span style="background-color: white">   0          } else if (value == IdentValue.WAIT) {</span><br>        1231:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR);</span><br>        1232:  <span style="background-color: white">   0          } else if (value == IdentValue.HELP) {</span><br>        1233:  <span style="background-color: white">                  // We don't have a cursor for this by default, maybe we need</span><br>        1234:  <span style="background-color: white">                  // a custom one for this (but I don't like it).</span><br>        1235:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR);</span><br>        1236:  <span style="background-color: white">   0          } else if (value == IdentValue.PROGRESS) {</span><br>        1237:  <span style="background-color: white">                  // We don't have a cursor for this by default, maybe we need</span><br>        1238:  <span style="background-color: white">                  // a custom one for this (but I don't like it).</span><br>        1239:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR);</span><br>        1240:  <span style="background-color: white">              }</span><br>        1241:  <span style="background-color: white">      </span><br>        1242:  <span style="background-color: white">   0          return null;</span><br>        1243:  <span style="background-color: white">          }</span><br>        1244:  <span style="background-color: white">      </span><br>        1245:  <span style="background-color: cyan"> 99+      public boolean isPaginateTable() {</span><br>        1246:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.FS_TABLE_PAGINATE, IdentValue.PAGINATE);</span><br>        1247:  <span style="background-color: white">          }</span><br>        1248:  <span style="background-color: white">      </span><br>        1249:  <span style="background-color: red"> 99+      public boolean isTextJustify() {</span><br>        1250:  <span style="background-color: red"> 99+          return isIdent(CSSName.TEXT_ALIGN, IdentValue.JUSTIFY) &amp;&amp;</span><br>        1251:  <span style="background-color: white">                      ! (isIdent(CSSName.WHITE_SPACE, IdentValue.PRE) ||</span><br>        1252:  <span style="background-color: white">                              isIdent(CSSName.WHITE_SPACE, IdentValue.PRE_LINE));</span><br>        1253:  <span style="background-color: white">          }</span><br>        1254:  <span style="background-color: white">      </span><br>        1255:  <span style="background-color: red"> 99+      public boolean isListMarkerInside() {</span><br>        1256:  <span style="background-color: red"> 99+          return isIdent(CSSName.LIST_STYLE_POSITION, IdentValue.INSIDE);</span><br>        1257:  <span style="background-color: white">          }</span><br>        1258:  <span style="background-color: white">      </span><br>        1259:  <span style="background-color: red"> 99+      public boolean isKeepWithInline() {</span><br>        1260:  <span style="background-color: red"> 99+          return isIdent(CSSName.FS_KEEP_WITH_INLINE, IdentValue.KEEP);</span><br>        1261:  <span style="background-color: white">          }</span><br>        1262:  <span style="background-color: white">      </span><br>        1263:  <span style="background-color: red"> 99+      public boolean isDynamicAutoWidth() {</span><br>        1264:  <span style="background-color: red"> 99+          return isIdent(CSSName.FS_DYNAMIC_AUTO_WIDTH, IdentValue.DYNAMIC);</span><br>        1265:  <span style="background-color: white">          }</span><br>        1266:  <span style="background-color: white">      </span><br>        1267:  <span style="background-color: red"> 99+      public boolean isDynamicAutoWidthApplicable() {</span><br>        1268:  <span style="background-color: white"> 99+          return isDynamicAutoWidth() &amp;&amp; isAutoWidth() &amp;&amp; ! isCanBeShrunkToFit();</span><br>        1269:  <span style="background-color: white">          }</span><br>        1270:  <span style="background-color: white">      </span><br>        1271:  <span style="background-color: red"> 99+      public boolean isCanBeShrunkToFit() {</span><br>        1272:  <span style="background-color: white"> 99+          return isInlineBlock() || isFloated() || isAbsolute() || isFixed();</span><br>        1273:  <span style="background-color: white">          }</span><br>        1274:  <span style="background-color: white">          </span><br>        1275:  <span style="background-color: white">   0      public boolean isDirectionLTR() {</span><br>        1276:  <span style="background-color: white">   0      	return isIdent(CSSName.DIRECTION, IdentValue.LTR);</span><br>        1277:  <span style="background-color: white">          }</span><br>        1278:  <span style="background-color: white">          </span><br>        1279:  <span style="background-color: white">   0      public boolean isDirectionRTL() {</span><br>        1280:  <span style="background-color: white">   0      	return isIdent(CSSName.DIRECTION, IdentValue.RTL);</span><br>        1281:  <span style="background-color: white">          }</span><br>        1282:  <span style="background-color: white">          </span><br>        1283:  <span style="background-color: white">   0      public boolean isDirectionAuto() {</span><br>        1284:  <span style="background-color: white">   0      	return isIdent(CSSName.DIRECTION, IdentValue.AUTO);</span><br>        1285:  <span style="background-color: white">          }</span><br>        1286:  <span style="background-color: white">      </span><br>        1287:  <span style="background-color: red"> 99+  	public IdentValue getDirection() {</span><br>        1288:  <span style="background-color: red"> 99+  		return getIdent(CSSName.DIRECTION);</span><br>        1289:  <span style="background-color: white">      	}</span><br>        1290:  <span style="background-color: white">      	</span><br>        1291:  <span style="background-color: red"> 99+  	public boolean hasLetterSpacing() {</span><br>        1292:  <span style="background-color: red"> 99+  	    return !isIdent(CSSName.LETTER_SPACING, IdentValue.NORMAL);</span><br>        1293:  <span style="background-color: white">      	}</span><br>        1294:  <span style="background-color: white">      	</span><br>        1295:  <span style="background-color: white"> 99+  	public boolean isParagraphContainerForBidi() {</span><br>        1296:  <span style="background-color: white"> 99+  		IdentValue display = getIdent(CSSName.DISPLAY);</span><br>        1297:  <span style="background-color: white">      		</span><br>        1298:  <span style="background-color: white"> 99+  		return (display != IdentValue.INLINE &amp;&amp;</span><br>        1299:  <span style="background-color: white">      				display != IdentValue.INLINE_BLOCK &amp;&amp;</span><br>        1300:  <span style="background-color: white">      				display != IdentValue.INLINE_TABLE) ||</span><br>        1301:  <span style="background-color: white">      				isNonFlowContent();</span><br>        1302:  <span style="background-color: white">      	}</span><br>        1303:  <span style="background-color: white">      	</span><br>        1304:  <span style="background-color: white">      	/**</span><br>        1305:  <span style="background-color: white">      	 * @return true for border-box, false for content-box.</span><br>        1306:  <span style="background-color: white">      	 */</span><br>        1307:  <span style="background-color: red"> 99+      public boolean isBorderBox() {</span><br>        1308:  <span style="background-color: red"> 99+          return isIdent(CSSName.BOX_SIZING, IdentValue.BORDER_BOX);</span><br>        1309:  <span style="background-color: white">          }</span><br>        1310:  <span style="background-color: white">      	</span><br>        1311:  <span style="background-color: white">      	/**</span><br>        1312:  <span style="background-color: white">      	 * Aims to get the correct resolved max-width for a box in dots unit.</span><br>        1313:  <span style="background-color: white">      	 * Returns -1 if there is no max-width defined.</span><br>        1314:  <span style="background-color: white">      	 * Assumptions: box has a containing block.</span><br>        1315:  <span style="background-color: white">      	 */</span><br>        1316:  <span style="background-color: white"> 99+  	public static int getCSSMaxWidth(CssContext c, Box box) {</span><br>        1317:  <span style="background-color: white"> 99+  		if (box.getStyle().isMaxWidthNone()) {</span><br>        1318:  <span style="background-color: white"> 99+  			return -1;</span><br>        1319:  <span style="background-color: white">      		}</span><br>        1320:  <span style="background-color: white">      		</span><br>        1321:  <span style="background-color: white">  33  	    return box.getStyle().getMaxWidth(c, box.getContainingBlock().getContentWidth());</span><br>        1322:  <span style="background-color: white">      	}</span><br>        1323:  <span style="background-color: white">      </span><br>        1324:  <span style="background-color: white">      	/**</span><br>        1325:  <span style="background-color: white">      	 * Aims to get the correct resolved max-height for a box in dots unit.</span><br>        1326:  <span style="background-color: white">      	 * returns -1 if there is no max-height defined.</span><br>        1327:  <span style="background-color: white">      	 * Assumptions: box has a containing block.</span><br>        1328:  <span style="background-color: white">      	 */</span><br>        1329:  <span style="background-color: white"> 99+  	public static int getCSSMaxHeight(CssContext c, Box box) {</span><br>        1330:  <span style="background-color: white"> 99+  		if (box.getStyle().isMaxHeightNone()) {</span><br>        1331:  <span style="background-color: white"> 99+  			return -1;</span><br>        1332:  <span style="background-color: white">      		}</span><br>        1333:  <span style="background-color: white">      		</span><br>        1334:  <span style="background-color: white">  17  		Length cssMaxHeight = box.getStyle().asLength(c, CSSName.MAX_HEIGHT);</span><br>        1335:  <span style="background-color: white">      </span><br>        1336:  <span style="background-color: white">      		/* 	MDN says:</span><br>        1337:  <span style="background-color: white">      		 *  The percentage is calculated with respect to the height of the generated box's containing block.</span><br>        1338:  <span style="background-color: white">      		 *  If the height of the containing block is not specified explicitly (i.e., it depends on content height),</span><br>        1339:  <span style="background-color: white">      		 *  and this element is not absolutely positioned, the percentage value is treated as none.*/</span><br>        1340:  <span style="background-color: white">      		</span><br>        1341:  <span style="background-color: white">  17  		if (cssMaxHeight.isPercent() &amp;&amp;</span><br>        1342:  <span style="background-color: white">      			box.getContainingBlock().getStyle().hasAbsoluteUnit(CSSName.HEIGHT)) {</span><br>        1343:  <span style="background-color: white">   4  			return (int) (cssMaxHeight.value() * box.getContainingBlock().getStyle().asLength(c, CSSName.HEIGHT).value() / 100f);</span><br>        1344:  <span style="background-color: white">  13  		} else if (cssMaxHeight.isPercent()) {</span><br>        1345:  <span style="background-color: white">   0  			return -1;</span><br>        1346:  <span style="background-color: white">      		} else {</span><br>        1347:  <span style="background-color: white">  13  			return (int) cssMaxHeight.value();</span><br>        1348:  <span style="background-color: white">      		}</span><br>        1349:  <span style="background-color: white">      	}</span><br>        1350:  <span style="background-color: white">      </span><br>        1351:  <span style="background-color: red"> 99+      public boolean isHasBackground() {</span><br>        1352:  <span style="background-color: red"> 99+          return !isIdent(CSSName.BACKGROUND_COLOR, IdentValue.TRANSPARENT) ||</span><br>        1353:  <span style="background-color: white">                     isHasBackgroundImage();</span><br>        1354:  <span style="background-color: white">          }</span><br>        1355:  <span style="background-color: white">      </span><br>        1356:  <span style="background-color: red"> 99+      public boolean isHasBackgroundImage() {</span><br>        1357:  <span style="background-color: red"> 99+          List
       <propertyvalue>
         backgroundImages = ((ListValue) valueByName(CSSName.BACKGROUND_IMAGE)).getValues();
       </propertyvalue></span><br>        1358:  <span style="background-color: white">      </span><br>        1359:  <span style="background-color: red"> 99+          if (backgroundImages.size() == 1) {</span><br>        1360:  <span style="background-color: red"> 99+              return backgroundImages.get(0).getIdentValue() != IdentValue.NONE;</span><br>        1361:  <span style="background-color: white">              } else {</span><br>        1362:  <span style="background-color: white">  24              return backgroundImages.stream().anyMatch(val -&gt; val.getIdentValue() != IdentValue.NONE);</span><br>        1363:  <span style="background-color: white">              }</span><br>        1364:  <span style="background-color: white">          }</span><br>        1365:  <span style="background-color: white">      </span><br>        1366:  <span style="background-color: white">          public enum BackgroundImageType {</span><br>        1367:  <span style="background-color: white">              URI, GRADIENT, NONE;</span><br>        1368:  <span style="background-color: white">          }</span><br>        1369:  <span style="background-color: white">      </span><br>        1370:  <span style="background-color: white">          public static class BackgroundContainer {</span><br>        1371:  <span style="background-color: white">              public BackgroundImageType type;</span><br>        1372:  <span style="background-color: white">              public PropertyValue imageGradientOrNone;</span><br>        1373:  <span style="background-color: white">      </span><br>        1374:  <span style="background-color: white">              public BackgroundPosition backgroundPosition;</span><br>        1375:  <span style="background-color: white">              public BackgroundSize backgroundSize;</span><br>        1376:  <span style="background-color: white">              public PropertyValue backgroundRepeat;</span><br>        1377:  <span style="background-color: white">          }</span><br>        1378:  <span style="background-color: white">      </span><br>        1379:  <span style="background-color: red"> 99+      public boolean isLinearGradient(PropertyValue value) {</span><br>        1380:  <span style="background-color: red"> 99+          return value.getPropertyValueType() == PropertyValue.VALUE_TYPE_FUNCTION &amp;&amp;</span><br>        1381:  <span style="background-color: white">                     Objects.equals(value.getFunction().getName(), "linear-gradient");</span><br>        1382:  <span style="background-color: white">          }</span><br>        1383:  <span style="background-color: white">      </span><br>        1384:  <span style="background-color: white">  19      public FSLinearGradient getLinearGradient(</span><br>        1385:  <span style="background-color: white">                  PropertyValue value, CssContext cssContext, int boxWidth, int boxHeight) {</span><br>        1386:  <span style="background-color: white">      </span><br>        1387:  <span style="background-color: white">  19          if (!isLinearGradient(value)) {</span><br>        1388:  <span style="background-color: white">   0              return null;</span><br>        1389:  <span style="background-color: white">              }</span><br>        1390:  <span style="background-color: white">      </span><br>        1391:  <span style="background-color: white">  19          return new FSLinearGradient(this, value.getFunction(), boxWidth, boxHeight, cssContext);</span><br>        1392:  <span style="background-color: white">          }</span><br>        1393:  <span style="background-color: white">      </span><br>        1394:  <span style="background-color: white">          /**</span><br>        1395:  <span style="background-color: white">           * Gets the values of the background properties and combines in a list</span><br>        1396:  <span style="background-color: white">           * of BackgroundContainer values.</span><br>        1397:  <span style="background-color: white">           */</span><br>        1398:  <span style="background-color: white"> 99+      @WebDoc(WebDocLocations.CSS_BACKGROUND_PROPERTIES)</span><br>        1399:  <span style="background-color: white">          public List
       <backgroundcontainer>
         getBackgroundImages() {
       </backgroundcontainer></span><br>        1400:  <span style="background-color: red"> 99+          List
       <propertyvalue>
         images = ((ListValue) valueByName(CSSName.BACKGROUND_IMAGE)).getValues();
       </propertyvalue></span><br>        1401:  <span style="background-color: red"> 99+          List
       <propertyvalue>
         positions = ((ListValue) valueByName(CSSName.BACKGROUND_POSITION)).getValues();
       </propertyvalue></span><br>        1402:  <span style="background-color: red"> 99+          List
       <propertyvalue>
         repeats = ((ListValue) valueByName(CSSName.BACKGROUND_REPEAT)).getValues();
       </propertyvalue></span><br>        1403:  <span style="background-color: red"> 99+          List
       <propertyvalue>
         sizes = ((ListValue) valueByName(CSSName.BACKGROUND_SIZE)).getValues();
       </propertyvalue></span><br>        1404:  <span style="background-color: white">      </span><br>        1405:  <span style="background-color: red"> 99+          assert positions.size() % 2 == 0;</span><br>        1406:  <span style="background-color: red"> 99+          assert sizes.size() % 2 == 0;</span><br>        1407:  <span style="background-color: white">      </span><br>        1408:  <span style="background-color: red"> 99+          List
       <backgroundposition>
         posPairs = new ArrayList&lt;&gt;(positions.size() / 2);
       </backgroundposition></span><br>        1409:  <span style="background-color: red"> 99+          for (int i = 0; i &lt; positions.size(); i += 2) {</span><br>        1410:  <span style="background-color: red"> 99+              posPairs.add(new BackgroundPosition(positions.get(i), positions.get(i + 1)));</span><br>        1411:  <span style="background-color: white">              }</span><br>        1412:  <span style="background-color: white">      </span><br>        1413:  <span style="background-color: red"> 99+          List
       <backgroundsize>
         sizePairs = new ArrayList&lt;&gt;(sizes.size() / 2);
       </backgroundsize></span><br>        1414:  <span style="background-color: red"> 99+          for (int i = 0; i &lt; sizes.size(); i += 2) {</span><br>        1415:  <span style="background-color: red"> 99+              sizePairs.add(new BackgroundSize(sizes.get(i), sizes.get(i + 1)));</span><br>        1416:  <span style="background-color: white">              }</span><br>        1417:  <span style="background-color: white">      </span><br>        1418:  <span style="background-color: red"> 99+          List
       <backgroundcontainer>
         backgrounds = new ArrayList&lt;&gt;(images.size());
       </backgroundcontainer></span><br>        1419:  <span style="background-color: white">      </span><br>        1420:  <span style="background-color: red"> 99+          for (int i = 0; i &lt; images.size(); i++) {</span><br>        1421:  <span style="background-color: red"> 99+              BackgroundContainer bg = new BackgroundContainer();</span><br>        1422:  <span style="background-color: red"> 99+              PropertyValue img = images.get(i);</span><br>        1423:  <span style="background-color: white">      </span><br>        1424:  <span style="background-color: red"> 99+              if (isLinearGradient(img)) {</span><br>        1425:  <span style="background-color: white">  19                  bg.type = BackgroundImageType.GRADIENT;</span><br>        1426:  <span style="background-color: red"> 99+              } else if (img.getIdentValue() == IdentValue.NONE) {</span><br>        1427:  <span style="background-color: red"> 99+                  bg.type = BackgroundImageType.NONE;</span><br>        1428:  <span style="background-color: white">                  } else {</span><br>        1429:  <span style="background-color: red"> 99+                  bg.type = BackgroundImageType.URI;</span><br>        1430:  <span style="background-color: white">                  }</span><br>        1431:  <span style="background-color: white">      </span><br>        1432:  <span style="background-color: red"> 99+              bg.imageGradientOrNone = img;</span><br>        1433:  <span style="background-color: white">      </span><br>        1434:  <span style="background-color: white">                  // If less background-position values are provided than images,</span><br>        1435:  <span style="background-color: white">                  // they must repeat.</span><br>        1436:  <span style="background-color: red"> 99+              bg.backgroundPosition = posPairs.get(i % posPairs.size());</span><br>        1437:  <span style="background-color: red"> 99+              bg.backgroundSize = sizePairs.get(i % sizePairs.size());</span><br>        1438:  <span style="background-color: red"> 99+              bg.backgroundRepeat = repeats.get(i % repeats.size());</span><br>        1439:  <span style="background-color: white">      </span><br>        1440:  <span style="background-color: red"> 99+              backgrounds.add(bg);</span><br>        1441:  <span style="background-color: white">              }</span><br>        1442:  <span style="background-color: white">      </span><br>        1443:  <span style="background-color: white">              // Pre-reverse the images, from back to front.</span><br>        1444:  <span style="background-color: red"> 99+          Collections.reverse(backgrounds);</span><br>        1445:  <span style="background-color: red"> 99+          return backgrounds;</span><br>        1446:  <span style="background-color: white">          }</span><br>        1447:  <span style="background-color: white">      }</span><br>        1448:  <span style="background-color: white">      </span><br>        1449:  <span style="background-color: white">      /*</span><br>        1450:  <span style="background-color: white">       * $Id$</span><br>        1451:  <span style="background-color: white">       *</span><br>        1452:  <span style="background-color: white">       * $Log$</span><br>        1453:  <span style="background-color: white">       * Revision 1.110  2010/01/12 14:33:27  peterbrant</span><br>        1454:  <span style="background-color: white">       * Ignore auto margins when calculating table min/max width.  Also, when deciding whether or not to proceed with the auto margin calculation for a table,  make sure we compare consistently with how the table min width is actually set.</span><br>        1455:  <span style="background-color: white">       *</span><br>        1456:  <span style="background-color: white">       * Revision 1.109  2009/11/08 23:52:48  peterbrant</span><br>        1457:  <span style="background-color: white">       * Treat percentage widths as auto when calculating min/max widths</span><br>        1458:  <span style="background-color: white">       *</span><br>        1459:  <span style="background-color: white">       * Revision 1.108  2009/05/09 14:17:41  pdoubleya</span><br>        1460:  <span style="background-color: white">       * FindBugs: static field should not be mutable; use inner class to declare CSS 4-side properties</span><br>        1461:  <span style="background-color: white">       *</span><br>        1462:  <span style="background-color: white">       * Revision 1.107  2009/04/25 10:48:42  pdoubleya</span><br>        1463:  <span style="background-color: white">       * Small opt, don't pull Ident unless needed, patch from Peter Fassev issue #263</span><br>        1464:  <span style="background-color: white">       *</span><br>        1465:  <span style="background-color: white">       * Revision 1.106  2008/12/14 19:27:16  peterbrant</span><br>        1466:  <span style="background-color: white">       * Always treat running elements as blocks</span><br>        1467:  <span style="background-color: white">       *</span><br>        1468:  <span style="background-color: white">       * Revision 1.105  2008/12/14 13:53:32  peterbrant</span><br>        1469:  <span style="background-color: white">       * Implement -fs-keep-with-inline: keep property that instructs FS to try to avoid breaking a box so that only borders and padding appear on a page</span><br>        1470:  <span style="background-color: white">       *</span><br>        1471:  <span style="background-color: white">       * Revision 1.104  2008/09/06 18:21:50  peterbrant</span><br>        1472:  <span style="background-color: white">       * Need to account for list-marker-position: inside when calculating inline min/max widths</span><br>        1473:  <span style="background-color: white">       *</span><br>        1474:  <span style="background-color: white">       * Revision 1.103  2008/08/01 22:23:54  peterbrant</span><br>        1475:  <span style="background-color: white">       * Fix various bugs related to collapsed table borders (one manifestation found by Olly Headey)</span><br>        1476:  <span style="background-color: white">       *</span><br>        1477:  <span style="background-color: white">       * Revision 1.102  2008/07/27 00:21:48  peterbrant</span><br>        1478:  <span style="background-color: white">       * Implement CMYK color support for PDF output, starting with patch from Mykola Gurov / Banish java.awt.Color from FS core layout classes</span><br>        1479:  <span style="background-color: white">       *</span><br>        1480:  <span style="background-color: white">       * Revision 1.101  2008/07/14 11:12:37  peterbrant</span><br>        1481:  <span style="background-color: white">       * Fix two bugs when -fs-table-paginate is paginate.  Block boxes in cells in a  that were also early on the page could be positioned incorrectly.  Line boxes contained within inline-block or inline-table content in a paginated table were generally placed incorrectly.</span><br>        1482:  <span style="background-color: white">       *</span><br>        1483:  <span style="background-color: white">       * Revision 1.100  2007/08/29 22:18:19  peterbrant</span><br>        1484:  <span style="background-color: white">       * Experiment with text justification</span><br>        1485:  <span style="background-color: white">       *</span><br>        1486:  <span style="background-color: white">       * Revision 1.99  2007/08/27 19:44:06  peterbrant</span><br>        1487:  <span style="background-color: white">       * Rename -fs-table-pagination to -fs-table-paginate</span><br>        1488:  <span style="background-color: white">       *</span><br>        1489:  <span style="background-color: white">       * Revision 1.98  2007/08/19 22:22:53  peterbrant</span><br>        1490:  <span style="background-color: white">       * Merge R8pbrant changes to HEAD</span><br>        1491:  <span style="background-color: white">       *</span><br>        1492:  <span style="background-color: white">       * Revision 1.97.2.4  2007/08/17 23:53:32  peterbrant</span><br>        1493:  <span style="background-color: white">       * Get rid of layer hack for overflow: hidden</span><br>        1494:  <span style="background-color: white">       *</span><br>        1495:  <span style="background-color: white">       * Revision 1.97.2.3  2007/08/16 22:38:48  peterbrant</span><br>        1496:  <span style="background-color: white">       * Further progress on table pagination</span><br>        1497:  <span style="background-color: white">       *</span><br>        1498:  <span style="background-color: white">       * Revision 1.97.2.2  2007/07/11 22:48:29  peterbrant</span><br>        1499:  <span style="background-color: white">       * Further progress on running headers and footers</span><br>        1500:  <span style="background-color: white">       *</span><br>        1501:  <span style="background-color: white">       * Revision 1.97.2.1  2007/07/09 22:18:04  peterbrant</span><br>        1502:  <span style="background-color: white">       * Begin work on running headers and footers and named pages</span><br>        1503:  <span style="background-color: white">       *</span><br>        1504:  <span style="background-color: white">       * Revision 1.97  2007/06/26 18:24:52  peterbrant</span><br>        1505:  <span style="background-color: white">       * Improve calculation of line-height: normal / If leading is positive, recalculate to center glyph area in inline box</span><br>        1506:  <span style="background-color: white">       *</span><br>        1507:  <span style="background-color: white">       * Revision 1.96  2007/06/19 22:31:46  peterbrant</span><br>        1508:  <span style="background-color: white">       * Only cache all zeros margin, border, padding.  See discussion on bug #147 for more info.</span><br>        1509:  <span style="background-color: white">       *</span><br>        1510:  <span style="background-color: white">       * Revision 1.95  2007/06/14 22:39:31  tobega</span><br>        1511:  <span style="background-color: white">       * Handling counters in LayoutContext instead. We still need to get the value from the counter function and change list-item counting.</span><br>        1512:  <span style="background-color: white">       *</span><br>        1513:  <span style="background-color: white">       * Revision 1.94  2007/06/13 14:16:00  peterbrant</span><br>        1514:  <span style="background-color: white">       * Comment out body of resolveCounters() for now</span><br>        1515:  <span style="background-color: white">       *</span><br>        1516:  <span style="background-color: white">       * Revision 1.93  2007/06/12 22:59:23  tobega</span><br>        1517:  <span style="background-color: white">       * Handling counters is done. Now we just need to get the values appropriately.</span><br>        1518:  <span style="background-color: white">       *</span><br>        1519:  <span style="background-color: white">       * Revision 1.92  2007/06/05 19:29:54  peterbrant</span><br>        1520:  <span style="background-color: white">       * More progress on counter support</span><br>        1521:  <span style="background-color: white">       *</span><br>        1522:  <span style="background-color: white">       * Revision 1.91  2007/05/24 19:56:52  peterbrant</span><br>        1523:  <span style="background-color: white">       * Add support for cursor property (predefined cursors only)</span><br>        1524:  <span style="background-color: white">       *</span><br>        1525:  <span style="background-color: white">       * Patch from Sean Bright</span><br>        1526:  <span style="background-color: white">       *</span><br>        1527:  <span style="background-color: white">       * Revision 1.90  2007/04/16 01:10:06  peterbrant</span><br>        1528:  <span style="background-color: white">       * Vertical margin and padding with percentage values may be incorrect if box participated in a shrink-to-fit calculation.  Fix margin calculation.</span><br>        1529:  <span style="background-color: white">       *</span><br>        1530:  <span style="background-color: white">       * Revision 1.89  2007/04/14 20:09:39  peterbrant</span><br>        1531:  <span style="background-color: white">       * Add method to clear cached rects</span><br>        1532:  <span style="background-color: white">       *</span><br>        1533:  <span style="background-color: white">       * Revision 1.88  2007/03/01 20:17:10  peterbrant</span><br>        1534:  <span style="background-color: white">       * Tables with collapsed borders don't have padding</span><br>        1535:  <span style="background-color: white">       *</span><br>        1536:  <span style="background-color: white">       * Revision 1.87  2007/02/28 18:16:32  peterbrant</span><br>        1537:  <span style="background-color: white">       * Support multiple values for text-decoration (per spec)</span><br>        1538:  <span style="background-color: white">       *</span><br>        1539:  <span style="background-color: white">       * Revision 1.86  2007/02/26 16:25:51  peterbrant</span><br>        1540:  <span style="background-color: white">       * Method name change to avoid confusion with visibility: hidden / Don't create empty inline boxes after all (inline layout will ignore them anyway) / Robustness improvements to generated content (treat display: table/table row groups/table-row as regular block boxes)</span><br>        1541:  <span style="background-color: white">       *</span><br>        1542:  <span style="background-color: white">       * Revision 1.85  2007/02/24 00:46:38  peterbrant</span><br>        1543:  <span style="background-color: white">       * Paint root element background over entire canvas (or it's first child if the root element doesn't define a background)</span><br>        1544:  <span style="background-color: white">       *</span><br>        1545:  <span style="background-color: white">       * Revision 1.84  2007/02/23 21:04:26  peterbrant</span><br>        1546:  <span style="background-color: white">       * Implement complete support for background-position and background-attachment</span><br>        1547:  <span style="background-color: white">       *</span><br>        1548:  <span style="background-color: white">       * Revision 1.83  2007/02/23 16:54:38  peterbrant</span><br>        1549:  <span style="background-color: white">       * Allow special ident -fs-intial-value to reset a property value to its initial value (used by border related shorthand properties as 'color' won't be known at property construction time)</span><br>        1550:  <span style="background-color: white">       *</span><br>        1551:  <span style="background-color: white">       * Revision 1.82  2007/02/22 18:21:20  peterbrant</span><br>        1552:  <span style="background-color: white">       * Add support for overflow: visible/hidden</span><br>        1553:  <span style="background-color: white">       *</span><br>        1554:  <span style="background-color: white">       * Revision 1.81  2007/02/21 01:19:12  peterbrant</span><br>        1555:  <span style="background-color: white">       * Need to take unit into account when creating Length objects with non-pixel units</span><br>        1556:  <span style="background-color: white">       *</span><br>        1557:  <span style="background-color: white">       * Revision 1.80  2007/02/20 20:05:40  peterbrant</span><br>        1558:  <span style="background-color: white">       * Complete support for absolute and relative font sizes</span><br>        1559:  <span style="background-color: white">       *</span><br>        1560:  <span style="background-color: white">       * Revision 1.79  2007/02/20 16:11:11  peterbrant</span><br>        1561:  <span style="background-color: white">       * Comment out references to CSSName.OVERFLOW</span><br>        1562:  <span style="background-color: white">       *</span><br>        1563:  <span style="background-color: white">       * Revision 1.78  2007/02/20 01:17:11  peterbrant</span><br>        1564:  <span style="background-color: white">       * Start CSS parser cleanup</span><br>        1565:  <span style="background-color: white">       *</span><br>        1566:  <span style="background-color: white">       * Revision 1.77  2007/02/20 00:01:12  peterbrant</span><br>        1567:  <span style="background-color: white">       * asColor() fix</span><br>        1568:  <span style="background-color: white">       *</span><br>        1569:  <span style="background-color: white">       * Revision 1.76  2007/02/19 23:18:43  peterbrant</span><br>        1570:  <span style="background-color: white">       * Further work on new CSS parser / Misc. bug fixes</span><br>        1571:  <span style="background-color: white">       *</span><br>        1572:  <span style="background-color: white">       * Revision 1.75  2007/02/19 14:53:43  peterbrant</span><br>        1573:  <span style="background-color: white">       * Integrate new CSS parser</span><br>        1574:  <span style="background-color: white">       *</span><br>        1575:  <span style="background-color: white">       * Revision 1.74  2007/02/07 16:33:28  peterbrant</span><br>        1576:  <span style="background-color: white">       * Initial commit of rewritten table support and associated refactorings</span><br>        1577:  <span style="background-color: white">       *</span><br>        1578:  <span style="background-color: white">       * Revision 1.73  2007/01/16 16:11:38  peterbrant</span><br>        1579:  <span style="background-color: white">       * Don't copy derived values as they propagate down the style tree (don't need to anymore</span><br>        1580:  <span style="background-color: white">       * now that we don't cache length values in LengthValue and PointValue)</span><br>        1581:  <span style="background-color: white">       *</span><br>        1582:  <span style="background-color: white">       * Revision 1.72  2006/10/04 23:52:57  peterbrant</span><br>        1583:  <span style="background-color: white">       * Implement support for margin: auto (centering blocks in their containing block)</span><br>        1584:  <span style="background-color: white">       *</span><br>        1585:  <span style="background-color: white">       * Revision 1.71  2006/09/06 22:21:43  peterbrant</span><br>        1586:  <span style="background-color: white">       * Fixes to shrink-to-fit implementation / Implement min/max-width (non-replaced content) only</span><br>        1587:  <span style="background-color: white">       *</span><br>        1588:  <span style="background-color: white">       * Revision 1.70  2006/09/01 23:49:40  peterbrant</span><br>        1589:  <span style="background-color: white">       * Implement basic margin collapsing / Various refactorings in preparation for shrink-to-fit / Add hack to treat auto margins as zero</span><br>        1590:  <span style="background-color: white">       *</span><br>        1591:  <span style="background-color: white">       * Revision 1.69  2006/08/29 17:29:14  peterbrant</span><br>        1592:  <span style="background-color: white">       * Make Style object a thing of the past</span><br>        1593:  <span style="background-color: white">       *</span><br>        1594:  <span style="background-color: white">       * Revision 1.68  2006/08/27 00:36:16  peterbrant</span><br>        1595:  <span style="background-color: white">       * Initial commit of (initial) R7 work</span><br>        1596:  <span style="background-color: white">       *</span><br>        1597:  <span style="background-color: white">       * Revision 1.67  2006/05/15 05:46:51  pdoubleya</span><br>        1598:  <span style="background-color: white">       * Return value from abs value check never assigned!</span><br>        1599:  <span style="background-color: white">       *</span><br>        1600:  <span style="background-color: white">       * Revision 1.66  2006/05/08 21:24:24  pdoubleya</span><br>        1601:  <span style="background-color: white">       * Log, don't throw exception, if we check for an absolute unit but it doesn't make sense to do so (IdentValue.hasAbsoluteUnit()).</span><br>        1602:  <span style="background-color: white">       *</span><br>        1603:  <span style="background-color: white">       * Revision 1.65  2006/05/08 20:56:09  pdoubleya</span><br>        1604:  <span style="background-color: white">       * Clean exception handling for case where assigned property value is not understood as a valid value; use initial value instead.</span><br>        1605:  <span style="background-color: white">       *</span><br>        1606:  <span style="background-color: white">       * Revision 1.64  2006/02/21 19:30:34  peterbrant</span><br>        1607:  <span style="background-color: white">       * Reset negative values for padding/border-width to 0</span><br>        1608:  <span style="background-color: white">       *</span><br>        1609:  <span style="background-color: white">       * Revision 1.63  2006/02/01 01:30:16  peterbrant</span><br>        1610:  <span style="background-color: white">       * Initial commit of PDF work</span><br>        1611:  <span style="background-color: white">       *</span><br>        1612:  <span style="background-color: white">       * Revision 1.62  2006/01/27 01:15:44  peterbrant</span><br>        1613:  <span style="background-color: white">       * Start on better support for different output devices</span><br>        1614:  <span style="background-color: white">       *</span><br>        1615:  <span style="background-color: white">       * Revision 1.61  2006/01/03 17:04:54  peterbrant</span><br>        1616:  <span style="background-color: white">       * Many pagination bug fixes / Add ability to position absolute boxes in margin area</span><br>        1617:  <span style="background-color: white">       *</span><br>        1618:  <span style="background-color: white">       * Revision 1.60  2006/01/03 02:11:15  peterbrant</span><br>        1619:  <span style="background-color: white">       * Expose asString() for all</span><br>        1620:  <span style="background-color: white">       *</span><br>        1621:  <span style="background-color: white">       * Revision 1.59  2006/01/01 02:38:22  peterbrant</span><br>        1622:  <span style="background-color: white">       * Merge more pagination work / Various minor cleanups</span><br>        1623:  <span style="background-color: white">       *</span><br>        1624:  <span style="background-color: white">       * Revision 1.58  2005/12/13 02:41:36  peterbrant</span><br>        1625:  <span style="background-color: white">       * Initial implementation of vertical-align: top/bottom (not done yet) / Minor cleanup and optimization</span><br>        1626:  <span style="background-color: white">       *</span><br>        1627:  <span style="background-color: white">       * Revision 1.57  2005/12/08 02:16:11  peterbrant</span><br>        1628:  <span style="background-color: white">       * Thread safety fix</span><br>        1629:  <span style="background-color: white">       *</span><br>        1630:  <span style="background-color: white">       * Revision 1.56  2005/12/05 00:09:04  peterbrant</span><br>        1631:  <span style="background-color: white">       * Couple of optimizations which improve layout speed by about 10%</span><br>        1632:  <span style="background-color: white">       *</span><br>        1633:  <span style="background-color: white">       * Revision 1.55  2005/11/25 16:57:26  peterbrant</span><br>        1634:  <span style="background-color: white">       * Initial commit of inline content refactoring</span><br>        1635:  <span style="background-color: white">       *</span><br>        1636:  <span style="background-color: white">       * Revision 1.54  2005/11/10 22:15:41  peterbrant</span><br>        1637:  <span style="background-color: white">       * Fix (hopefully) exception on identifiers which are converted by the CSS layer (e.g. thick becomes 3px)</span><br>        1638:  <span style="background-color: white">       *</span><br>        1639:  <span style="background-color: white">       * Revision 1.53  2005/11/08 22:53:44  tobega</span><br>        1640:  <span style="background-color: white">       * added getLineHeight method to CalculatedStyle and hacked in some list-item support</span><br>        1641:  <span style="background-color: white">       *</span><br>        1642:  <span style="background-color: white">       * Revision 1.52  2005/10/31 22:43:15  tobega</span><br>        1643:  <span style="background-color: white">       * Some memory optimization of the Matcher. Probably cleaner code, too.</span><br>        1644:  <span style="background-color: white">       *</span><br>        1645:  <span style="background-color: white">       * Revision 1.51  2005/10/31 19:02:12  pdoubleya</span><br>        1646:  <span style="background-color: white">       * support for inherited padding and margins.</span><br>        1647:  <span style="background-color: white">       *</span><br>        1648:  <span style="background-color: white">       * Revision 1.50  2005/10/31 18:01:44  pdoubleya</span><br>        1649:  <span style="background-color: white">       * InheritedLength is created per-length, to accomodate calls that need to defer to a specific parent.</span><br>        1650:  <span style="background-color: white">       *</span><br>        1651:  <span style="background-color: white">       * Revision 1.49  2005/10/31 12:38:14  pdoubleya</span><br>        1652:  <span style="background-color: white">       * Additional inheritance fixes.</span><br>        1653:  <span style="background-color: white">       *</span><br>        1654:  <span style="background-color: white">       * Revision 1.48  2005/10/31 10:16:08  pdoubleya</span><br>        1655:  <span style="background-color: white">       * Preliminary support for inherited lengths.</span><br>        1656:  <span style="background-color: white">       *</span><br>        1657:  <span style="background-color: white">       * Revision 1.47  2005/10/25 15:38:28  pdoubleya</span><br>        1658:  <span style="background-color: white">       * Moved guessType() to ValueConstants, applied fix to method suggested by Chris Oliver, to avoid exception-based catch.</span><br>        1659:  <span style="background-color: white">       *</span><br>        1660:  <span style="background-color: white">       * Revision 1.46  2005/10/25 00:38:47  tobega</span><br>        1661:  <span style="background-color: white">       * Reduced memory footprint of Matcher and stopped trying to cache the possibly uncache-able CascadedStyles, the fingerprint works just as well or better as a key in CalculatedStyle!</span><br>        1662:  <span style="background-color: white">       *</span><br>        1663:  <span style="background-color: white">       * Revision 1.45  2005/10/24 15:37:35  pdoubleya</span><br>        1664:  <span style="background-color: white">       * Caching border, margin and property instances directly.</span><br>        1665:  <span style="background-color: white">       *</span><br>        1666:  <span style="background-color: white">       * Revision 1.44  2005/10/24 10:19:40  pdoubleya</span><br>        1667:  <span style="background-color: white">       * CSSName FS_ID is now public and final, allowing direct access to the id, bypassing getAssignedID(); micro-optimization :); getAssignedID() and setAssignedID() have been removed. IdentValue string property is also final (as should have been).</span><br>        1668:  <span style="background-color: white">       *</span><br>        1669:  <span style="background-color: white">       * Revision 1.43  2005/10/22 22:58:15  peterbrant</span><br>        1670:  <span style="background-color: white">       * Box level restyle works again (really this time!)</span><br>        1671:  <span style="background-color: white">       *</span><br>        1672:  <span style="background-color: white">       * Revision 1.42  2005/10/21 23:51:48  peterbrant</span><br>        1673:  <span style="background-color: white">       * Rollback ill-advised change in revision 1.40</span><br>        1674:  <span style="background-color: white">       *</span><br>        1675:  <span style="background-color: white">       * Revision 1.41  2005/10/21 23:11:26  pdoubleya</span><br>        1676:  <span style="background-color: white">       * Store key for margin, border and padding in each style instance, was re-creating on each call.</span><br>        1677:  <span style="background-color: white">       *</span><br>        1678:  <span style="background-color: white">       * Revision 1.40  2005/10/21 23:04:02  peterbrant</span><br>        1679:  <span style="background-color: white">       * Make box level restyle work again</span><br>        1680:  <span style="background-color: white">       *</span><br>        1681:  <span style="background-color: white">       * Revision 1.39  2005/10/21 18:49:46  pdoubleya</span><br>        1682:  <span style="background-color: white">       * Fixed border painting bug.</span><br>        1683:  <span style="background-color: white">       *</span><br>        1684:  <span style="background-color: white">       * Revision 1.38  2005/10/21 18:14:59  pdoubleya</span><br>        1685:  <span style="background-color: white">       * set  initial capacity for cached rects.</span><br>        1686:  <span style="background-color: white">       *</span><br>        1687:  <span style="background-color: white">       * Revision 1.37  2005/10/21 18:10:50  pdoubleya</span><br>        1688:  <span style="background-color: white">       * Support for cachable borders. Still buggy on some pages, but getting there.</span><br>        1689:  <span style="background-color: white">       *</span><br>        1690:  <span style="background-color: white">       * Revision 1.36  2005/10/21 13:02:20  pdoubleya</span><br>        1691:  <span style="background-color: white">       * Changed to cache padding in RectPropertySet.</span><br>        1692:  <span style="background-color: white">       *</span><br>        1693:  <span style="background-color: white">       * Revision 1.35  2005/10/21 12:20:04  pdoubleya</span><br>        1694:  <span style="background-color: white">       * Added array for margin side props.</span><br>        1695:  <span style="background-color: white">       *</span><br>        1696:  <span style="background-color: white">       * Revision 1.34  2005/10/21 12:16:18  pdoubleya</span><br>        1697:  <span style="background-color: white">       * Removed use of MarginPropertySet; using RectPS  now.</span><br>        1698:  <span style="background-color: white">       *</span><br>        1699:  <span style="background-color: white">       * Revision 1.33  2005/10/21 12:01:13  pdoubleya</span><br>        1700:  <span style="background-color: white">       * Added cachable rect property for margin, cleanup minor in styling.</span><br>        1701:  <span style="background-color: white">       *</span><br>        1702:  <span style="background-color: white">       * Revision 1.32  2005/10/21 10:02:54  pdoubleya</span><br>        1703:  <span style="background-color: white">       * Cleanup, removed unneeded vars, reorg code in CS.</span><br>        1704:  <span style="background-color: white">       *</span><br>        1705:  <span style="background-color: white">       * Revision 1.31  2005/10/20 20:48:01  pdoubleya</span><br>        1706:  <span style="background-color: white">       * Updates for refactoring to style classes. CalculatedStyle now has lookup methods to cover all general cases, so propertyByName() is private, which means the backing classes for styling were able to be replaced.</span><br>        1707:  <span style="background-color: white">       *</span><br>        1708:  <span style="background-color: white">       * Revision 1.30  2005/10/03 23:44:43  tobega</span><br>        1709:  <span style="background-color: white">       * thread-safer css code and improved style caching</span><br>        1710:  <span style="background-color: white">       *</span><br>        1711:  <span style="background-color: white">       * Revision 1.29  2005/09/11 20:43:15  tobega</span><br>        1712:  <span style="background-color: white">       * Fixed table-css interaction bug, colspan now works again</span><br>        1713:  <span style="background-color: white">       *</span><br>        1714:  <span style="background-color: white">       * Revision 1.28  2005/07/20 22:47:33  joshy</span><br>        1715:  <span style="background-color: white">       * fix for 94, percentage for top absolute position</span><br>        1716:  <span style="background-color: white">       *</span><br>        1717:  <span style="background-color: white">       * Revision 1.27  2005/06/22 23:48:41  tobega</span><br>        1718:  <span style="background-color: white">       * Refactored the css package to allow a clean separation from the core.</span><br>        1719:  <span style="background-color: white">       *</span><br>        1720:  <span style="background-color: white">       * Revision 1.26  2005/06/21 08:23:13  pdoubleya</span><br>        1721:  <span style="background-color: white">       * Added specific list and count of primitive, non shorthand properties, and CalculatedStyle now sizes array to this size.</span><br>        1722:  <span style="background-color: white">       *</span><br>        1723:  <span style="background-color: white">       * Revision 1.25  2005/06/16 07:24:46  tobega</span><br>        1724:  <span style="background-color: white">       * Fixed background image bug.</span><br>        1725:  <span style="background-color: white">       * Caching images in browser.</span><br>        1726:  <span style="background-color: white">       * Enhanced LinkListener.</span><br>        1727:  <span style="background-color: white">       * Some house-cleaning, playing with Idea's code inspection utility.</span><br>        1728:  <span style="background-color: white">       *</span><br>        1729:  <span style="background-color: white">       * Revision 1.24  2005/06/03 23:06:21  tobega</span><br>        1730:  <span style="background-color: white">       * Now uses value of "color" as initial value for "border-color" and rgb-triples are supported</span><br>        1731:  <span style="background-color: white">       *</span><br>        1732:  <span style="background-color: white">       * Revision 1.23  2005/06/01 00:47:02  tobega</span><br>        1733:  <span style="background-color: white">       * Partly confused hack trying to get width and height working properly for replaced elements.</span><br>        1734:  <span style="background-color: white">       *</span><br>        1735:  <span style="background-color: white">       * Revision 1.22  2005/05/29 16:38:58  tobega</span><br>        1736:  <span style="background-color: white">       * Handling of ex values should now be working well. Handling of em values improved. Is it correct?</span><br>        1737:  <span style="background-color: white">       * Also started defining dividing responsibilities between Context and RenderingContext.</span><br>        1738:  <span style="background-color: white">       *</span><br>        1739:  <span style="background-color: white">       * Revision 1.21  2005/05/13 11:49:57  tobega</span><br>        1740:  <span style="background-color: white">       * Started to fix up borders on inlines. Got caught up in refactoring.</span><br>        1741:  <span style="background-color: white">       * Boxes shouldn't cache borders and stuff unless necessary. Started to remove unnecessary references.</span><br>        1742:  <span style="background-color: white">       * Hover is not working completely well now, might get better when I'm done.</span><br>        1743:  <span style="background-color: white">       *</span><br>        1744:  <span style="background-color: white">       * Revision 1.20  2005/05/09 20:35:38  tobega</span><br>        1745:  <span style="background-color: white">       * Caching fonts in CalculatedStyle</span><br>        1746:  <span style="background-color: white">       *</span><br>        1747:  <span style="background-color: white">       * Revision 1.19  2005/05/08 15:37:28  tobega</span><br>        1748:  <span style="background-color: white">       * Fixed up style caching so it really works (internalize CascadedStyles and let each CalculatedStyle keep track of its derived children)</span><br>        1749:  <span style="background-color: white">       *</span><br>        1750:  <span style="background-color: white">       * Revision 1.18  2005/05/08 14:51:21  tobega</span><br>        1751:  <span style="background-color: white">       * Removed the need for the Styler</span><br>        1752:  <span style="background-color: white">       *</span><br>        1753:  <span style="background-color: white">       * Revision 1.17  2005/05/08 14:36:54  tobega</span><br>        1754:  <span style="background-color: white">       * Refactored away the need for having a context in a CalculatedStyle</span><br>        1755:  <span style="background-color: white">       *</span><br>        1756:  <span style="background-color: white">       * Revision 1.16  2005/04/07 16:33:34  pdoubleya</span><br>        1757:  <span style="background-color: white">       * Fix border width if set to "none" in CSS (Kevin).</span><br>        1758:  <span style="background-color: white">       *</span><br>        1759:  <span style="background-color: white">       * Revision 1.15  2005/03/24 23:16:33  pdoubleya</span><br>        1760:  <span style="background-color: white">       * Added use of SharedContext (Kevin).</span><br>        1761:  <span style="background-color: white">       *</span><br>        1762:  <span style="background-color: white">       * Revision 1.14  2005/02/03 23:15:50  pdoubleya</span><br>        1763:  <span style="background-color: white">       * .</span><br>        1764:  <span style="background-color: white">       *</span><br>        1765:  <span style="background-color: white">       * Revision 1.13  2005/01/29 20:22:20  pdoubleya</span><br>        1766:  <span style="background-color: white">       * Clean/reformat code. Removed commented blocks, checked copyright.</span><br>        1767:  <span style="background-color: white">       *</span><br>        1768:  <span style="background-color: white">       * Revision 1.12  2005/01/25 12:46:12  pdoubleya</span><br>        1769:  <span style="background-color: white">       * Refactored duplicate code into separate method.</span><br>        1770:  <span style="background-color: white">       *</span><br>        1771:  <span style="background-color: white">       * Revision 1.11  2005/01/24 22:46:43  pdoubleya</span><br>        1772:  <span style="background-color: white">       * Added support for ident-checks using IdentValue instead of string comparisons.</span><br>        1773:  <span style="background-color: white">       *</span><br>        1774:  <span style="background-color: white">       * Revision 1.10  2005/01/24 19:01:05  pdoubleya</span><br>        1775:  <span style="background-color: white">       * Mass checkin. Changed to use references to CSSName, which now has a Singleton instance for each property, everywhere property names were being used before. Removed commented code. Cascaded and Calculated style now store properties in arrays rather than maps, for optimization.</span><br>        1776:  <span style="background-color: white">       *</span><br>        1777:  <span style="background-color: white">       * Revision 1.9  2005/01/24 14:36:31  pdoubleya</span><br>        1778:  <span style="background-color: white">       * Mass commit, includes: updated for changes to property declaration instantiation, and new use of DerivedValue. Removed any references to older XR... classes (e.g. XRProperty). Cleaned imports.</span><br>        1779:  <span style="background-color: white">       *</span><br>        1780:  <span style="background-color: white">       * Revision 1.8  2004/12/05 18:11:36  tobega</span><br>        1781:  <span style="background-color: white">       * Now uses style cache for pseudo-element styles. Also started preparing to replace inline node handling with inline content handling.</span><br>        1782:  <span style="background-color: white">       *</span><br>        1783:  <span style="background-color: white">       * Revision 1.7  2004/12/05 00:48:54  tobega</span><br>        1784:  <span style="background-color: white">       * Cleaned up so that now all property-lookups use the CalculatedStyle. Also added support for relative values of top, left, width, etc.</span><br>        1785:  <span style="background-color: white">       *</span><br>        1786:  <span style="background-color: white">       * Revision 1.6  2004/11/15 12:42:23  pdoubleya</span><br>        1787:  <span style="background-color: white">       * Across this checkin (all may not apply to this particular file)</span><br>        1788:  <span style="background-color: white">       * Changed default/package-access members to private.</span><br>        1789:  <span style="background-color: white">       * Changed to use XRRuntimeException where appropriate.</span><br>        1790:  <span style="background-color: white">       * Began move from System.err.println to std logging.</span><br>        1791:  <span style="background-color: white">       * Standard code reformat.</span><br>        1792:  <span style="background-color: white">       * Removed some unnecessary SAC member variables that were only used in initialization.</span><br>        1793:  <span style="background-color: white">       * CVS log section.</span><br>        1794:  <span style="background-color: white">       *</span><br>        1795:  <span style="background-color: white">       *</span><br>        1796:  <span style="background-color: white">       */</span><br>        1797:  <span style="background-color: white">      </span><br></pre> </code> 
   </div> 
   <div class="column"> 
    <h2>Patched Code:</h2> <code> <pre id="patched-trace">        1-&gt;N:  <span style="background-color: white">      /*</span><br>        2-&gt;N:  <span style="background-color: white">       * CalculatedStyle.java</span><br>        3-&gt;N:  <span style="background-color: white">       * Copyright (c) 2004, 2005 Patrick Wright, Torbjoern Gannholm</span><br>        4-&gt;N:  <span style="background-color: white">       * Copyright (c) 2006 Wisconsin Court System</span><br>        5-&gt;N:  <span style="background-color: white">       *</span><br>        6-&gt;N:  <span style="background-color: white">       * This program is free software; you can redistribute it and/or</span><br>        7-&gt;N:  <span style="background-color: white">       * modify it under the terms of the GNU Lesser General Public License</span><br>        8-&gt;N:  <span style="background-color: white">       * as published by the Free Software Foundation; either version 2.1</span><br>        9-&gt;N:  <span style="background-color: white">       * of the License, or (at your option) any later version.</span><br>       10-&gt;N:  <span style="background-color: white">       *</span><br>       11-&gt;N:  <span style="background-color: white">       * This program is distributed in the hope that it will be useful,</span><br>       12-&gt;N:  <span style="background-color: white">       * but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br>       13-&gt;N:  <span style="background-color: white">       * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><br>       14-&gt;N:  <span style="background-color: white">       * GNU Lesser General Public License for more details.</span><br>       15-&gt;N:  <span style="background-color: white">       *</span><br>       16-&gt;N:  <span style="background-color: white">       * You should have received a copy of the GNU Lesser General Public License</span><br>       17-&gt;N:  <span style="background-color: white">       * along with this program; if not, write to the Free Software</span><br>       18-&gt;N:  <span style="background-color: white">       * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span><br>       19-&gt;N:  <span style="background-color: white">       *</span><br>       20-&gt;N:  <span style="background-color: white">       */</span><br>       21-&gt;N:  <span style="background-color: white">      package com.openhtmltopdf.css.style;</span><br>       22-&gt;N:  <span style="background-color: white">      </span><br>       23-&gt;N:  <span style="background-color: white">      import java.awt.Cursor;</span><br>       24-&gt;N:  <span style="background-color: white">      import java.util.ArrayList;</span><br>       25-&gt;N:  <span style="background-color: white">      import java.util.Collections;</span><br>       26-&gt;N:  <span style="background-color: white">      import java.util.List;</span><br>       27-&gt;N:  <span style="background-color: white">      import java.util.Objects;</span><br>       28-&gt;N:  <span style="background-color: white">      import java.util.logging.Level;</span><br>       29-&gt;N:  <span style="background-color: white">      import java.util.stream.Collectors;</span><br>       30-&gt;N:  <span style="background-color: white">      </span><br>       31-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.context.StyleReference;</span><br>       32-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.CSSName;</span><br>       33-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.constants.IdentValue;</span><br>       34-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.newmatch.CascadedStyle;</span><br>       35-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.CSSPrimitiveValue;</span><br>       36-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.CounterData;</span><br>       37-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSColor;</span><br>       38-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSFunction;</span><br>       39-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.FSRGBColor;</span><br>       40-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.PropertyValue;</span><br>       41-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.parser.property.PrimitivePropertyBuilders;</span><br>       42-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.sheet.PropertyDeclaration;</span><br>       43-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.BorderPropertySet;</span><br>       44-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.CountersValue;</span><br>       45-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.DerivedValueFactory;</span><br>       46-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.FSLinearGradient;</span><br>       47-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.FunctionValue;</span><br>       48-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.LengthValue;</span><br>       49-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.ListValue;</span><br>       50-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.NumberValue;</span><br>       51-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.style.derived.RectPropertySet;</span><br>       52-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.css.value.FontSpecification;</span><br>       53-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.BoxBuilder;</span><br>       54-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.LayoutContext;</span><br>       55-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.SharedContext;</span><br>       56-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.layout.counter.RootCounterContext;</span><br>       57-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.newtable.TableBox;</span><br>       58-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.render.Box;</span><br>       59-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.render.FSFont;</span><br>       60-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.render.FSFontMetrics;</span><br>       61-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.render.RenderingContext;</span><br>       62-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.util.LogMessageId;</span><br>       63-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.util.ThreadCtx;</span><br>       64-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.util.WebDoc;</span><br>       65-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.util.WebDocLocations;</span><br>       66-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.util.XRLog;</span><br>       67-&gt;N:  <span style="background-color: white">      import com.openhtmltopdf.util.XRRuntimeException;</span><br>       68-&gt;N:  <span style="background-color: white">      </span><br>       69-&gt;N:  <span style="background-color: white">      </span><br>       70-&gt;N:  <span style="background-color: white">      /**</span><br>       71-&gt;N:  <span style="background-color: white">       * A set of properties that apply to a single Element, derived from all matched</span><br>       72-&gt;N:  <span style="background-color: white">       * properties following the rules for CSS cascade, inheritance, importance,</span><br>       73-&gt;N:  <span style="background-color: white">       * specificity and sequence. A property retrieved by name should always have</span><br>       74-&gt;N:  <span style="background-color: white">       * exactly one value in this class (e.g. one-one map). Some methods to retrieve</span><br>       75-&gt;N:  <span style="background-color: white">       * property values from an instance of this class require a valid {@link</span><br>       76-&gt;N:  <span style="background-color: white">       * com.openhtmltopdf.layout.LayoutContext} be given to them.</span><br>       77-&gt;N:  <span style="background-color: white">       * <br><br></span><br>       78-&gt;N:  <span style="background-color: white">       * This is the go to class for working with a resolved style. Generally, you can get a</span><br>       79-&gt;N:  <span style="background-color: white">       * instance for a box by calling:</span><br>       80-&gt;N:  <span style="background-color: white">       *</span><br>       81-&gt;N:  <span style="background-color: white">       * 
       <ul></ul></span><br>       82-&gt;N:  <span style="background-color: white">       *   <li>{@link Box#getStyle()} after a box has been created by the {@link BoxBuilder}</li></span><br>       83-&gt;N:  <span style="background-color: white">       *   <li>{@link SharedContext#getStyle(org.w3c.dom.Element)} for an element</li></span><br>       84-&gt;N:  <span style="background-color: white">       *   <li>{@link StyleReference#getPseudoElementStyle(org.w3c.dom.Node, String)} for a pseudo</li></span><br>       85-&gt;N:  <span style="background-color: white">       *       element. StyleReference is available from {@link LayoutContext}</span><br>       86-&gt;N:  <span style="background-color: white">       *   <li>{@link #deriveStyle(CascadedStyle)}</li> to create a child style (non-inherited</span><br>       87-&gt;N:  <span style="background-color: white">       *       property values will not be available from the child style</span><br>       88-&gt;N:  <span style="background-color: white">       *   <li>{@link EmptyStyle} to start with nothing</li></span><br>       89-&gt;N:  <span style="background-color: white">       * </span><br>       90-&gt;N:  <span style="background-color: white">       *</span><br>       91-&gt;N:  <span style="background-color: white">       * @author Torbjoern Gannholm</span><br>       92-&gt;N:  <span style="background-color: white">       * @author Patrick Wright</span><br>       93-&gt;N:  <span style="background-color: white">       */</span><br>       94-&gt;N:  <span style="background-color: white">      public class CalculatedStyle {</span><br>       95-&gt;N:  <span style="background-color: white">          /**</span><br>       96-&gt;N:  <span style="background-color: white">           * The parent-style we inherit from</span><br>       97-&gt;N:  <span style="background-color: white">           */</span><br>      98-&gt;86:  <span style="background-color: white">          private CalculatedStyle _parent;</span><br>       99-&gt;N:  <span style="background-color: white">      </span><br>     100-&gt;88:  <span style="background-color: white">          private BorderPropertySet _border;</span><br>     101-&gt;89:  <span style="background-color: white">          private RectPropertySet _margin;</span><br>     102-&gt;90:  <span style="background-color: white">          private RectPropertySet _padding;</span><br>      103-&gt;N:  <span style="background-color: white">      </span><br>     104-&gt;92:  <span style="background-color: white">          private float _lineHeight;</span><br>     105-&gt;93:  <span style="background-color: white">          private boolean _lineHeightResolved;</span><br>      106-&gt;N:  <span style="background-color: white">      </span><br>     107-&gt;95:  <span style="background-color: white">          private FSFont _FSFont;</span><br>     108-&gt;96:  <span style="background-color: white">          private FSFontMetrics _FSFontMetrics;</span><br>      109-&gt;N:  <span style="background-color: white">      </span><br>     110-&gt;98:  <span style="background-color: white">          private boolean _marginsAllowed = true;</span><br>     111-&gt;99:  <span style="background-color: white">          private boolean _paddingAllowed = true;</span><br>    112-&gt;100:  <span style="background-color: white">          private boolean _bordersAllowed = true;</span><br>      113-&gt;N:  <span style="background-color: white">      </span><br>      114-&gt;N:  <span style="background-color: white">          /**</span><br>      115-&gt;N:  <span style="background-color: white">           * Cache child styles of this style that have the same cascaded properties</span><br>      116-&gt;N:  <span style="background-color: white">           */</span><br>    117-&gt;107:  <span style="background-color: white">          private final java.util.Map
       <string, calculatedstyle>
         _childCache = new java.util.HashMap&lt;&gt;();
       </string,></span><br>      118-&gt;N:  <span style="background-color: white">      </span><br>      119-&gt;N:  <span style="background-color: white">          /**</span><br>      120-&gt;N:  <span style="background-color: white">           * Our main array of property values defined in this style, keyed</span><br>      121-&gt;N:  <span style="background-color: white">           * by the CSSName assigned ID.</span><br>      122-&gt;N:  <span style="background-color: white">           */</span><br>    123-&gt;120:  <span style="background-color: white">          private final FSDerivedValue[] _derivedValuesById;</span><br>      124-&gt;N:  <span style="background-color: white">      </span><br>    125-&gt;122:  <span style="background-color: white">   0      public FSDerivedValue[] getderivedValuesById() {</span><br>      126-&gt;N:  <span style="background-color: white">   0  		return _derivedValuesById;</span><br>      127-&gt;N:  <span style="background-color: white">      	}</span><br>      128-&gt;N:  <span style="background-color: white">      </span><br>      129-&gt;N:  <span style="background-color: white">      	/**</span><br>      130-&gt;N:  <span style="background-color: white">           * The derived Font for this style</span><br>      131-&gt;N:  <span style="background-color: white">           */</span><br>    132-&gt;129:  <span style="background-color: white">          private FontSpecification _font;</span><br>      133-&gt;N:  <span style="background-color: white">      </span><br>      134-&gt;N:  <span style="background-color: white">      </span><br>      135-&gt;N:  <span style="background-color: white">          /**</span><br>      136-&gt;N:  <span style="background-color: white">           * Default constructor; as the instance is immutable after use, don't use</span><br>      137-&gt;N:  <span style="background-color: white">           * this for class instantiation externally.</span><br>      138-&gt;N:  <span style="background-color: white">           */</span><br>      139-&gt;N:  <span style="background-color: white"> 99+      protected CalculatedStyle() {</span><br>    140-&gt;137:  <span style="background-color: cyan"> 99+          _derivedValuesById = new FSDerivedValue[CSSName.countCSSPrimitiveNames()];</span><br>      141-&gt;N:  <span style="background-color: white">          }</span><br>      142-&gt;N:  <span style="background-color: white">      </span><br>      143-&gt;N:  <span style="background-color: white">      </span><br>      144-&gt;N:  <span style="background-color: white">          /**</span><br>      145-&gt;N:  <span style="background-color: white">           * Constructor for the CalculatedStyle object. To get a derived style, use</span><br>      146-&gt;N:  <span style="background-color: white">           * the Styler objects getDerivedStyle which will cache styles</span><br>      147-&gt;N:  <span style="background-color: white">           *</span><br>      148-&gt;N:  <span style="background-color: white">           * @param parent  PARAM</span><br>      149-&gt;N:  <span style="background-color: white">           * @param matched PARAM</span><br>      150-&gt;N:  <span style="background-color: white">           */</span><br>      151-&gt;U:  <span style="background-color: yellow"> 99+      private CalculatedStyle(CalculatedStyle parent, CascadedStyle matched) {</span><br>    152-&gt;149:  <span style="background-color: cyan"> 99+          this();</span><br>    153-&gt;150:  <span style="background-color: cyan"> 99+          _parent = parent;</span><br>      154-&gt;N:  <span style="background-color: white">      </span><br>      155-&gt;U:  <span style="background-color: yellow"> 99+          init(matched);</span><br>      156-&gt;N:  <span style="background-color: white">          }</span><br>      157-&gt;N:  <span style="background-color: white">      </span><br>      158-&gt;N:  <span style="background-color: white">      </span><br>      159-&gt;U:  <span style="background-color: yellow"> 99+      private void init(CascadedStyle matched) {</span><br>      160-&gt;U:  <span style="background-color: yellow"> 99+          derive(matched);</span><br>      161-&gt;U:  <span style="background-color: yellow">      </span><br>      162-&gt;U:  <span style="background-color: yellow"> 99+          checkPaddingAllowed();</span><br>      163-&gt;U:  <span style="background-color: yellow"> 99+          checkMarginsAllowed();</span><br>      164-&gt;U:  <span style="background-color: yellow"> 99+          checkBordersAllowed();</span><br>      165-&gt;U:  <span style="background-color: yellow">          }</span><br>      166-&gt;N:  <span style="background-color: white">      </span><br>    167-&gt;159:  <span style="background-color: cyan"> 99+      private void checkPaddingAllowed() {</span><br>    168-&gt;160:  <span style="background-color: cyan"> 99+          IdentValue v = getIdent(CSSName.DISPLAY);</span><br>    169-&gt;161:  <span style="background-color: cyan"> 99+          if (v == IdentValue.TABLE_HEADER_GROUP || v == IdentValue.TABLE_ROW_GROUP ||</span><br>    170-&gt;162:  <span style="background-color: white">                      v == IdentValue.TABLE_FOOTER_GROUP || v == IdentValue.TABLE_ROW) {</span><br>    171-&gt;163:  <span style="background-color: cyan"> 99+              _paddingAllowed = false;</span><br>    172-&gt;164:  <span style="background-color: cyan"> 99+          } else if ((v == IdentValue.TABLE || v == IdentValue.INLINE_TABLE) &amp;&amp; isCollapseBorders()) {</span><br>    173-&gt;165:  <span style="background-color: cyan">  47              _paddingAllowed = false;</span><br>      174-&gt;N:  <span style="background-color: white">              }</span><br>      175-&gt;N:  <span style="background-color: white">          }</span><br>      176-&gt;N:  <span style="background-color: white">      </span><br>    177-&gt;169:  <span style="background-color: cyan"> 99+      private void checkMarginsAllowed() {</span><br>    178-&gt;170:  <span style="background-color: cyan"> 99+          IdentValue v = getIdent(CSSName.DISPLAY);</span><br>    179-&gt;171:  <span style="background-color: cyan"> 99+          if (v == IdentValue.TABLE_HEADER_GROUP || v == IdentValue.TABLE_ROW_GROUP ||</span><br>    180-&gt;172:  <span style="background-color: white">                      v == IdentValue.TABLE_FOOTER_GROUP || v == IdentValue.TABLE_ROW ||</span><br>    181-&gt;173:  <span style="background-color: white">                      v == IdentValue.TABLE_CELL) {</span><br>    182-&gt;174:  <span style="background-color: cyan"> 99+              _marginsAllowed = false;</span><br>      183-&gt;N:  <span style="background-color: white">              }</span><br>      184-&gt;N:  <span style="background-color: white">          }</span><br>      185-&gt;N:  <span style="background-color: white">      </span><br>    186-&gt;178:  <span style="background-color: cyan"> 99+      private void checkBordersAllowed() {</span><br>    187-&gt;179:  <span style="background-color: cyan"> 99+          IdentValue v = getIdent(CSSName.DISPLAY);</span><br>    188-&gt;180:  <span style="background-color: cyan"> 99+          if (v == IdentValue.TABLE_HEADER_GROUP || v == IdentValue.TABLE_ROW_GROUP ||</span><br>    189-&gt;181:  <span style="background-color: white">                      v == IdentValue.TABLE_FOOTER_GROUP || v == IdentValue.TABLE_ROW) {</span><br>    190-&gt;182:  <span style="background-color: cyan"> 99+              _bordersAllowed = false;</span><br>      191-&gt;N:  <span style="background-color: white">              }</span><br>      192-&gt;N:  <span style="background-color: white">          }</span><br>      193-&gt;N:  <span style="background-color: white">      </span><br>      194-&gt;N:  <span style="background-color: white">          /**</span><br>      195-&gt;N:  <span style="background-color: white">           * Derives a <strong>child</strong> style from this style. Non-inherited properties</span><br>      196-&gt;N:  <span style="background-color: white">           * such as borders will be replaced compared to <code>this</code> which is used</span><br>      197-&gt;N:  <span style="background-color: white">           * as parent style.</span><br>      198-&gt;N:  <span style="background-color: white">           * <br><br></span><br>      199-&gt;N:  <span style="background-color: white">           * Depends on the ability to return the identical CascadedStyle each time a child style is needed</span><br>      200-&gt;N:  <span style="background-color: white">           *</span><br>      201-&gt;N:  <span style="background-color: white">           * @param matched the CascadedStyle to apply</span><br>      202-&gt;N:  <span style="background-color: white">           * @return The derived child style</span><br>      203-&gt;N:  <span style="background-color: white">           */</span><br>    204-&gt;194:  <span style="background-color: cyan"> 99+      public CalculatedStyle deriveStyle(CascadedStyle matched) {</span><br>    205-&gt;195:  <span style="background-color: cyan"> 99+          String fingerprint = matched.getFingerprint();</span><br>    206-&gt;196:  <span style="background-color: cyan"> 99+          CalculatedStyle cs = _childCache.get(fingerprint);</span><br>      207-&gt;N:  <span style="background-color: white">      </span><br>    208-&gt;198:  <span style="background-color: cyan"> 99+          if (cs == null) {</span><br>    209-&gt;199:  <span style="background-color: cyan"> 99+              cs = new CalculatedStyle(this, matched);</span><br>    210-&gt;200:  <span style="background-color: cyan"> 99+              _childCache.put(fingerprint, cs);</span><br>      211-&gt;N:  <span style="background-color: white">              }</span><br>      212-&gt;N:  <span style="background-color: white">      </span><br>      213-&gt;U:  <span style="background-color: yellow"> 99+          RootCounterContext cc = ThreadCtx.get().sharedContext().getGlobalCounterContext();</span><br>      214-&gt;U:  <span style="background-color: yellow"> 99+          cc.resetCounterValue(cs);</span><br>      215-&gt;U:  <span style="background-color: yellow"> 99+          cc.incrementCounterValue(cs);</span><br>      216-&gt;N:  <span style="background-color: white">      </span><br>    217-&gt;202:  <span style="background-color: cyan"> 99+          return cs;</span><br>      218-&gt;N:  <span style="background-color: white">          }</span><br>      219-&gt;N:  <span style="background-color: white">      </span><br>      220-&gt;N:  <span style="background-color: white">          /**</span><br>      221-&gt;N:  <span style="background-color: white">           * Override this style with specified styles. This will NOT</span><br>      222-&gt;N:  <span style="background-color: white">           * create a child style, rather an exact copy with only the specified</span><br>      223-&gt;N:  <span style="background-color: white">           * properties overridden. Compare to {@link #deriveStyle(CascadedStyle)}.</span><br>      224-&gt;N:  <span style="background-color: white">           */</span><br>      225-&gt;U:  <span style="background-color: yellow">   0      public CalculatedStyle overrideStyle(CascadedStyle matched) {</span><br>      226-&gt;U:  <span style="background-color: yellow">   0          CalculatedStyle ret = new CalculatedStyle();</span><br>      227-&gt;U:  <span style="background-color: yellow">      </span><br>      228-&gt;U:  <span style="background-color: yellow">   0          ret._parent = this._parent;</span><br>      229-&gt;U:  <span style="background-color: yellow">   0          System.arraycopy(this._derivedValuesById, 0, ret._derivedValuesById, 0, ret._derivedValuesById.length);</span><br>      230-&gt;U:  <span style="background-color: yellow">      </span><br>      231-&gt;U:  <span style="background-color: yellow">   0          init(matched);</span><br>      232-&gt;U:  <span style="background-color: yellow">      </span><br>      233-&gt;U:  <span style="background-color: yellow">   0          return ret;</span><br>      234-&gt;U:  <span style="background-color: yellow">          }</span><br>      235-&gt;N:  <span style="background-color: white">      </span><br>      236-&gt;N:  <span style="background-color: white">          /**</span><br>      237-&gt;N:  <span style="background-color: white">           * Override this style with specified styles. This will NOT</span><br>      238-&gt;N:  <span style="background-color: white">           * create a child style, rather an exact copy with only the display</span><br>      239-&gt;N:  <span style="background-color: white">           * property overridden. Compare to {@link #createAnonymousStyle(IdentValue)}</span><br>      240-&gt;N:  <span style="background-color: white">           * which creates a child style.</span><br>      241-&gt;N:  <span style="background-color: white">           */</span><br>      242-&gt;U:  <span style="background-color: yellow">   0      public CalculatedStyle overrideStyle(IdentValue display) {</span><br>      243-&gt;U:  <span style="background-color: yellow">   0          CalculatedStyle ret = new CalculatedStyle();</span><br>      244-&gt;U:  <span style="background-color: yellow">      </span><br>      245-&gt;U:  <span style="background-color: yellow">   0          ret._parent = this._parent;</span><br>      246-&gt;U:  <span style="background-color: yellow">   0          System.arraycopy(this._derivedValuesById, 0, ret._derivedValuesById, 0, ret._derivedValuesById.length);</span><br>      247-&gt;U:  <span style="background-color: yellow">      </span><br>      248-&gt;U:  <span style="background-color: yellow">   0          ret.init(CascadedStyle.createAnonymousStyle(display));</span><br>      249-&gt;U:  <span style="background-color: yellow">      </span><br>      250-&gt;U:  <span style="background-color: yellow">   0          return ret;</span><br>      251-&gt;U:  <span style="background-color: yellow">          }</span><br>      252-&gt;N:  <span style="background-color: white">      </span><br>      253-&gt;N:  <span style="background-color: white">          /**</span><br>      254-&gt;N:  <span style="background-color: white">           * Returns the parent style.</span><br>      255-&gt;N:  <span style="background-color: white">           *</span><br>      256-&gt;N:  <span style="background-color: white">           * @return Returns the parent style</span><br>      257-&gt;N:  <span style="background-color: white">           */</span><br>    258-&gt;218:  <span style="background-color: cyan"> 99+      public CalculatedStyle getParent() {</span><br>      259-&gt;N:  <span style="background-color: white"> 99+          return _parent;</span><br>      260-&gt;N:  <span style="background-color: white">          }</span><br>      261-&gt;N:  <span style="background-color: white">      </span><br>      262-&gt;N:  <span style="background-color: white">          /**</span><br>      263-&gt;N:  <span style="background-color: white">           * Converts to a String representation of the object.</span><br>      264-&gt;N:  <span style="background-color: white">           *</span><br>      265-&gt;N:  <span style="background-color: white">           * @return The borderWidth value</span><br>      266-&gt;N:  <span style="background-color: white">           */</span><br>    267-&gt;227:  <span style="background-color: white">   0      @Override</span><br>    268-&gt;228:  <span style="background-color: white">          public String toString() {</span><br>      269-&gt;N:  <span style="background-color: white">   0          return genStyleKey();</span><br>      270-&gt;N:  <span style="background-color: white">          }</span><br>      271-&gt;N:  <span style="background-color: white">      </span><br>    272-&gt;232:  <span style="background-color: cyan"> 99+      public FSColor asColor(CSSName cssName) {</span><br>    273-&gt;233:  <span style="background-color: cyan"> 99+          FSDerivedValue prop = valueByName(cssName);</span><br>    274-&gt;234:  <span style="background-color: cyan"> 99+          if (prop == IdentValue.TRANSPARENT) {</span><br>      275-&gt;N:  <span style="background-color: white">   0              return FSRGBColor.TRANSPARENT;</span><br>      276-&gt;N:  <span style="background-color: white">              } else {</span><br>    277-&gt;237:  <span style="background-color: cyan"> 99+              return prop.asColor();</span><br>      278-&gt;N:  <span style="background-color: white">              }</span><br>      279-&gt;N:  <span style="background-color: white">          }</span><br>      280-&gt;N:  <span style="background-color: white">      </span><br>    281-&gt;241:  <span style="background-color: red"> 99+      public float asFloat(CSSName cssName) {</span><br>    282-&gt;242:  <span style="background-color: red"> 99+          return valueByName(cssName).asFloat();</span><br>      283-&gt;N:  <span style="background-color: white">          }</span><br>      284-&gt;N:  <span style="background-color: white">      </span><br>    285-&gt;245:  <span style="background-color: white">   0      public String asString(CSSName cssName) {</span><br>    286-&gt;246:  <span style="background-color: white">   0          return valueByName(cssName).asString();</span><br>      287-&gt;N:  <span style="background-color: white">          }</span><br>      288-&gt;N:  <span style="background-color: white">      </span><br>    289-&gt;249:  <span style="background-color: white">  96      public String[] asStringArray(CSSName cssName) {</span><br>    290-&gt;250:  <span style="background-color: white">  96          return valueByName(cssName).asStringArray();</span><br>      291-&gt;N:  <span style="background-color: white">          }</span><br>      292-&gt;N:  <span style="background-color: white">      </span><br>      293-&gt;N:  <span style="background-color: white">          // TODO: doc</span><br>    294-&gt;260:  <span style="background-color: red"> 99+      public boolean hasAbsoluteUnit(CSSName cssName) {</span><br>    295-&gt;261:  <span style="background-color: red"> 99+          boolean isAbs = false;</span><br>      296-&gt;N:  <span style="background-color: white"> 99+          try {</span><br>    297-&gt;263:  <span style="background-color: red"> 99+              isAbs = valueByName(cssName).hasAbsoluteUnit();</span><br>    298-&gt;264:  <span style="background-color: white">              } catch (Exception e) {</span><br>    299-&gt;265:  <span style="background-color: white">   0              XRLog.log(Level.WARNING, LogMessageId.LogMessageId2Param.LAYOUT_CSS_PROPERTY_HAS_UNPROCESSABLE_ASSIGNMENT, cssName, e.getMessage());</span><br>    300-&gt;266:  <span style="background-color: white">   0              isAbs = false;</span><br>      301-&gt;N:  <span style="background-color: white">              }</span><br>    302-&gt;268:  <span style="background-color: red"> 99+          return isAbs;</span><br>      303-&gt;N:  <span style="background-color: white">          }</span><br>      304-&gt;N:  <span style="background-color: white">      </span><br>      305-&gt;N:  <span style="background-color: white">          /**</span><br>      306-&gt;N:  <span style="background-color: white">           * Gets the ident attribute of the CalculatedStyle object</span><br>      307-&gt;N:  <span style="background-color: white">           *</span><br>      308-&gt;N:  <span style="background-color: white">           * @param cssName PARAM</span><br>      309-&gt;N:  <span style="background-color: white">           * @param val     PARAM</span><br>      310-&gt;N:  <span style="background-color: white">           * @return The ident value</span><br>      311-&gt;N:  <span style="background-color: white">           */</span><br>    312-&gt;278:  <span style="background-color: cyan"> 99+      public boolean isIdent(CSSName cssName, IdentValue val) {</span><br>    313-&gt;279:  <span style="background-color: cyan"> 99+          return valueByName(cssName) == val;</span><br>      314-&gt;N:  <span style="background-color: white">          }</span><br>      315-&gt;N:  <span style="background-color: white">      </span><br>      316-&gt;N:  <span style="background-color: white">          /**</span><br>      317-&gt;N:  <span style="background-color: white">           * Gets the ident attribute of the CalculatedStyle object</span><br>      318-&gt;N:  <span style="background-color: white">           *</span><br>      319-&gt;N:  <span style="background-color: white">           * @param cssName PARAM</span><br>      320-&gt;N:  <span style="background-color: white">           * @return The ident value</span><br>      321-&gt;N:  <span style="background-color: white">           */</span><br>    322-&gt;288:  <span style="background-color: cyan"> 99+      public IdentValue getIdent(CSSName cssName) {</span><br>    323-&gt;289:  <span style="background-color: cyan"> 99+          return valueByName(cssName).asIdentValue();</span><br>      324-&gt;N:  <span style="background-color: white">          }</span><br>      325-&gt;N:  <span style="background-color: white">      </span><br>      326-&gt;N:  <span style="background-color: white">          /**</span><br>      327-&gt;N:  <span style="background-color: white">           * Convenience property accessor; returns a Color initialized with the</span><br>      328-&gt;N:  <span style="background-color: white">           * foreground color Uses the actual value (computed actual value) for this</span><br>      329-&gt;N:  <span style="background-color: white">           * element.</span><br>      330-&gt;N:  <span style="background-color: white">           *</span><br>      331-&gt;N:  <span style="background-color: white">           * @return The color value</span><br>      332-&gt;N:  <span style="background-color: white">           */</span><br>    333-&gt;299:  <span style="background-color: cyan"> 99+      public FSColor getColor() {</span><br>    334-&gt;300:  <span style="background-color: cyan"> 99+          return asColor(CSSName.COLOR);</span><br>      335-&gt;N:  <span style="background-color: white">          }</span><br>      336-&gt;N:  <span style="background-color: white">      </span><br>      337-&gt;N:  <span style="background-color: white">          /**</span><br>      338-&gt;N:  <span style="background-color: white">           * Convenience property accessor; returns a Color initialized with the</span><br>      339-&gt;N:  <span style="background-color: white">           * background color value; Uses the actual value (computed actual value) for</span><br>      340-&gt;N:  <span style="background-color: white">           * this element.</span><br>      341-&gt;N:  <span style="background-color: white">           *</span><br>      342-&gt;N:  <span style="background-color: white">           * @return The backgroundColor value</span><br>      343-&gt;N:  <span style="background-color: white">           */</span><br>    344-&gt;310:  <span style="background-color: cyan"> 99+      public FSColor getBackgroundColor() {</span><br>    345-&gt;311:  <span style="background-color: cyan"> 99+          FSDerivedValue prop = valueByName(CSSName.BACKGROUND_COLOR);</span><br>    346-&gt;312:  <span style="background-color: cyan"> 99+          if (prop == IdentValue.TRANSPARENT) {</span><br>    347-&gt;313:  <span style="background-color: cyan"> 99+              return null;</span><br>      348-&gt;N:  <span style="background-color: white">              } else {</span><br>    349-&gt;315:  <span style="background-color: cyan"> 99+              return asColor(CSSName.BACKGROUND_COLOR);</span><br>      350-&gt;N:  <span style="background-color: white">              }</span><br>      351-&gt;N:  <span style="background-color: white">          }</span><br>      352-&gt;N:  <span style="background-color: white">      </span><br>    353-&gt;319:  <span style="background-color: cyan"> 99+      public List
       <counterdata>
         getCounterReset() {
       </counterdata></span><br>    354-&gt;320:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(CSSName.COUNTER_RESET);</span><br>      355-&gt;N:  <span style="background-color: white">      </span><br>    356-&gt;322:  <span style="background-color: cyan"> 99+          if (value == IdentValue.NONE) {</span><br>    357-&gt;323:  <span style="background-color: cyan"> 99+              return null;</span><br>      358-&gt;N:  <span style="background-color: white">              } else {</span><br>    359-&gt;325:  <span style="background-color: white">   0              return ((CountersValue) value).getValues();</span><br>      360-&gt;N:  <span style="background-color: white">              }</span><br>      361-&gt;N:  <span style="background-color: white">          }</span><br>      362-&gt;N:  <span style="background-color: white">      </span><br>    363-&gt;329:  <span style="background-color: cyan"> 99+      public List
       <counterdata>
         getCounterIncrement() {
       </counterdata></span><br>    364-&gt;330:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(CSSName.COUNTER_INCREMENT);</span><br>      365-&gt;N:  <span style="background-color: white">      </span><br>    366-&gt;332:  <span style="background-color: cyan"> 99+          if (value == IdentValue.NONE) {</span><br>    367-&gt;333:  <span style="background-color: cyan"> 99+              return null;</span><br>      368-&gt;N:  <span style="background-color: white">              } else {</span><br>    369-&gt;335:  <span style="background-color: cyan">  96              return  ((CountersValue) value).getValues();</span><br>      370-&gt;N:  <span style="background-color: white">              }</span><br>      371-&gt;N:  <span style="background-color: white">          }</span><br>      372-&gt;N:  <span style="background-color: white">      </span><br>    373-&gt;339:  <span style="background-color: cyan"> 99+      public BorderPropertySet getBorder(CssContext ctx) {</span><br>      374-&gt;N:  <span style="background-color: white"> 99+          if (! _bordersAllowed) {</span><br>      375-&gt;N:  <span style="background-color: white"> 99+              return BorderPropertySet.EMPTY_BORDER;</span><br>      376-&gt;N:  <span style="background-color: white">              } else {</span><br>    377-&gt;343:  <span style="background-color: cyan"> 99+              BorderPropertySet b = getBorderProperty(this, ctx);</span><br>    378-&gt;344:  <span style="background-color: cyan"> 99+              return b;</span><br>      379-&gt;N:  <span style="background-color: white">              }</span><br>      380-&gt;N:  <span style="background-color: white">          }</span><br>      381-&gt;N:  <span style="background-color: white">      </span><br>    382-&gt;348:  <span style="background-color: cyan"> 99+      public FontSpecification getFont(CssContext ctx) {</span><br>    383-&gt;349:  <span style="background-color: cyan"> 99+          if (_font == null) {</span><br>    384-&gt;350:  <span style="background-color: cyan"> 99+              _font = new FontSpecification();</span><br>      385-&gt;N:  <span style="background-color: white">      </span><br>    386-&gt;352:  <span style="background-color: cyan"> 99+              _font.families = valueByName(CSSName.FONT_FAMILY).asStringArray();</span><br>      387-&gt;N:  <span style="background-color: white">      </span><br>    388-&gt;354:  <span style="background-color: cyan"> 99+              FSDerivedValue fontSize = valueByName(CSSName.FONT_SIZE);</span><br>    389-&gt;355:  <span style="background-color: cyan"> 99+              if (fontSize instanceof IdentValue) {</span><br>    390-&gt;356:  <span style="background-color: cyan"> 99+                  PropertyValue replacement;</span><br>    391-&gt;357:  <span style="background-color: cyan"> 99+                  IdentValue resolved = resolveAbsoluteFontSize();</span><br>    392-&gt;358:  <span style="background-color: cyan"> 99+                  if (resolved != null) {</span><br>    393-&gt;359:  <span style="background-color: cyan"> 99+                      replacement = FontSizeHelper.resolveAbsoluteFontSize(resolved, _font.families);</span><br>      394-&gt;N:  <span style="background-color: white">                      } else {</span><br>    395-&gt;361:  <span style="background-color: white">   0                      replacement = FontSizeHelper.getDefaultRelativeFontSize((IdentValue) fontSize);</span><br>      396-&gt;N:  <span style="background-color: white">                      }</span><br>    397-&gt;363:  <span style="background-color: cyan"> 99+                  _font.size = LengthValue.calcFloatProportionalValue(</span><br>    398-&gt;364:  <span style="background-color: white">                              this, CSSName.FONT_SIZE, replacement.getCssText(),</span><br>    399-&gt;365:  <span style="background-color: white">                              replacement.getFloatValue(), replacement.getPrimitiveType(), 0, ctx);</span><br>      400-&gt;N:  <span style="background-color: white">                  } else {</span><br>    401-&gt;367:  <span style="background-color: cyan"> 99+                  _font.size = getFloatPropertyProportionalTo(CSSName.FONT_SIZE, 0, ctx);</span><br>      402-&gt;N:  <span style="background-color: white">                  }</span><br>      403-&gt;N:  <span style="background-color: white">      </span><br>    404-&gt;370:  <span style="background-color: cyan"> 99+              _font.fontWeight = getIdent(CSSName.FONT_WEIGHT);</span><br>      405-&gt;N:  <span style="background-color: white">      </span><br>    406-&gt;372:  <span style="background-color: cyan"> 99+              _font.fontStyle = getIdent(CSSName.FONT_STYLE);</span><br>    407-&gt;373:  <span style="background-color: cyan"> 99+              _font.variant = getIdent(CSSName.FONT_VARIANT);</span><br>      408-&gt;N:  <span style="background-color: white">              }</span><br>      409-&gt;N:  <span style="background-color: white"> 99+          return _font;</span><br>      410-&gt;N:  <span style="background-color: white">          }</span><br>      411-&gt;N:  <span style="background-color: white">      </span><br>    412-&gt;378:  <span style="background-color: cyan"> 99+      public FontSpecification getFontSpecification() {</span><br>      413-&gt;N:  <span style="background-color: white"> 99+      return _font;</span><br>      414-&gt;N:  <span style="background-color: white">          }</span><br>      415-&gt;N:  <span style="background-color: white">      </span><br>    416-&gt;382:  <span style="background-color: cyan"> 99+      private IdentValue resolveAbsoluteFontSize() {</span><br>    417-&gt;383:  <span style="background-color: cyan"> 99+          FSDerivedValue fontSize = valueByName(CSSName.FONT_SIZE);</span><br>    418-&gt;384:  <span style="background-color: cyan"> 99+          if (! (fontSize instanceof IdentValue)) {</span><br>    419-&gt;385:  <span style="background-color: white">   0              return null;</span><br>      420-&gt;N:  <span style="background-color: white">              }</span><br>    421-&gt;387:  <span style="background-color: cyan"> 99+          IdentValue fontSizeIdent = (IdentValue) fontSize;</span><br>    422-&gt;388:  <span style="background-color: cyan"> 99+          if (PrimitivePropertyBuilders.ABSOLUTE_FONT_SIZES.get(fontSizeIdent.FS_ID)) {</span><br>    423-&gt;389:  <span style="background-color: cyan"> 99+              return fontSizeIdent;</span><br>      424-&gt;N:  <span style="background-color: white">              }</span><br>      425-&gt;N:  <span style="background-color: white">      </span><br>    426-&gt;392:  <span style="background-color: white">   0          IdentValue parent = getParent().resolveAbsoluteFontSize();</span><br>    427-&gt;393:  <span style="background-color: white">   0          if (parent != null) {</span><br>    428-&gt;394:  <span style="background-color: white">   0              if (fontSizeIdent == IdentValue.SMALLER) {</span><br>    429-&gt;395:  <span style="background-color: white">   0                  return FontSizeHelper.getNextSmaller(parent);</span><br>    430-&gt;396:  <span style="background-color: white">   0              } else if (fontSize == IdentValue.LARGER) {</span><br>    431-&gt;397:  <span style="background-color: white">   0                  return FontSizeHelper.getNextLarger(parent);</span><br>      432-&gt;N:  <span style="background-color: white">                  }</span><br>      433-&gt;N:  <span style="background-color: white">              }</span><br>      434-&gt;N:  <span style="background-color: white">      </span><br>    435-&gt;401:  <span style="background-color: white">   0          return null;</span><br>      436-&gt;N:  <span style="background-color: white">          }</span><br>      437-&gt;N:  <span style="background-color: white">      </span><br>    438-&gt;404:  <span style="background-color: cyan"> 99+      public float getFloatPropertyProportionalTo(CSSName cssName, float baseValue, CssContext ctx) {</span><br>    439-&gt;405:  <span style="background-color: cyan"> 99+          return valueByName(cssName).getFloatProportionalTo(cssName, baseValue, ctx);</span><br>      440-&gt;N:  <span style="background-color: white">          }</span><br>      441-&gt;N:  <span style="background-color: white">      </span><br>      442-&gt;N:  <span style="background-color: white">          /**</span><br>      443-&gt;N:  <span style="background-color: white">           * @param cssName</span><br>      444-&gt;N:  <span style="background-color: white">           * @param parentWidth</span><br>      445-&gt;N:  <span style="background-color: white">           * @param ctx</span><br>      446-&gt;N:  <span style="background-color: white">           * @return TODO</span><br>      447-&gt;N:  <span style="background-color: white">           */</span><br>    448-&gt;414:  <span style="background-color: cyan"> 99+      public float getFloatPropertyProportionalWidth(CSSName cssName, float parentWidth, CssContext ctx) {</span><br>    449-&gt;415:  <span style="background-color: cyan"> 99+          return valueByName(cssName).getFloatProportionalTo(cssName, parentWidth, ctx);</span><br>      450-&gt;N:  <span style="background-color: white">          }</span><br>      451-&gt;N:  <span style="background-color: white">      </span><br>      452-&gt;N:  <span style="background-color: white">          /**</span><br>      453-&gt;N:  <span style="background-color: white">           * @param cssName</span><br>      454-&gt;N:  <span style="background-color: white">           * @param parentHeight</span><br>      455-&gt;N:  <span style="background-color: white">           * @param ctx</span><br>      456-&gt;N:  <span style="background-color: white">           * @return TODO</span><br>      457-&gt;N:  <span style="background-color: white">           */</span><br>    458-&gt;424:  <span style="background-color: cyan"> 99+      public float getFloatPropertyProportionalHeight(CSSName cssName, float parentHeight, CssContext ctx) {</span><br>    459-&gt;425:  <span style="background-color: cyan"> 99+          return valueByName(cssName).getFloatProportionalTo(cssName, parentHeight, ctx);</span><br>      460-&gt;N:  <span style="background-color: white">          }</span><br>      461-&gt;N:  <span style="background-color: white">      </span><br>    462-&gt;428:  <span style="background-color: cyan"> 99+      public float getLineHeight(CssContext ctx) {</span><br>      463-&gt;N:  <span style="background-color: white"> 99+          if (! _lineHeightResolved) {</span><br>    464-&gt;430:  <span style="background-color: cyan"> 99+              if (isIdent(CSSName.LINE_HEIGHT, IdentValue.NORMAL)) {</span><br>    465-&gt;431:  <span style="background-color: cyan"> 99+                  float lineHeight1 = getFont(ctx).size * 1.1f;</span><br>      466-&gt;N:  <span style="background-color: white">                      // Make sure rasterized characters will (probably) fit inside</span><br>      467-&gt;N:  <span style="background-color: white">                      // the line box</span><br>    468-&gt;434:  <span style="background-color: cyan"> 99+                  FSFontMetrics metrics = getFSFontMetrics(ctx);</span><br>    469-&gt;435:  <span style="background-color: cyan"> 99+                  float lineHeight2 = (float)Math.ceil(metrics.getDescent() + metrics.getAscent());</span><br>    470-&gt;436:  <span style="background-color: cyan"> 99+                  _lineHeight = Math.max(lineHeight1, lineHeight2);</span><br>    471-&gt;437:  <span style="background-color: cyan"> 99+              } else if (isLength(CSSName.LINE_HEIGHT)) {</span><br>      472-&gt;N:  <span style="background-color: white">                      //could be more elegant, I suppose</span><br>    473-&gt;439:  <span style="background-color: cyan">  79                  _lineHeight = getFloatPropertyProportionalHeight(CSSName.LINE_HEIGHT, 0, ctx);</span><br>      474-&gt;N:  <span style="background-color: white">                  } else {</span><br>      475-&gt;N:  <span style="background-color: white">                      //must be a number</span><br>    476-&gt;442:  <span style="background-color: white">  85                  _lineHeight = getFont(ctx).size * valueByName(CSSName.LINE_HEIGHT).asFloat();</span><br>      477-&gt;N:  <span style="background-color: white">                  }</span><br>    478-&gt;444:  <span style="background-color: cyan"> 99+              _lineHeightResolved = true;</span><br>      479-&gt;N:  <span style="background-color: white">              }</span><br>      480-&gt;N:  <span style="background-color: white"> 99+          return _lineHeight;</span><br>      481-&gt;N:  <span style="background-color: white">          }</span><br>      482-&gt;N:  <span style="background-color: white">      </span><br>      483-&gt;N:  <span style="background-color: white">          /**</span><br>      484-&gt;N:  <span style="background-color: white">           * Convenience property accessor; returns a Border initialized with the</span><br>      485-&gt;N:  <span style="background-color: white">           * four-sided margin width. Uses the actual value (computed actual value)</span><br>      486-&gt;N:  <span style="background-color: white">           * for this element.</span><br>      487-&gt;N:  <span style="background-color: white">           *</span><br>      488-&gt;N:  <span style="background-color: white">           * @param cbWidth</span><br>      489-&gt;N:  <span style="background-color: white">           * @param ctx</span><br>      490-&gt;N:  <span style="background-color: white">           * @return The marginWidth value</span><br>      491-&gt;N:  <span style="background-color: white">           */</span><br>    492-&gt;458:  <span style="background-color: cyan"> 99+      public RectPropertySet getMarginRect(float cbWidth, CssContext ctx) {</span><br>    493-&gt;459:  <span style="background-color: cyan"> 99+          return getMarginRect(cbWidth, ctx, true);</span><br>      494-&gt;N:  <span style="background-color: white">          }</span><br>      495-&gt;N:  <span style="background-color: white">      </span><br>    496-&gt;462:  <span style="background-color: cyan"> 99+      public RectPropertySet getMarginRect(float cbWidth, CssContext ctx, boolean useCache) {</span><br>      497-&gt;N:  <span style="background-color: white"> 99+          if (! _marginsAllowed) {</span><br>      498-&gt;N:  <span style="background-color: white"> 99+              return RectPropertySet.ALL_ZEROS;</span><br>      499-&gt;N:  <span style="background-color: white">              } else {</span><br>      500-&gt;N:  <span style="background-color: white"> 99+              return getMarginProperty(</span><br>    501-&gt;467:  <span style="background-color: white">                          this, CSSName.MARGIN_SHORTHAND, CSSName.MARGIN_SIDE_PROPERTIES, cbWidth, ctx, useCache);</span><br>      502-&gt;N:  <span style="background-color: white">              }</span><br>      503-&gt;N:  <span style="background-color: white">          }</span><br>      504-&gt;N:  <span style="background-color: white">      </span><br>      505-&gt;N:  <span style="background-color: white">          /**</span><br>      506-&gt;N:  <span style="background-color: white">           * Convenience property accessor; returns a Border initialized with the</span><br>      507-&gt;N:  <span style="background-color: white">           * four-sided padding width. Uses the actual value (computed actual value)</span><br>      508-&gt;N:  <span style="background-color: white">           * for this element.</span><br>      509-&gt;N:  <span style="background-color: white">           *</span><br>      510-&gt;N:  <span style="background-color: white">           * @param cbWidth</span><br>      511-&gt;N:  <span style="background-color: white">           * @param ctx</span><br>      512-&gt;N:  <span style="background-color: white">           * @return The paddingWidth value</span><br>      513-&gt;N:  <span style="background-color: white">           */</span><br>    514-&gt;480:  <span style="background-color: cyan"> 99+      public RectPropertySet getPaddingRect(float cbWidth, CssContext ctx, boolean useCache) {</span><br>      515-&gt;N:  <span style="background-color: white"> 99+          if (! _paddingAllowed) {</span><br>      516-&gt;N:  <span style="background-color: white"> 99+              return RectPropertySet.ALL_ZEROS;</span><br>      517-&gt;N:  <span style="background-color: white">              } else {</span><br>    518-&gt;484:  <span style="background-color: cyan"> 99+              return getPaddingProperty(this, CSSName.PADDING_SHORTHAND, CSSName.PADDING_SIDE_PROPERTIES, cbWidth, ctx, useCache);</span><br>      519-&gt;N:  <span style="background-color: white">              }</span><br>      520-&gt;N:  <span style="background-color: white">          }</span><br>      521-&gt;N:  <span style="background-color: white">      </span><br>    522-&gt;488:  <span style="background-color: cyan"> 99+      public RectPropertySet getPaddingRect(float cbWidth, CssContext ctx) {</span><br>    523-&gt;489:  <span style="background-color: cyan"> 99+          return getPaddingRect(cbWidth, ctx, true);</span><br>      524-&gt;N:  <span style="background-color: white">          }</span><br>      525-&gt;N:  <span style="background-color: white">      </span><br>      526-&gt;N:  <span style="background-color: white">          /**</span><br>      527-&gt;N:  <span style="background-color: white">           * @param cssName</span><br>      528-&gt;N:  <span style="background-color: white">           * @return TODO</span><br>      529-&gt;N:  <span style="background-color: white">           */</span><br>    530-&gt;496:  <span style="background-color: white"> 99+      public String getStringProperty(CSSName cssName) {</span><br>    531-&gt;497:  <span style="background-color: white"> 99+          return valueByName(cssName).asString();</span><br>      532-&gt;N:  <span style="background-color: white">          }</span><br>      533-&gt;N:  <span style="background-color: white">      </span><br>      534-&gt;N:  <span style="background-color: white">          /**</span><br>      535-&gt;N:  <span style="background-color: white">           * TODO: doc</span><br>      536-&gt;N:  <span style="background-color: white">           */</span><br>    537-&gt;503:  <span style="background-color: cyan"> 99+      public boolean isLength(CSSName cssName) {</span><br>    538-&gt;504:  <span style="background-color: cyan"> 99+          FSDerivedValue val = valueByName(cssName);</span><br>    539-&gt;505:  <span style="background-color: cyan"> 99+          return val instanceof LengthValue;</span><br>      540-&gt;N:  <span style="background-color: white">          }</span><br>      541-&gt;N:  <span style="background-color: white">      </span><br>    542-&gt;508:  <span style="background-color: cyan"> 99+      public boolean isLengthOrNumber(CSSName cssName) {</span><br>    543-&gt;509:  <span style="background-color: cyan"> 99+          FSDerivedValue val = valueByName(cssName);</span><br>    544-&gt;510:  <span style="background-color: cyan"> 99+          return val instanceof NumberValue || val instanceof LengthValue;</span><br>      545-&gt;N:  <span style="background-color: white">          }</span><br>      546-&gt;N:  <span style="background-color: white">      </span><br>      547-&gt;N:  <span style="background-color: white">          /**</span><br>      548-&gt;N:  <span style="background-color: white">           * Returns a {@link FSDerivedValue} by name. Because we are a derived</span><br>      549-&gt;N:  <span style="background-color: white">           * style, the property will already be resolved at this point.</span><br>      550-&gt;N:  <span style="background-color: white">           * <br><br></span><br>      551-&gt;N:  <span style="background-color: white">           * This will look up the ancestor tree for inherited properties and</span><br>      552-&gt;N:  <span style="background-color: white">           * use an initial value for unspecified properties which do not inherit.</span><br>      553-&gt;N:  <span style="background-color: white">           *</span><br>      554-&gt;N:  <span style="background-color: white">           * @param cssName The CSS property name, e.g. "font-family"</span><br>      555-&gt;N:  <span style="background-color: white">           */</span><br>    556-&gt;520:  <span style="background-color: cyan"> 99+      public FSDerivedValue valueByName(CSSName cssName) {</span><br>    557-&gt;521:  <span style="background-color: cyan"> 99+          FSDerivedValue val = _derivedValuesById[cssName.FS_ID];</span><br>      558-&gt;N:  <span style="background-color: white">      </span><br>    559-&gt;523:  <span style="background-color: cyan"> 99+          boolean needInitialValue = val == IdentValue.FS_INITIAL_VALUE;</span><br>      560-&gt;N:  <span style="background-color: white">      </span><br>      561-&gt;N:  <span style="background-color: white">              // but the property may not be defined for this Element</span><br>    562-&gt;526:  <span style="background-color: cyan"> 99+          if (val == null || needInitialValue) {</span><br>      563-&gt;N:  <span style="background-color: white">                  // if it is inheritable (like color) and we are not root, ask our parent</span><br>      564-&gt;N:  <span style="background-color: white">                  // for the value</span><br>    565-&gt;529:  <span style="background-color: white">   0              if (! needInitialValue &amp;&amp; CSSName.propertyInherits(cssName)</span><br>    566-&gt;530:  <span style="background-color: white">                          &amp;&amp; _parent != null</span><br>    567-&gt;532:  <span style="background-color: white">                          &amp;&amp; (val = _parent.valueByName(cssName)) != null) {</span><br>      568-&gt;N:  <span style="background-color: white">                      // Do nothing, val is already set</span><br>      569-&gt;N:  <span style="background-color: white">                  } else {</span><br>      570-&gt;N:  <span style="background-color: white">                      // otherwise, use the initial value (defined by the CSS2 Spec)</span><br>    571-&gt;536:  <span style="background-color: cyan"> 99+                  String initialValue = CSSName.initialValue(cssName);</span><br>    572-&gt;537:  <span style="background-color: cyan"> 99+                  if (initialValue == null) {</span><br>    573-&gt;538:  <span style="background-color: white">   0                      throw new XRRuntimeException("Property '" + cssName + "' has no initial values assigned. " +</span><br>    574-&gt;539:  <span style="background-color: white">                                  "Check CSSName declarations.");</span><br>      575-&gt;N:  <span style="background-color: white">                      }</span><br>    576-&gt;541:  <span style="background-color: cyan"> 99+                  if (initialValue.charAt(0) == '=') {</span><br>    577-&gt;542:  <span style="background-color: cyan"> 99+                      CSSName ref = CSSName.getByPropertyName(initialValue.substring(1));</span><br>    578-&gt;543:  <span style="background-color: cyan"> 99+                      val = valueByName(ref);</span><br>      579-&gt;N:  <span style="background-color: white">                      } else {</span><br>    580-&gt;545:  <span style="background-color: cyan"> 99+                      val = CSSName.initialDerivedValue(cssName);</span><br>      581-&gt;N:  <span style="background-color: white">                      }</span><br>      582-&gt;N:  <span style="background-color: white">                  }</span><br>    583-&gt;548:  <span style="background-color: cyan"> 99+              _derivedValuesById[cssName.FS_ID] = val;</span><br>      584-&gt;N:  <span style="background-color: white">              }</span><br>      585-&gt;N:  <span style="background-color: white">      </span><br>    586-&gt;550:  <span style="background-color: cyan"> 99+          return val;</span><br>      587-&gt;N:  <span style="background-color: white">          }</span><br>      588-&gt;N:  <span style="background-color: white">      </span><br>      589-&gt;N:  <span style="background-color: white">          /**</span><br>      590-&gt;N:  <span style="background-color: white">           * This method should result in the element for this style having a</span><br>      591-&gt;N:  <span style="background-color: white">           * derived value for all specified (in stylesheets, style attribute, other non</span><br>      592-&gt;N:  <span style="background-color: white">           * CSS attrs, etc) primitive CSS properties. Other properties are picked up</span><br>      593-&gt;N:  <span style="background-color: white">           * from an ancestor (if they inherit) or their initial values (if</span><br>      594-&gt;N:  <span style="background-color: white">           * they don't inherit). See {@link #valueByName(CSSName)}.</span><br>      595-&gt;N:  <span style="background-color: white">           * <br><br></span><br>      596-&gt;N:  <span style="background-color: white">           * The implementation is based on the notion that</span><br>      597-&gt;N:  <span style="background-color: white">           * the matched styles are given to us in a perfectly sorted order, such that</span><br>      598-&gt;N:  <span style="background-color: white">           * properties appearing later in the rule-set always override properties</span><br>      599-&gt;N:  <span style="background-color: white">           * appearing earlier.</span><br>      600-&gt;N:  <span style="background-color: white">           * <br><br></span><br>      601-&gt;N:  <span style="background-color: white">           * The current implementation makes no attempt to check</span><br>      602-&gt;N:  <span style="background-color: white">           * this assumption. When this method exits, the derived property</span><br>      603-&gt;N:  <span style="background-color: white">           * list for this class will be populated with the properties defined for</span><br>      604-&gt;N:  <span style="background-color: white">           * this element, properly cascaded.</span><br>      605-&gt;N:  <span style="background-color: white">           */</span><br>    606-&gt;573:  <span style="background-color: cyan"> 99+      private void derive(CascadedStyle matched) {</span><br>    607-&gt;574:  <span style="background-color: cyan"> 99+          if (matched == null) {</span><br>    608-&gt;575:  <span style="background-color: white">   0              return;</span><br>      609-&gt;N:  <span style="background-color: white">              }</span><br>      610-&gt;N:  <span style="background-color: white">      </span><br>    611-&gt;578:  <span style="background-color: cyan"> 99+          for (PropertyDeclaration pd : matched.getCascadedPropertyDeclarations()) {</span><br>    612-&gt;579:  <span style="background-color: cyan"> 99+              FSDerivedValue val = deriveValue(pd.getCSSName(), pd.getValue());</span><br>    613-&gt;580:  <span style="background-color: cyan"> 99+              _derivedValuesById[pd.getCSSName().FS_ID] = val;</span><br>      614-&gt;N:  <span style="background-color: white">              }</span><br>      615-&gt;N:  <span style="background-color: white">          }</span><br>      616-&gt;N:  <span style="background-color: white">      </span><br>    617-&gt;584:  <span style="background-color: cyan"> 99+      private FSDerivedValue deriveValue(CSSName cssName, CSSPrimitiveValue value) {</span><br>    618-&gt;585:  <span style="background-color: cyan"> 99+          return DerivedValueFactory.newDerivedValue(this, cssName, (PropertyValue) value);</span><br>      619-&gt;N:  <span style="background-color: white">          }</span><br>      620-&gt;N:  <span style="background-color: white">      </span><br>    621-&gt;588:  <span style="background-color: white">   0      private String genStyleKey() {</span><br>    622-&gt;589:  <span style="background-color: white">   0          StringBuilder  sb = new StringBuilder();</span><br>    623-&gt;590:  <span style="background-color: white">   0          for (int i = 0; i &lt; _derivedValuesById.length; i++) {</span><br>    624-&gt;591:  <span style="background-color: white">   0              CSSName name = CSSName.getByID(i);</span><br>    625-&gt;592:  <span style="background-color: white">   0              FSDerivedValue val = _derivedValuesById[i];</span><br>    626-&gt;593:  <span style="background-color: white">   0              if (val != null) {</span><br>    627-&gt;594:  <span style="background-color: white">   0                  sb.append(name.toString());</span><br>      628-&gt;N:  <span style="background-color: white">                  } else {</span><br>    629-&gt;596:  <span style="background-color: white">   0                  sb.append("(no prop assigned in this pos)");</span><br>      630-&gt;N:  <span style="background-color: white">                  }</span><br>    631-&gt;598:  <span style="background-color: white">   0              sb.append("|\n");</span><br>      632-&gt;N:  <span style="background-color: white">              }</span><br>    633-&gt;600:  <span style="background-color: white">   0          return sb.toString();</span><br>      634-&gt;N:  <span style="background-color: white">      </span><br>      635-&gt;N:  <span style="background-color: white">          }</span><br>      636-&gt;N:  <span style="background-color: white">      </span><br>    637-&gt;604:  <span style="background-color: white">   0      public RectPropertySet getCachedPadding() {</span><br>    638-&gt;605:  <span style="background-color: white">   0          if (_padding == null) {</span><br>    639-&gt;606:  <span style="background-color: white">   0              throw new XRRuntimeException("No padding property cached yet; should have called getPropertyRect() at least once before.");</span><br>      640-&gt;N:  <span style="background-color: white">              } else {</span><br>      641-&gt;N:  <span style="background-color: white">   0              return _padding;</span><br>      642-&gt;N:  <span style="background-color: white">              }</span><br>      643-&gt;N:  <span style="background-color: white">          }</span><br>      644-&gt;N:  <span style="background-color: white">      </span><br>    645-&gt;612:  <span style="background-color: white">   0      public RectPropertySet getCachedMargin() {</span><br>    646-&gt;613:  <span style="background-color: white">   0          if (_margin == null) {</span><br>    647-&gt;614:  <span style="background-color: white">   0              throw new XRRuntimeException("No margin property cached yet; should have called getMarginRect() at least once before.");</span><br>      648-&gt;N:  <span style="background-color: white">              } else {</span><br>      649-&gt;N:  <span style="background-color: white">   0              return _margin;</span><br>      650-&gt;N:  <span style="background-color: white">              }</span><br>      651-&gt;N:  <span style="background-color: white">          }</span><br>      652-&gt;N:  <span style="background-color: white">      </span><br>    653-&gt;620:  <span style="background-color: cyan"> 99+      private static RectPropertySet getPaddingProperty(CalculatedStyle style,</span><br>    654-&gt;621:  <span style="background-color: white">                                                            CSSName shorthandProp,</span><br>    655-&gt;622:  <span style="background-color: white">                                                            CSSName.CSSSideProperties sides,</span><br>    656-&gt;623:  <span style="background-color: white">                                                            float cbWidth,</span><br>    657-&gt;624:  <span style="background-color: white">                                                            CssContext ctx,</span><br>    658-&gt;625:  <span style="background-color: white">                                                            boolean useCache) {</span><br>    659-&gt;626:  <span style="background-color: cyan"> 99+          if (! useCache) {</span><br>    660-&gt;627:  <span style="background-color: white">   0              return newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>      661-&gt;N:  <span style="background-color: white">              } else {</span><br>    662-&gt;629:  <span style="background-color: cyan"> 99+              if (style._padding == null) {</span><br>    663-&gt;630:  <span style="background-color: cyan"> 99+                  RectPropertySet result = newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>    664-&gt;631:  <span style="background-color: cyan"> 99+                  boolean allZeros = result.isAllZeros();</span><br>      665-&gt;N:  <span style="background-color: white">      </span><br>    666-&gt;633:  <span style="background-color: cyan"> 99+                  if (allZeros) {</span><br>    667-&gt;634:  <span style="background-color: cyan"> 99+                      result = RectPropertySet.ALL_ZEROS;</span><br>      668-&gt;N:  <span style="background-color: white">                      }</span><br>      669-&gt;N:  <span style="background-color: white">      </span><br>    670-&gt;637:  <span style="background-color: cyan"> 99+                  style._padding = result;</span><br>      671-&gt;N:  <span style="background-color: white">      </span><br>    672-&gt;639:  <span style="background-color: cyan"> 99+                  if (! allZeros &amp;&amp; style._padding.hasNegativeValues()) {</span><br>    673-&gt;640:  <span style="background-color: white">   0                      style._padding.resetNegativeValues();</span><br>      674-&gt;N:  <span style="background-color: white">                      }</span><br>      675-&gt;N:  <span style="background-color: white">                  }</span><br>      676-&gt;N:  <span style="background-color: white">      </span><br>    677-&gt;644:  <span style="background-color: cyan"> 99+              return style._padding;</span><br>      678-&gt;N:  <span style="background-color: white">              }</span><br>      679-&gt;N:  <span style="background-color: white">          }</span><br>      680-&gt;N:  <span style="background-color: white">      </span><br>    681-&gt;648:  <span style="background-color: cyan"> 99+      private static RectPropertySet getMarginProperty(CalculatedStyle style,</span><br>    682-&gt;649:  <span style="background-color: white">                                                           CSSName shorthandProp,</span><br>    683-&gt;650:  <span style="background-color: white">                                                           CSSName.CSSSideProperties sides,</span><br>    684-&gt;651:  <span style="background-color: white">                                                           float cbWidth,</span><br>    685-&gt;652:  <span style="background-color: white">                                                           CssContext ctx,</span><br>    686-&gt;653:  <span style="background-color: white">                                                           boolean useCache) {</span><br>    687-&gt;654:  <span style="background-color: cyan"> 99+          if (! useCache) {</span><br>    688-&gt;655:  <span style="background-color: white">   0              return newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>      689-&gt;N:  <span style="background-color: white">              } else {</span><br>    690-&gt;657:  <span style="background-color: cyan"> 99+              if (style._margin == null) {</span><br>    691-&gt;658:  <span style="background-color: cyan"> 99+                  RectPropertySet result = newRectInstance(style, shorthandProp, sides, cbWidth, ctx);</span><br>    692-&gt;659:  <span style="background-color: cyan"> 99+                  if (result.isAllZeros()) {</span><br>    693-&gt;660:  <span style="background-color: cyan"> 99+                      result = RectPropertySet.ALL_ZEROS;</span><br>      694-&gt;N:  <span style="background-color: white">                      }</span><br>    695-&gt;662:  <span style="background-color: cyan"> 99+                  style._margin = result;</span><br>      696-&gt;N:  <span style="background-color: white">                  }</span><br>      697-&gt;N:  <span style="background-color: white">      </span><br>    698-&gt;665:  <span style="background-color: cyan"> 99+              return style._margin;</span><br>      699-&gt;N:  <span style="background-color: white">              }</span><br>      700-&gt;N:  <span style="background-color: white">          }</span><br>      701-&gt;N:  <span style="background-color: white">      </span><br>    702-&gt;669:  <span style="background-color: cyan"> 99+      private static RectPropertySet newRectInstance(CalculatedStyle style,</span><br>    703-&gt;670:  <span style="background-color: white">                                                         CSSName shorthand,</span><br>    704-&gt;671:  <span style="background-color: white">                                                         CSSName.CSSSideProperties sides,</span><br>    705-&gt;672:  <span style="background-color: white">                                                         float cbWidth,</span><br>    706-&gt;673:  <span style="background-color: white">                                                         CssContext ctx) {</span><br>    707-&gt;674:  <span style="background-color: cyan"> 99+          RectPropertySet rect;</span><br>    708-&gt;675:  <span style="background-color: cyan"> 99+          rect = RectPropertySet.newInstance(style,</span><br>    709-&gt;676:  <span style="background-color: white">                      shorthand,</span><br>    710-&gt;677:  <span style="background-color: white">                      sides,</span><br>    711-&gt;678:  <span style="background-color: white">                      cbWidth,</span><br>    712-&gt;679:  <span style="background-color: white">                      ctx);</span><br>    713-&gt;680:  <span style="background-color: cyan"> 99+          return rect;</span><br>      714-&gt;N:  <span style="background-color: white">          }</span><br>      715-&gt;N:  <span style="background-color: white">      </span><br>    716-&gt;683:  <span style="background-color: cyan"> 99+      private static BorderPropertySet getBorderProperty(CalculatedStyle style,</span><br>    717-&gt;684:  <span style="background-color: white">                                                             CssContext ctx) {</span><br>    718-&gt;685:  <span style="background-color: cyan"> 99+          if (style._border == null) {</span><br>    719-&gt;686:  <span style="background-color: cyan"> 99+              BorderPropertySet result = BorderPropertySet.newInstance(style, ctx);</span><br>      720-&gt;N:  <span style="background-color: white">      </span><br>    721-&gt;688:  <span style="background-color: cyan"> 99+              boolean allZeros = result.isAllZeros();</span><br>    722-&gt;689:  <span style="background-color: cyan"> 99+              if (allZeros &amp;&amp; ! result.hasHidden() &amp;&amp; !result.hasBorderRadius()) {</span><br>    723-&gt;690:  <span style="background-color: cyan"> 99+                  result = BorderPropertySet.EMPTY_BORDER;</span><br>      724-&gt;N:  <span style="background-color: white">                  }</span><br>      725-&gt;N:  <span style="background-color: white">      </span><br>    726-&gt;693:  <span style="background-color: cyan"> 99+              style._border = result;</span><br>      727-&gt;N:  <span style="background-color: white">      </span><br>    728-&gt;695:  <span style="background-color: cyan"> 99+              if (! allZeros &amp;&amp; style._border.hasNegativeValues()) {</span><br>    729-&gt;696:  <span style="background-color: white">   0                  style._border.resetNegativeValues();</span><br>      730-&gt;N:  <span style="background-color: white">                  }</span><br>      731-&gt;N:  <span style="background-color: white">              }</span><br>    732-&gt;699:  <span style="background-color: cyan"> 99+          return style._border;</span><br>      733-&gt;N:  <span style="background-color: white">          }</span><br>      734-&gt;N:  <span style="background-color: white">      </span><br>    735-&gt;702:  <span style="background-color: white">          public static final int LEFT = 1;</span><br>    736-&gt;703:  <span style="background-color: white">          public static final int RIGHT = 2;</span><br>      737-&gt;N:  <span style="background-color: white">      </span><br>    738-&gt;705:  <span style="background-color: white">          public static final int TOP = 3;</span><br>    739-&gt;706:  <span style="background-color: white">          public static final int BOTTOM = 4;</span><br>      740-&gt;N:  <span style="background-color: white">      </span><br>    741-&gt;708:  <span style="background-color: cyan"> 99+      public int getMarginBorderPadding(</span><br>    742-&gt;709:  <span style="background-color: white">                  CssContext cssCtx, int cbWidth, int which) {</span><br>    743-&gt;710:  <span style="background-color: cyan"> 99+          BorderPropertySet border = getBorder(cssCtx);</span><br>    744-&gt;711:  <span style="background-color: cyan"> 99+          RectPropertySet margin = getMarginRect(cbWidth, cssCtx);</span><br>    745-&gt;712:  <span style="background-color: cyan"> 99+          RectPropertySet padding = getPaddingRect(cbWidth, cssCtx);</span><br>      746-&gt;N:  <span style="background-color: white">      </span><br>    747-&gt;714:  <span style="background-color: cyan"> 99+          switch (which) {</span><br>    748-&gt;715:  <span style="background-color: cyan"> 99+              case LEFT:</span><br>    749-&gt;716:  <span style="background-color: cyan"> 99+                  return (int) (margin.left() + border.left() + padding.left());</span><br>    750-&gt;717:  <span style="background-color: cyan"> 99+              case RIGHT:</span><br>    751-&gt;718:  <span style="background-color: cyan"> 99+                  return (int) (margin.right() + border.right() + padding.right());</span><br>    752-&gt;719:  <span style="background-color: cyan"> 99+              case TOP:</span><br>    753-&gt;720:  <span style="background-color: cyan"> 99+                  return (int) (margin.top() + border.top() + padding.top());</span><br>    754-&gt;721:  <span style="background-color: cyan"> 99+              case BOTTOM:</span><br>    755-&gt;722:  <span style="background-color: cyan"> 99+                  return (int) (margin.bottom() + border.bottom() + padding.bottom());</span><br>      756-&gt;N:  <span style="background-color: white">   0              default:</span><br>    757-&gt;724:  <span style="background-color: white">   0                  throw new IllegalArgumentException();</span><br>      758-&gt;N:  <span style="background-color: white">              }</span><br>      759-&gt;N:  <span style="background-color: white">          }</span><br>      760-&gt;N:  <span style="background-color: white">      </span><br>    761-&gt;728:  <span style="background-color: cyan"> 99+      public IdentValue getWhitespace() {</span><br>    762-&gt;729:  <span style="background-color: cyan"> 99+          return getIdent(CSSName.WHITE_SPACE);</span><br>      763-&gt;N:  <span style="background-color: white">          }</span><br>      764-&gt;N:  <span style="background-color: white">      </span><br>    765-&gt;732:  <span style="background-color: cyan"> 99+      public FSFont getFSFont(CssContext cssContext) {</span><br>    766-&gt;733:  <span style="background-color: cyan"> 99+          if (_FSFont == null) {</span><br>    767-&gt;734:  <span style="background-color: cyan"> 99+              _FSFont = cssContext.getFont(getFont(cssContext));</span><br>      768-&gt;N:  <span style="background-color: white">              }</span><br>      769-&gt;N:  <span style="background-color: white"> 99+          return _FSFont;</span><br>      770-&gt;N:  <span style="background-color: white">          }</span><br>      771-&gt;N:  <span style="background-color: white">      </span><br>    772-&gt;739:  <span style="background-color: cyan"> 99+      public FSFontMetrics getFSFontMetrics(CssContext c) {</span><br>    773-&gt;740:  <span style="background-color: cyan"> 99+          if (_FSFontMetrics == null) {</span><br>    774-&gt;741:  <span style="background-color: cyan"> 99+              _FSFontMetrics = c.getFSFontMetrics(getFSFont(c));</span><br>      775-&gt;N:  <span style="background-color: white">              }</span><br>      776-&gt;N:  <span style="background-color: white"> 99+          return _FSFontMetrics;</span><br>      777-&gt;N:  <span style="background-color: white">          }</span><br>      778-&gt;N:  <span style="background-color: white">      </span><br>    779-&gt;746:  <span style="background-color: cyan"> 99+      public IdentValue getWordWrap() {</span><br>    780-&gt;747:  <span style="background-color: cyan"> 99+          return getIdent(CSSName.WORD_WRAP);</span><br>      781-&gt;N:  <span style="background-color: white">          }</span><br>      782-&gt;N:  <span style="background-color: white">      </span><br>    783-&gt;750:  <span style="background-color: cyan">  14      public boolean isClearLeft() {</span><br>    784-&gt;751:  <span style="background-color: cyan">  14          IdentValue clear = getIdent(CSSName.CLEAR);</span><br>    785-&gt;752:  <span style="background-color: cyan">  14          return clear == IdentValue.LEFT || clear == IdentValue.BOTH;</span><br>      786-&gt;N:  <span style="background-color: white">          }</span><br>      787-&gt;N:  <span style="background-color: white">      </span><br>    788-&gt;755:  <span style="background-color: cyan">   8      public boolean isClearRight() {</span><br>    789-&gt;756:  <span style="background-color: cyan">   8          IdentValue clear = getIdent(CSSName.CLEAR);</span><br>    790-&gt;757:  <span style="background-color: cyan">   8          return clear == IdentValue.RIGHT || clear == IdentValue.BOTH;</span><br>      791-&gt;N:  <span style="background-color: white">          }</span><br>      792-&gt;N:  <span style="background-color: white">      </span><br>    793-&gt;760:  <span style="background-color: cyan"> 99+      public boolean isCleared() {</span><br>    794-&gt;761:  <span style="background-color: cyan"> 99+          return ! isIdent(CSSName.CLEAR, IdentValue.NONE);</span><br>      795-&gt;N:  <span style="background-color: white">          }</span><br>      796-&gt;N:  <span style="background-color: white">      </span><br>    797-&gt;764:  <span style="background-color: white">   0      public IdentValue getBackgroundRepeat(PropertyValue value) {</span><br>    798-&gt;765:  <span style="background-color: white">   0          return value.getIdentValue();</span><br>      799-&gt;N:  <span style="background-color: white">          }</span><br>      800-&gt;N:  <span style="background-color: white">      </span><br>    801-&gt;768:  <span style="background-color: cyan"> 99+      public boolean isInline() {</span><br>    802-&gt;769:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.INLINE) &amp;&amp;</span><br>      803-&gt;N:  <span style="background-color: white">                      ! (isFloated() || isAbsolute() || isFixed() || isRunning());</span><br>      804-&gt;N:  <span style="background-color: white">          }</span><br>      805-&gt;N:  <span style="background-color: white">      </span><br>    806-&gt;773:  <span style="background-color: cyan"> 99+      public boolean isInlineBlock() {</span><br>    807-&gt;774:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.INLINE_BLOCK);</span><br>      808-&gt;N:  <span style="background-color: white">          }</span><br>      809-&gt;N:  <span style="background-color: white">      </span><br>    810-&gt;777:  <span style="background-color: cyan"> 99+      public boolean isTable() {</span><br>    811-&gt;778:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE);</span><br>      812-&gt;N:  <span style="background-color: white">          }</span><br>      813-&gt;N:  <span style="background-color: white">      </span><br>    814-&gt;781:  <span style="background-color: cyan"> 99+      public boolean isInlineTable() {</span><br>    815-&gt;782:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.INLINE_TABLE);</span><br>      816-&gt;N:  <span style="background-color: white">          }</span><br>      817-&gt;N:  <span style="background-color: white">      </span><br>    818-&gt;785:  <span style="background-color: cyan"> 99+      public boolean isTableCell() {</span><br>    819-&gt;786:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_CELL);</span><br>      820-&gt;N:  <span style="background-color: white">          }</span><br>      821-&gt;N:  <span style="background-color: white">      </span><br>    822-&gt;789:  <span style="background-color: cyan"> 99+      public boolean isTableSection() {</span><br>    823-&gt;790:  <span style="background-color: cyan"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>      824-&gt;N:  <span style="background-color: white">      </span><br>    825-&gt;792:  <span style="background-color: cyan"> 99+          return display == IdentValue.TABLE_ROW_GROUP ||</span><br>    826-&gt;793:  <span style="background-color: white">                      display == IdentValue.TABLE_HEADER_GROUP ||</span><br>    827-&gt;794:  <span style="background-color: white">                      display == IdentValue.TABLE_FOOTER_GROUP;</span><br>      828-&gt;N:  <span style="background-color: white">          }</span><br>      829-&gt;N:  <span style="background-color: white">      </span><br>    830-&gt;797:  <span style="background-color: cyan"> 99+      public boolean isTableCaption() {</span><br>    831-&gt;798:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_CAPTION);</span><br>      832-&gt;N:  <span style="background-color: white">          }</span><br>      833-&gt;N:  <span style="background-color: white">      </span><br>    834-&gt;801:  <span style="background-color: white">   0      public boolean isTableHeader() {</span><br>    835-&gt;802:  <span style="background-color: white">   0          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_HEADER_GROUP);</span><br>      836-&gt;N:  <span style="background-color: white">          }</span><br>      837-&gt;N:  <span style="background-color: white">      </span><br>    838-&gt;805:  <span style="background-color: white">   0      public boolean isTableFooter() {</span><br>    839-&gt;806:  <span style="background-color: white">   0          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_FOOTER_GROUP);</span><br>      840-&gt;N:  <span style="background-color: white">          }</span><br>      841-&gt;N:  <span style="background-color: white">      </span><br>    842-&gt;809:  <span style="background-color: cyan"> 99+      public boolean isTableRow() {</span><br>    843-&gt;810:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.TABLE_ROW);</span><br>      844-&gt;N:  <span style="background-color: white">          }</span><br>      845-&gt;N:  <span style="background-color: white">      </span><br>    846-&gt;813:  <span style="background-color: cyan"> 99+      public boolean isDisplayNone() {</span><br>    847-&gt;814:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.NONE);</span><br>      848-&gt;N:  <span style="background-color: white">          }</span><br>      849-&gt;N:  <span style="background-color: white">      </span><br>    850-&gt;817:  <span style="background-color: red"> 99+      public boolean isSpecifiedAsBlock() {</span><br>    851-&gt;818:  <span style="background-color: red"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.BLOCK);</span><br>      852-&gt;N:  <span style="background-color: white">          }</span><br>      853-&gt;N:  <span style="background-color: white">      </span><br>    854-&gt;821:  <span style="background-color: white">   0      public boolean isBlockEquivalent() {</span><br>      855-&gt;N:  <span style="background-color: white">   0          if (isFloated() || isAbsolute() || isFixed()) {</span><br>    856-&gt;823:  <span style="background-color: white">   0              return true;</span><br>      857-&gt;N:  <span style="background-color: white">              } else {</span><br>    858-&gt;825:  <span style="background-color: white">   0              IdentValue display = getIdent(CSSName.DISPLAY);</span><br>    859-&gt;826:  <span style="background-color: white">   0              if (display == IdentValue.INLINE) {</span><br>    860-&gt;827:  <span style="background-color: white">   0                  return false;</span><br>      861-&gt;N:  <span style="background-color: white">                  } else {</span><br>    862-&gt;829:  <span style="background-color: white">   0                  return display == IdentValue.BLOCK || display == IdentValue.LIST_ITEM ||</span><br>    863-&gt;830:  <span style="background-color: white">                              display == IdentValue.RUN_IN || display == IdentValue.INLINE_BLOCK ||</span><br>    864-&gt;831:  <span style="background-color: white">                              display == IdentValue.TABLE || display == IdentValue.INLINE_TABLE;</span><br>      865-&gt;N:  <span style="background-color: white">                  }</span><br>      866-&gt;N:  <span style="background-color: white">              }</span><br>      867-&gt;N:  <span style="background-color: white">          }</span><br>      868-&gt;N:  <span style="background-color: white">      </span><br>    869-&gt;836:  <span style="background-color: cyan"> 99+      public boolean isLayedOutInInlineContext() {</span><br>      870-&gt;N:  <span style="background-color: white"> 99+          if (isFloated() || isAbsolute() || isFixed() || isRunning()) {</span><br>    871-&gt;838:  <span style="background-color: cyan"> 99+              return true;</span><br>      872-&gt;N:  <span style="background-color: white">              } else {</span><br>    873-&gt;840:  <span style="background-color: cyan"> 99+              IdentValue display = getIdent(CSSName.DISPLAY);</span><br>    874-&gt;841:  <span style="background-color: cyan"> 99+              return display == IdentValue.INLINE || display == IdentValue.INLINE_BLOCK ||</span><br>    875-&gt;842:  <span style="background-color: white">                          display == IdentValue.INLINE_TABLE;</span><br>      876-&gt;N:  <span style="background-color: white">              }</span><br>      877-&gt;N:  <span style="background-color: white">          }</span><br>      878-&gt;N:  <span style="background-color: white">      </span><br>    879-&gt;846:  <span style="background-color: white">   5      public boolean isNeedAutoMarginResolution() {</span><br>      880-&gt;N:  <span style="background-color: white">   5          return ! (isAbsolute() || isFixed() || isFloated() || isInlineBlock());</span><br>      881-&gt;N:  <span style="background-color: white">          }</span><br>      882-&gt;N:  <span style="background-color: white">      </span><br>    883-&gt;850:  <span style="background-color: cyan"> 99+      public boolean isAbsolute() {</span><br>    884-&gt;851:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.POSITION, IdentValue.ABSOLUTE);</span><br>      885-&gt;N:  <span style="background-color: white">          }</span><br>      886-&gt;N:  <span style="background-color: white">      </span><br>    887-&gt;854:  <span style="background-color: cyan"> 99+      public boolean isFixed() {</span><br>    888-&gt;855:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.POSITION, IdentValue.FIXED);</span><br>      889-&gt;N:  <span style="background-color: white">          }</span><br>      890-&gt;N:  <span style="background-color: white">      </span><br>    891-&gt;858:  <span style="background-color: cyan"> 99+      public boolean isFloated() {</span><br>    892-&gt;859:  <span style="background-color: cyan"> 99+          IdentValue floatVal = getIdent(CSSName.FLOAT);</span><br>    893-&gt;860:  <span style="background-color: cyan"> 99+          return floatVal == IdentValue.LEFT || floatVal == IdentValue.RIGHT;</span><br>      894-&gt;N:  <span style="background-color: white">          }</span><br>      895-&gt;N:  <span style="background-color: white">      </span><br>    896-&gt;863:  <span style="background-color: cyan"> 99+      public boolean isFloatedLeft() {</span><br>    897-&gt;864:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.FLOAT, IdentValue.LEFT);</span><br>      898-&gt;N:  <span style="background-color: white">          }</span><br>      899-&gt;N:  <span style="background-color: white">      </span><br>    900-&gt;867:  <span style="background-color: cyan">  85      public boolean isFloatedRight() {</span><br>    901-&gt;868:  <span style="background-color: cyan">  85          return isIdent(CSSName.FLOAT, IdentValue.RIGHT);</span><br>      902-&gt;N:  <span style="background-color: white">          }</span><br>      903-&gt;N:  <span style="background-color: white">      </span><br>      904-&gt;U:  <span style="background-color: yellow"> 99+      public boolean isFootnote() {</span><br>      905-&gt;U:  <span style="background-color: yellow"> 99+          return isIdent(CSSName.FLOAT, IdentValue.FOOTNOTE);</span><br>      906-&gt;U:  <span style="background-color: yellow">          }</span><br>      907-&gt;N:  <span style="background-color: white">      </span><br>      908-&gt;U:  <span style="background-color: yellow">   0      public boolean isFootnoteBody() {</span><br>      909-&gt;U:  <span style="background-color: yellow">   0          return isIdent(CSSName.DISPLAY, IdentValue.FS_FOOTNOTE_BODY);</span><br>      910-&gt;U:  <span style="background-color: yellow">          }</span><br>      911-&gt;N:  <span style="background-color: white">      </span><br>    912-&gt;871:  <span style="background-color: cyan"> 99+      public boolean isRelative() {</span><br>    913-&gt;872:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.POSITION, IdentValue.RELATIVE);</span><br>      914-&gt;N:  <span style="background-color: white">          }</span><br>      915-&gt;N:  <span style="background-color: white">      </span><br>    916-&gt;875:  <span style="background-color: cyan"> 99+      public boolean isPostionedOrFloated() {</span><br>      917-&gt;N:  <span style="background-color: white"> 99+          return isAbsolute() || isFixed() || isFloated() || isRelative();</span><br>      918-&gt;N:  <span style="background-color: white">          }</span><br>      919-&gt;N:  <span style="background-color: white">      </span><br>    920-&gt;879:  <span style="background-color: cyan"> 99+      public boolean isPositioned() {</span><br>      921-&gt;N:  <span style="background-color: white"> 99+          return isAbsolute() || isFixed() || isRelative();</span><br>      922-&gt;N:  <span style="background-color: white">          }</span><br>      923-&gt;N:  <span style="background-color: white">      </span><br>    924-&gt;883:  <span style="background-color: cyan"> 99+      public boolean isAutoWidth() {</span><br>    925-&gt;884:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.WIDTH, IdentValue.AUTO);</span><br>      926-&gt;N:  <span style="background-color: white">          }</span><br>      927-&gt;N:  <span style="background-color: white">      </span><br>    928-&gt;887:  <span style="background-color: white"> 99+      public boolean isAbsoluteWidth() {</span><br>    929-&gt;888:  <span style="background-color: white"> 99+          return valueByName(CSSName.WIDTH).hasAbsoluteUnit();</span><br>      930-&gt;N:  <span style="background-color: white">          }</span><br>      931-&gt;N:  <span style="background-color: white">      </span><br>    932-&gt;891:  <span style="background-color: cyan"> 99+      public boolean isAutoHeight() {</span><br>    933-&gt;892:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.HEIGHT, IdentValue.AUTO);</span><br>      934-&gt;N:  <span style="background-color: white">          }</span><br>      935-&gt;N:  <span style="background-color: white">      </span><br>    936-&gt;895:  <span style="background-color: cyan"> 99+      public boolean isAutoLeftMargin() {</span><br>    937-&gt;896:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.MARGIN_LEFT, IdentValue.AUTO);</span><br>      938-&gt;N:  <span style="background-color: white">          }</span><br>      939-&gt;N:  <span style="background-color: white">      </span><br>    940-&gt;899:  <span style="background-color: cyan"> 99+      public boolean isAutoRightMargin() {</span><br>    941-&gt;900:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.MARGIN_RIGHT, IdentValue.AUTO);</span><br>      942-&gt;N:  <span style="background-color: white">          }</span><br>      943-&gt;N:  <span style="background-color: white">      </span><br>    944-&gt;903:  <span style="background-color: cyan"> 99+      public boolean isAutoZIndex() {</span><br>    945-&gt;904:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.Z_INDEX, IdentValue.AUTO);</span><br>      946-&gt;N:  <span style="background-color: white">          }</span><br>      947-&gt;N:  <span style="background-color: white">      </span><br>    948-&gt;907:  <span style="background-color: cyan"> 99+      public boolean establishesBFC() {</span><br>      949-&gt;N:  <span style="background-color: white"> 99+          if (hasColumns()) {</span><br>    950-&gt;909:  <span style="background-color: white">   0              return true;</span><br>      951-&gt;N:  <span style="background-color: white">              }</span><br>      952-&gt;N:  <span style="background-color: white">              </span><br>    953-&gt;912:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(CSSName.POSITION);</span><br>      954-&gt;N:  <span style="background-color: white">      </span><br>    955-&gt;914:  <span style="background-color: cyan"> 99+          if (value instanceof FunctionValue) {  // running(header)</span><br>    956-&gt;915:  <span style="background-color: cyan"> 99+              return false;</span><br>      957-&gt;N:  <span style="background-color: white">              } else {</span><br>    958-&gt;917:  <span style="background-color: cyan"> 99+              IdentValue display = getIdent(CSSName.DISPLAY);</span><br>    959-&gt;918:  <span style="background-color: cyan"> 99+              IdentValue position = (IdentValue)value;</span><br>      960-&gt;N:  <span style="background-color: white">      </span><br>      961-&gt;N:  <span style="background-color: white"> 99+              return isFloated() ||</span><br>    962-&gt;921:  <span style="background-color: white">                          position == IdentValue.ABSOLUTE || position == IdentValue.FIXED ||</span><br>    963-&gt;922:  <span style="background-color: white">                          display == IdentValue.INLINE_BLOCK || display == IdentValue.TABLE_CELL ||</span><br>    964-&gt;923:  <span style="background-color: white">                          ! isIdent(CSSName.OVERFLOW, IdentValue.VISIBLE);</span><br>      965-&gt;N:  <span style="background-color: white">              }</span><br>      966-&gt;N:  <span style="background-color: white">          }</span><br>      967-&gt;N:  <span style="background-color: white">      </span><br>    968-&gt;927:  <span style="background-color: cyan"> 99+      public boolean requiresLayer() {</span><br>    969-&gt;928:  <span style="background-color: cyan"> 99+      	if (!isIdent(CSSName.TRANSFORM, IdentValue.NONE)) {</span><br>    970-&gt;929:  <span style="background-color: red"> 99+      		return true;</span><br>      971-&gt;N:  <span style="background-color: white">          	}</span><br>      972-&gt;N:  <span style="background-color: white">          	</span><br>    973-&gt;932:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(CSSName.POSITION);</span><br>      974-&gt;N:  <span style="background-color: white">      </span><br>    975-&gt;934:  <span style="background-color: cyan"> 99+          if (value instanceof FunctionValue) {  // running(header)</span><br>    976-&gt;935:  <span style="background-color: cyan"> 99+              return false;</span><br>      977-&gt;N:  <span style="background-color: white">              } else {</span><br>    978-&gt;937:  <span style="background-color: cyan"> 99+              IdentValue position = getIdent(CSSName.POSITION);</span><br>      979-&gt;N:  <span style="background-color: white">      </span><br>    980-&gt;939:  <span style="background-color: cyan"> 99+              if (position == IdentValue.ABSOLUTE ||</span><br>    981-&gt;940:  <span style="background-color: white">                          position == IdentValue.RELATIVE || position == IdentValue.FIXED) {</span><br>    982-&gt;941:  <span style="background-color: cyan"> 99+                  return true;</span><br>      983-&gt;N:  <span style="background-color: white">                  }</span><br>      984-&gt;N:  <span style="background-color: white">      </span><br>    985-&gt;944:  <span style="background-color: cyan"> 99+              IdentValue overflow = getIdent(CSSName.OVERFLOW);</span><br>    986-&gt;945:  <span style="background-color: cyan"> 99+              return (overflow == IdentValue.SCROLL || overflow == IdentValue.AUTO) &amp;&amp;</span><br>      987-&gt;N:  <span style="background-color: white">                          isOverflowApplies();</span><br>      988-&gt;N:  <span style="background-color: white">      </span><br>      989-&gt;N:  <span style="background-color: white">              }</span><br>      990-&gt;N:  <span style="background-color: white">          }</span><br>      991-&gt;N:  <span style="background-color: white">      </span><br>    992-&gt;951:  <span style="background-color: cyan"> 99+      public boolean isRunning() {</span><br>    993-&gt;952:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(CSSName.POSITION);</span><br>    994-&gt;953:  <span style="background-color: cyan"> 99+          return value instanceof FunctionValue;</span><br>      995-&gt;N:  <span style="background-color: white">          }</span><br>      996-&gt;N:  <span style="background-color: white">      </span><br>    997-&gt;956:  <span style="background-color: cyan">  91      public String getRunningName() {</span><br>    998-&gt;957:  <span style="background-color: cyan">  91          FunctionValue value = (FunctionValue)valueByName(CSSName.POSITION);</span><br>    999-&gt;958:  <span style="background-color: cyan">  91          FSFunction function = value.getFunction();</span><br>     1000-&gt;N:  <span style="background-color: white">      </span><br>   1001-&gt;960:  <span style="background-color: cyan">  91          PropertyValue param = function.getParameters().get(0);</span><br>     1002-&gt;N:  <span style="background-color: white">      </span><br>   1003-&gt;962:  <span style="background-color: cyan">  91          return param.getStringValue();</span><br>     1004-&gt;N:  <span style="background-color: white">          }</span><br>     1005-&gt;N:  <span style="background-color: white">      </span><br>   1006-&gt;965:  <span style="background-color: cyan"> 99+      public boolean isOverflowApplies() {</span><br>   1007-&gt;966:  <span style="background-color: cyan"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>   1008-&gt;967:  <span style="background-color: cyan"> 99+          return display == IdentValue.BLOCK || display == IdentValue.LIST_ITEM ||</span><br>   1009-&gt;968:  <span style="background-color: white">                      display == IdentValue.TABLE || display == IdentValue.INLINE_BLOCK ||</span><br>   1010-&gt;969:  <span style="background-color: white">                      display == IdentValue.TABLE_CELL;</span><br>     1011-&gt;N:  <span style="background-color: white">          }</span><br>     1012-&gt;N:  <span style="background-color: white">      </span><br>   1013-&gt;972:  <span style="background-color: cyan"> 99+      public boolean isOverflowVisible() {</span><br>   1014-&gt;973:  <span style="background-color: cyan"> 99+          return valueByName(CSSName.OVERFLOW) == IdentValue.VISIBLE;</span><br>     1015-&gt;N:  <span style="background-color: white">          }</span><br>     1016-&gt;N:  <span style="background-color: white">      </span><br>   1017-&gt;976:  <span style="background-color: cyan"> 99+      public boolean isHorizontalBackgroundRepeat(PropertyValue value) {</span><br>   1018-&gt;977:  <span style="background-color: cyan"> 99+          return value.getIdentValue() == IdentValue.REPEAT_X || value.getIdentValue() == IdentValue.REPEAT;</span><br>     1019-&gt;N:  <span style="background-color: white">          }</span><br>     1020-&gt;N:  <span style="background-color: white">      </span><br>   1021-&gt;980:  <span style="background-color: cyan"> 99+      public boolean isVerticalBackgroundRepeat(PropertyValue value) {</span><br>   1022-&gt;981:  <span style="background-color: cyan"> 99+          return value.getIdentValue() == IdentValue.REPEAT_Y || value.getIdentValue() == IdentValue.REPEAT;</span><br>     1023-&gt;N:  <span style="background-color: white">          }</span><br>     1024-&gt;N:  <span style="background-color: white">      </span><br>   1025-&gt;984:  <span style="background-color: cyan"> 99+      public boolean isTopAuto() {</span><br>   1026-&gt;985:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.TOP, IdentValue.AUTO);</span><br>     1027-&gt;N:  <span style="background-color: white">      </span><br>     1028-&gt;N:  <span style="background-color: white">          }</span><br>     1029-&gt;N:  <span style="background-color: white">      </span><br>   1030-&gt;989:  <span style="background-color: cyan"> 99+      public boolean isBottomAuto() {</span><br>   1031-&gt;990:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.BOTTOM, IdentValue.AUTO);</span><br>     1032-&gt;N:  <span style="background-color: white">          }</span><br>     1033-&gt;N:  <span style="background-color: white">      </span><br>   1034-&gt;993:  <span style="background-color: cyan"> 99+      public boolean isListItem() {</span><br>   1035-&gt;994:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.DISPLAY, IdentValue.LIST_ITEM);</span><br>     1036-&gt;N:  <span style="background-color: white">          }</span><br>     1037-&gt;N:  <span style="background-color: white">          </span><br>   1038-&gt;997:  <span style="background-color: cyan"> 99+      public boolean hasColumns() {</span><br>   1039-&gt;998:  <span style="background-color: cyan"> 99+          return !isIdent(CSSName.COLUMN_COUNT, IdentValue.AUTO) &amp;&amp; asFloat(CSSName.COLUMN_COUNT) &gt; 1;</span><br>     1040-&gt;N:  <span style="background-color: white">          }</span><br>     1041-&gt;N:  <span style="background-color: white">          </span><br>  1042-&gt;1001:  <span style="background-color: white">   8      public int columnCount() {</span><br>  1043-&gt;1002:  <span style="background-color: white">   8      	return (int) asFloat(CSSName.COLUMN_COUNT);</span><br>     1044-&gt;N:  <span style="background-color: white">          }</span><br>     1045-&gt;N:  <span style="background-color: white">          </span><br>  1046-&gt;1005:  <span style="background-color: cyan"> 99+      public int fsMaxOverflowPages() {</span><br>  1047-&gt;1006:  <span style="background-color: cyan"> 99+          return (int) asFloat(CSSName.FS_MAX_OVERFLOW_PAGES);</span><br>     1048-&gt;N:  <span style="background-color: white">          }</span><br>     1049-&gt;N:  <span style="background-color: white">      </span><br>     1050-&gt;N:  <span style="background-color: white">      	/**</span><br>     1051-&gt;N:  <span style="background-color: white">           * Determine if the element is visible. This is normaly the case</span><br>     1052-&gt;N:  <span style="background-color: white">           * if visibility == visible. Only when visibilty is</span><br>     1053-&gt;N:  <span style="background-color: white">           * -fs-table-paginate-repeated-visible and we are in a repeated table header</span><br>     1054-&gt;N:  <span style="background-color: white">           * the element will also be visible. This allows to only show an element in the table header</span><br>     1055-&gt;N:  <span style="background-color: white">           * after a page break.</span><br>     1056-&gt;N:  <span style="background-color: white">           * @param renderingContext null or the current renderingContext. If null,</span><br>     1057-&gt;N:  <span style="background-color: white">           *                         then the -fs-table-paginate-repeated-visible logic</span><br>     1058-&gt;N:  <span style="background-color: white">           *                         will not work.</span><br>     1059-&gt;N:  <span style="background-color: white">      	 * @param thisElement the element for which the visibility should be determined. Only required if</span><br>     1060-&gt;N:  <span style="background-color: white">           * -fs-table-paginate-repeated-visible is specified.</span><br>     1061-&gt;N:  <span style="background-color: white">           * @return true if the element is visible</span><br>     1062-&gt;N:  <span style="background-color: white">           */</span><br>  1063-&gt;1022:  <span style="background-color: cyan"> 99+      public boolean isVisible(RenderingContext renderingContext, Box thisElement) {</span><br>  1064-&gt;1023:  <span style="background-color: cyan"> 99+          IdentValue val = getIdent(CSSName.VISIBILITY);</span><br>  1065-&gt;1024:  <span style="background-color: cyan"> 99+  		if (val == IdentValue.VISIBLE)</span><br>  1066-&gt;1025:  <span style="background-color: cyan"> 99+  			return true;</span><br>  1067-&gt;1026:  <span style="background-color: white">   0  		if (renderingContext != null) {</span><br>  1068-&gt;1027:  <span style="background-color: white">   0  			if (val == IdentValue.FS_TABLE_PAGINATE_REPEATED_VISIBLE) {</span><br>     1069-&gt;N:  <span style="background-color: white">      				/*</span><br>     1070-&gt;N:  <span style="background-color: white">      				 * We need to find the parent TableBox which has a</span><br>     1071-&gt;N:  <span style="background-color: white">      				 * ContentLimitContainer and can be repeated.</span><br>     1072-&gt;N:  <span style="background-color: white">      				 */</span><br>  1073-&gt;1032:  <span style="background-color: white">   0  				Box parentElement = thisElement.getParent();</span><br>  1074-&gt;1033:  <span style="background-color: white">   0  				while (parentElement != null</span><br>  1075-&gt;1034:  <span style="background-color: white">      						&amp;&amp; !(parentElement.getStyle().isTable()</span><br>  1076-&gt;1035:  <span style="background-color: white">                                      &amp;&amp; ((TableBox) parentElement).hasContentLimitContainer()))</span><br>  1077-&gt;1036:  <span style="background-color: white">   0  					parentElement = parentElement.getDocumentParent();</span><br>     1078-&gt;N:  <span style="background-color: white">      </span><br>  1079-&gt;1038:  <span style="background-color: white">   0  				if (parentElement != null) {</span><br>  1080-&gt;1039:  <span style="background-color: white">   0  				    TableBox tableBox = (TableBox) parentElement;</span><br>  1081-&gt;1040:  <span style="background-color: white">   0                      return !tableBox.isTableRenderedOnFirstPage(renderingContext);</span><br>     1082-&gt;N:  <span style="background-color: white">      				}</span><br>     1083-&gt;N:  <span style="background-color: white">      			}</span><br>     1084-&gt;N:  <span style="background-color: white">      		}</span><br>  1085-&gt;1044:  <span style="background-color: white">   0          return false;</span><br>     1086-&gt;N:  <span style="background-color: white">          }</span><br>     1087-&gt;N:  <span style="background-color: white">      </span><br>  1088-&gt;1047:  <span style="background-color: cyan"> 99+      public boolean isForcePageBreakBefore() {</span><br>  1089-&gt;1048:  <span style="background-color: cyan"> 99+          IdentValue val = getIdent(CSSName.PAGE_BREAK_BEFORE);</span><br>  1090-&gt;1049:  <span style="background-color: cyan"> 99+          return val == IdentValue.ALWAYS || val == IdentValue.LEFT</span><br>  1091-&gt;1050:  <span style="background-color: white">                      || val == IdentValue.RIGHT;</span><br>     1092-&gt;N:  <span style="background-color: white">          }</span><br>     1093-&gt;N:  <span style="background-color: white">      </span><br>  1094-&gt;1053:  <span style="background-color: cyan"> 99+      public boolean isForcePageBreakAfter() {</span><br>  1095-&gt;1054:  <span style="background-color: cyan"> 99+          IdentValue val = getIdent(CSSName.PAGE_BREAK_AFTER);</span><br>  1096-&gt;1055:  <span style="background-color: cyan"> 99+          return val == IdentValue.ALWAYS || val == IdentValue.LEFT</span><br>  1097-&gt;1056:  <span style="background-color: white">                      || val == IdentValue.RIGHT;</span><br>     1098-&gt;N:  <span style="background-color: white">          }</span><br>     1099-&gt;N:  <span style="background-color: white">          </span><br>  1100-&gt;1059:  <span style="background-color: white"> 99+      public boolean isColumnBreakBefore() {</span><br>  1101-&gt;1060:  <span style="background-color: white"> 99+          return isIdent(CSSName.BREAK_BEFORE, IdentValue.COLUMN);</span><br>     1102-&gt;N:  <span style="background-color: white">          }</span><br>     1103-&gt;N:  <span style="background-color: white">          </span><br>  1104-&gt;1063:  <span style="background-color: white"> 99+      public boolean isColumnBreakAfter() {</span><br>  1105-&gt;1064:  <span style="background-color: white"> 99+          return isIdent(CSSName.BREAK_AFTER, IdentValue.COLUMN);</span><br>     1106-&gt;N:  <span style="background-color: white">          }</span><br>     1107-&gt;N:  <span style="background-color: white">      </span><br>  1108-&gt;1067:  <span style="background-color: cyan"> 99+      public boolean isAvoidPageBreakInside() {</span><br>  1109-&gt;1068:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.PAGE_BREAK_INSIDE, IdentValue.AVOID);</span><br>     1110-&gt;N:  <span style="background-color: white">          }</span><br>     1111-&gt;N:  <span style="background-color: white">      </span><br>     1112-&gt;N:  <span style="background-color: white">          /**</span><br>     1113-&gt;N:  <span style="background-color: white">           * This method derives a style for an anonymous child box with an overriden</span><br>     1114-&gt;N:  <span style="background-color: white">           * value for the display property.</span><br>     1115-&gt;N:  <span style="background-color: white">           * <br><br></span><br>     1116-&gt;N:  <span style="background-color: white">           * NOTE: All non-inherited properties of <code>this</code> will be lost as</span><br>     1117-&gt;N:  <span style="background-color: white">           * the returned style is for a child box.</span><br>     1118-&gt;N:  <span style="background-color: white">           */</span><br>  1119-&gt;1071:  <span style="background-color: cyan"> 99+      public CalculatedStyle createAnonymousStyle(IdentValue display) {</span><br>  1120-&gt;1072:  <span style="background-color: cyan"> 99+          return deriveStyle(CascadedStyle.createAnonymousStyle(display));</span><br>     1121-&gt;N:  <span style="background-color: white">          }</span><br>     1122-&gt;N:  <span style="background-color: white">      </span><br>  1123-&gt;1075:  <span style="background-color: cyan"> 99+      public boolean mayHaveFirstLine() {</span><br>  1124-&gt;1076:  <span style="background-color: cyan"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>  1125-&gt;1077:  <span style="background-color: cyan"> 99+          return display == IdentValue.BLOCK ||</span><br>  1126-&gt;1078:  <span style="background-color: white">                      display == IdentValue.LIST_ITEM ||</span><br>  1127-&gt;1079:  <span style="background-color: white">                      display == IdentValue.RUN_IN ||</span><br>  1128-&gt;1080:  <span style="background-color: white">                      display == IdentValue.TABLE ||</span><br>  1129-&gt;1081:  <span style="background-color: white">                      display == IdentValue.TABLE_CELL ||</span><br>  1130-&gt;1082:  <span style="background-color: white">                      display == IdentValue.TABLE_CAPTION ||</span><br>  1131-&gt;1083:  <span style="background-color: white">                      display == IdentValue.INLINE_BLOCK;</span><br>     1132-&gt;N:  <span style="background-color: white">          }</span><br>     1133-&gt;N:  <span style="background-color: white">      </span><br>  1134-&gt;1086:  <span style="background-color: cyan"> 99+      public boolean mayHaveFirstLetter() {</span><br>  1135-&gt;1087:  <span style="background-color: cyan"> 99+          IdentValue display = getIdent(CSSName.DISPLAY);</span><br>  1136-&gt;1088:  <span style="background-color: cyan"> 99+          return display == IdentValue.BLOCK ||</span><br>  1137-&gt;1089:  <span style="background-color: white">                      display == IdentValue.LIST_ITEM ||</span><br>  1138-&gt;1090:  <span style="background-color: white">                      display == IdentValue.TABLE_CELL ||</span><br>  1139-&gt;1091:  <span style="background-color: white">                      display == IdentValue.TABLE_CAPTION ||</span><br>  1140-&gt;1092:  <span style="background-color: white">                      display == IdentValue.INLINE_BLOCK;</span><br>     1141-&gt;N:  <span style="background-color: white">          }</span><br>     1142-&gt;N:  <span style="background-color: white">      </span><br>  1143-&gt;1095:  <span style="background-color: cyan"> 99+      public boolean isNonFlowContent() {</span><br>     1144-&gt;N:  <span style="background-color: white"> 99+          return isFloated() || isAbsolute() || isFixed() || isRunning();</span><br>     1145-&gt;N:  <span style="background-color: white">          }</span><br>     1146-&gt;N:  <span style="background-color: white">      </span><br>  1147-&gt;1099:  <span style="background-color: cyan"> 99+      public boolean isMayCollapseMarginsWithChildren() {</span><br>  1148-&gt;1100:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.OVERFLOW, IdentValue.VISIBLE) &amp;&amp;</span><br>     1149-&gt;N:  <span style="background-color: white">                      ! (isFloated() || isAbsolute() || isFixed() || isInlineBlock());</span><br>     1150-&gt;N:  <span style="background-color: white">          }</span><br>     1151-&gt;N:  <span style="background-color: white">      </span><br>  1152-&gt;1104:  <span style="background-color: cyan"> 99+      public boolean isAbsFixedOrInlineBlockEquiv() {</span><br>     1153-&gt;N:  <span style="background-color: white"> 99+          return isAbsolute() || isFixed() || isInlineBlock() || isInlineTable();</span><br>     1154-&gt;N:  <span style="background-color: white">          }</span><br>     1155-&gt;N:  <span style="background-color: white">      </span><br>  1156-&gt;1108:  <span style="background-color: cyan"> 99+      public boolean isMaxWidthNone() {</span><br>  1157-&gt;1109:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.MAX_WIDTH, IdentValue.NONE);</span><br>     1158-&gt;N:  <span style="background-color: white">          }</span><br>     1159-&gt;N:  <span style="background-color: white">      </span><br>  1160-&gt;1112:  <span style="background-color: cyan"> 99+      public boolean isMaxHeightNone() {</span><br>  1161-&gt;1113:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.MAX_HEIGHT, IdentValue.NONE);</span><br>     1162-&gt;N:  <span style="background-color: white">          }</span><br>     1163-&gt;N:  <span style="background-color: white">      </span><br>  1164-&gt;1116:  <span style="background-color: cyan"> 99+      public boolean isImageRenderingPixelated() {</span><br>  1165-&gt;1117:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.IMAGE_RENDERING, IdentValue.PIXELATED) || isIdent(CSSName.IMAGE_RENDERING, IdentValue.CRISP_EDGES);</span><br>     1166-&gt;N:  <span style="background-color: white">          }</span><br>  1167-&gt;1119:  <span style="background-color: cyan"> 99+      public boolean isImageRenderingInterpolate(){</span><br>     1168-&gt;N:  <span style="background-color: white"> 99+          return !isImageRenderingPixelated();</span><br>     1169-&gt;N:  <span style="background-color: white">          }</span><br>     1170-&gt;N:  <span style="background-color: white">      </span><br>  1171-&gt;1123:  <span style="background-color: cyan"> 99+      public int getMinWidth(CssContext c, int cbWidth) {</span><br>  1172-&gt;1124:  <span style="background-color: cyan"> 99+          return (int) getFloatPropertyProportionalTo(CSSName.MIN_WIDTH, cbWidth, c);</span><br>     1173-&gt;N:  <span style="background-color: white">          }</span><br>     1174-&gt;N:  <span style="background-color: white">      </span><br>  1175-&gt;1127:  <span style="background-color: cyan"> 99+      public int getMaxWidth(CssContext c, int cbWidth) {</span><br>  1176-&gt;1128:  <span style="background-color: cyan"> 99+          return (int) getFloatPropertyProportionalTo(CSSName.MAX_WIDTH, cbWidth, c);</span><br>     1177-&gt;N:  <span style="background-color: white">          }</span><br>     1178-&gt;N:  <span style="background-color: white">      </span><br>  1179-&gt;1131:  <span style="background-color: cyan"> 99+      public int getMinHeight(CssContext c, int cbHeight) {</span><br>  1180-&gt;1132:  <span style="background-color: cyan"> 99+          return (int) getFloatPropertyProportionalTo(CSSName.MIN_HEIGHT, cbHeight, c);</span><br>     1181-&gt;N:  <span style="background-color: white">          }</span><br>     1182-&gt;N:  <span style="background-color: white">      </span><br>  1183-&gt;1135:  <span style="background-color: white">  69      public int getMaxHeight(CssContext c, int cbHeight) {</span><br>  1184-&gt;1136:  <span style="background-color: white">  69          return (int) getFloatPropertyProportionalTo(CSSName.MAX_HEIGHT, cbHeight, c);</span><br>     1185-&gt;N:  <span style="background-color: white">          }</span><br>     1186-&gt;N:  <span style="background-color: white">      </span><br>  1187-&gt;1139:  <span style="background-color: red"> 99+      public boolean isCollapseBorders() {</span><br>     1188-&gt;N:  <span style="background-color: white">          	// The second part of this condition was commented out by @danfickle because seems unneccessary</span><br>     1189-&gt;N:  <span style="background-color: white">          	// See https://github.com/danfickle/openhtmltopdf/issues/97</span><br>     1190-&gt;N:  <span style="background-color: white">          	</span><br>  1191-&gt;1143:  <span style="background-color: red"> 99+          return isIdent(CSSName.BORDER_COLLAPSE, IdentValue.COLLAPSE); // &amp;&amp; ! isPaginateTable();</span><br>     1192-&gt;N:  <span style="background-color: white">          }</span><br>     1193-&gt;N:  <span style="background-color: white">      </span><br>  1194-&gt;1146:  <span style="background-color: red"> 99+      public int getBorderHSpacing(CssContext c) {</span><br>  1195-&gt;1147:  <span style="background-color: red"> 99+          return isCollapseBorders() ? 0 : (int) getFloatPropertyProportionalTo(CSSName.FS_BORDER_SPACING_HORIZONTAL, 0, c);</span><br>     1196-&gt;N:  <span style="background-color: white">          }</span><br>     1197-&gt;N:  <span style="background-color: white">      </span><br>  1198-&gt;1150:  <span style="background-color: red"> 99+      public int getBorderVSpacing(CssContext c) {</span><br>  1199-&gt;1151:  <span style="background-color: red"> 99+          return isCollapseBorders() ? 0 : (int) getFloatPropertyProportionalTo(CSSName.FS_BORDER_SPACING_VERTICAL, 0, c);</span><br>     1200-&gt;N:  <span style="background-color: white">          }</span><br>     1201-&gt;N:  <span style="background-color: white">      </span><br>  1202-&gt;1154:  <span style="background-color: red"> 99+      public int getRowSpan() {</span><br>  1203-&gt;1155:  <span style="background-color: red"> 99+          int result = (int) asFloat(CSSName.FS_ROWSPAN);</span><br>  1204-&gt;1156:  <span style="background-color: red"> 99+          return result &gt; 0 ? result : 1;</span><br>     1205-&gt;N:  <span style="background-color: white">          }</span><br>     1206-&gt;N:  <span style="background-color: white">      </span><br>  1207-&gt;1159:  <span style="background-color: red"> 99+      public int getColSpan() {</span><br>  1208-&gt;1160:  <span style="background-color: red"> 99+          int result = (int) asFloat(CSSName.FS_COLSPAN);</span><br>  1209-&gt;1161:  <span style="background-color: red"> 99+          return result &gt; 0 ? result : 1;</span><br>     1210-&gt;N:  <span style="background-color: white">          }</span><br>     1211-&gt;N:  <span style="background-color: white">      </span><br>  1212-&gt;1164:  <span style="background-color: cyan"> 99+      public float getFSPageBreakMinHeight(CssContext c){</span><br>  1213-&gt;1165:  <span style="background-color: cyan"> 99+          return getFloatPropertyProportionalTo(CSSName.FS_PAGE_BREAK_MIN_HEIGHT, 0, c);</span><br>     1214-&gt;N:  <span style="background-color: white">          }</span><br>     1215-&gt;N:  <span style="background-color: white">      </span><br>  1216-&gt;1168:  <span style="background-color: cyan"> 99+      public Length asLength(CssContext c, CSSName cssName) {</span><br>  1217-&gt;1169:  <span style="background-color: cyan"> 99+          Length result = new Length();</span><br>     1218-&gt;N:  <span style="background-color: white">      </span><br>  1219-&gt;1171:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(cssName);</span><br>  1220-&gt;1172:  <span style="background-color: cyan"> 99+          if (value instanceof LengthValue || value instanceof NumberValue) {</span><br>  1221-&gt;1173:  <span style="background-color: red"> 99+              if (value.hasAbsoluteUnit()) {</span><br>  1222-&gt;1174:  <span style="background-color: red"> 99+                  result.setValue((int) value.getFloatProportionalTo(cssName, 0, c));</span><br>  1223-&gt;1175:  <span style="background-color: red"> 99+                  result.setType(Length.FIXED);</span><br>     1224-&gt;N:  <span style="background-color: white">                  } else {</span><br>  1225-&gt;1177:  <span style="background-color: cyan"> 99+                  result.setValue((int) value.asFloat());</span><br>  1226-&gt;1178:  <span style="background-color: cyan"> 99+                  result.setType(Length.PERCENT);</span><br>     1227-&gt;N:  <span style="background-color: white">                  }</span><br>     1228-&gt;N:  <span style="background-color: white">              }</span><br>     1229-&gt;N:  <span style="background-color: white">      </span><br>  1230-&gt;1182:  <span style="background-color: cyan"> 99+          return result;</span><br>     1231-&gt;N:  <span style="background-color: white">          }</span><br>     1232-&gt;N:  <span style="background-color: white">      </span><br>  1233-&gt;1185:  <span style="background-color: cyan"> 99+      public boolean isShowEmptyCells() {</span><br>  1234-&gt;1186:  <span style="background-color: cyan"> 99+          return isCollapseBorders() || isIdent(CSSName.EMPTY_CELLS, IdentValue.SHOW);</span><br>     1235-&gt;N:  <span style="background-color: white">          }</span><br>     1236-&gt;N:  <span style="background-color: white">      </span><br>  1237-&gt;1189:  <span style="background-color: cyan"> 99+      public List
       <identvalue>
         getTextDecorations() {
       </identvalue></span><br>  1238-&gt;1190:  <span style="background-color: cyan"> 99+          FSDerivedValue value = valueByName(CSSName.TEXT_DECORATION);</span><br>  1239-&gt;1191:  <span style="background-color: cyan"> 99+          if (value == IdentValue.NONE) {</span><br>  1240-&gt;1192:  <span style="background-color: cyan"> 99+              return null;</span><br>     1241-&gt;N:  <span style="background-color: white">              } else {</span><br>  1242-&gt;1194:  <span style="background-color: red"> 99+              List
       <propertyvalue>
         idents = ((ListValue) value).getValues();
       </propertyvalue></span><br>  1243-&gt;1195:  <span style="background-color: red"> 99+              return idents.stream()</span><br>  1244-&gt;1196:  <span style="background-color: white">                          .map(val -&gt; (IdentValue) DerivedValueFactory.newDerivedValue(this, CSSName.TEXT_DECORATION, val))</span><br>  1245-&gt;1197:  <span style="background-color: white">                          .collect(Collectors.toList());</span><br>     1246-&gt;N:  <span style="background-color: white">              }</span><br>     1247-&gt;N:  <span style="background-color: white">          }</span><br>     1248-&gt;N:  <span style="background-color: white">      </span><br>  1249-&gt;1201:  <span style="background-color: white">   0      public Cursor getCursor() {</span><br>  1250-&gt;1202:  <span style="background-color: white">   0          FSDerivedValue value = valueByName(CSSName.CURSOR);</span><br>     1251-&gt;N:  <span style="background-color: white">      </span><br>  1252-&gt;1204:  <span style="background-color: white">   0          if (value == IdentValue.AUTO || value == IdentValue.DEFAULT) {</span><br>  1253-&gt;1205:  <span style="background-color: white">   0              return Cursor.getDefaultCursor();</span><br>  1254-&gt;1206:  <span style="background-color: white">   0          } else if (value == IdentValue.CROSSHAIR) {</span><br>  1255-&gt;1207:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.CROSSHAIR_CURSOR);</span><br>  1256-&gt;1208:  <span style="background-color: white">   0          } else if (value == IdentValue.POINTER) {</span><br>  1257-&gt;1209:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.HAND_CURSOR);</span><br>  1258-&gt;1210:  <span style="background-color: white">   0          } else if (value == IdentValue.MOVE) {</span><br>  1259-&gt;1211:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.MOVE_CURSOR);</span><br>  1260-&gt;1212:  <span style="background-color: white">   0          } else if (value == IdentValue.E_RESIZE) {</span><br>  1261-&gt;1213:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.E_RESIZE_CURSOR);</span><br>  1262-&gt;1214:  <span style="background-color: white">   0          } else if (value == IdentValue.NE_RESIZE) {</span><br>  1263-&gt;1215:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.NE_RESIZE_CURSOR);</span><br>  1264-&gt;1216:  <span style="background-color: white">   0          } else if (value == IdentValue.NW_RESIZE) {</span><br>  1265-&gt;1217:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.NW_RESIZE_CURSOR);</span><br>  1266-&gt;1218:  <span style="background-color: white">   0          } else if (value == IdentValue.N_RESIZE) {</span><br>  1267-&gt;1219:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.N_RESIZE_CURSOR);</span><br>  1268-&gt;1220:  <span style="background-color: white">   0          } else if (value == IdentValue.SE_RESIZE) {</span><br>  1269-&gt;1221:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.SE_RESIZE_CURSOR);</span><br>  1270-&gt;1222:  <span style="background-color: white">   0          } else if (value == IdentValue.SW_RESIZE) {</span><br>  1271-&gt;1223:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.SW_RESIZE_CURSOR);</span><br>  1272-&gt;1224:  <span style="background-color: white">   0          } else if (value == IdentValue.S_RESIZE) {</span><br>  1273-&gt;1225:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.S_RESIZE_CURSOR);</span><br>  1274-&gt;1226:  <span style="background-color: white">   0          } else if (value == IdentValue.W_RESIZE) {</span><br>  1275-&gt;1227:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.W_RESIZE_CURSOR);</span><br>  1276-&gt;1228:  <span style="background-color: white">   0          } else if (value == IdentValue.TEXT) {</span><br>  1277-&gt;1229:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR);</span><br>  1278-&gt;1230:  <span style="background-color: white">   0          } else if (value == IdentValue.WAIT) {</span><br>  1279-&gt;1231:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR);</span><br>  1280-&gt;1232:  <span style="background-color: white">   0          } else if (value == IdentValue.HELP) {</span><br>     1281-&gt;N:  <span style="background-color: white">                  // We don't have a cursor for this by default, maybe we need</span><br>     1282-&gt;N:  <span style="background-color: white">                  // a custom one for this (but I don't like it).</span><br>  1283-&gt;1235:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR);</span><br>  1284-&gt;1236:  <span style="background-color: white">   0          } else if (value == IdentValue.PROGRESS) {</span><br>     1285-&gt;N:  <span style="background-color: white">                  // We don't have a cursor for this by default, maybe we need</span><br>     1286-&gt;N:  <span style="background-color: white">                  // a custom one for this (but I don't like it).</span><br>  1287-&gt;1239:  <span style="background-color: white">   0              return Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR);</span><br>     1288-&gt;N:  <span style="background-color: white">              }</span><br>     1289-&gt;N:  <span style="background-color: white">      </span><br>  1290-&gt;1242:  <span style="background-color: white">   0          return null;</span><br>     1291-&gt;N:  <span style="background-color: white">          }</span><br>     1292-&gt;N:  <span style="background-color: white">      </span><br>  1293-&gt;1245:  <span style="background-color: red"> 99+      public boolean isPaginateTable() {</span><br>  1294-&gt;1246:  <span style="background-color: red"> 99+          return isIdent(CSSName.FS_TABLE_PAGINATE, IdentValue.PAGINATE);</span><br>     1295-&gt;N:  <span style="background-color: white">          }</span><br>     1296-&gt;N:  <span style="background-color: white">      </span><br>  1297-&gt;1249:  <span style="background-color: cyan"> 99+      public boolean isTextJustify() {</span><br>  1298-&gt;1250:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.TEXT_ALIGN, IdentValue.JUSTIFY) &amp;&amp;</span><br>  1299-&gt;1251:  <span style="background-color: white">                      ! (isIdent(CSSName.WHITE_SPACE, IdentValue.PRE) ||</span><br>  1300-&gt;1252:  <span style="background-color: white">                              isIdent(CSSName.WHITE_SPACE, IdentValue.PRE_LINE));</span><br>     1301-&gt;N:  <span style="background-color: white">          }</span><br>     1302-&gt;N:  <span style="background-color: white">      </span><br>  1303-&gt;1255:  <span style="background-color: cyan"> 99+      public boolean isListMarkerInside() {</span><br>  1304-&gt;1256:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.LIST_STYLE_POSITION, IdentValue.INSIDE);</span><br>     1305-&gt;N:  <span style="background-color: white">          }</span><br>     1306-&gt;N:  <span style="background-color: white">      </span><br>  1307-&gt;1259:  <span style="background-color: cyan"> 99+      public boolean isKeepWithInline() {</span><br>  1308-&gt;1260:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.FS_KEEP_WITH_INLINE, IdentValue.KEEP);</span><br>     1309-&gt;N:  <span style="background-color: white">          }</span><br>     1310-&gt;N:  <span style="background-color: white">      </span><br>  1311-&gt;1263:  <span style="background-color: cyan"> 99+      public boolean isDynamicAutoWidth() {</span><br>  1312-&gt;1264:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.FS_DYNAMIC_AUTO_WIDTH, IdentValue.DYNAMIC);</span><br>     1313-&gt;N:  <span style="background-color: white">          }</span><br>     1314-&gt;N:  <span style="background-color: white">      </span><br>  1315-&gt;1267:  <span style="background-color: cyan"> 99+      public boolean isDynamicAutoWidthApplicable() {</span><br>     1316-&gt;N:  <span style="background-color: white"> 99+          return isDynamicAutoWidth() &amp;&amp; isAutoWidth() &amp;&amp; ! isCanBeShrunkToFit();</span><br>     1317-&gt;N:  <span style="background-color: white">          }</span><br>     1318-&gt;N:  <span style="background-color: white">      </span><br>  1319-&gt;1271:  <span style="background-color: cyan"> 99+      public boolean isCanBeShrunkToFit() {</span><br>     1320-&gt;N:  <span style="background-color: white"> 99+          return isInlineBlock() || isFloated() || isAbsolute() || isFixed();</span><br>     1321-&gt;N:  <span style="background-color: white">          }</span><br>     1322-&gt;N:  <span style="background-color: white">          </span><br>  1323-&gt;1275:  <span style="background-color: white">   0      public boolean isDirectionLTR() {</span><br>  1324-&gt;1276:  <span style="background-color: white">   0      	return isIdent(CSSName.DIRECTION, IdentValue.LTR);</span><br>     1325-&gt;N:  <span style="background-color: white">          }</span><br>     1326-&gt;N:  <span style="background-color: white">          </span><br>  1327-&gt;1279:  <span style="background-color: white">   0      public boolean isDirectionRTL() {</span><br>  1328-&gt;1280:  <span style="background-color: white">   0      	return isIdent(CSSName.DIRECTION, IdentValue.RTL);</span><br>     1329-&gt;N:  <span style="background-color: white">          }</span><br>     1330-&gt;N:  <span style="background-color: white">          </span><br>  1331-&gt;1283:  <span style="background-color: white">   0      public boolean isDirectionAuto() {</span><br>  1332-&gt;1284:  <span style="background-color: white">   0      	return isIdent(CSSName.DIRECTION, IdentValue.AUTO);</span><br>     1333-&gt;N:  <span style="background-color: white">          }</span><br>     1334-&gt;N:  <span style="background-color: white">      </span><br>  1335-&gt;1287:  <span style="background-color: cyan"> 99+  	public IdentValue getDirection() {</span><br>  1336-&gt;1288:  <span style="background-color: cyan"> 99+  		return getIdent(CSSName.DIRECTION);</span><br>     1337-&gt;N:  <span style="background-color: white">      	}</span><br>     1338-&gt;N:  <span style="background-color: white">      	</span><br>  1339-&gt;1291:  <span style="background-color: cyan"> 99+  	public boolean hasLetterSpacing() {</span><br>  1340-&gt;1292:  <span style="background-color: cyan"> 99+  	    return !isIdent(CSSName.LETTER_SPACING, IdentValue.NORMAL);</span><br>     1341-&gt;N:  <span style="background-color: white">      	}</span><br>     1342-&gt;N:  <span style="background-color: white">      	</span><br>  1343-&gt;1295:  <span style="background-color: white"> 99+  	public boolean isParagraphContainerForBidi() {</span><br>  1344-&gt;1296:  <span style="background-color: white"> 99+  		IdentValue display = getIdent(CSSName.DISPLAY);</span><br>     1345-&gt;N:  <span style="background-color: white">      		</span><br>  1346-&gt;1298:  <span style="background-color: white"> 99+  		return (display != IdentValue.INLINE &amp;&amp;</span><br>  1347-&gt;1299:  <span style="background-color: white">      				display != IdentValue.INLINE_BLOCK &amp;&amp;</span><br>  1348-&gt;1300:  <span style="background-color: white">      				display != IdentValue.INLINE_TABLE) ||</span><br>     1349-&gt;N:  <span style="background-color: white">      				isNonFlowContent();</span><br>     1350-&gt;N:  <span style="background-color: white">      	}</span><br>     1351-&gt;N:  <span style="background-color: white">      	</span><br>     1352-&gt;N:  <span style="background-color: white">      	/**</span><br>     1353-&gt;N:  <span style="background-color: white">      	 * @return true for border-box, false for content-box.</span><br>     1354-&gt;N:  <span style="background-color: white">      	 */</span><br>  1355-&gt;1307:  <span style="background-color: cyan"> 99+      public boolean isBorderBox() {</span><br>  1356-&gt;1308:  <span style="background-color: cyan"> 99+          return isIdent(CSSName.BOX_SIZING, IdentValue.BORDER_BOX);</span><br>     1357-&gt;N:  <span style="background-color: white">          }</span><br>     1358-&gt;N:  <span style="background-color: white">      	</span><br>     1359-&gt;N:  <span style="background-color: white">      	/**</span><br>     1360-&gt;N:  <span style="background-color: white">      	 * Aims to get the correct resolved max-width for a box in dots unit.</span><br>     1361-&gt;N:  <span style="background-color: white">      	 * Returns -1 if there is no max-width defined.</span><br>     1362-&gt;N:  <span style="background-color: white">      	 * Assumptions: box has a containing block.</span><br>     1363-&gt;N:  <span style="background-color: white">      	 */</span><br>  1364-&gt;1316:  <span style="background-color: white"> 99+  	public static int getCSSMaxWidth(CssContext c, Box box) {</span><br>  1365-&gt;1317:  <span style="background-color: white"> 99+  		if (box.getStyle().isMaxWidthNone()) {</span><br>  1366-&gt;1318:  <span style="background-color: white"> 99+  			return -1;</span><br>     1367-&gt;N:  <span style="background-color: white">      		}</span><br>     1368-&gt;N:  <span style="background-color: white">      		</span><br>  1369-&gt;1321:  <span style="background-color: white">  33  	    return box.getStyle().getMaxWidth(c, box.getContainingBlock().getContentWidth());</span><br>     1370-&gt;N:  <span style="background-color: white">      	}</span><br>     1371-&gt;N:  <span style="background-color: white">      </span><br>     1372-&gt;N:  <span style="background-color: white">      	/**</span><br>     1373-&gt;N:  <span style="background-color: white">      	 * Aims to get the correct resolved max-height for a box in dots unit.</span><br>     1374-&gt;N:  <span style="background-color: white">      	 * returns -1 if there is no max-height defined.</span><br>     1375-&gt;N:  <span style="background-color: white">      	 * Assumptions: box has a containing block.</span><br>     1376-&gt;N:  <span style="background-color: white">      	 */</span><br>  1377-&gt;1329:  <span style="background-color: white"> 99+  	public static int getCSSMaxHeight(CssContext c, Box box) {</span><br>  1378-&gt;1330:  <span style="background-color: white"> 99+  		if (box.getStyle().isMaxHeightNone()) {</span><br>  1379-&gt;1331:  <span style="background-color: white"> 99+  			return -1;</span><br>     1380-&gt;N:  <span style="background-color: white">      		}</span><br>     1381-&gt;N:  <span style="background-color: white">      		</span><br>  1382-&gt;1334:  <span style="background-color: white">  17  		Length cssMaxHeight = box.getStyle().asLength(c, CSSName.MAX_HEIGHT);</span><br>     1383-&gt;N:  <span style="background-color: white">      </span><br>     1384-&gt;N:  <span style="background-color: white">      		/* 	MDN says:</span><br>     1385-&gt;N:  <span style="background-color: white">      		 *  The percentage is calculated with respect to the height of the generated box's containing block.</span><br>     1386-&gt;N:  <span style="background-color: white">      		 *  If the height of the containing block is not specified explicitly (i.e., it depends on content height),</span><br>     1387-&gt;N:  <span style="background-color: white">      		 *  and this element is not absolutely positioned, the percentage value is treated as none.*/</span><br>     1388-&gt;N:  <span style="background-color: white">      		</span><br>  1389-&gt;1341:  <span style="background-color: white">  17  		if (cssMaxHeight.isPercent() &amp;&amp;</span><br>  1390-&gt;1342:  <span style="background-color: white">      			box.getContainingBlock().getStyle().hasAbsoluteUnit(CSSName.HEIGHT)) {</span><br>  1391-&gt;1343:  <span style="background-color: white">   4  			return (int) (cssMaxHeight.value() * box.getContainingBlock().getStyle().asLength(c, CSSName.HEIGHT).value() / 100f);</span><br>  1392-&gt;1344:  <span style="background-color: white">  13  		} else if (cssMaxHeight.isPercent()) {</span><br>  1393-&gt;1345:  <span style="background-color: white">   0  			return -1;</span><br>     1394-&gt;N:  <span style="background-color: white">      		} else {</span><br>  1395-&gt;1347:  <span style="background-color: white">  13  			return (int) cssMaxHeight.value();</span><br>     1396-&gt;N:  <span style="background-color: white">      		}</span><br>     1397-&gt;N:  <span style="background-color: white">      	}</span><br>     1398-&gt;N:  <span style="background-color: white">      </span><br>  1399-&gt;1351:  <span style="background-color: cyan"> 99+      public boolean isHasBackground() {</span><br>  1400-&gt;1352:  <span style="background-color: cyan"> 99+          return !isIdent(CSSName.BACKGROUND_COLOR, IdentValue.TRANSPARENT) ||</span><br>     1401-&gt;N:  <span style="background-color: white">                     isHasBackgroundImage();</span><br>     1402-&gt;N:  <span style="background-color: white">          }</span><br>     1403-&gt;N:  <span style="background-color: white">      </span><br>  1404-&gt;1356:  <span style="background-color: cyan"> 99+      public boolean isHasBackgroundImage() {</span><br>  1405-&gt;1357:  <span style="background-color: cyan"> 99+          List
       <propertyvalue>
         backgroundImages = ((ListValue) valueByName(CSSName.BACKGROUND_IMAGE)).getValues();
       </propertyvalue></span><br>     1406-&gt;N:  <span style="background-color: white">      </span><br>  1407-&gt;1359:  <span style="background-color: cyan"> 99+          if (backgroundImages.size() == 1) {</span><br>  1408-&gt;1360:  <span style="background-color: cyan"> 99+              return backgroundImages.get(0).getIdentValue() != IdentValue.NONE;</span><br>     1409-&gt;N:  <span style="background-color: white">              } else {</span><br>  1410-&gt;1362:  <span style="background-color: white">  24              return backgroundImages.stream().anyMatch(val -&gt; val.getIdentValue() != IdentValue.NONE);</span><br>     1411-&gt;N:  <span style="background-color: white">              }</span><br>     1412-&gt;N:  <span style="background-color: white">          }</span><br>     1413-&gt;N:  <span style="background-color: white">      </span><br>     1414-&gt;N:  <span style="background-color: white">          public enum BackgroundImageType {</span><br>     1415-&gt;N:  <span style="background-color: white">              URI, GRADIENT, NONE;</span><br>     1416-&gt;N:  <span style="background-color: white">          }</span><br>     1417-&gt;N:  <span style="background-color: white">      </span><br>     1418-&gt;N:  <span style="background-color: white">          public static class BackgroundContainer {</span><br>  1419-&gt;1371:  <span style="background-color: white">              public BackgroundImageType type;</span><br>  1420-&gt;1372:  <span style="background-color: white">              public PropertyValue imageGradientOrNone;</span><br>     1421-&gt;N:  <span style="background-color: white">      </span><br>  1422-&gt;1374:  <span style="background-color: white">              public BackgroundPosition backgroundPosition;</span><br>  1423-&gt;1375:  <span style="background-color: white">              public BackgroundSize backgroundSize;</span><br>  1424-&gt;1376:  <span style="background-color: white">              public PropertyValue backgroundRepeat;</span><br>     1425-&gt;N:  <span style="background-color: white">          }</span><br>     1426-&gt;N:  <span style="background-color: white">      </span><br>  1427-&gt;1379:  <span style="background-color: cyan"> 99+      public boolean isLinearGradient(PropertyValue value) {</span><br>  1428-&gt;1380:  <span style="background-color: cyan"> 99+          return value.getPropertyValueType() == PropertyValue.VALUE_TYPE_FUNCTION &amp;&amp;</span><br>  1429-&gt;1381:  <span style="background-color: white">                     Objects.equals(value.getFunction().getName(), "linear-gradient");</span><br>     1430-&gt;N:  <span style="background-color: white">          }</span><br>     1431-&gt;N:  <span style="background-color: white">      </span><br>  1432-&gt;1384:  <span style="background-color: white">  19      public FSLinearGradient getLinearGradient(</span><br>  1433-&gt;1385:  <span style="background-color: white">                  PropertyValue value, CssContext cssContext, int boxWidth, int boxHeight) {</span><br>     1434-&gt;N:  <span style="background-color: white">      </span><br>  1435-&gt;1387:  <span style="background-color: white">  19          if (!isLinearGradient(value)) {</span><br>  1436-&gt;1388:  <span style="background-color: white">   0              return null;</span><br>     1437-&gt;N:  <span style="background-color: white">              }</span><br>     1438-&gt;N:  <span style="background-color: white">      </span><br>  1439-&gt;1391:  <span style="background-color: white">  19          return new FSLinearGradient(this, value.getFunction(), boxWidth, boxHeight, cssContext);</span><br>     1440-&gt;N:  <span style="background-color: white">          }</span><br>     1441-&gt;N:  <span style="background-color: white">      </span><br>     1442-&gt;N:  <span style="background-color: white">          /**</span><br>     1443-&gt;N:  <span style="background-color: white">           * Gets the values of the background properties and combines in a list</span><br>     1444-&gt;N:  <span style="background-color: white">           * of BackgroundContainer values.</span><br>     1445-&gt;N:  <span style="background-color: white">           */</span><br>     1446-&gt;N:  <span style="background-color: white"> 99+      @WebDoc(WebDocLocations.CSS_BACKGROUND_PROPERTIES)</span><br>  1447-&gt;1399:  <span style="background-color: white">          public List
       <backgroundcontainer>
         getBackgroundImages() {
       </backgroundcontainer></span><br>  1448-&gt;1400:  <span style="background-color: cyan"> 99+          List
       <propertyvalue>
         images = ((ListValue) valueByName(CSSName.BACKGROUND_IMAGE)).getValues();
       </propertyvalue></span><br>  1449-&gt;1401:  <span style="background-color: cyan"> 99+          List
       <propertyvalue>
         positions = ((ListValue) valueByName(CSSName.BACKGROUND_POSITION)).getValues();
       </propertyvalue></span><br>  1450-&gt;1402:  <span style="background-color: cyan"> 99+          List
       <propertyvalue>
         repeats = ((ListValue) valueByName(CSSName.BACKGROUND_REPEAT)).getValues();
       </propertyvalue></span><br>  1451-&gt;1403:  <span style="background-color: cyan"> 99+          List
       <propertyvalue>
         sizes = ((ListValue) valueByName(CSSName.BACKGROUND_SIZE)).getValues();
       </propertyvalue></span><br>     1452-&gt;N:  <span style="background-color: white">      </span><br>  1453-&gt;1405:  <span style="background-color: cyan"> 99+          assert positions.size() % 2 == 0;</span><br>  1454-&gt;1406:  <span style="background-color: cyan"> 99+          assert sizes.size() % 2 == 0;</span><br>     1455-&gt;N:  <span style="background-color: white">      </span><br>  1456-&gt;1408:  <span style="background-color: cyan"> 99+          List
       <backgroundposition>
         posPairs = new ArrayList&lt;&gt;(positions.size() / 2);
       </backgroundposition></span><br>  1457-&gt;1409:  <span style="background-color: cyan"> 99+          for (int i = 0; i &lt; positions.size(); i += 2) {</span><br>  1458-&gt;1410:  <span style="background-color: cyan"> 99+              posPairs.add(new BackgroundPosition(positions.get(i), positions.get(i + 1)));</span><br>     1459-&gt;N:  <span style="background-color: white">              }</span><br>     1460-&gt;N:  <span style="background-color: white">      </span><br>  1461-&gt;1413:  <span style="background-color: cyan"> 99+          List
       <backgroundsize>
         sizePairs = new ArrayList&lt;&gt;(sizes.size() / 2);
       </backgroundsize></span><br>  1462-&gt;1414:  <span style="background-color: cyan"> 99+          for (int i = 0; i &lt; sizes.size(); i += 2) {</span><br>  1463-&gt;1415:  <span style="background-color: cyan"> 99+              sizePairs.add(new BackgroundSize(sizes.get(i), sizes.get(i + 1)));</span><br>     1464-&gt;N:  <span style="background-color: white">              }</span><br>     1465-&gt;N:  <span style="background-color: white">      </span><br>  1466-&gt;1418:  <span style="background-color: cyan"> 99+          List
       <backgroundcontainer>
         backgrounds = new ArrayList&lt;&gt;(images.size());
       </backgroundcontainer></span><br>     1467-&gt;N:  <span style="background-color: white">      </span><br>  1468-&gt;1420:  <span style="background-color: cyan"> 99+          for (int i = 0; i &lt; images.size(); i++) {</span><br>  1469-&gt;1421:  <span style="background-color: cyan"> 99+              BackgroundContainer bg = new BackgroundContainer();</span><br>  1470-&gt;1422:  <span style="background-color: cyan"> 99+              PropertyValue img = images.get(i);</span><br>     1471-&gt;N:  <span style="background-color: white">      </span><br>  1472-&gt;1424:  <span style="background-color: cyan"> 99+              if (isLinearGradient(img)) {</span><br>  1473-&gt;1425:  <span style="background-color: white">  19                  bg.type = BackgroundImageType.GRADIENT;</span><br>  1474-&gt;1426:  <span style="background-color: cyan"> 99+              } else if (img.getIdentValue() == IdentValue.NONE) {</span><br>  1475-&gt;1427:  <span style="background-color: cyan"> 99+                  bg.type = BackgroundImageType.NONE;</span><br>     1476-&gt;N:  <span style="background-color: white">                  } else {</span><br>  1477-&gt;1429:  <span style="background-color: cyan"> 99+                  bg.type = BackgroundImageType.URI;</span><br>     1478-&gt;N:  <span style="background-color: white">                  }</span><br>     1479-&gt;N:  <span style="background-color: white">      </span><br>  1480-&gt;1432:  <span style="background-color: cyan"> 99+              bg.imageGradientOrNone = img;</span><br>     1481-&gt;N:  <span style="background-color: white">      </span><br>     1482-&gt;N:  <span style="background-color: white">                  // If less background-position values are provided than images,</span><br>     1483-&gt;N:  <span style="background-color: white">                  // they must repeat.</span><br>  1484-&gt;1436:  <span style="background-color: cyan"> 99+              bg.backgroundPosition = posPairs.get(i % posPairs.size());</span><br>  1485-&gt;1437:  <span style="background-color: cyan"> 99+              bg.backgroundSize = sizePairs.get(i % sizePairs.size());</span><br>  1486-&gt;1438:  <span style="background-color: cyan"> 99+              bg.backgroundRepeat = repeats.get(i % repeats.size());</span><br>     1487-&gt;N:  <span style="background-color: white">      </span><br>  1488-&gt;1440:  <span style="background-color: cyan"> 99+              backgrounds.add(bg);</span><br>     1489-&gt;N:  <span style="background-color: white">              }</span><br>     1490-&gt;N:  <span style="background-color: white">      </span><br>     1491-&gt;N:  <span style="background-color: white">              // Pre-reverse the images, from back to front.</span><br>  1492-&gt;1444:  <span style="background-color: cyan"> 99+          Collections.reverse(backgrounds);</span><br>  1493-&gt;1445:  <span style="background-color: cyan"> 99+          return backgrounds;</span><br>     1494-&gt;N:  <span style="background-color: white">          }</span><br>     1495-&gt;N:  <span style="background-color: white">      }</span><br></pre> </code> 
   </div> 
  </div>  
 </body>
</html>