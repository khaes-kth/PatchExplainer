<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <title>Execution Trace Diff</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <style>
* {
  box-sizing: border-box;
}

/* Create two equal columns that floats next to each other */
.column {
  float: left;
  width: 50%;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

.test {
    border: 1px solid darkblue;
    padding-left: 10px;
}
</style> 
 </head> 
 <body> 
  <div class="row test"> 
   <h2>Differencing Test:</h2> <code> <pre>@Test <br>
public void test_main(){ <br>
    String ret = NumberAnalyzer.analyze(1); <br>
    assertThat(ret, containsString("greater")); <br>
}
        </pre> </code> 
  </div> 
  <div class="row"> 
   <div class="column"> 
    <h2>Original Code:</h2> <code> <pre id="original-trace">           1:  <span style="background-color: white">      package com.garbagemule.MobArena.waves.ability;</span><br>           2:  <span style="background-color: white">      </span><br>           3:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ChainLightning;</span><br>           4:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientDistant;</span><br>           5:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientNearby;</span><br>           6:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientTarget;</span><br>           7:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchDistant;</span><br>           8:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchNearby;</span><br>           9:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchTarget;</span><br>          10:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FireAura;</span><br>          11:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.Flood;</span><br>          12:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.LightningAura;</span><br>          13:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.LivingBomb;</span><br>          14:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ObsidianBomb;</span><br>          15:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullDistant;</span><br>          16:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullNearby;</span><br>          17:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullTarget;</span><br>          18:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.RootTarget;</span><br>          19:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ShootArrow;</span><br>          20:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ShootFireball;</span><br>          21:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ShufflePositions;</span><br>          22:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowDistant;</span><br>          23:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowNearby;</span><br>          24:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowTarget;</span><br>          25:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.WarpToPlayer;</span><br>          26:  <span style="background-color: white">      import org.bukkit.Bukkit;</span><br>          27:  <span style="background-color: white">      </span><br>          28:  <span style="background-color: white">      import javax.tools.JavaCompiler;</span><br>          29:  <span style="background-color: white">      import javax.tools.JavaFileObject;</span><br>          30:  <span style="background-color: white">      import javax.tools.StandardJavaFileManager;</span><br>          31:  <span style="background-color: white">      import javax.tools.ToolProvider;</span><br>          32:  <span style="background-color: white">      import java.io.File;</span><br>          33:  <span style="background-color: white">      import java.net.URL;</span><br>          34:  <span style="background-color: white">      import java.net.URLClassLoader;</span><br>          35:  <span style="background-color: white">      import java.util.ArrayList;</span><br>          36:  <span style="background-color: white">      import java.util.Arrays;</span><br>          37:  <span style="background-color: white">      import java.util.HashMap;</span><br>          38:  <span style="background-color: white">      import java.util.List;</span><br>          39:  <span style="background-color: white">      import java.util.Map;</span><br>          40:  <span style="background-color: white">      </span><br>          41:  <span style="background-color: white">      public class AbilityManager</span><br>          42:  <span style="background-color: white">      {</span><br>          43:  <span style="background-color: white">          private static final String ma = "plugins" + File.separator + "MobArena.jar";</span><br>          44:  <span style="background-color: white">          private static final String cb = System.getProperty("java.class.path");</span><br>          45:  <span style="background-color: white">          private static final String classpath = ma + System.getProperty("path.separator") + cb;</span><br>          46:  <span style="background-color: white">      </span><br>          47:  <span style="background-color: white">          private static Map
       <string,class>
        <!--? extends Ability-->&gt; abilities;
       </string,class></span><br>          48:  <span style="background-color: white">      </span><br>          49:  <span style="background-color: white">          /**</span><br>          50:  <span style="background-color: white">           * Get an instance of an ability by alias</span><br>          51:  <span style="background-color: white">           * @param alias the alias of an ability</span><br>          52:  <span style="background-color: white">           * @return a new Ability object, or null</span><br>          53:  <span style="background-color: white">           */</span><br>          54:  <span style="background-color: white">   0      public static Ability getAbility(String alias) {</span><br>          55:  <span style="background-color: white">   0          try {</span><br>          56:  <span style="background-color: white">   0              Class<!--? extends Ability--> cls = abilities.get(alias.toLowerCase().replaceAll("[-_.]", ""));</span><br>          57:  <span style="background-color: white">   0              return cls.newInstance();</span><br>          58:  <span style="background-color: white">              } catch (Exception e) {</span><br>          59:  <span style="background-color: white">   0              return null;</span><br>          60:  <span style="background-color: white">              }</span><br>          61:  <span style="background-color: white">          }</span><br>          62:  <span style="background-color: white">      </span><br>          63:  <span style="background-color: white">          /**</span><br>          64:  <span style="background-color: white">           * Load all the core abilities included in MobArena</span><br>          65:  <span style="background-color: white">           */</span><br>          66:  <span style="background-color: white">   0      public static void loadCoreAbilities() {</span><br>          67:  <span style="background-color: white">   0          if (abilities == null) abilities = new HashMap&lt;&gt;();</span><br>          68:  <span style="background-color: white">      </span><br>          69:  <span style="background-color: white">   0          register(ChainLightning.class);</span><br>          70:  <span style="background-color: white">   0          register(DisorientDistant.class);</span><br>          71:  <span style="background-color: white">   0          register(DisorientNearby.class);</span><br>          72:  <span style="background-color: white">   0          register(DisorientTarget.class);</span><br>          73:  <span style="background-color: white">   0          register(FetchDistant.class);</span><br>          74:  <span style="background-color: white">   0          register(FetchNearby.class);</span><br>          75:  <span style="background-color: white">   0          register(FetchTarget.class);</span><br>          76:  <span style="background-color: white">   0          register(FireAura.class);</span><br>          77:  <span style="background-color: white">   0          register(Flood.class);</span><br>          78:  <span style="background-color: white">   0          register(LightningAura.class);</span><br>          79:  <span style="background-color: white">   0          register(LivingBomb.class);</span><br>          80:  <span style="background-color: white">   0          register(ObsidianBomb.class);</span><br>          81:  <span style="background-color: white">   0          register(PullDistant.class);</span><br>          82:  <span style="background-color: white">   0          register(PullNearby.class);</span><br>          83:  <span style="background-color: white">   0          register(PullTarget.class);</span><br>          84:  <span style="background-color: white">   0          register(RootTarget.class);</span><br>          85:  <span style="background-color: white">   0          register(ShootArrow.class);</span><br>          86:  <span style="background-color: white">   0          register(ShootFireball.class);</span><br>          87:  <span style="background-color: white">   0          register(ShufflePositions.class);</span><br>          88:  <span style="background-color: white">   0          register(ThrowDistant.class);</span><br>          89:  <span style="background-color: white">   0          register(ThrowNearby.class);</span><br>          90:  <span style="background-color: white">   0          register(ThrowTarget.class);</span><br>          91:  <span style="background-color: white">   0          register(WarpToPlayer.class);</span><br>          92:  <span style="background-color: white">          }</span><br>          93:  <span style="background-color: white">      </span><br>          94:  <span style="background-color: white">          /**</span><br>          95:  <span style="background-color: white">           * Load the custom abilities from the specified directory.</span><br>          96:  <span style="background-color: white">           * @param dataDir main plugin data folder</span><br>          97:  <span style="background-color: white">           */</span><br>          98:  <span style="background-color: white">   0      public static void loadCustomAbilities(File dataDir) {</span><br>          99:  <span style="background-color: white">   0          if (abilities == null) abilities = new HashMap&lt;&gt;();</span><br>         100:  <span style="background-color: white">      </span><br>         101:  <span style="background-color: white">   0          File classDir = new File(dataDir, "abilities");</span><br>         102:  <span style="background-color: white">   0          if (!classDir.exists()) {</span><br>         103:  <span style="background-color: white">   0              return;</span><br>         104:  <span style="background-color: white">              }</span><br>         105:  <span style="background-color: white">      </span><br>         106:  <span style="background-color: white">              // Grab the source directory.</span><br>         107:  <span style="background-color: white">   0          File javaDir = new File(classDir, "src");</span><br>         108:  <span style="background-color: white">      </span><br>         109:  <span style="background-color: white">              /* If the source directory exists, we need to verify that the system</span><br>         110:  <span style="background-color: white">               * has a java compiler before attempting anything. If not, we need to</span><br>         111:  <span style="background-color: white">               * skip the compiling step and just go straight to loading in the</span><br>         112:  <span style="background-color: white">               * existing class files. */</span><br>         113:  <span style="background-color: white">   0          if (javaDir.exists()) {</span><br>         114:  <span style="background-color: white">   0              if (ToolProvider.getSystemJavaCompiler() != null) {</span><br>         115:  <span style="background-color: white">   0                  compileAbilities(javaDir, classDir);</span><br>         116:  <span style="background-color: white">                  } else {</span><br>         117:  <span style="background-color: white">   0                  Bukkit.getLogger().warning("[MobArena] Found plugins/MobArena/abilities/src/ folder, but no Java compiler. The source files will not be compiled!");</span><br>         118:  <span style="background-color: white">                  }</span><br>         119:  <span style="background-color: white">              }</span><br>         120:  <span style="background-color: white">      </span><br>         121:  <span style="background-color: white">              // Load all the custom abilities.</span><br>         122:  <span style="background-color: white">   0          loadClasses(classDir);</span><br>         123:  <span style="background-color: white">          }</span><br>         124:  <span style="background-color: white">      </span><br>         125:  <span style="background-color: white">   0      private static void register(Class<!--? extends Ability--> cls) {</span><br>         126:  <span style="background-color: white">   0          register(cls, false);</span><br>         127:  <span style="background-color: white">          }</span><br>         128:  <span style="background-color: white">      </span><br>         129:  <span style="background-color: white">          /**</span><br>         130:  <span style="background-color: white">           * Register an ability by its class object</span><br>         131:  <span style="background-color: white">           * @param cls the ability class</span><br>         132:  <span style="background-color: white">           */</span><br>         133:  <span style="background-color: white">   0      private static void register(Class<!--? extends Ability--> cls, boolean announce) {</span><br>         134:  <span style="background-color: white">   0          AbilityInfo info = cls.getAnnotation(AbilityInfo.class);</span><br>         135:  <span style="background-color: white">   0          if (info == null) return;</span><br>         136:  <span style="background-color: white">      </span><br>         137:  <span style="background-color: white">              // Map all the aliases</span><br>         138:  <span style="background-color: white">   0          for (String alias : info.aliases()) {</span><br>         139:  <span style="background-color: white">   0              abilities.put(alias, cls);</span><br>         140:  <span style="background-color: white">              }</span><br>         141:  <span style="background-color: white">      </span><br>         142:  <span style="background-color: white">              // Announce custom abilities</span><br>         143:  <span style="background-color: white">   0          if (announce) Bukkit.getLogger().info("[MobArena] Loaded custom ability '" + info.name() + "'");</span><br>         144:  <span style="background-color: white">          }</span><br>         145:  <span style="background-color: white">      </span><br>         146:  <span style="background-color: white">   0      private static void compileAbilities(File javaDir, File classDir) {</span><br>         147:  <span style="background-color: white">   0          if (!javaDir.exists()) return;</span><br>         148:  <span style="background-color: white">      </span><br>         149:  <span style="background-color: white">              // Make ready a new list of files to compile.</span><br>         150:  <span style="background-color: white">   0          List
       <file>
         toCompile = getSourceFilesToCompile(javaDir, classDir);
       </file></span><br>         151:  <span style="background-color: white">      </span><br>         152:  <span style="background-color: white">              // No files to compile?</span><br>         153:  <span style="background-color: white">   0          if (toCompile.isEmpty()) {</span><br>         154:  <span style="background-color: white">   0              return;</span><br>         155:  <span style="background-color: white">              }</span><br>         156:  <span style="background-color: white">      </span><br>         157:  <span style="background-color: white">              // Notify the console.</span><br>         158:  <span style="background-color: white">   0          Bukkit.getLogger().info("[MobArena] Compiling abilities: " + fileListToString(toCompile));</span><br>         159:  <span style="background-color: white">      </span><br>         160:  <span style="background-color: white">              // Get the compiler</span><br>         161:  <span style="background-color: white">   0          JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();</span><br>         162:  <span style="background-color: white">   0          StandardJavaFileManager fileManager = compiler.getStandardFileManager(null, null, null);</span><br>         163:  <span style="background-color: white">      </span><br>         164:  <span style="background-color: white">              // Generate some JavaFileObjects</span><br>         165:  <span style="background-color: white">   0          try {</span><br>         166:  <span style="background-color: white">   0              Iterable<!--? extends JavaFileObject--> compilationUnits = fileManager.getJavaFileObjectsFromFiles(toCompile);</span><br>         167:  <span style="background-color: white">      </span><br>         168:  <span style="background-color: white">                  // Include the MobArena.jar on the classpath, and set the destination folder.</span><br>         169:  <span style="background-color: white">   0              List
       <string>
         options = Arrays.asList("-classpath", classpath, "-d", classDir.getPath());
       </string></span><br>         170:  <span style="background-color: white">      </span><br>         171:  <span style="background-color: white">                  // Set up the compilation task.</span><br>         172:  <span style="background-color: white">   0              JavaCompiler.CompilationTask task = compiler.getTask(null, fileManager, null, options, null, compilationUnits);</span><br>         173:  <span style="background-color: white">      </span><br>         174:  <span style="background-color: white">                  // Call the task.</span><br>         175:  <span style="background-color: white">   0              task.call();</span><br>         176:  <span style="background-color: white">      </span><br>         177:  <span style="background-color: white">                  // And close the file manager.</span><br>         178:  <span style="background-color: white">   0              fileManager.close();</span><br>         179:  <span style="background-color: white">              }</span><br>         180:  <span style="background-color: white">              catch (Exception e) {</span><br>         181:  <span style="background-color: white">   0              Bukkit.getLogger().severe("[MobArena] Compilation step failed...");</span><br>         182:  <span style="background-color: white">   0              e.printStackTrace();</span><br>         183:  <span style="background-color: white">              }</span><br>         184:  <span style="background-color: white">          }</span><br>         185:  <span style="background-color: white">      </span><br>         186:  <span style="background-color: white">   0      private static List
       <file>
         getSourceFilesToCompile(File javaDir, File classDir) {
       </file></span><br>         187:  <span style="background-color: white">   0          List
       <file>
         result = new ArrayList&lt;&gt;();
       </file></span><br>         188:  <span style="background-color: white">      </span><br>         189:  <span style="background-color: white">   0          if (javaDir == null || !javaDir.exists()) {</span><br>         190:  <span style="background-color: white">   0              return result;</span><br>         191:  <span style="background-color: white">              }</span><br>         192:  <span style="background-color: white">      </span><br>         193:  <span style="background-color: white">              // Grab the array of compiled files.</span><br>         194:  <span style="background-color: white">   0          File[] classFiles = classDir.listFiles();</span><br>         195:  <span style="background-color: white">      </span><br>         196:  <span style="background-color: white">              // Go through each source file.</span><br>         197:  <span style="background-color: white">   0          for (File javaFile : javaDir.listFiles()) {</span><br>         198:  <span style="background-color: white">                  // Skip if it's not a .java file.</span><br>         199:  <span style="background-color: white">   0              if (!javaFile.getName().endsWith(".java")) {</span><br>         200:  <span style="background-color: white">   0                  Bukkit.getLogger().info("[MobArena] Found invalid ability file: " + javaFile.getName());</span><br>         201:  <span style="background-color: white">   0                  continue;</span><br>         202:  <span style="background-color: white">                  }</span><br>         203:  <span style="background-color: white">      </span><br>         204:  <span style="background-color: white">                  // Find the associated .class file.</span><br>         205:  <span style="background-color: white">   0              File classFile = findClassFile(javaFile, classFiles);</span><br>         206:  <span style="background-color: white">      </span><br>         207:  <span style="background-color: white">                  // If the .class file is newer, we don't need to compile.</span><br>         208:  <span style="background-color: white">   0              if (isClassFileNewer(javaFile, classFile)) {</span><br>         209:  <span style="background-color: white">   0                  continue;</span><br>         210:  <span style="background-color: white">                  }</span><br>         211:  <span style="background-color: white">   0              result.add(javaFile);</span><br>         212:  <span style="background-color: white">              }</span><br>         213:  <span style="background-color: white">      </span><br>         214:  <span style="background-color: white">   0          return result;</span><br>         215:  <span style="background-color: white">          }</span><br>         216:  <span style="background-color: white">      </span><br>         217:  <span style="background-color: white">   0      private static File findClassFile(File javaFile, File[] classFiles) {</span><br>         218:  <span style="background-color: white">   0          String javaFileName = javaFile.getName();</span><br>         219:  <span style="background-color: white">   0          String classFileName = javaFileName.substring(0, javaFileName.lastIndexOf(".")) + ".class";</span><br>         220:  <span style="background-color: white">      </span><br>         221:  <span style="background-color: white">   0          for (File classFile : classFiles) {</span><br>         222:  <span style="background-color: white">   0              if (classFile.getName().equals(classFileName)) {</span><br>         223:  <span style="background-color: white">   0                  return classFile;</span><br>         224:  <span style="background-color: white">                  }</span><br>         225:  <span style="background-color: white">              }</span><br>         226:  <span style="background-color: white">   0          return null;</span><br>         227:  <span style="background-color: white">          }</span><br>         228:  <span style="background-color: white">      </span><br>         229:  <span style="background-color: white">   0      private static boolean isClassFileNewer(File javaFile, File classFile) {</span><br>         230:  <span style="background-color: white">   0          if (classFile == null) return false;</span><br>         231:  <span style="background-color: white">      </span><br>         232:  <span style="background-color: white">   0          return (classFile.lastModified() &gt; javaFile.lastModified());</span><br>         233:  <span style="background-color: white">          }</span><br>         234:  <span style="background-color: white">      </span><br>         235:  <span style="background-color: white">          /**</span><br>         236:  <span style="background-color: white">           * (Compiles and) loads all custom abilities in the given directory.</span><br>         237:  <span style="background-color: white">           * @param classDir a directory</span><br>         238:  <span style="background-color: white">           */</span><br>         239:  <span style="background-color: white">   0      private static void loadClasses(File classDir) {</span><br>         240:  <span style="background-color: white">              // Grab the class loader</span><br>         241:  <span style="background-color: white">   0          ClassLoader loader = getLoader(classDir);</span><br>         242:  <span style="background-color: white">   0          if (loader == null) return;</span><br>         243:  <span style="background-color: white">      </span><br>         244:  <span style="background-color: white">   0          for (File file : classDir.listFiles()) {</span><br>         245:  <span style="background-color: white">   0              String filename = file.getName();</span><br>         246:  <span style="background-color: white">      </span><br>         247:  <span style="background-color: white">                  // Only load .class files.</span><br>         248:  <span style="background-color: white">   0              int dot = filename.lastIndexOf(".class");</span><br>         249:  <span style="background-color: white">   0              if (dot &lt; 0) continue;</span><br>         250:  <span style="background-color: white">      </span><br>         251:  <span style="background-color: white">                  // Trim off the .class extension</span><br>         252:  <span style="background-color: white">   0              String name = filename.substring(0, file.getName().lastIndexOf("."));</span><br>         253:  <span style="background-color: white">      </span><br>         254:  <span style="background-color: white">   0              try {</span><br>         255:  <span style="background-color: white">                      // Load the class</span><br>         256:  <span style="background-color: white">   0                  Class<!--?--> cls = loader.loadClass(name);</span><br>         257:  <span style="background-color: white">      </span><br>         258:  <span style="background-color: white">                      // Verify that it's an Ability, then register it</span><br>         259:  <span style="background-color: white">   0                  if (Ability.class.isAssignableFrom(cls)) {</span><br>         260:  <span style="background-color: white">   0                      register(cls.asSubclass(Ability.class), true);</span><br>         261:  <span style="background-color: white">                      }</span><br>         262:  <span style="background-color: white">                  } catch (Exception e) {}</span><br>         263:  <span style="background-color: white">              }</span><br>         264:  <span style="background-color: white">          }</span><br>         265:  <span style="background-color: white">      </span><br>         266:  <span style="background-color: white">          /**</span><br>         267:  <span style="background-color: white">           * Get a ClassLoader for the given directory.</span><br>         268:  <span style="background-color: white">           * @param dir a directory</span><br>         269:  <span style="background-color: white">           * @return a ClassLoader, or null</span><br>         270:  <span style="background-color: white">           */</span><br>         271:  <span style="background-color: white">   0      private static ClassLoader getLoader(File dir) {</span><br>         272:  <span style="background-color: white">   0          try {</span><br>         273:  <span style="background-color: white">   0              ClassLoader loader = new URLClassLoader(new URL[] { dir.toURI().toURL() }, Ability.class.getClassLoader());</span><br>         274:  <span style="background-color: white">   0              return loader;</span><br>         275:  <span style="background-color: white">              }</span><br>         276:  <span style="background-color: white">              catch (Exception e) {}</span><br>         277:  <span style="background-color: white">      </span><br>         278:  <span style="background-color: white">   0          return null;</span><br>         279:  <span style="background-color: white">          }</span><br>         280:  <span style="background-color: white">      </span><br>         281:  <span style="background-color: white">   0      private static String fileListToString(List
       <file>
         list) {
       </file></span><br>         282:  <span style="background-color: white">   0          return fileListToString(list, null);</span><br>         283:  <span style="background-color: white">          }</span><br>         284:  <span style="background-color: white">      </span><br>         285:  <span style="background-color: white">   0      private static String fileListToString(List
       <file>
         list, String exclude) {
       </file></span><br>         286:  <span style="background-color: white">   0          if (list.isEmpty()) return "";</span><br>         287:  <span style="background-color: white">      </span><br>         288:  <span style="background-color: white">   0          StringBuffer buffy = new StringBuffer();</span><br>         289:  <span style="background-color: white">      </span><br>         290:  <span style="background-color: white">   0          for (File file : list) {</span><br>         291:  <span style="background-color: white">   0              String name = file.getName();</span><br>         292:  <span style="background-color: white">   0              int dot = name.lastIndexOf(".");</span><br>         293:  <span style="background-color: white">      </span><br>         294:  <span style="background-color: white">   0              if (exclude != null &amp;&amp; name.contains(exclude)) {</span><br>         295:  <span style="background-color: white">   0                  continue;</span><br>         296:  <span style="background-color: white">                  }</span><br>         297:  <span style="background-color: white">      </span><br>         298:  <span style="background-color: white">   0              buffy.append(", " + name.substring(0, dot));</span><br>         299:  <span style="background-color: white">              }</span><br>         300:  <span style="background-color: white">      </span><br>         301:  <span style="background-color: white">              // Trim off the first ", ".</span><br>         302:  <span style="background-color: white">   0          return buffy.substring(2);</span><br>         303:  <span style="background-color: white">          }</span><br>         304:  <span style="background-color: white">      }</span><br></pre> </code> 
   </div> 
   <div class="column"> 
    <h2>Patched Code:</h2> <code> <pre id="patched-trace">        1-&gt;N:  <span style="background-color: white">      package com.garbagemule.MobArena.waves.ability;</span><br>        2-&gt;N:  <span style="background-color: white">      </span><br>        3-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ChainLightning;</span><br>        4-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientAll;</span><br>        5-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientDistant;</span><br>        6-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientNearby;</span><br>        7-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.DisorientTarget;</span><br>        8-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchAll;</span><br>        9-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchDistant;</span><br>       10-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchNearby;</span><br>       11-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FetchTarget;</span><br>       12-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.FireAura;</span><br>       13-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.Flood;</span><br>       14-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.LightningAura;</span><br>       15-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.LivingBomb;</span><br>       16-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ObsidianBomb;</span><br>       17-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullAll;</span><br>       18-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullDistant;</span><br>       19-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullNearby;</span><br>       20-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.PullTarget;</span><br>       21-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.RootTarget;</span><br>       22-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ShootArrow;</span><br>       23-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ShootFireball;</span><br>       24-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ShufflePositions;</span><br>       25-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowAll;</span><br>       26-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowDistant;</span><br>       27-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowNearby;</span><br>       28-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.ThrowTarget;</span><br>       29-&gt;N:  <span style="background-color: white">      import com.garbagemule.MobArena.waves.ability.core.WarpToPlayer;</span><br>       30-&gt;N:  <span style="background-color: white">      import org.bukkit.Bukkit;</span><br>       31-&gt;N:  <span style="background-color: white">      </span><br>       32-&gt;N:  <span style="background-color: white">      import javax.tools.JavaCompiler;</span><br>       33-&gt;N:  <span style="background-color: white">      import javax.tools.JavaFileObject;</span><br>       34-&gt;N:  <span style="background-color: white">      import javax.tools.StandardJavaFileManager;</span><br>       35-&gt;N:  <span style="background-color: white">      import javax.tools.ToolProvider;</span><br>       36-&gt;N:  <span style="background-color: white">      import java.io.File;</span><br>       37-&gt;N:  <span style="background-color: white">      import java.net.URL;</span><br>       38-&gt;N:  <span style="background-color: white">      import java.net.URLClassLoader;</span><br>       39-&gt;N:  <span style="background-color: white">      import java.util.ArrayList;</span><br>       40-&gt;N:  <span style="background-color: white">      import java.util.Arrays;</span><br>       41-&gt;N:  <span style="background-color: white">      import java.util.HashMap;</span><br>       42-&gt;N:  <span style="background-color: white">      import java.util.List;</span><br>       43-&gt;N:  <span style="background-color: white">      import java.util.Map;</span><br>       44-&gt;N:  <span style="background-color: white">      </span><br>       45-&gt;N:  <span style="background-color: white">      public class AbilityManager</span><br>       46-&gt;N:  <span style="background-color: white">      {</span><br>      47-&gt;43:  <span style="background-color: white">          private static final String ma = "plugins" + File.separator + "MobArena.jar";</span><br>      48-&gt;44:  <span style="background-color: white">          private static final String cb = System.getProperty("java.class.path");</span><br>      49-&gt;45:  <span style="background-color: white">          private static final String classpath = ma + System.getProperty("path.separator") + cb;</span><br>       50-&gt;N:  <span style="background-color: white">      </span><br>      51-&gt;47:  <span style="background-color: white">          private static Map
       <string,class>
        <!--? extends Ability-->&gt; abilities;
       </string,class></span><br>       52-&gt;N:  <span style="background-color: white">      </span><br>       53-&gt;N:  <span style="background-color: white">          /**</span><br>       54-&gt;N:  <span style="background-color: white">           * Get an instance of an ability by alias</span><br>       55-&gt;N:  <span style="background-color: white">           * @param alias the alias of an ability</span><br>       56-&gt;N:  <span style="background-color: white">           * @return a new Ability object, or null</span><br>       57-&gt;N:  <span style="background-color: white">           */</span><br>      58-&gt;54:  <span style="background-color: white">   0      public static Ability getAbility(String alias) {</span><br>       59-&gt;N:  <span style="background-color: white">   0          try {</span><br>      60-&gt;56:  <span style="background-color: white">   0              Class<!--? extends Ability--> cls = abilities.get(alias.toLowerCase().replaceAll("[-_.]", ""));</span><br>      61-&gt;57:  <span style="background-color: white">   0              return cls.newInstance();</span><br>      62-&gt;58:  <span style="background-color: white">              } catch (Exception e) {</span><br>      63-&gt;59:  <span style="background-color: white">   0              return null;</span><br>       64-&gt;N:  <span style="background-color: white">              }</span><br>       65-&gt;N:  <span style="background-color: white">          }</span><br>       66-&gt;N:  <span style="background-color: white">      </span><br>       67-&gt;N:  <span style="background-color: white">          /**</span><br>       68-&gt;N:  <span style="background-color: white">           * Load all the core abilities included in MobArena</span><br>       69-&gt;N:  <span style="background-color: white">           */</span><br>      70-&gt;66:  <span style="background-color: white">   0      public static void loadCoreAbilities() {</span><br>      71-&gt;67:  <span style="background-color: white">   0          if (abilities == null) abilities = new HashMap&lt;&gt;();</span><br>       72-&gt;N:  <span style="background-color: white">      </span><br>       73-&gt;N:  <span style="background-color: white">   0          register(ChainLightning.class);</span><br>       74-&gt;U:  <span style="background-color: yellow">   0          register(DisorientAll.class);</span><br>       75-&gt;N:  <span style="background-color: white">   0          register(DisorientDistant.class);</span><br>       76-&gt;N:  <span style="background-color: white">   0          register(DisorientNearby.class);</span><br>       77-&gt;N:  <span style="background-color: white">   0          register(DisorientTarget.class);</span><br>       78-&gt;U:  <span style="background-color: yellow">   0          register(FetchAll.class);</span><br>       79-&gt;N:  <span style="background-color: white">   0          register(FetchDistant.class);</span><br>       80-&gt;N:  <span style="background-color: white">   0          register(FetchNearby.class);</span><br>       81-&gt;N:  <span style="background-color: white">   0          register(FetchTarget.class);</span><br>       82-&gt;N:  <span style="background-color: white">   0          register(FireAura.class);</span><br>       83-&gt;N:  <span style="background-color: white">   0          register(Flood.class);</span><br>       84-&gt;N:  <span style="background-color: white">   0          register(LightningAura.class);</span><br>       85-&gt;N:  <span style="background-color: white">   0          register(LivingBomb.class);</span><br>       86-&gt;N:  <span style="background-color: white">   0          register(ObsidianBomb.class);</span><br>       87-&gt;U:  <span style="background-color: yellow">   0          register(PullAll.class);</span><br>       88-&gt;N:  <span style="background-color: white">   0          register(PullDistant.class);</span><br>       89-&gt;N:  <span style="background-color: white">   0          register(PullNearby.class);</span><br>       90-&gt;N:  <span style="background-color: white">   0          register(PullTarget.class);</span><br>       91-&gt;N:  <span style="background-color: white">   0          register(RootTarget.class);</span><br>       92-&gt;N:  <span style="background-color: white">   0          register(ShootArrow.class);</span><br>       93-&gt;N:  <span style="background-color: white">   0          register(ShootFireball.class);</span><br>       94-&gt;N:  <span style="background-color: white">   0          register(ShufflePositions.class);</span><br>       95-&gt;U:  <span style="background-color: yellow">   0          register(ThrowAll.class);</span><br>       96-&gt;N:  <span style="background-color: white">   0          register(ThrowDistant.class);</span><br>       97-&gt;N:  <span style="background-color: white">   0          register(ThrowNearby.class);</span><br>       98-&gt;N:  <span style="background-color: white">   0          register(ThrowTarget.class);</span><br>       99-&gt;N:  <span style="background-color: white">   0          register(WarpToPlayer.class);</span><br>      100-&gt;N:  <span style="background-color: white">          }</span><br>      101-&gt;N:  <span style="background-color: white">      </span><br>      102-&gt;N:  <span style="background-color: white">          /**</span><br>      103-&gt;N:  <span style="background-color: white">           * Load the custom abilities from the specified directory.</span><br>      104-&gt;N:  <span style="background-color: white">           * @param dataDir main plugin data folder</span><br>      105-&gt;N:  <span style="background-color: white">           */</span><br>     106-&gt;98:  <span style="background-color: white">   0      public static void loadCustomAbilities(File dataDir) {</span><br>     107-&gt;99:  <span style="background-color: white">   0          if (abilities == null) abilities = new HashMap&lt;&gt;();</span><br>      108-&gt;N:  <span style="background-color: white">      </span><br>    109-&gt;101:  <span style="background-color: white">   0          File classDir = new File(dataDir, "abilities");</span><br>    110-&gt;102:  <span style="background-color: white">   0          if (!classDir.exists()) {</span><br>    111-&gt;103:  <span style="background-color: white">   0              return;</span><br>      112-&gt;N:  <span style="background-color: white">              }</span><br>      113-&gt;N:  <span style="background-color: white">      </span><br>      114-&gt;N:  <span style="background-color: white">              // Grab the source directory.</span><br>    115-&gt;107:  <span style="background-color: white">   0          File javaDir = new File(classDir, "src");</span><br>      116-&gt;N:  <span style="background-color: white">      </span><br>      117-&gt;N:  <span style="background-color: white">              /* If the source directory exists, we need to verify that the system</span><br>      118-&gt;N:  <span style="background-color: white">               * has a java compiler before attempting anything. If not, we need to</span><br>      119-&gt;N:  <span style="background-color: white">               * skip the compiling step and just go straight to loading in the</span><br>      120-&gt;N:  <span style="background-color: white">               * existing class files. */</span><br>    121-&gt;113:  <span style="background-color: white">   0          if (javaDir.exists()) {</span><br>    122-&gt;114:  <span style="background-color: white">   0              if (ToolProvider.getSystemJavaCompiler() != null) {</span><br>    123-&gt;115:  <span style="background-color: white">   0                  compileAbilities(javaDir, classDir);</span><br>      124-&gt;N:  <span style="background-color: white">                  } else {</span><br>    125-&gt;117:  <span style="background-color: white">   0                  Bukkit.getLogger().warning("[MobArena] Found plugins/MobArena/abilities/src/ folder, but no Java compiler. The source files will not be compiled!");</span><br>      126-&gt;N:  <span style="background-color: white">                  }</span><br>      127-&gt;N:  <span style="background-color: white">              }</span><br>      128-&gt;N:  <span style="background-color: white">      </span><br>      129-&gt;N:  <span style="background-color: white">              // Load all the custom abilities.</span><br>    130-&gt;122:  <span style="background-color: white">   0          loadClasses(classDir);</span><br>      131-&gt;N:  <span style="background-color: white">          }</span><br>      132-&gt;N:  <span style="background-color: white">      </span><br>    133-&gt;125:  <span style="background-color: white">   0      private static void register(Class<!--? extends Ability--> cls) {</span><br>    134-&gt;126:  <span style="background-color: white">   0          register(cls, false);</span><br>      135-&gt;N:  <span style="background-color: white">          }</span><br>      136-&gt;N:  <span style="background-color: white">      </span><br>      137-&gt;N:  <span style="background-color: white">          /**</span><br>      138-&gt;N:  <span style="background-color: white">           * Register an ability by its class object</span><br>      139-&gt;N:  <span style="background-color: white">           * @param cls the ability class</span><br>      140-&gt;N:  <span style="background-color: white">           */</span><br>    141-&gt;133:  <span style="background-color: white">   0      private static void register(Class<!--? extends Ability--> cls, boolean announce) {</span><br>    142-&gt;134:  <span style="background-color: white">   0          AbilityInfo info = cls.getAnnotation(AbilityInfo.class);</span><br>    143-&gt;135:  <span style="background-color: white">   0          if (info == null) return;</span><br>      144-&gt;N:  <span style="background-color: white">      </span><br>      145-&gt;N:  <span style="background-color: white">              // Map all the aliases</span><br>    146-&gt;138:  <span style="background-color: white">   0          for (String alias : info.aliases()) {</span><br>    147-&gt;139:  <span style="background-color: white">   0              abilities.put(alias, cls);</span><br>      148-&gt;N:  <span style="background-color: white">              }</span><br>      149-&gt;N:  <span style="background-color: white">      </span><br>      150-&gt;N:  <span style="background-color: white">              // Announce custom abilities</span><br>    151-&gt;143:  <span style="background-color: white">   0          if (announce) Bukkit.getLogger().info("[MobArena] Loaded custom ability '" + info.name() + "'");</span><br>      152-&gt;N:  <span style="background-color: white">          }</span><br>      153-&gt;N:  <span style="background-color: white">      </span><br>    154-&gt;146:  <span style="background-color: white">   0      private static void compileAbilities(File javaDir, File classDir) {</span><br>    155-&gt;147:  <span style="background-color: white">   0          if (!javaDir.exists()) return;</span><br>      156-&gt;N:  <span style="background-color: white">      </span><br>      157-&gt;N:  <span style="background-color: white">              // Make ready a new list of files to compile.</span><br>    158-&gt;150:  <span style="background-color: white">   0          List
       <file>
         toCompile = getSourceFilesToCompile(javaDir, classDir);
       </file></span><br>      159-&gt;N:  <span style="background-color: white">      </span><br>      160-&gt;N:  <span style="background-color: white">              // No files to compile?</span><br>    161-&gt;153:  <span style="background-color: white">   0          if (toCompile.isEmpty()) {</span><br>    162-&gt;154:  <span style="background-color: white">   0              return;</span><br>      163-&gt;N:  <span style="background-color: white">              }</span><br>      164-&gt;N:  <span style="background-color: white">      </span><br>      165-&gt;N:  <span style="background-color: white">              // Notify the console.</span><br>    166-&gt;158:  <span style="background-color: white">   0          Bukkit.getLogger().info("[MobArena] Compiling abilities: " + fileListToString(toCompile));</span><br>      167-&gt;N:  <span style="background-color: white">      </span><br>      168-&gt;N:  <span style="background-color: white">              // Get the compiler</span><br>    169-&gt;161:  <span style="background-color: white">   0          JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();</span><br>    170-&gt;162:  <span style="background-color: white">   0          StandardJavaFileManager fileManager = compiler.getStandardFileManager(null, null, null);</span><br>      171-&gt;N:  <span style="background-color: white">      </span><br>      172-&gt;N:  <span style="background-color: white">              // Generate some JavaFileObjects</span><br>      173-&gt;N:  <span style="background-color: white">   0          try {</span><br>    174-&gt;166:  <span style="background-color: white">   0              Iterable<!--? extends JavaFileObject--> compilationUnits = fileManager.getJavaFileObjectsFromFiles(toCompile);</span><br>      175-&gt;N:  <span style="background-color: white">      </span><br>      176-&gt;N:  <span style="background-color: white">                  // Include the MobArena.jar on the classpath, and set the destination folder.</span><br>    177-&gt;169:  <span style="background-color: white">   0              List
       <string>
         options = Arrays.asList("-classpath", classpath, "-d", classDir.getPath());
       </string></span><br>      178-&gt;N:  <span style="background-color: white">      </span><br>      179-&gt;N:  <span style="background-color: white">                  // Set up the compilation task.</span><br>    180-&gt;172:  <span style="background-color: white">   0              JavaCompiler.CompilationTask task = compiler.getTask(null, fileManager, null, options, null, compilationUnits);</span><br>      181-&gt;N:  <span style="background-color: white">      </span><br>      182-&gt;N:  <span style="background-color: white">                  // Call the task.</span><br>    183-&gt;175:  <span style="background-color: white">   0              task.call();</span><br>      184-&gt;N:  <span style="background-color: white">      </span><br>      185-&gt;N:  <span style="background-color: white">                  // And close the file manager.</span><br>    186-&gt;178:  <span style="background-color: white">   0              fileManager.close();</span><br>      187-&gt;N:  <span style="background-color: white">              }</span><br>    188-&gt;180:  <span style="background-color: white">              catch (Exception e) {</span><br>    189-&gt;181:  <span style="background-color: white">   0              Bukkit.getLogger().severe("[MobArena] Compilation step failed...");</span><br>    190-&gt;182:  <span style="background-color: white">   0              e.printStackTrace();</span><br>      191-&gt;N:  <span style="background-color: white">              }</span><br>      192-&gt;N:  <span style="background-color: white">          }</span><br>      193-&gt;N:  <span style="background-color: white">      </span><br>    194-&gt;186:  <span style="background-color: white">   0      private static List
       <file>
         getSourceFilesToCompile(File javaDir, File classDir) {
       </file></span><br>    195-&gt;187:  <span style="background-color: white">   0          List
       <file>
         result = new ArrayList&lt;&gt;();
       </file></span><br>      196-&gt;N:  <span style="background-color: white">      </span><br>    197-&gt;189:  <span style="background-color: white">   0          if (javaDir == null || !javaDir.exists()) {</span><br>    198-&gt;190:  <span style="background-color: white">   0              return result;</span><br>      199-&gt;N:  <span style="background-color: white">              }</span><br>      200-&gt;N:  <span style="background-color: white">      </span><br>      201-&gt;N:  <span style="background-color: white">              // Grab the array of compiled files.</span><br>    202-&gt;194:  <span style="background-color: white">   0          File[] classFiles = classDir.listFiles();</span><br>      203-&gt;N:  <span style="background-color: white">      </span><br>      204-&gt;N:  <span style="background-color: white">              // Go through each source file.</span><br>    205-&gt;197:  <span style="background-color: white">   0          for (File javaFile : javaDir.listFiles()) {</span><br>      206-&gt;N:  <span style="background-color: white">                  // Skip if it's not a .java file.</span><br>    207-&gt;199:  <span style="background-color: white">   0              if (!javaFile.getName().endsWith(".java")) {</span><br>    208-&gt;200:  <span style="background-color: white">   0                  Bukkit.getLogger().info("[MobArena] Found invalid ability file: " + javaFile.getName());</span><br>    209-&gt;201:  <span style="background-color: white">   0                  continue;</span><br>      210-&gt;N:  <span style="background-color: white">                  }</span><br>      211-&gt;N:  <span style="background-color: white">      </span><br>      212-&gt;N:  <span style="background-color: white">                  // Find the associated .class file.</span><br>    213-&gt;205:  <span style="background-color: white">   0              File classFile = findClassFile(javaFile, classFiles);</span><br>      214-&gt;N:  <span style="background-color: white">      </span><br>      215-&gt;N:  <span style="background-color: white">                  // If the .class file is newer, we don't need to compile.</span><br>    216-&gt;208:  <span style="background-color: white">   0              if (isClassFileNewer(javaFile, classFile)) {</span><br>    217-&gt;209:  <span style="background-color: white">   0                  continue;</span><br>      218-&gt;N:  <span style="background-color: white">                  }</span><br>    219-&gt;211:  <span style="background-color: white">   0              result.add(javaFile);</span><br>      220-&gt;N:  <span style="background-color: white">              }</span><br>      221-&gt;N:  <span style="background-color: white">      </span><br>    222-&gt;214:  <span style="background-color: white">   0          return result;</span><br>      223-&gt;N:  <span style="background-color: white">          }</span><br>      224-&gt;N:  <span style="background-color: white">      </span><br>    225-&gt;217:  <span style="background-color: white">   0      private static File findClassFile(File javaFile, File[] classFiles) {</span><br>    226-&gt;218:  <span style="background-color: white">   0          String javaFileName = javaFile.getName();</span><br>    227-&gt;219:  <span style="background-color: white">   0          String classFileName = javaFileName.substring(0, javaFileName.lastIndexOf(".")) + ".class";</span><br>      228-&gt;N:  <span style="background-color: white">      </span><br>    229-&gt;221:  <span style="background-color: white">   0          for (File classFile : classFiles) {</span><br>    230-&gt;222:  <span style="background-color: white">   0              if (classFile.getName().equals(classFileName)) {</span><br>    231-&gt;223:  <span style="background-color: white">   0                  return classFile;</span><br>      232-&gt;N:  <span style="background-color: white">                  }</span><br>      233-&gt;N:  <span style="background-color: white">              }</span><br>    234-&gt;226:  <span style="background-color: white">   0          return null;</span><br>      235-&gt;N:  <span style="background-color: white">          }</span><br>      236-&gt;N:  <span style="background-color: white">      </span><br>    237-&gt;229:  <span style="background-color: white">   0      private static boolean isClassFileNewer(File javaFile, File classFile) {</span><br>    238-&gt;230:  <span style="background-color: white">   0          if (classFile == null) return false;</span><br>      239-&gt;N:  <span style="background-color: white">      </span><br>    240-&gt;232:  <span style="background-color: white">   0          return (classFile.lastModified() &gt; javaFile.lastModified());</span><br>      241-&gt;N:  <span style="background-color: white">          }</span><br>      242-&gt;N:  <span style="background-color: white">      </span><br>      243-&gt;N:  <span style="background-color: white">          /**</span><br>      244-&gt;N:  <span style="background-color: white">           * (Compiles and) loads all custom abilities in the given directory.</span><br>      245-&gt;N:  <span style="background-color: white">           * @param classDir a directory</span><br>      246-&gt;N:  <span style="background-color: white">           */</span><br>    247-&gt;239:  <span style="background-color: white">   0      private static void loadClasses(File classDir) {</span><br>      248-&gt;N:  <span style="background-color: white">              // Grab the class loader</span><br>    249-&gt;241:  <span style="background-color: white">   0          ClassLoader loader = getLoader(classDir);</span><br>    250-&gt;242:  <span style="background-color: white">   0          if (loader == null) return;</span><br>      251-&gt;N:  <span style="background-color: white">      </span><br>    252-&gt;244:  <span style="background-color: white">   0          for (File file : classDir.listFiles()) {</span><br>    253-&gt;245:  <span style="background-color: white">   0              String filename = file.getName();</span><br>      254-&gt;N:  <span style="background-color: white">      </span><br>      255-&gt;N:  <span style="background-color: white">                  // Only load .class files.</span><br>    256-&gt;248:  <span style="background-color: white">   0              int dot = filename.lastIndexOf(".class");</span><br>    257-&gt;249:  <span style="background-color: white">   0              if (dot &lt; 0) continue;</span><br>      258-&gt;N:  <span style="background-color: white">      </span><br>      259-&gt;N:  <span style="background-color: white">                  // Trim off the .class extension</span><br>    260-&gt;252:  <span style="background-color: white">   0              String name = filename.substring(0, file.getName().lastIndexOf("."));</span><br>      261-&gt;N:  <span style="background-color: white">      </span><br>      262-&gt;N:  <span style="background-color: white">   0              try {</span><br>      263-&gt;N:  <span style="background-color: white">                      // Load the class</span><br>    264-&gt;256:  <span style="background-color: white">   0                  Class<!--?--> cls = loader.loadClass(name);</span><br>      265-&gt;N:  <span style="background-color: white">      </span><br>      266-&gt;N:  <span style="background-color: white">                      // Verify that it's an Ability, then register it</span><br>    267-&gt;259:  <span style="background-color: white">   0                  if (Ability.class.isAssignableFrom(cls)) {</span><br>    268-&gt;260:  <span style="background-color: white">   0                      register(cls.asSubclass(Ability.class), true);</span><br>      269-&gt;N:  <span style="background-color: white">                      }</span><br>    270-&gt;262:  <span style="background-color: white">                  } catch (Exception e) {}</span><br>      271-&gt;N:  <span style="background-color: white">              }</span><br>      272-&gt;N:  <span style="background-color: white">          }</span><br>      273-&gt;N:  <span style="background-color: white">      </span><br>      274-&gt;N:  <span style="background-color: white">          /**</span><br>      275-&gt;N:  <span style="background-color: white">           * Get a ClassLoader for the given directory.</span><br>      276-&gt;N:  <span style="background-color: white">           * @param dir a directory</span><br>      277-&gt;N:  <span style="background-color: white">           * @return a ClassLoader, or null</span><br>      278-&gt;N:  <span style="background-color: white">           */</span><br>    279-&gt;271:  <span style="background-color: white">   0      private static ClassLoader getLoader(File dir) {</span><br>      280-&gt;N:  <span style="background-color: white">   0          try {</span><br>    281-&gt;273:  <span style="background-color: white">   0              ClassLoader loader = new URLClassLoader(new URL[] { dir.toURI().toURL() }, Ability.class.getClassLoader());</span><br>    282-&gt;274:  <span style="background-color: white">   0              return loader;</span><br>      283-&gt;N:  <span style="background-color: white">              }</span><br>    284-&gt;276:  <span style="background-color: white">              catch (Exception e) {}</span><br>      285-&gt;N:  <span style="background-color: white">      </span><br>    286-&gt;278:  <span style="background-color: white">   0          return null;</span><br>      287-&gt;N:  <span style="background-color: white">          }</span><br>      288-&gt;N:  <span style="background-color: white">      </span><br>    289-&gt;281:  <span style="background-color: white">   0      private static String fileListToString(List
       <file>
         list) {
       </file></span><br>    290-&gt;282:  <span style="background-color: white">   0          return fileListToString(list, null);</span><br>      291-&gt;N:  <span style="background-color: white">          }</span><br>      292-&gt;N:  <span style="background-color: white">      </span><br>    293-&gt;285:  <span style="background-color: white">   0      private static String fileListToString(List
       <file>
         list, String exclude) {
       </file></span><br>    294-&gt;286:  <span style="background-color: white">   0          if (list.isEmpty()) return "";</span><br>      295-&gt;N:  <span style="background-color: white">      </span><br>    296-&gt;288:  <span style="background-color: white">   0          StringBuffer buffy = new StringBuffer();</span><br>      297-&gt;N:  <span style="background-color: white">      </span><br>    298-&gt;290:  <span style="background-color: white">   0          for (File file : list) {</span><br>    299-&gt;291:  <span style="background-color: white">   0              String name = file.getName();</span><br>    300-&gt;292:  <span style="background-color: white">   0              int dot = name.lastIndexOf(".");</span><br>      301-&gt;N:  <span style="background-color: white">      </span><br>    302-&gt;294:  <span style="background-color: white">   0              if (exclude != null &amp;&amp; name.contains(exclude)) {</span><br>    303-&gt;295:  <span style="background-color: white">   0                  continue;</span><br>      304-&gt;N:  <span style="background-color: white">                  }</span><br>      305-&gt;N:  <span style="background-color: white">      </span><br>    306-&gt;298:  <span style="background-color: white">   0              buffy.append(", " + name.substring(0, dot));</span><br>      307-&gt;N:  <span style="background-color: white">              }</span><br>      308-&gt;N:  <span style="background-color: white">      </span><br>      309-&gt;N:  <span style="background-color: white">              // Trim off the first ", ".</span><br>    310-&gt;302:  <span style="background-color: white">   0          return buffy.substring(2);</span><br>      311-&gt;N:  <span style="background-color: white">          }</span><br>      312-&gt;N:  <span style="background-color: white">      }</span><br></pre> </code> 
   </div> 
  </div>  
 </body>
</html>